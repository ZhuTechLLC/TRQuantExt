<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ¬ç¿é‡åŒ– - é‡åŒ–æŠ•èµ„æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root {
            --bg-primary: #0d0d14;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #252540;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --primary: #667eea;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --border: #2a2a4a;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24px;
            background: linear-gradient(135deg, var(--primary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-actions button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
        }
        
        .header-actions button:hover { opacity: 0.9; }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab:hover { color: var(--text-primary); }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        
        .stat-card .icon { font-size: 24px; margin-bottom: 8px; }
        .stat-card .label { color: var(--text-secondary); font-size: 13px; }
        .stat-card .value { font-size: 28px; font-weight: bold; margin-top: 4px; }
        .stat-card .value.success { color: var(--success); }
        .stat-card .value.warning { color: var(--warning); }
        .stat-card .value.info { color: var(--info); }
        
        /* Content Sections */
        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 13px;
        }
        
        tr:hover { background: var(--bg-tertiary); }
        
        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        
        .card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .card-title { font-weight: 600; margin-bottom: 8px; }
        .card-desc { color: var(--text-secondary); font-size: 13px; }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .badge-success { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge-warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .badge-info { background: rgba(59, 130, 246, 0.2); color: var(--info); }
        
        /* Tab Content */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        /* Workflow Steps */
        .workflow-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .workflow-step {
            flex: 1;
            text-align: center;
            padding: 16px;
            position: relative;
        }
        
        .workflow-step::after {
            content: 'â†’';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        .workflow-step:last-child::after { display: none; }
        
        .workflow-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 24px;
        }
        
        .workflow-icon.done { background: var(--success); }
        .workflow-icon.pending { background: var(--bg-tertiary); border: 2px dashed var(--border); }
        
        .workflow-label { font-size: 13px; color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š é‡åŒ–æŠ•èµ„æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h1>
            <div class="header-actions">
                <button onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                <button onclick="openLatestReport()">ğŸ“„ æŸ¥çœ‹æœ€æ–°æŠ¥å‘Š</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="overview">ğŸ“‹ æ¦‚è§ˆ</div>
            <div class="tab" data-tab="astock">ğŸ“ˆ Aè‚¡ç­–ç•¥ç®¡ç†</div>
            <div class="tab" data-tab="strategies">ğŸ ç­–ç•¥ä»£ç </div>
            <div class="tab" data-tab="reports">ğŸ“Š å›æµ‹æŠ¥å‘Š</div>
            <div class="tab" data-tab="docs">ğŸ“„ ç ”ç©¶æ–‡æ¡£</div>
            <div class="tab" data-tab="factors">ğŸ§® å› å­ç ”ç©¶</div>
        </div>
        
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="stats-grid" id="stats-grid">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ”— å¿«é€Ÿå…¥å£</span>
                </div>
                <div class="cards-grid">
                    <div class="card" onclick="switchTab('strategies')">
                        <div class="card-title">ğŸ“ ç­–ç•¥ä»£ç åº“</div>
                        <div class="card-desc">æŸ¥çœ‹æœ¬åœ°ä¸PTradeç­–ç•¥å¹¶ç›´æ¥æ‰“å¼€ä»£ç </div>
                    </div>
                    <div class="card" onclick="switchTab('reports')">
                        <div class="card-title">ğŸ“Š å›æµ‹æŠ¥å‘Šä¸­å¿ƒ</div>
                        <div class="card-desc">æŸ¥çœ‹èšå®½+PTradeå›æµ‹ç»“æœã€æŒ‡æ ‡å¡ç‰‡ä¸åŸå§‹æŠ¥å‘Š</div>
                    </div>
                    <div class="card" onclick="switchTab('factors')">
                        <div class="card-title">ğŸ§® é‡åŒ–å› å­åº“</div>
                        <div class="card-desc">æŒ‰åŠ¨é‡/ä»·å€¼/è´¨é‡/æ³¢åŠ¨åˆ†ç±»ï¼Œæ€»è§ˆæœ€æ–°å› å­é…ç½®</div>
                    </div>
                    <div class="card" onclick="switchTab('docs')">
                        <div class="card-title">ğŸ“„ ç ”ç©¶æ–‡æ¡£é›†</div>
                        <div class="card-desc">æ±‡æ€»å¹³å°ä»‹ç»ã€ç­–ç•¥æ‰‹å†Œç­‰èµ„æ–™</div>
                    </div>
                    <div class="card" onclick="switchTab('astock')">
                        <div class="card-title">ğŸ“ˆ Aè‚¡ç­–ç•¥ç®¡ç†</div>
                        <div class="card-desc">ç®¡ç†å·¥ä½œæµç”Ÿæˆçš„æ•°æ®ã€æŠ¥å‘Šå’Œç­–ç•¥</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Aè‚¡ç­–ç•¥ç®¡ç† Tab -->
        <div id="astock" class="tab-content">
            <!-- å·¥ä½œæµçŠ¶æ€ -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ”„ å·¥ä½œæµç¨‹çŠ¶æ€</span>
                    <button onclick="refreshAstockData()" style="background:var(--primary);color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;">åˆ·æ–°</button>
                </div>
                <div class="workflow-steps" id="workflow-steps">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            
            <!-- å¸‚åœºè¶‹åŠ¿ -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ“ˆ å¸‚åœºè¶‹åŠ¿</span>
                </div>
                <div id="market-trend">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            
            <!-- æŠ•èµ„ä¸»çº¿ -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP20</span>
                </div>
                <div id="mainlines-table">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            
            <!-- å€™é€‰æ±  -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ“¦ å€™é€‰æ± è‚¡ç¥¨</span>
                </div>
                <div id="candidate-pool">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            
            <!-- ç”Ÿæˆçš„æŠ¥å‘Š -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ“„ ç”Ÿæˆçš„æŠ¥å‘Š</span>
                </div>
                <div id="astock-reports">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            
            <!-- ç”Ÿæˆçš„ç­–ç•¥ -->
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ ç”Ÿæˆçš„ç­–ç•¥</span>
                </div>
                <div id="astock-strategies">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- Strategies Tab -->
        <div id="strategies" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ ç­–ç•¥ä»£ç åº“</span>
                </div>
                <div id="strategies-table">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ“Š å›æµ‹æŠ¥å‘Š</span>
                </div>
                <div id="reports-table">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- Docs Tab -->
        <div id="docs" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ“„ ç ”ç©¶æ–‡æ¡£</span>
                </div>
                <div id="docs-table">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- Factors Tab -->
        <div id="factors" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <span class="section-title">ğŸ§® é‡åŒ–å› å­åº“</span>
                </div>
                <div id="factors-table">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.dataset.tab;
                switchTab(tabId);
            });
        });
        
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // åŠ è½½æ•°æ®
            if (tabId === 'astock') loadAstockData();
            else if (tabId === 'strategies') loadStrategies();
            else if (tabId === 'reports') loadReports();
            else if (tabId === 'docs') loadDocs();
            else if (tabId === 'factors') loadFactors();
        }
        
        // åŠ è½½æ¦‚è§ˆæ•°æ®
        async function loadOverview() {
            try {
                const resp = await fetch('/api/overview');
                const data = await resp.json();
                
                document.getElementById('stats-grid').innerHTML = `
                    <div class="stat-card">
                        <div class="icon">ğŸ</div>
                        <div class="label">ç­–ç•¥æ•°é‡</div>
                        <div class="value info">${data.strategy_count || 0}</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ“Š</div>
                        <div class="label">PTradeç­–ç•¥</div>
                        <div class="value success">${data.ptrade_strategies || 0}</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ“„</div>
                        <div class="label">ç´¯è®¡æŠ¥å‘Š</div>
                        <div class="value warning">${data.report_count || 0}</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ”„</div>
                        <div class="label">PTradeå›æµ‹</div>
                        <div class="value info">${data.backtest_count || 0}</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ“ˆ</div>
                        <div class="label">å¹³å‡èƒœç‡</div>
                        <div class="value success">${(data.avg_win_rate || 0).toFixed(0)}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">ğŸ’°</div>
                        <div class="label">å¹³å‡ç›ˆäºæ¯”</div>
                        <div class="value">${(data.avg_profit_loss_ratio || 0).toFixed(2)}</div>
                    </div>
                `;
            } catch (e) {
                console.error('åŠ è½½æ¦‚è§ˆå¤±è´¥:', e);
            }
        }
        
        // åŠ è½½Aè‚¡ç­–ç•¥ç®¡ç†æ•°æ®
        async function loadAstockData() {
            try {
                const resp = await fetch('/api/astock/workflow');
                const result = await resp.json();
                
                if (!result.success) {
                    console.error('åŠ è½½å¤±è´¥:', result.error);
                    return;
                }
                
                const data = result.data;
                
                // å·¥ä½œæµçŠ¶æ€
                const hasData = (arr) => arr && arr.length > 0;
                document.getElementById('workflow-steps').innerHTML = `
                    <div class="workflow-step">
                        <div class="workflow-icon ${data.market_trend.phase !== 'æœªçŸ¥' ? 'done' : 'pending'}">ğŸ“ˆ</div>
                        <div class="workflow-label">å¸‚åœºè¶‹åŠ¿</div>
                    </div>
                    <div class="workflow-step">
                        <div class="workflow-icon ${hasData(data.mainlines) ? 'done' : 'pending'}">ğŸ”¥</div>
                        <div class="workflow-label">æŠ•èµ„ä¸»çº¿</div>
                    </div>
                    <div class="workflow-step">
                        <div class="workflow-icon ${data.candidate_pool.total > 0 ? 'done' : 'pending'}">ğŸ“¦</div>
                        <div class="workflow-label">å€™é€‰æ± </div>
                    </div>
                    <div class="workflow-step">
                        <div class="workflow-icon ${hasData(data.factor_recommendation.factors) ? 'done' : 'pending'}">ğŸ§®</div>
                        <div class="workflow-label">å› å­æ¨è</div>
                    </div>
                `;
                
                // å¸‚åœºè¶‹åŠ¿
                const trend = data.market_trend;
                const scoreColor = trend.score > 50 ? 'var(--success)' : trend.score > 30 ? 'var(--warning)' : 'var(--danger)';
                document.getElementById('market-trend').innerHTML = `
                    <div style="display:flex;gap:20px;flex-wrap:wrap;">
                        <div style="background:var(--bg-tertiary);padding:20px;border-radius:10px;flex:1;min-width:200px;">
                            <div style="color:var(--text-secondary);font-size:13px;">å¸‚åœºé˜¶æ®µ</div>
                            <div style="font-size:24px;font-weight:bold;color:var(--warning);margin-top:8px;">${trend.phase}</div>
                        </div>
                        <div style="background:var(--bg-tertiary);padding:20px;border-radius:10px;flex:1;min-width:200px;">
                            <div style="color:var(--text-secondary);font-size:13px;">ç»¼åˆè¯„åˆ†</div>
                            <div style="font-size:24px;font-weight:bold;color:${scoreColor};margin-top:8px;">${trend.score.toFixed(0)}</div>
                        </div>
                        <div style="background:var(--bg-tertiary);padding:20px;border-radius:10px;flex:1;min-width:200px;">
                            <div style="color:var(--text-secondary);font-size:13px;">çŸ­æœŸè¶‹åŠ¿</div>
                            <div style="font-size:18px;margin-top:8px;">${trend.short_term || '-'}</div>
                        </div>
                        <div style="background:var(--bg-tertiary);padding:20px;border-radius:10px;flex:1;min-width:200px;">
                            <div style="color:var(--text-secondary);font-size:13px;">ä¸­æœŸè¶‹åŠ¿</div>
                            <div style="font-size:18px;margin-top:8px;">${trend.mid_term || '-'}</div>
                        </div>
                    </div>
                `;
                
                // æŠ•èµ„ä¸»çº¿
                if (data.mainlines && data.mainlines.length > 0) {
                    let html = '<table><thead><tr><th>æ’å</th><th>ä¸»çº¿åç§°</th><th>ç»¼åˆè¯„åˆ†</th></tr></thead><tbody>';
                    data.mainlines.slice(0, 20).forEach((m, i) => {
                        html += `<tr><td>#${i+1}</td><td>${m.name}</td><td style="color:var(--success);">${(m.composite_score || 0).toFixed(1)}</td></tr>`;
                    });
                    html += '</tbody></table>';
                    document.getElementById('mainlines-table').innerHTML = html;
                } else {
                    document.getElementById('mainlines-table').innerHTML = '<p style="color:var(--text-secondary);">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆè¿è¡Œå·¥ä½œæµç¨‹</p>';
                }
                
                // å€™é€‰æ± 
                if (data.candidate_pool.stocks && data.candidate_pool.stocks.length > 0) {
                    let html = `<p style="margin-bottom:12px;">å…± <strong>${data.candidate_pool.total}</strong> åªè‚¡ç¥¨</p>`;
                    html += '<table><thead><tr><th>ä»£ç </th><th>åç§°</th><th>æ¥æº</th><th>è¯„åˆ†</th></tr></thead><tbody>';
                    data.candidate_pool.stocks.slice(0, 20).forEach(s => {
                        html += `<tr><td>${s.code}</td><td>${s.name}</td><td>${s.source || '-'}</td><td style="color:var(--success);">${(s.score || s.composite_score || 0).toFixed(1)}</td></tr>`;
                    });
                    html += '</tbody></table>';
                    document.getElementById('candidate-pool').innerHTML = html;
                } else {
                    document.getElementById('candidate-pool').innerHTML = '<p style="color:var(--text-secondary);">æš‚æ— æ•°æ®</p>';
                }
                
                // åŠ è½½æŠ¥å‘Šå’Œç­–ç•¥
                loadAstockReports();
                loadAstockStrategies();
                
            } catch (e) {
                console.error('åŠ è½½Aè‚¡æ•°æ®å¤±è´¥:', e);
            }
        }
        
        async function loadAstockReports() {
            try {
                const resp = await fetch('/api/astock/reports');
                const result = await resp.json();
                
                if (result.success && result.data.length > 0) {
                    let html = '<table><thead><tr><th>æŠ¥å‘Šåç§°</th><th>ç±»å‹</th><th>æ›´æ–°æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';
                    result.data.slice(0, 10).forEach(r => {
                        html += `<tr><td>${r.name}</td><td><span class="badge badge-info">${r.type}</span></td><td>${r.modified}</td><td><a href="${r.url}" target="_blank" style="color:var(--primary);">æŸ¥çœ‹</a></td></tr>`;
                    });
                    html += '</tbody></table>';
                    document.getElementById('astock-reports').innerHTML = html;
                } else {
                    document.getElementById('astock-reports').innerHTML = '<p style="color:var(--text-secondary);">æš‚æ— æŠ¥å‘Š</p>';
                }
            } catch (e) {
                console.error('åŠ è½½æŠ¥å‘Šå¤±è´¥:', e);
            }
        }
        
        async function loadAstockStrategies() {
            try {
                const resp = await fetch('/api/astock/generated_strategies');
                const result = await resp.json();
                
                if (result.success && result.data.length > 0) {
                    let html = '<table><thead><tr><th>ç­–ç•¥åç§°</th><th>æ›´æ–°æ—¶é—´</th><th>å¤§å°</th></tr></thead><tbody>';
                    result.data.slice(0, 10).forEach(s => {
                        html += `<tr><td>${s.name}</td><td>${s.modified}</td><td>${s.size}</td></tr>`;
                    });
                    html += '</tbody></table>';
                    document.getElementById('astock-strategies').innerHTML = html;
                } else {
                    document.getElementById('astock-strategies').innerHTML = '<p style="color:var(--text-secondary);">æš‚æ— ç”Ÿæˆçš„ç­–ç•¥</p>';
                }
            } catch (e) {
                console.error('åŠ è½½ç­–ç•¥å¤±è´¥:', e);
            }
        }
        
        async function loadStrategies() {
            try {
                const resp = await fetch('/api/strategies');
                const data = await resp.json();
                
                let html = '<table><thead><tr><th>ç­–ç•¥åç§°</th><th>æ¥æº</th><th>æ›´æ–°æ—¶é—´</th></tr></thead><tbody>';
                data.forEach(s => {
                    html += `<tr><td>${s.name}</td><td><span class="badge badge-info">${s.source}</span></td><td>${s.modified}</td></tr>`;
                });
                html += '</tbody></table>';
                document.getElementById('strategies-table').innerHTML = html;
            } catch (e) {
                console.error('åŠ è½½ç­–ç•¥å¤±è´¥:', e);
            }
        }
        
        async function loadReports() {
            try {
                const resp = await fetch('/api/reports');
                const data = await resp.json();
                
                let html = '<table><thead><tr><th>æŠ¥å‘Šåç§°</th><th>å¹³å°</th><th>æ›´æ–°æ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';
                data.forEach(r => {
                    html += `<tr><td>${r.name}</td><td><span class="badge badge-success">${r.platform}</span></td><td>${r.modified}</td><td><a href="${r.url}" target="_blank" style="color:var(--primary);">æŸ¥çœ‹</a></td></tr>`;
                });
                html += '</tbody></table>';
                document.getElementById('reports-table').innerHTML = html;
            } catch (e) {
                console.error('åŠ è½½æŠ¥å‘Šå¤±è´¥:', e);
            }
        }
        
        async function loadDocs() {
            try {
                const resp = await fetch('/api/docs');
                const data = await resp.json();
                
                let html = '<table><thead><tr><th>æ–‡æ¡£åç§°</th><th>ç±»å‹</th><th>åˆ†ç±»</th><th>æ“ä½œ</th></tr></thead><tbody>';
                data.forEach(d => {
                    html += `<tr><td>${d.name}</td><td>${d.type}</td><td>${d.category}</td><td><a href="${d.url}" target="_blank" style="color:var(--primary);">æŸ¥çœ‹</a></td></tr>`;
                });
                html += '</tbody></table>';
                document.getElementById('docs-table').innerHTML = html;
            } catch (e) {
                console.error('åŠ è½½æ–‡æ¡£å¤±è´¥:', e);
            }
        }
        
        async function loadFactors() {
            try {
                const resp = await fetch('/api/factors');
                const data = await resp.json();
                
                let html = '';
                data.forEach(category => {
                    html += `<div style="margin-bottom:20px;"><h3 style="margin-bottom:12px;">${category.name}</h3><div class="cards-grid">`;
                    category.factors.forEach(f => {
                        html += `<div class="card"><div class="card-title">${f.name}</div><div class="card-desc">${f.description}</div></div>`;
                    });
                    html += '</div></div>';
                });
                document.getElementById('factors-table').innerHTML = html;
            } catch (e) {
                console.error('åŠ è½½å› å­å¤±è´¥:', e);
            }
        }
        
        function refreshData() {
            loadOverview();
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            if (activeTab === 'astock') loadAstockData();
        }
        
        function refreshAstockData() {
            loadAstockData();
        }
        
        function openLatestReport() {
            fetch('/api/astock/reports')
                .then(resp => resp.json())
                .then(result => {
                    if (result.success && result.data.length > 0) {
                        window.open(result.data[0].url, '_blank');
                    } else {
                        alert('æš‚æ— æŠ¥å‘Š');
                    }
                });
        }
        
        // åˆå§‹åŠ è½½
        loadOverview();
    </script>
</body>
</html>
