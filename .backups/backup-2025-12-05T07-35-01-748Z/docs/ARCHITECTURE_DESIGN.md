# 韬睿量化系统 - 架构设计文档

## 一、多市场架构设计

### 1.1 核心原则

```
┌─────────────────────────────────────────────────────────────┐
│                    韬睿量化平台 (TaoRui Quant)               │
├─────────────────────────────────────────────────────────────┤
│                      核心框架层 (Core)                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │  数据抽象层  │  │  策略引擎   │  │  回测框架   │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
├─────────────────────────────────────────────────────────────┤
│                      市场适配层 (Adapters)                   │
│  ┌─────────────────────┐    ┌─────────────────────┐         │
│  │   A股模块 (AShare)   │    │  美股模块 (USStock)  │         │
│  │  - 数据源: JQData    │    │  - 数据源: yfinance  │         │
│  │  - 交易: PTrade/QMT  │    │  - 交易: IBKR/Alpaca │         │
│  │  - 因子: A股特色     │    │  - 因子: 美股特色    │         │
│  └─────────────────────┘    └─────────────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 目录结构

```
jqquant/
├── core/                      # 核心框架（市场无关）
│   ├── base_data_source.py    # 数据源抽象基类
│   ├── base_factor.py         # 因子抽象基类
│   ├── base_strategy.py       # 策略抽象基类
│   ├── backtest_engine.py     # 回测引擎
│   └── portfolio.py           # 组合管理
│
├── markets/                   # 市场适配层
│   ├── __init__.py
│   ├── ashare/                # A股模块
│   │   ├── __init__.py
│   │   ├── data_sources/      # JQData, AKShare, Wind
│   │   ├── factors/           # A股特色因子
│   │   ├── strategies/        # A股策略模板
│   │   ├── brokers/           # PTrade, QMT
│   │   └── mainline/          # 主线识别（A股版）
│   │
│   └── usstock/               # 美股模块（未来）
│       ├── __init__.py
│       ├── data_sources/      # yfinance, Alpha Vantage
│       ├── factors/           # 美股特色因子
│       ├── strategies/        # 美股策略模板
│       ├── brokers/           # IBKR, Alpaca
│       └── themes/            # 主题投资（美股版）
│
├── gui/                       # GUI层
│   ├── widgets/
│   │   ├── market_selector.py # 市场选择器
│   │   └── ...
│   └── ...
│
└── config/
    ├── ashare_config.py       # A股配置
    └── usstock_config.py      # 美股配置
```

### 1.3 市场标识规范

```python
# 股票代码规范
MARKET_CODES = {
    "ashare": {
        "prefix": "CN",
        "exchanges": ["SH", "SZ", "BJ"],
        "example": "CN.000001.SZ",  # 平安银行
    },
    "usstock": {
        "prefix": "US",
        "exchanges": ["NYSE", "NASDAQ", "AMEX"],
        "example": "US.AAPL.NASDAQ",  # 苹果
    },
}
```

---

## 二、主线识别系统设计

### 2.1 设计理念

**核心观点**：主线识别不应仅限于"当下热点"，更要具备**前瞻性**。

```
传统方法（滞后）          韬睿方法（前瞻）
    ↓                        ↓
追涨杀跌 ──────────────→ 提前布局
看涨停板 ──────────────→ 看政策+产业+资金
追热点   ──────────────→ 预判催化剂
```

### 2.2 三层主线识别框架

```
┌─────────────────────────────────────────────────────────────┐
│                     主线识别系统                             │
├─────────────────────────────────────────────────────────────┤
│  第一层：宏观前瞻（6-12个月）                                │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ • 政策周期分析（货币/财政/产业政策）                   │    │
│  │ • 经济周期定位（复苏/过热/滞胀/衰退）                  │    │
│  │ • 全球产业趋势（AI/新能源/生物医药）                   │    │
│  │ • 重大事件日历（两会/中央经济工作会议/行业会议）        │    │
│  └─────────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────┤
│  第二层：中观验证（1-3个月）                                 │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ • 行业景气度跟踪（PMI/库存/价格/产能利用率）           │    │
│  │ • 机构资金流向（北向/公募/险资/社保）                  │    │
│  │ • 产业链传导（上游→中游→下游）                        │    │
│  │ • 催化剂时间表（财报季/政策窗口/行业事件）             │    │
│  └─────────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────┤
│  第三层：微观确认（1-4周）                                   │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ • 板块技术形态（突破/蓄势/调整）                       │    │
│  │ • 龙头股表现（领涨/补涨/滞涨）                         │    │
│  │ • 资金集中度（主力净流入/换手率/涨停数）               │    │
│  │ • 市场情绪（融资余额/期权PCR/舆情热度）                │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 前瞻性指标体系

#### 2.3.1 政策前瞻指标

| 指标 | 数据源 | 领先周期 | 权重 |
|------|--------|----------|------|
| 中央政策文件 | 政府网站/新闻 | 6-12月 | 30% |
| 产业规划发布 | 发改委/工信部 | 3-6月 | 25% |
| 地方政策落地 | 地方政府 | 1-3月 | 20% |
| 行业会议/论坛 | 新闻/公告 | 1-2月 | 15% |
| 龙头企业动向 | 公告/调研 | 1-2月 | 10% |

#### 2.3.2 资金前瞻指标

| 指标 | 数据源 | 领先周期 | 权重 |
|------|--------|----------|------|
| 北向资金行业配置 | 沪深港通 | 1-3月 | 25% |
| 公募基金季报持仓 | 基金公告 | 1季度 | 20% |
| ETF资金净流入 | 交易所 | 1-2周 | 20% |
| 融资余额变化 | 交易所 | 1-2周 | 15% |
| 大宗交易/股东增持 | 公告 | 1-4周 | 20% |

#### 2.3.3 产业前瞻指标

| 指标 | 数据源 | 领先周期 | 权重 |
|------|--------|----------|------|
| 行业PMI | 统计局/财新 | 1-2月 | 20% |
| 产品价格趋势 | 行业网站 | 1-3月 | 25% |
| 产能利用率 | 行业协会 | 1-2月 | 15% |
| 订单/库存数据 | 上市公司 | 1季度 | 20% |
| 技术突破/新品发布 | 新闻/公告 | 3-6月 | 20% |

### 2.4 主线评分模型

```python
class MainlineScore:
    """主线综合评分"""
    
    def calculate(self, mainline: str) -> dict:
        return {
            "total_score": 0-100,
            "components": {
                "policy_score": 0-100,      # 政策支持度
                "capital_score": 0-100,     # 资金认可度
                "industry_score": 0-100,    # 产业景气度
                "timing_score": 0-100,      # 时机成熟度
                "risk_score": 0-100,        # 风险可控度
            },
            "stage": "emerging|growing|mature|declining",
            "recommendation": "strong_buy|buy|hold|reduce|avoid",
            "catalysts": [...],             # 未来催化剂
            "risks": [...],                 # 主要风险
        }
```

### 2.5 主线生命周期

```
           启动期        成长期        成熟期        衰退期
            │            │            │            │
政策信号 ───┼────────────┼────────────┼────────────┼───→
            │            │            │            │
机构布局 ───────┼────────┼────────────┼────────────┼───→
                │        │            │            │
散户参与 ────────────────┼────────────┼────────────┼───→
                         │            │            │
媒体热度 ─────────────────────────────┼────────────┼───→
                                      │            │
            ↑            ↑            ↑            ↑
         最佳买点      持有期       减仓期       离场期
```

---

## 三、实现计划

### 3.1 第一阶段：基础框架（当前）

- [x] 主线方法论页面
- [ ] 主线识别工具
  - [ ] 板块扫描器
  - [ ] 政策日历
  - [ ] 催化剂追踪
- [ ] 热度评分系统
- [ ] 个股筛选工具

### 3.2 第二阶段：前瞻性增强

- [ ] 政策分析模块
- [ ] 产业链图谱
- [ ] 机构持仓分析
- [ ] 事件驱动日历

### 3.3 第三阶段：多市场扩展

- [ ] 核心框架抽象
- [ ] 美股数据源接入
- [ ] 美股因子库
- [ ] 美股策略模板

---

## 四、A股 vs 美股差异对照

| 维度 | A股 | 美股 |
|------|-----|------|
| **交易规则** | T+1, 涨跌停 | T+0, 无涨跌停 |
| **主要指数** | 上证/深证/创业板 | 标普/纳斯达克/道琼斯 |
| **数据源** | JQData/AKShare/Wind | yfinance/Alpha Vantage |
| **交易接口** | PTrade/QMT | IBKR/Alpaca |
| **有效因子** | 小市值/反转/质量 | 动量/价值/质量 |
| **主线逻辑** | 政策驱动/板块轮动 | 科技创新/行业周期 |
| **资金特征** | 北向/公募/游资 | 机构/ETF/期权 |

---

*文档版本: 1.0*
*更新日期: 2024-11*


