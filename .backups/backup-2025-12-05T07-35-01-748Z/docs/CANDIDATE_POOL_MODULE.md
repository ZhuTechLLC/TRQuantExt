# 候选池模块使用指南

## 概述

候选池模块是基于JQData构建的股票筛选系统，支持**历史模式（免费版）**和**实时模式（付费版）**两种数据模式，实现无缝切换。

## 数据权限说明

### JQData 免费试用版

| 数据类别 | 可获取 | 方法 | 用途 |
|---------|-------|------|------|
| 板块成分股 | ✅ | `get_industry_stocks`, `get_concept_stocks` | 主线→成分股 |
| A股日K行情 | ✅ | `get_price` | 技术突破识别 |
| 财务数据 | ✅ | `get_fundamentals` | 基本面因子 |
| 基本信息 | ✅ | `get_all_securities` | 股票过滤 |

### 权限范围

- **免费版**：通常只能访问 3个月前 ~ 1年前 的历史数据
- **付费版**：可访问实时数据

系统会**自动检测**账号权限范围，并在该范围内获取数据。

## 使用方法

### 1. 访问候选池

点击侧边栏 **"📦 候选池"**

### 2. 输入参数

- **主线名称**：概念或行业名称（如"石墨烯"、"阿里"）
- **类型**：
  - `concept` - 概念板块
  - `industry` - 行业板块
- **使用缓存**：建议勾选，避免重复API调用

### 3. 构建候选池

点击"构建候选池"按钮，系统将：

1. 自动检测账号数据权限
2. 获取板块成分股
3. 进行技术突破筛选（涨停、放量、均线突破）
4. 进行财务因子筛选（ROE、净利润增速）
5. 计算综合得分并排序

### 4. 查看结果

- **统计信息**：总成分股数、筛选后数量、平均得分
- **候选股票表格**：排名、代码、名称、得分、标签
- **详细信息**：点击股票查看完整分析

## 数据模式

### 历史模式（免费版）

- 界面显示 📅 图标和数据日期
- 用于策略验证和回测
- 结果基于历史数据

### 实时模式（付费版）

- 界面显示 🟢 图标
- 用于实盘选股
- 结果基于最新数据

## 技术筛选条件

满足以下任一条件的股票会被选入：

1. **涨停**：涨跌幅 ≥ 9.5%
2. **放量突破**：成交量较前一日放大 50%+
3. **站上均线**：收盘价 > 60日均线
4. **连续上涨**：连续上涨 ≥ 3天

## 财务筛选条件

满足以下任一条件的股票会被保留：

1. **ROE > 10%**
2. **净利润同比增长 > 30%**
3. **营收同比增长 > 20%**

## 综合评分

```
综合得分 = 技术面得分 × 0.6 + 基本面得分 × 0.4
```

### 技术面得分（0-100）

- 涨停：+30分
- 放量突破：+20分
- 站上均线：+20分
- 连续上涨：每天+10分，最高30分

### 基本面得分（0-100）

- ROE > 20%：+40分；> 10%：+20分
- 净利润增长 > 50%：+30分；> 30%：+20分
- 营收增长 > 30%：+30分；> 20%：+20分

## 缓存机制

系统使用两级缓存：

1. **MongoDB**（如可用）：持久化存储
2. **文件缓存**：JSON格式，存储于 `~/.local/share/jqquant/cache/`

缓存Key格式：`mainline_{概念名}_{日期}`

## API调用优化

为适应免费版限制，系统采用以下策略：

1. **批量处理**：财务数据分批获取（每批1000条）
2. **自动调整日期**：自动将请求日期调整到权限范围内
3. **缓存优先**：优先使用缓存数据
4. **进度显示**：技术筛选时显示进度

## 配置文件

`config/jqdata_config.json`:

```json
{
  "username": "your_username",
  "password": "your_password",
  "data_mode": "historical",
  "permission": {
    "auto_detect": true
  }
}
```

## 升级建议

| 场景 | 建议 |
|------|------|
| 策略验证/PoC | 免费版足够 |
| 分钟级数据需求 | 升级付费版 |
| 主力资金分析 | 升级付费版 |
| 实盘交易信号 | 升级付费版 |

## 常见问题

### Q: 为什么显示"历史模式"？
A: 免费版账号只能访问历史数据。开通付费账号后自动切换为实时模式。

### Q: 为什么某些概念找不到成分股？
A: 可能是概念名称不匹配。请使用JQData中存在的概念名称，可通过"获取概念列表"功能查看。

### Q: 如何减少API调用？
A: 勾选"使用缓存"，系统会优先使用当日缓存数据。
