# 五维评分系统重构方案

## 📋 任务分解

### 阶段1：需求分析与设计（当前阶段）

#### 1.1 读取PDF设计方案
- **任务**：提取《市场主线识别模块五维评分系统设计方案.pdf》的核心内容
- **输出**：五维评分系统的详细设计文档
- **复杂度**：中（需要理解PDF内容）

#### 1.2 对比现有实现
- **任务**：对比现有 `pro_engine.py` 与PDF设计方案的差异
- **输出**：差异分析报告
- **复杂度**：低

#### 1.3 设计新架构
- **任务**：设计每个维度独立Tab的UI架构
- **输出**：UI架构设计图
- **复杂度**：中

---

### 阶段2：核心引擎重构

#### 2.1 五维评分引擎重构
- **任务**：重构评分引擎，确保每个维度独立计算
- **文件**：`markets/ashare/mainline/five_dimension_engine.py` (新建)
- **复杂度**：高

#### 2.2 数据获取层优化
- **任务**：为每个维度优化数据获取逻辑
- **文件**：`markets/ashare/mainline/dimension_data_fetcher.py` (新建)
- **复杂度**：中

---

### 阶段3：UI重构

#### 3.1 创建维度Tab组件
- **任务**：为每个维度创建独立的Tab组件
  - 资金维度Tab
  - 动量维度Tab
  - 热度维度Tab
  - 政策维度Tab
  - 龙头维度Tab
- **文件**：`gui/widgets/dimension_tabs/` (新建目录)
- **复杂度**：高

#### 3.2 创建综合评分Tab
- **任务**：创建"专业投资主线"综合Tab，汇总五维评分
- **文件**：`gui/widgets/professional_mainline_tab.py` (新建)
- **复杂度**：中

#### 3.3 更新主面板
- **任务**：更新 `mainline_panel.py`，集成新的Tab结构
- **文件**：`gui/widgets/mainline_panel.py` (修改)
- **复杂度**：中

---

### 阶段4：数据流与集成

#### 4.1 维度数据传递
- **任务**：确保各维度数据正确传递到综合评分
- **复杂度**：中

#### 4.2 报告生成
- **任务**：更新报告生成器，包含五维评分详情
- **文件**：`markets/ashare/mainline/five_dimension_report_generator.py` (新建)
- **复杂度**：中

---

## 🤖 模型选择建议

### 任务复杂度评估

| 阶段 | 任务 | 复杂度 | 推荐模型 |
|------|------|--------|----------|
| 1.1 | 读取PDF设计方案 | 中 | **Auto** (PDF解析) |
| 1.2 | 对比现有实现 | 低 | **Auto** |
| 1.3 | 设计新架构 | 中 | **Auto** |
| 2.1 | 五维评分引擎重构 | **高** | **Max** (核心算法) |
| 2.2 | 数据获取层优化 | 中 | **Auto** |
| 3.1 | 创建维度Tab组件 | **高** | **Max** (复杂UI) |
| 3.2 | 创建综合评分Tab | 中 | **Auto** |
| 3.3 | 更新主面板 | 中 | **Auto** |
| 4.1 | 维度数据传递 | 中 | **Auto** |
| 4.2 | 报告生成 | 中 | **Auto** |

### 执行策略

**当前阶段（需求分析）**：使用 **Auto Mode**
- PDF内容提取和理解
- 现有代码对比分析
- 架构设计

**核心开发阶段**：使用 **Max Mode**
- 五维评分引擎重构（核心算法）
- 维度Tab组件开发（复杂UI逻辑）

**其他阶段**：使用 **Auto Mode**
- 数据获取优化
- 报告生成
- 集成测试

---

## 📐 五维评分系统架构设计（基于现有代码推测）

### 五个维度

1. **资金维度 (25分)**
   - 当日净流入排名 (40%)
   - 5日累计净流入排名 (30%)
   - 流入占比 (30%)

2. **动量维度 (20分)**
   - 涨跌幅排名 (40%)
   - 相对强度 (30%)
   - 趋势得分 (30%)

3. **热度维度 (20分)**
   - 涨停股占比 (40%)
   - 成交量放大 (30%)
   - 关注度得分 (30%)

4. **政策维度 (20分)**
   - 政策支持力度 (50%)
   - 产业趋势 (30%)
   - 事件催化 (20%)

5. **龙头维度 (15分)**
   - 龙头强度 (50%)
   - 跟风效应 (30%)
   - 大市值龙头 (20%)

### UI结构设计

```
投资主线 (MainlinePanel)
├── 📖 方法论
├── 🔍 主线识别 (旧版，保留)
├── 🎯 专业主线识别 (新版，五维评分)
│   ├── Tab 1: 💰 资金维度
│   ├── Tab 2: 📈 动量维度
│   ├── Tab 3: 🔥 热度维度
│   ├── Tab 4: 📜 政策维度
│   ├── Tab 5: 👑 龙头维度
│   └── Tab 6: 🎯 综合评分 (专业投资主线)
├── 📊 热度评分 (独立模块)
├── 🎯 个股筛选
├── 📋 调研笔记
├── 📈 回测验证
└── ⚡ 实时监控
```

---

## 🎯 执行计划

### 第一步：需求分析（当前）
1. 读取PDF文件，提取核心设计
2. 对比现有实现
3. 确定具体改进点

### 第二步：核心引擎开发
1. 创建五维评分引擎
2. 优化数据获取层
3. 实现维度独立计算

### 第三步：UI开发
1. 创建维度Tab组件
2. 创建综合评分Tab
3. 集成到主面板

### 第四步：测试与优化
1. 端到端测试
2. 性能优化
3. 文档更新

---

*待PDF内容提取后，更新详细设计*

