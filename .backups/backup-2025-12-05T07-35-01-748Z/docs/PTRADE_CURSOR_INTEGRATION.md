# PTrade与Cursor集成方案

## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                    韬睿量化投研平台                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐      │
│   │  策略开发    │ ──▶ │   回测验证   │ ──▶ │  实盘交易    │      │
│   │  (Cursor)   │     │  (PTrade)   │     │  (PTrade)   │      │
│   └─────────────┘     └─────────────┘     └─────────────┘      │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   ┌─────────────────────────────────────────────────────┐      │
│   │              仪表盘 (Dashboard)                      │      │
│   │  - 策略管理  - 回测报告  - 交易记录  - 持仓监控       │      │
│   └─────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 二、PTrade接入方式

### 2.1 数据同步方案

由于PTrade运行在券商服务器上，我们通过以下方式获取数据：

#### 方案A：文件导出同步（推荐）
```
PTrade回测 → 导出JSON/CSV → 本地仪表盘读取 → Cursor分析
```

1. 在PTrade中运行回测，导出结果到本地
2. 韬睿量化平台读取导出文件
3. 在Cursor中使用AI分析优化

#### 方案B：API直连（需券商支持）
```
PTrade API → 本地代理服务 → 仪表盘实时展示
```

### 2.2 PTrade数据导出格式

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "total_return": 0.15,
  "annual_return": 0.165,
  "max_drawdown": 0.08,
  "sharpe_ratio": 1.85,
  "win_rate": 0.62,
  "total_trades": 156,
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000,
      "amount": 10500
    }
  ],
  "daily_returns": [
    {"date": "2024-01-02", "return": 0.012, "nav": 1.012}
  ]
}
```

## 三、Cursor集成工作流

### 3.1 策略开发流程

```
1. 需求描述 → 2. AI生成PTrade代码 → 3. 本地验证 → 4. 上传PTrade → 5. 回测 → 6. 分析优化
     ↑                                                                           │
     └───────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Prompt模板

#### 生成PTrade策略

```
请帮我生成一个PTrade量化策略，要求如下：

## 策略描述
基于动量和价值因子的多因子选股策略，每周调仓一次

## 策略类型
多因子选股

## 股票池
沪深300成分股

## 技术要求
- 使用PTrade Python 3.11环境
- 必须包含 initialize, before_market_open, market_open, after_market_close 函数
- 使用PTrade内置函数：get_price, order, order_target, set_benchmark等
- 实现止损止盈逻辑
- 添加风险控制

## 因子要求
- 动量因子：过去20日收益率
- 价值因子：市盈率PE
- 质量因子：ROE

## 参数设置
- 回看周期：20天
- 持仓上限：单股10%
- 止损比例：8%

请生成完整的PTrade策略代码，包含详细注释。
```

#### 分析回测结果

```
请分析以下PTrade回测结果：

## 策略信息
- 策略名称: 多因子动量策略
- 回测区间: 2024-01-01 至 2024-11-25
- 初始资金: 1000000

## 回测指标
- 总收益率: 15.00%
- 年化收益: 16.50%
- 最大回撤: 8.00%
- 夏普比率: 1.85
- 胜率: 62.00%
- 总交易次数: 156

请从以下方面进行分析：
1. 收益风险评估
2. 交易行为分析
3. 策略优缺点
4. 改进建议

给出具体的优化方向和代码修改建议。
```

#### 优化策略

```
请帮我优化以下PTrade策略代码：

## 优化目标
- 提高夏普比率到2.0以上
- 降低最大回撤到5%以内
- 增加交易频率

## 可用因子
- 动量因子
- 价值因子（PE、PB）
- 质量因子（ROE、毛利率）
- 波动率因子
- 资金流因子

请给出优化后的完整代码，并解释修改原因。
```

### 3.3 在Cursor中使用

1. **打开策略文件**
   - 在韬睿量化平台点击"在Cursor中打开"
   - 或直接在Cursor中打开 `strategies/ptrade/` 目录

2. **使用AI助手**
   - 按 `Ctrl+K` 或 `Cmd+K` 打开AI对话
   - 粘贴Prompt模板
   - 根据AI建议修改代码

3. **同步到PTrade**
   - 将修改后的代码复制到PTrade策略编辑器
   - 运行回测验证

## 四、仪表盘策略管理

### 4.1 功能列表

- **策略列表**：显示所有PTrade策略
- **回测报告**：展示回测结果和图表
- **版本管理**：策略版本历史
- **一键同步**：导入PTrade数据

### 4.2 数据目录结构

```
JQQuant/
├── strategies/
│   └── ptrade/           # PTrade策略代码
│       ├── momentum_v1.py
│       └── multifactor_v2.py
├── data/
│   └── ptrade/           # PTrade导出数据
│       ├── backtest_results/
│       ├── trade_records/
│       └── positions/
└── prompts/              # AI Prompt模板
    ├── generate_strategy.md
    └── analyze_backtest.md
```

## 五、使用步骤

### 5.1 首次配置

1. **配置PTrade路径**
   ```json
   // config/ptrade_config.json
   {
     "host": "ptrade.gjzq.com",
     "port": 7709,
     "account_id": "您的账号",
     "strategy_path": "/path/to/ptrade/strategies",
     "data_path": "/path/to/ptrade/exports"
   }
   ```

2. **安装依赖**
   ```bash
   pip install pyperclip  # 剪贴板支持
   ```

### 5.2 日常使用

1. **生成策略**
   - 在韬睿量化平台点击"AI生成策略"
   - 选择"PTrade格式"
   - 描述策略需求
   - 复制Prompt到Cursor

2. **导入回测结果**
   - 在PTrade中导出回测结果为JSON
   - 放入 `data/ptrade/backtest_results/` 目录
   - 在仪表盘中刷新查看

3. **分析优化**
   - 在仪表盘中点击"分析报告"
   - 复制分析Prompt到Cursor
   - 根据建议修改策略

## 六、PTrade策略代码规范

### 6.1 必需函数

```python
def initialize(context):
    """初始化，设置基准、滑点、手续费等"""
    pass

def before_market_open(context):
    """盘前处理"""
    pass

def market_open(context):
    """开盘交易逻辑"""
    pass

def after_market_close(context):
    """盘后处理"""
    pass
```

### 6.2 常用PTrade函数

```python
# 数据获取
get_price(stock, count=20, frequency='1d', fields=['close'])
get_fundamentals(query, date)
get_industry(stock)

# 交易函数
order(stock, amount)           # 买入/卖出指定数量
order_target(stock, amount)    # 调仓到目标数量
order_value(stock, value)      # 买入指定金额

# 账户信息
context.portfolio.total_value      # 总资产
context.portfolio.available_cash   # 可用资金
context.portfolio.positions        # 持仓字典

# 设置函数
set_benchmark('000300.XSHG')
set_slippage(PriceRelatedSlippage(0.002))
set_commission(PerTrade(buy_cost=0.0003, sell_cost=0.0013))
```

## 七、常见问题

### Q1: 如何将JQQuant策略转换为PTrade格式？

使用Cursor的AI助手，提供转换Prompt：
```
请将以下JQQuant策略代码转换为PTrade格式...
```

### Q2: PTrade回测数据如何导出？

在PTrade中：
1. 运行回测完成后
2. 点击"导出报告"
3. 选择JSON格式
4. 保存到本地

### Q3: 如何实现实时数据同步？

目前支持文件同步方式。实时API需要券商开放接口权限。

---

> 文档版本: v1.0
> 更新日期: 2024-11-25
> 维护: 韬睿量化团队














