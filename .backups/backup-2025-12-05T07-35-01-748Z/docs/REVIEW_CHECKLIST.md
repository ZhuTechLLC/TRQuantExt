# ä¸»çº¿è¯†åˆ«ä¸çƒ­åº¦è¯„åˆ†ç³»ç»Ÿ - å®Œæ•´æ£€é˜…æ¸…å•

## âœ… å·²å®Œæˆé¡¹

### 1. çƒ­åº¦è¯„åˆ†ç³»ç»Ÿ
- [x] 5å› å­è¯„åˆ†æ¨¡å‹è®¾è®¡
- [x] çŸ­ä¸­é•¿æœŸæƒé‡é…ç½®
- [x] æ•°æ®æºé€æ˜å±•ç¤ºï¼ˆAPIã€å­—æ®µã€ç¤ºä¾‹æ•°æ®ï¼‰
- [x] GUIé¢æ¿å®Œæ•´å±•ç¤º
- [x] æŠ¥å‘Šç”Ÿæˆå’Œè‡ªåŠ¨æ‰“å¼€
- [x] æ•°æ®ä¿å­˜åˆ°JSONæ–‡ä»¶

### 2. ä¸»çº¿è¯†åˆ«ç³»ç»Ÿ
- [x] ä¸“ä¸šçº§ä¸»çº¿è¯†åˆ«å¼•æ“
- [x] 5ç»´åº¦è¯„åˆ†æ¨¡å‹
- [x] GUIé¢æ¿
- [x] æŠ¥å‘Šç”Ÿæˆ

### 3. æ–‡æ¡£
- [x] çƒ­åº¦è¯„åˆ†æ¶æ„æ–‡æ¡£
- [x] è¡”æ¥å…³ç³»æ–‡æ¡£
- [x] å¼€å‘é‡Œç¨‹ç¢‘æ–‡æ¡£

---

## âš ï¸ å¾…å®Œæˆé¡¹

### 1. ä¸»çº¿è¯†åˆ«ä¸çƒ­åº¦è¯„åˆ†çš„å®é™…æ•°æ®ä¼ é€’ âœ… **å·²ä¿®å¤**

**ä¿®å¤å†…å®¹**ï¼š
- âœ… å·²æ›´æ–° `pro_engine.py` ä½¿ç”¨æ–°çš„ `IntegratedHeatmapEngine`
- âœ… å·²æ›´æ–° `analyze_enhanced()` æ–¹æ³•ä½¿ç”¨æ–°çš„API
- âœ… å·²æ›´æ–°é…ç½®è¯´æ˜ä¸º5å› å­æ¨¡å‹
- âœ… å·²ä¿å­˜çƒ­åº¦è¯„åˆ†ç»“æœä¾›åç»­ä½¿ç”¨

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… å¼•æ“åˆå§‹åŒ–æˆåŠŸ
- âœ… ä½¿ç”¨æ–°çš„é›†æˆçƒ­åº¦è¯„åˆ†å¼•æ“

---

### 2. ä¸ªè‚¡ç­›é€‰æ¨¡å—è¯»å–çƒ­åº¦è¯„åˆ†æ•°æ® âŒ

**é—®é¢˜**ï¼š
- ä¸ªè‚¡ç­›é€‰Tab (`_create_stock_selection_tab`) åªæœ‰UIæ¡†æ¶
- æ²¡æœ‰å®ç°è¯»å– `latest_heatmap_scores.json` çš„é€»è¾‘
- æ²¡æœ‰å®ç°"æ‰€å±ä¸»çº¿çƒ­åº¦ Ã— 15%"çš„åŠ æƒè®¡ç®—

**éœ€è¦å®ç°**ï¼š
1. è¯»å–çƒ­åº¦è¯„åˆ†JSONæ–‡ä»¶
2. ç­›é€‰é«˜çƒ­åº¦(â‰¥60åˆ†)ä¸»çº¿
3. è·å–ä¸»çº¿å†…çš„ä¸ªè‚¡åˆ—è¡¨
4. è®¡ç®—ä¸ªè‚¡è¯„åˆ†ï¼š`æ‰€å±ä¸»çº¿çƒ­åº¦ Ã— 15% + ä¸ªè‚¡å› å­ Ã— 85%`
5. æ˜¾ç¤ºç­›é€‰ç»“æœ

**æ–‡ä»¶ä½ç½®**ï¼š
- `gui/widgets/mainline_panel.py` ç¬¬1484è¡Œ `_create_stock_selection_tab()`
- ç¬¬2253è¡Œæœ‰ `# TODO: å®ç°ä¸ªè‚¡ç­›é€‰é€»è¾‘`

---

### 3. çƒ­åº¦è¯„åˆ†ä¸ä¸»çº¿è¯†åˆ«çš„æ•°æ®ä¸€è‡´æ€§ âš ï¸

**é—®é¢˜**ï¼š
- ä¸¤ä¸ªæ¨¡å—ä½¿ç”¨ç›¸åŒçš„æ•°æ®æºï¼Œä½†å¯èƒ½åœ¨ä¸åŒæ—¶é—´è·å–
- éœ€è¦ç¡®ä¿æ•°æ®æ—¶é—´æˆ³ä¸€è‡´

**å»ºè®®**ï¼š
- ä¸»çº¿è¯†åˆ«æ‰§è¡Œæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨çƒ­åº¦è¯„åˆ†
- æˆ–è€…å…±äº«åŒä¸€ä¸ªæ•°æ®è·å–ç»“æœ

---

### 4. ä¸ªè‚¡ç­›é€‰çš„æ•°æ®è·å– âŒ

**é—®é¢˜**ï¼š
- ä¸ªè‚¡ç­›é€‰éœ€è¦è·å–ä¸»çº¿å†…çš„ä¸ªè‚¡åˆ—è¡¨
- éœ€è¦ä¸ªè‚¡çš„æŠ€æœ¯é¢ã€èµ„é‡‘é¢ã€åŸºæœ¬é¢æ•°æ®
- å½“å‰æ²¡æœ‰å®ç°æ•°æ®è·å–é€»è¾‘

**éœ€è¦å®ç°**ï¼š
1. æ ¹æ®ä¸»çº¿åç§°è·å–æ¿å—æˆåˆ†è‚¡
2. è·å–ä¸ªè‚¡æŠ€æœ¯æŒ‡æ ‡ï¼ˆå‡çº¿ã€é‡ä»·ç­‰ï¼‰
3. è·å–ä¸ªè‚¡èµ„é‡‘æµå‘
4. è·å–ä¸ªè‚¡åŸºæœ¬é¢æ•°æ®ï¼ˆROEã€è¥æ”¶å¢é€Ÿç­‰ï¼‰

---

### 5. æŠ¥å‘Šç›®å½•ç»“æ„ âš ï¸

**å½“å‰ç»“æ„**ï¼š
```
~/.local/share/jqquant/reports/
â”œâ”€â”€ heatmap/          # çƒ­åº¦è¯„åˆ†æŠ¥å‘Š
â”‚   â”œâ”€â”€ latest_heatmap_scores.json
â”‚   â””â”€â”€ heatmap_report_*.html
â””â”€â”€ mainline/         # ä¸»çº¿è¯†åˆ«æŠ¥å‘Š
    â””â”€â”€ daily/
        â””â”€â”€ mainline_report_*.html
```

**å»ºè®®ä¼˜åŒ–**ï¼š
- æ·»åŠ  `stock_selection/` ç›®å½•
- æ·»åŠ  `integration/` ç›®å½•ï¼ˆç»¼åˆæŠ¥å‘Šï¼‰

---

### 6. æµ‹è¯•å’ŒéªŒè¯ âŒ

**ç¼ºå¤±é¡¹**ï¼š
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼šä¸»çº¿è¯†åˆ« â†’ çƒ­åº¦è¯„åˆ† â†’ ä¸ªè‚¡ç­›é€‰
- æ•°æ®ä¸€è‡´æ€§æµ‹è¯•
- æŠ¥å‘Šç”Ÿæˆæµ‹è¯•

---

## ğŸ”§ ä¼˜å…ˆçº§ä¿®å¤å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. **ä¿®å¤ä¸»çº¿è¯†åˆ«ä½¿ç”¨æ–°çš„çƒ­åº¦è¯„åˆ†å¼•æ“**
   - æ–‡ä»¶ï¼š`markets/ashare/mainline/pro_engine.py`
   - å½±å“ï¼šç¡®ä¿æ•°æ®ä¸€è‡´æ€§

2. **å®ç°ä¸ªè‚¡ç­›é€‰è¯»å–çƒ­åº¦è¯„åˆ†**
   - æ–‡ä»¶ï¼š`gui/widgets/mainline_panel.py`
   - å½±å“ï¼šå®Œæˆå®Œæ•´æµç¨‹

### ä¸­ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å®Œå–„ï¼‰
3. **å®ç°ä¸ªè‚¡æ•°æ®è·å–**
   - éœ€è¦ï¼šæ¿å—æˆåˆ†è‚¡APIã€ä¸ªè‚¡æŒ‡æ ‡API
   - å½±å“ï¼šä¸ªè‚¡ç­›é€‰åŠŸèƒ½å¯ç”¨æ€§

4. **ä¼˜åŒ–æ•°æ®ä¼ é€’æœºåˆ¶**
   - ç¡®ä¿ä¸»çº¿è¯†åˆ«å’Œçƒ­åº¦è¯„åˆ†ä½¿ç”¨åŒä¸€ä»½æ•°æ®
   - å½±å“ï¼šæ•°æ®ä¸€è‡´æ€§

### ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–ï¼‰
5. **æŠ¥å‘Šç›®å½•ä¼˜åŒ–**
6. **ç«¯åˆ°ç«¯æµ‹è¯•**

---

## ğŸ“‹ å…·ä½“ä¿®æ”¹æ¸…å•

### ä¿®æ”¹1ï¼šæ›´æ–°ä¸»çº¿è¯†åˆ«å¼•æ“ä½¿ç”¨æ–°çš„çƒ­åº¦è¯„åˆ†

**æ–‡ä»¶**ï¼š`markets/ashare/mainline/pro_engine.py`

**ä¿®æ”¹ä½ç½®**ï¼š
- ç¬¬621-633è¡Œï¼š`_init_heatmap_engine()` æ–¹æ³•
- ç¬¬648-673è¡Œï¼š`_integrate_heatmap_scores()` æ–¹æ³•

**ä¿®æ”¹å†…å®¹**ï¼š
```python
# æ—§ä»£ç 
from .heatmap_engine import HeatmapEngine, HeatmapDataAggregator

# æ–°ä»£ç 
from .integrated_heatmap import IntegratedHeatmapEngine
```

---

### ä¿®æ”¹2ï¼šå®ç°ä¸ªè‚¡ç­›é€‰è¯»å–çƒ­åº¦è¯„åˆ†

**æ–‡ä»¶**ï¼š`gui/widgets/mainline_panel.py`

**ä¿®æ”¹ä½ç½®**ï¼š
- ç¬¬2253è¡Œï¼š`_screen_stocks()` æ–¹æ³•

**éœ€è¦å®ç°**ï¼š
```python
def _screen_stocks(self):
    # 1. è¯»å–çƒ­åº¦è¯„åˆ†
    heatmap_path = Path.home() / ".local/share/jqquant/reports/heatmap/latest_heatmap_scores.json"
    if heatmap_path.exists():
        with open(heatmap_path) as f:
            heatmap_data = json.load(f)
        high_heat = heatmap_data.get("high_heat_mainlines", [])
    else:
        QMessageBox.warning(self, "æç¤º", "è¯·å…ˆè®¡ç®—çƒ­åº¦è¯„åˆ†")
        return
    
    # 2. è·å–é€‰ä¸­ä¸»çº¿å†…çš„ä¸ªè‚¡
    selected_sector = self.stock_sector_combo.currentText()
    if selected_sector not in high_heat:
        QMessageBox.warning(self, "æç¤º", f"{selected_sector} çƒ­åº¦ä¸è¶³ï¼Œè¯·é€‰æ‹©é«˜çƒ­åº¦ä¸»çº¿")
        return
    
    # 3. è·å–ä¸ªè‚¡åˆ—è¡¨å’Œæ•°æ®
    stocks = get_stocks_in_sector(selected_sector)
    
    # 4. è®¡ç®—ä¸ªè‚¡è¯„åˆ†
    mainline_heat = next(s["total_score"] for s in heatmap_data["scores"] 
                         if s["name"] == selected_sector)
    
    stock_scores = []
    for stock in stocks:
        # è·å–ä¸ªè‚¡å› å­
        tech_score = calculate_tech_score(stock)
        fund_score = calculate_fund_score(stock)
        basic_score = calculate_basic_score(stock)
        
        # ç»¼åˆè¯„åˆ†
        stock_total = (
            mainline_heat * 0.15 +  # æ‰€å±ä¸»çº¿çƒ­åº¦
            (tech_score * 0.3 + fund_score * 0.3 + basic_score * 0.4) * 0.85
        )
        stock_scores.append({
            "code": stock.code,
            "name": stock.name,
            "score": stock_total,
            ...
        })
    
    # 5. æ˜¾ç¤ºç»“æœ
    self._display_stock_results(stock_scores)
```

---

## ğŸ“Š å®Œæˆåº¦ç»Ÿè®¡

| æ¨¡å— | å®Œæˆåº¦ | è¯´æ˜ |
|------|--------|------|
| çƒ­åº¦è¯„åˆ†ç³»ç»Ÿ | 100% | âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå·²ä¸ä¸»çº¿è¯†åˆ«é›†æˆ |
| ä¸»çº¿è¯†åˆ«ç³»ç»Ÿ | 95% | âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œå·²ä½¿ç”¨æ–°çš„çƒ­åº¦è¯„åˆ†å¼•æ“ |
| ä¸ªè‚¡ç­›é€‰æ¨¡å— | 30% | âš ï¸ åªæœ‰UIæ¡†æ¶ï¼Œç¼ºå°‘æ ¸å¿ƒé€»è¾‘ |
| æ•°æ®ä¼ é€’æœºåˆ¶ | 90% | âœ… å·²å®ç°æ•°æ®ä¼ é€’ï¼Œç¼ºå°‘ä¸ªè‚¡æ•°æ®è·å– |
| æ–‡æ¡£ | 100% | âœ… å®Œæ•´ |

**æ€»ä½“å®Œæˆåº¦ï¼š83%** â¬†ï¸ (ä»75%æå‡)

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³ä¿®å¤**ï¼šæ›´æ–° `pro_engine.py` ä½¿ç”¨æ–°çš„çƒ­åº¦è¯„åˆ†å¼•æ“
2. **æœ¬å‘¨å®Œæˆ**ï¼šå®ç°ä¸ªè‚¡ç­›é€‰è¯»å–çƒ­åº¦è¯„åˆ†æ•°æ®
3. **åç»­ä¼˜åŒ–**ï¼šå®Œå–„ä¸ªè‚¡æ•°æ®è·å–å’Œè¯„åˆ†è®¡ç®—

---

*æœ€åæ›´æ–°ï¼š2024-11-28*

