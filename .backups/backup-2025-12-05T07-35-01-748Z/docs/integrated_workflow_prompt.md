# 韬睿量化系统集成工作流程需求文档

## 原始需求

在工作台上集成整个工作流程，目标能输出适合PTrade的代码：

1. **位置**：在工作台现有量化工作流程下方，添加一个按次序向下的垂直工作流程

2. **布局**：
   - 左侧：流程步骤按钮
   - 右侧：结果摘要及详细信息链接，用文件管理系统界面管理，用HTML显示

3. **信息获取步骤**：
   - 点击后系统自动检测数据库关联状态
   - 右侧显示具体状态简明结论
   - 提供详细状态报告链接

4. **市场趋势步骤**：
   - 右侧显示分析报告链接
   - 文件管理系统中显示详细专业报告
   - 报告包括：原理、计算方法、代码实现
   - 结论用于下一步及代码开发

5. **投资主线步骤**：
   - 生成报告包括五维评分原理、方法、综合评分计算
   - 分为：历史、当下、前瞻（短期、中期、长期）
   - 结合市场趋势结论用于下一步

6. **候选池构建步骤**：
   - 右侧给出摘要和详细结果的步骤与分析

7. **因子构建步骤**：
   - 右侧显示摘要和分析报告链接
   - 报告说明选择哪些因子、为什么、案例等

8. **策略生成步骤**：
   - 右侧显示摘要和HTML报告页面链接
   - 策略代码由大语言模型生成

---

## 优化后的Prompt（用于Cursor开发）

```
请在TRQuant量化系统的工作台页面实现一个完整的集成工作流程模块：

## 架构要求

### 1. 布局设计
- 在现有横向工作流程图下方添加**垂直工作流程面板**
- 采用左右分栏布局：
  - **左侧（30%宽度）**：流程步骤列表，每个步骤是可点击的卡片
  - **右侧（70%宽度）**：结果展示区，包含摘要卡片和HTML报告预览

### 2. 流程步骤（自上而下）
1. **📡 信息获取** - 检测数据源连接状态
2. **📈 市场趋势** - 短中长期趋势分析
3. **🔥 投资主线** - 五维评分与主线识别
4. **📦 候选池构建** - 主线股票+强势股筛选
5. **🧮 因子构建** - 因子选择与组合
6. **💻 策略生成** - 输出PTrade策略代码

### 3. 右侧结果区功能
- **状态摘要卡片**：显示当前步骤的关键结论（2-3行）
- **详情按钮**：点击打开完整HTML报告
- **报告预览**：嵌入式HTML预览窗口
- **文件管理**：报告存储在 reports/ 目录，支持历史查看

### 4. 报告内容要求
每个步骤的报告应包含：
- 原理说明（为什么这样做）
- 计算方法（具体如何实现）
- 结果数据（表格/图表）
- 结论建议（用于下一步）
- 代码片段（可直接使用的Python代码）

### 5. 数据流转
- 每个步骤的输出存入MongoDB
- 下一步骤自动读取上一步骤的结论
- 最终汇总生成PTrade策略代码

### 6. 技术实现
- 使用PyQt6 QSplitter实现左右分栏
- 使用QWebEngineView显示HTML报告
- 报告使用Jinja2模板生成
- 异步执行避免UI阻塞
```

---

## 文件结构

```
TRQuant/
├── gui/
│   └── widgets/
│       └── integrated_workflow_panel.py  # 集成工作流程面板
├── core/
│   └── report_generator.py              # 报告生成器（增强）
├── templates/
│   ├── data_status_report.html          # 数据状态报告模板
│   ├── market_trend_report.html         # 市场趋势报告模板
│   ├── mainline_report.html             # 投资主线报告模板
│   ├── candidate_pool_report.html       # 候选池报告模板
│   ├── factor_report.html               # 因子分析报告模板
│   └── strategy_report.html             # 策略生成报告模板
└── reports/                             # 生成的报告存储目录
    └── {date}/
        ├── data_status.html
        ├── market_trend.html
        └── ...
```

---

## 开发优先级

1. P0: 创建集成工作流程面板基础框架
2. P0: 实现左侧流程步骤列表
3. P0: 实现右侧结果展示区
4. P1: 实现各步骤的执行逻辑
5. P1: 创建HTML报告模板
6. P2: 实现报告生成与存储
7. P2: 实现步骤间数据流转
8. P3: 策略代码生成（LLM集成）

