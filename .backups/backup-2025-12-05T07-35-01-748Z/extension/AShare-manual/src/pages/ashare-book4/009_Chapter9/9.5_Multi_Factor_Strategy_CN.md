---
title: "9.5 多因子策略实现"
description: "将多因子模型转化为QMT策略代码"
lang: "zh-CN"
layout: "/src/layouts/Layout.astro"
currentBook: "ashare-quantitative"
currentChapter: "ashare-quantitative-chapter9"
updateDate: "2025-01-26"
---

# 🔗 9.5 多因子策略实现

> **核心摘要：**
> 
> 本节将第七章的多因子模型转化为QMT可执行的策略代码。

## 📋 多因子策略代码

<div class="board-details">
  <div class="board-card">
    <h4>📋 QMT多因子策略</h4>
    <div class="board-content">

```python
from xtquant import xtdata
from xtquant.xttrader import XtQuantTrader
import pandas as pd
import numpy as np

class QMTMultiFactorStrategy:
    def __init__(self, path, session_id):
        self.path = path
        self.session_id = session_id
        self.hold_num = 30
        
    def calculate_factors(self, stocks):
        """计算多因子得分"""
        # 获取财务数据
        finance = xtdata.get_financial_data(
            stock_list=stocks,
            table_list=['Balance', 'Income']
        )
        
        # 计算因子
        df = pd.DataFrame()
        df['code'] = stocks
        
        # EP因子 (1/PE)
        df['ep'] = 1 / finance['pe_ratio']
        
        # ROE因子
        df['roe'] = finance['roe']
        
        # 标准化
        df['ep_zscore'] = (df['ep'] - df['ep'].mean()) / df['ep'].std()
        df['roe_zscore'] = (df['roe'] - df['roe'].mean()) / df['roe'].std()
        
        # 综合得分
        df['score'] = 0.5 * df['ep_zscore'] + 0.5 * df['roe_zscore']
        
        return df.nlargest(self.hold_num, 'score')['code'].tolist()
    
    def rebalance(self, target_stocks):
        """调仓"""
        # 获取当前持仓
        positions = self.trader.query_stock_positions(self.account)
        current_stocks = [p.stock_code for p in positions]
        
        # 卖出不在目标池的股票
        for stock in current_stocks:
            if stock not in target_stocks:
                self.trader.order_stock(
                    self.account, stock,
                    xtconstant.STOCK_SELL,
                    positions[stock].volume,
                    xtconstant.LATEST_PRICE, 0
                )
        
        # 买入目标股票
        cash = self.trader.query_stock_asset(self.account).cash
        per_stock_value = cash / len(target_stocks)
        
        for stock in target_stocks:
            if stock not in current_stocks:
                price = xtdata.get_full_tick([stock])[stock]['lastPrice']
                volume = int(per_stock_value / price / 100) * 100
                if volume > 0:
                    self.trader.order_stock(
                        self.account, stock,
                        xtconstant.STOCK_BUY,
                        volume,
                        xtconstant.LATEST_PRICE, 0
                    )
```

</div>
  </div>
</div>

## 🔮 总结与展望

<div class="summary-outlook">
  <h3>本节回顾</h3>
  <p>本节展示了如何在QMT中实现多因子策略。</p>
  
  <h3>下节预告</h3>
  <p>下一节将学习QMT策略的实盘部署流程。</p>
  
  <a href="/ashare-book4/009_Chapter9/9.6_Live_Deployment_CN" class="next-section">
    继续学习：9.6 实盘部署 →
  </a>
</div>













