# 架构与设计决策记录 (Decisions)

本文件记录项目在架构和设计上的关键决策，包括决策时间、内容、原因及考虑的替代方案。通过这些记录可以跟踪模块的演进和重要技术选择。

- **2025-12-01** 决策：采用"Web服务 + VSCode插件"双架构方案

  - **背景**：最初构想仅通过Web界面提供量化功能，但单人开发者希望充分利用VSCode提高开发效率，并使用AI模型辅助编码。

  - **方案权衡**：方案A是纯Web系统，用户在浏览器编写策略；方案B增加VSCode插件，开发者可在IDE中编写并运行策略。方案A实现简单但开发体验较弱，方案B开发略复杂但提升效率。

  - **决定**：选择方案B，即同时开发VSCode插件和后端Web服务，通过API连接两者。原因是插件能提供更优秀的开发者体验，充分发挥AI辅助编码优势，同时保留Web界面供其它用户使用。

  - **影响**：架构更复杂，需要设计清晰的API契约保证IDE与后端解耦；开发者需维护两套客户端，但长远看提高了系统可用性。

- **2025-12-10** 决策：引入`.cursor-rules.mdc`规范驱动AI代码生成

  - **背景**：在早期使用AI生成代码时，发现模型输出风格不统一、有时偏离项目约定，需频繁手工修改。

  - **方案权衡**：方案A是依赖开发者每次提示时重申规范；方案B是在项目中引入Cursor的规则文件，提供统一上下文约束AI行为。

  - **决定**：采用方案B，编写项目规则文件`.cursor-rules.mdc`存放在代码库，定义编码规范和架构提示。这样Claude模型在生成代码时会自动参考这些规则，减少风格偏差。

  - **影响**：需要维护规则文件随项目更新，但显著提升了AI生成代码的一致性，减少人工调整，长期降低token消耗和沟通成本。

- **2025-12-15** 决策：数据库从SQLite切换为PostgreSQL

  - **背景**：起初使用SQLite本地文件存储数据方便开发，但随着并发访问和数据量增长，其限制逐渐明显。

  - **方案权衡**：考虑过继续使用SQLite + 分库，或迁移到更健壮的数据库如PostgreSQL/MySQL。后者需额外部署但支持并发和复杂查询。

  - **决定**：迁移至PostgreSQL数据库。理由：PostgreSQL 在可靠性、并发性能和扩展性方面更符合生产需求；放弃SQLite方案是因为其锁机制无法满足高并发，且扩展性较差。

  - **影响**：后端数据层模块需要重构以使用PostgreSQL驱动，增加初始化和配置步骤；但长期提升了系统稳定性，并为将来功能扩展奠定基础。

*(后续决策将按时间倒序添加在此列表，以方便查阅最新决策。)*

