# å®Œæ•´å¼€å‘å·¥ä½œæµæ–¹æ¡ˆ

## ðŸŽ¯ æ ¸å¿ƒç›®æ ‡

1. âœ… **å®‰å…¨åŒæ­¥**ï¼šä¸ä¸¢å¤±ä»»ä½•æ–‡ä»¶
2. âœ… **ä¸»é¡¹ç›®å¼€å‘**ï¼šåœ¨Cursorä¸­å¼€å‘ï¼Œèƒ½çœ‹åˆ°å®žé™…æ•ˆæžœ
3. âœ… **å¿«æ·æ–¹å¼**ï¼šä¿æŒDockå¿«æ·æ–¹å¼å¯ç”¨
4. âœ… **Dockeréƒ¨ç½²**ï¼šè·¨å¹³å°å®‰è£…å’Œè¿è¡Œ

---

## ðŸ“‹ æ–¹æ¡ˆæ€»è§ˆ

### æž¶æž„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¼€å‘çŽ¯å¢ƒï¼ˆä¸»é¡¹ç›®ï¼‰                          â”‚
â”‚  /home/taotao/dev/QuantTest/TRQuant                         â”‚
â”‚  - Gitä»“åº“                                                    â”‚
â”‚  - Cursorç®¡ç†                                                  â”‚
â”‚  - æºä»£ç å¼€å‘                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• åŒå‘åŒæ­¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¿è¡ŒçŽ¯å¢ƒï¼ˆå®‰è£…ç›®å½•ï¼‰                        â”‚
â”‚  ~/.local/share/jqquant                                     â”‚
â”‚  - æ¡Œé¢åº”ç”¨å®‰è£…                                               â”‚
â”‚  - å¿«æ·æ–¹å¼æŒ‡å‘                                               â”‚
â”‚  - DockeræŒ‚è½½                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• DockeræŒ‚è½½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Dockerå®¹å™¨                                 â”‚
â”‚  - è·¨å¹³å°è¿è¡Œ                                                 â”‚
â”‚  - æ•°æ®æŒä¹…åŒ–                                                 â”‚
â”‚  - é…ç½®ç‹¬ç«‹                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”’ ç¬¬ä¸€éƒ¨åˆ†ï¼šå®‰å…¨åŒæ­¥ï¼ˆä¸ä¸¢å¤±æ–‡ä»¶ï¼‰

### 1.1 åŒæ­¥ç­–ç•¥

**åŽŸåˆ™**ï¼š
- âœ… åªå¤åˆ¶æ–‡ä»¶ï¼Œä¸åˆ é™¤ç›®æ ‡æ–‡ä»¶
- âœ… å¦‚æžœç›®æ ‡æ–‡ä»¶è¾ƒæ–°ï¼Œè·³è¿‡ï¼ˆä¸è¦†ç›–ï¼‰
- âœ… æ”¯æŒå¤‡ä»½
- âœ… æ”¯æŒå¹²è¿è¡Œï¼ˆé¢„è§ˆï¼‰

### 1.2 ä½¿ç”¨å®‰å…¨åŒæ­¥è„šæœ¬

```bash
# 1. é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®žé™…å¤åˆ¶ï¼‰
cd ~/.local/share/jqquant
python scripts/sync_to_main_project_safe.py --dry-run

# 2. å®žé™…åŒæ­¥ï¼ˆå¸¦å¤‡ä»½ï¼‰
python scripts/sync_to_main_project_safe.py --backup

# 3. ä»…åŒæ­¥ï¼ˆä¸å¤‡ä»½ï¼‰
python scripts/sync_to_main_project_safe.py
```

### 1.3 åŒæ­¥å†…å®¹

**ä¼šåŒæ­¥**ï¼š
- ä»£ç æ–‡ä»¶ï¼ˆ`gui/`, `markets/`, `core/`ç­‰ï¼‰
- æ–‡æ¡£æ–‡ä»¶ï¼ˆ`docs/`ï¼‰
- é…ç½®æ–‡ä»¶ï¼ˆ`config/`ï¼Œä¸å«æ•æ„Ÿä¿¡æ¯ï¼‰
- è„šæœ¬æ–‡ä»¶ï¼ˆ`scripts/`ï¼‰

**ä¸ä¼šåŒæ­¥**ï¼ˆé¿å…è¦†ç›–ï¼‰ï¼š
- Gitç›®å½•ï¼ˆ`.git/`ï¼‰
- ç¼“å­˜æ–‡ä»¶ï¼ˆ`__pycache__/`, `*.pyc`ï¼‰
- æ•°æ®æ–‡ä»¶ï¼ˆ`data/`, `cache/`, `logs/`ï¼‰
- è™šæ‹ŸçŽ¯å¢ƒï¼ˆ`venv/`ï¼‰

### 1.4 å®‰å…¨ä¿è¯

1. **å¤‡ä»½æœºåˆ¶**ï¼š
   ```bash
   # è‡ªåŠ¨å¤‡ä»½åˆ°ä¸»ç›®å½•çš„çˆ¶ç›®å½•
   /home/taotao/dev/QuantTest/TRQuant_backup_20241129_120000
   ```

2. **æ–‡ä»¶ä¿æŠ¤**ï¼š
   - ä¸åˆ é™¤ç›®æ ‡æ–‡ä»¶
   - ä¸è¦†ç›–è¾ƒæ–°çš„æ–‡ä»¶
   - ä¿ç•™GitåŽ†å²

3. **æ—¥å¿—è®°å½•**ï¼š
   - è¯¦ç»†è®°å½•æ¯ä¸ªæ“ä½œ
   - æ˜¾ç¤ºè·³è¿‡çš„æ–‡ä»¶åŠåŽŸå› 

---

## ðŸ’» ç¬¬äºŒéƒ¨åˆ†ï¼šä¸»é¡¹ç›®å¼€å‘ï¼ˆçœ‹åˆ°å®žé™…æ•ˆæžœï¼‰

### 2.1 å¼€å‘çŽ¯å¢ƒé…ç½®

#### æ­¥éª¤1ï¼šä¿®æ”¹é…ç½®æ”¯æŒå¼€å‘æ¨¡å¼

**ä¿®æ”¹ `config/settings.py`**ï¼š

```python
import os
from pathlib import Path

# æ£€æµ‹è¿è¡Œæ¨¡å¼
def get_project_root():
    """èŽ·å–é¡¹ç›®æ ¹ç›®å½•"""
    # ä¼˜å…ˆä½¿ç”¨çŽ¯å¢ƒå˜é‡
    if os.getenv('JQQUANT_DEV_MODE') == '1':
        return Path('/home/taotao/dev/QuantTest/TRQuant')
    
    # æ£€æµ‹å½“å‰æ–‡ä»¶ä½ç½®
    current_file = Path(__file__).resolve()
    current_path = str(current_file)
    
    # å¦‚æžœåœ¨devç›®å½•ï¼Œä½¿ç”¨ä¸»é¡¹ç›®
    if 'dev/QuantTest/TRQuant' in current_path:
        return Path('/home/taotao/dev/QuantTest/TRQuant')
    
    # é»˜è®¤ä½¿ç”¨å®‰è£…ç›®å½•
    return Path(__file__).parent.parent

PROJECT_ROOT = get_project_root()

# æ•°æ®ç›®å½•ï¼ˆå¯ä»¥ç‹¬ç«‹é…ç½®ï¼‰
if os.getenv('JQQUANT_DEV_MODE') == '1':
    # å¼€å‘æ¨¡å¼ï¼šæ•°æ®ç›®å½•ä¹Ÿåœ¨ä¸»é¡¹ç›®
    DATA_DIR = PROJECT_ROOT / "data"
    CACHE_DIR = PROJECT_ROOT / "cache"
    LOGS_DIR = PROJECT_ROOT / "logs"
    REPORTS_DIR = PROJECT_ROOT / "reports"
else:
    # ç”Ÿäº§æ¨¡å¼ï¼šä½¿ç”¨ç”¨æˆ·ç›®å½•
    user_data_dir = Path.home() / '.local/share/jqquant'
    DATA_DIR = user_data_dir / "data"
    CACHE_DIR = user_data_dir / "cache"
    LOGS_DIR = user_data_dir / "logs"
    REPORTS_DIR = user_data_dir / "reports"
```

#### æ­¥éª¤2ï¼šåˆ›å»ºå¼€å‘å¯åŠ¨è„šæœ¬

**åˆ›å»º `scripts/dev_run.sh`**ï¼š

```bash
#!/usr/bin/env bash
# å¼€å‘æ¨¡å¼å¯åŠ¨è„šæœ¬

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

# è®¾ç½®å¼€å‘æ¨¡å¼
export JQQUANT_DEV_MODE=1

# æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
if [ -f "${PROJECT_ROOT}/venv/bin/activate" ]; then
    source "${PROJECT_ROOT}/venv/bin/activate"
fi

# è¿è¡Œåº”ç”¨
cd "${PROJECT_ROOT}"
exec python3 JQQuant.py "$@"
```

**åˆ›å»º `scripts/dev_run.py`**ï¼ˆWindowså…¼å®¹ï¼‰ï¼š

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""å¼€å‘æ¨¡å¼å¯åŠ¨è„šæœ¬ï¼ˆè·¨å¹³å°ï¼‰"""

import os
import sys
from pathlib import Path

# è®¾ç½®å¼€å‘æ¨¡å¼
os.environ['JQQUANT_DEV_MODE'] = '1'

# é¡¹ç›®æ ¹ç›®å½•
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

# åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
os.chdir(project_root)

# è¿è¡Œä¸»ç¨‹åº
if __name__ == '__main__':
    from JQQuant import main
    main()
```

#### æ­¥éª¤3ï¼šåœ¨Cursorä¸­è¿è¡Œ

**æ–¹æ³•1ï¼šä½¿ç”¨ç»ˆç«¯è¿è¡Œ**
```bash
# åœ¨Cursorç»ˆç«¯ä¸­
cd /home/taotao/dev/QuantTest/TRQuant
JQQUANT_DEV_MODE=1 python JQQuant.py
```

**æ–¹æ³•2ï¼šé…ç½®è¿è¡Œä»»åŠ¡**

**åˆ›å»º `.vscode/tasks.json`**ï¼š

```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "è¿è¡ŒJQQuantï¼ˆå¼€å‘æ¨¡å¼ï¼‰",
            "type": "shell",
            "command": "python3",
            "args": ["JQQuant.py"],
            "options": {
                "env": {
                    "JQQUANT_DEV_MODE": "1"
                },
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": [],
            "presentation": {
                "reveal": "always",
                "panel": "new"
            }
        }
    ]
}
```

**åˆ›å»º `.vscode/launch.json`**ï¼š

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: JQQuantï¼ˆå¼€å‘æ¨¡å¼ï¼‰",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/JQQuant.py",
            "console": "integratedTerminal",
            "env": {
                "JQQUANT_DEV_MODE": "1"
            },
            "cwd": "${workspaceFolder}"
        }
    ]
}
```

### 2.2 å¼€å‘å·¥ä½œæµ

1. **åœ¨Cursorä¸­æ‰“å¼€ä¸»é¡¹ç›®**
   ```bash
   # File â†’ Open Folder
   /home/taotao/dev/QuantTest/TRQuant
   ```

2. **ç¼–å†™ä»£ç **
   - åœ¨Cursorä¸­ç¼–è¾‘
   - å®žæ—¶çœ‹åˆ°ä»£ç 

3. **è¿è¡Œæµ‹è¯•**
   ```bash
   # æ–¹å¼1ï¼šç»ˆç«¯è¿è¡Œ
   JQQUANT_DEV_MODE=1 python JQQuant.py
   
   # æ–¹å¼2ï¼šä½¿ç”¨è¿è¡Œä»»åŠ¡ï¼ˆF5ï¼‰
   ```

4. **æŸ¥çœ‹æ•ˆæžœ**
   - GUIçª—å£æ­£å¸¸æ‰“å¼€
   - åŠŸèƒ½æ­£å¸¸ä½¿ç”¨
   - æ•°æ®ä¿å­˜åœ¨ä¸»é¡¹ç›®çš„`data/`ç›®å½•

---

## ðŸš€ ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¿æŒå¿«æ·æ–¹å¼å¯ç”¨

### 3.1 å¿«æ·æ–¹å¼é…ç½®

**ä¿®æ”¹ `scripts/sync_shortcuts.sh`**ï¼š

```bash
#!/usr/bin/env bash
# åŒæ­¥å¿«æ·æ–¹å¼ï¼Œæ”¯æŒå¼€å‘æ¨¡å¼

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

# æ£€æµ‹è¿è¡Œæ¨¡å¼
if [ -n "${JQQUANT_DEV_MODE:-}" ] && [ "${JQQUANT_DEV_MODE}" = "1" ]; then
    # å¼€å‘æ¨¡å¼ï¼šä½¿ç”¨ä¸»é¡¹ç›®ç›®å½•
    APP_DIR="${PROJECT_ROOT}"
    INSTALL_DIR="${PROJECT_ROOT}"
else
    # ç”Ÿäº§æ¨¡å¼ï¼šä½¿ç”¨å®‰è£…ç›®å½•
    INSTALL_DIR="${JQQUANT_INSTALL_DIR:-$HOME/.local/share/jqquant}"
    APP_DIR="${INSTALL_DIR}"
fi

LAUNCHER_PATH="$HOME/.local/bin/jqquant"
APPLICATIONS_DIR="$HOME/.local/share/applications"
ICON_TARGET="$HOME/.local/share/icons/hicolor/256x256/apps/jqquant.svg"
DESKTOP_ENTRY="$APPLICATIONS_DIR/jqquant.desktop"
USER_DESKTOP="${XDG_DESKTOP_DIR:-$HOME/Desktop}"
DESKTOP_SHORTCUT="$USER_DESKTOP/jqquant.desktop"
ICON_SOURCE="$APP_DIR/gui/resources/jqquant_icon.svg"

mkdir -p "$HOME/.local/bin" \
         "$APPLICATIONS_DIR" \
         "$HOME/.local/share/icons/hicolor/256x256/apps"

# å¤åˆ¶å›¾æ ‡
if [ -f "$ICON_SOURCE" ]; then
    cp "$ICON_SOURCE" "$ICON_TARGET"
fi

# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > "$LAUNCHER_PATH" <<EOF_LAUNCHER
#!/usr/bin/env bash
set -euo pipefail

# æ£€æµ‹è¿è¡Œæ¨¡å¼
if [ -f "${PROJECT_ROOT}/JQQuant.py" ] && [ -n "\${JQQUANT_USE_DEV:-}" ]; then
    # å¼€å‘æ¨¡å¼
    APP_DIR="${PROJECT_ROOT}"
    export JQQUANT_DEV_MODE=1
else
    # ç”Ÿäº§æ¨¡å¼
    APP_DIR="${INSTALL_DIR}"
fi

if [ ! -f "\${APP_DIR}/JQQuant.py" ]; then
    echo "é”™è¯¯: æ‰¾ä¸åˆ°JQQuant.pyåœ¨ \${APP_DIR}"
    exit 1
fi

cd "\${APP_DIR}" || exit 1

# æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
if [ -f "\${APP_DIR}/venv/bin/activate" ]; then
    source "\${APP_DIR}/venv/bin/activate"
fi

exec python3 JQQuant.py "\$@"
EOF_LAUNCHER

chmod +x "$LAUNCHER_PATH"

# åˆ›å»ºæ¡Œé¢æ¡ç›®
cat > "$DESKTOP_ENTRY" <<EOF_DESKTOP
[Desktop Entry]
Version=2.0
Type=Application
Name=éŸ¬ç¿é‡åŒ–
Comment=æœºæž„çº§é‡åŒ–æŠ•ç ”å¹³å°
Exec=$LAUNCHER_PATH
Icon=$ICON_TARGET
Terminal=false
Categories=Finance;Office;Development;
StartupNotify=true
StartupWMClass=JQQuant
EOF_DESKTOP

# å¤åˆ¶åˆ°æ¡Œé¢
if [ -d "$USER_DESKTOP" ]; then
    cp "$DESKTOP_ENTRY" "$DESKTOP_SHORTCUT"
fi

update-desktop-database "$APPLICATIONS_DIR" >/dev/null 2>&1 || true

echo "âœ… å¿«æ·æ–¹å¼å·²æ›´æ–°"
echo "   å¯åŠ¨è„šæœ¬: $LAUNCHER_PATH"
echo "   æ¡Œé¢æ¡ç›®: $DESKTOP_ENTRY"
```

### 3.2 å¿«æ·æ–¹å¼ä½¿ç”¨

**é»˜è®¤è¡Œä¸º**ï¼š
- ç‚¹å‡»å¿«æ·æ–¹å¼ â†’ ä½¿ç”¨å®‰è£…ç›®å½•è¿è¡Œ

**åˆ‡æ¢åˆ°å¼€å‘æ¨¡å¼**ï¼š
```bash
# è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼Œä¸‹æ¬¡å¯åŠ¨ä½¿ç”¨å¼€å‘æ¨¡å¼
export JQQUANT_USE_DEV=1

# æˆ–ä¿®æ”¹å¯åŠ¨è„šæœ¬ï¼Œé»˜è®¤ä½¿ç”¨å¼€å‘æ¨¡å¼
```

---

## ðŸ³ ç¬¬å››éƒ¨åˆ†ï¼šDockerè·¨å¹³å°éƒ¨ç½²

### 4.1 Dockeré…ç½®ä¼˜åŒ–

**ä¿®æ”¹ `docker-compose.yml`**ï¼š

```yaml
version: '3.8'

services:
  jqquant:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: jqquant
    volumes:
      # æŒ‚è½½é…ç½®ç›®å½•ï¼ˆä»Žä¸»é¡¹ç›®æˆ–å®‰è£…ç›®å½•ï¼‰
      - ${JQQUANT_CONFIG_DIR:-./config}:/app/config:ro
      # æŒ‚è½½æ•°æ®ç›®å½•ï¼ˆæŒä¹…åŒ–ï¼‰
      - ${JQQUANT_DATA_DIR:-./data}:/app/data
      # æŒ‚è½½æ—¥å¿—ç›®å½•
      - ${JQQUANT_LOGS_DIR:-./logs}:/app/logs
      # æŒ‚è½½ç»“æžœç›®å½•
      - ${JQQUANT_RESULTS_DIR:-./results}:/app/results
      # å¦‚æžœéœ€è¦GUIï¼ŒæŒ‚è½½X11
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ${XAUTHORITY:-$HOME/.Xauthority}:/root/.Xauthority:ro
    environment:
      - PYTHONUNBUFFERED=1
      - DISPLAY=${DISPLAY:-:0}
      - JQQUANT_DEV_MODE=${JQQUANT_DEV_MODE:-0}
    network_mode: host  # å¦‚æžœéœ€è¦è®¿é—®æœ¬åœ°æœåŠ¡
    # å¦‚æžœéœ€è¦GUI
    privileged: true
```

### 4.2 è·¨å¹³å°Dockerè„šæœ¬

**åˆ›å»º `docker/run_cross_platform.sh`**ï¼š

```bash
#!/usr/bin/env bash
# è·¨å¹³å°Dockerè¿è¡Œè„šæœ¬

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

# æ£€æµ‹æ“ä½œç³»ç»Ÿ
detect_os() {
    case "$(uname -s)" in
        Linux*)     echo "linux";;
        Darwin*)    echo "macos";;
        MINGW*)     echo "windows";;
        CYGWIN*)   echo "windows";;
        *)          echo "unknown";;
    esac
}

OS=$(detect_os)

# é…ç½®ç›®å½•ï¼ˆä¼˜å…ˆä½¿ç”¨ä¸»é¡¹ç›®ï¼Œå¦åˆ™ä½¿ç”¨å®‰è£…ç›®å½•ï¼‰
if [ -f "${PROJECT_ROOT}/JQQuant.py" ]; then
    CONFIG_DIR="${PROJECT_ROOT}/config"
    DATA_DIR="${PROJECT_ROOT}/data"
    LOGS_DIR="${PROJECT_ROOT}/logs"
    RESULTS_DIR="${PROJECT_ROOT}/results"
else
    INSTALL_DIR="${HOME}/.local/share/jqquant"
    CONFIG_DIR="${INSTALL_DIR}/config"
    DATA_DIR="${INSTALL_DIR}/data"
    LOGS_DIR="${INSTALL_DIR}/logs"
    RESULTS_DIR="${INSTALL_DIR}/results"
fi

# åˆ›å»ºç›®å½•
mkdir -p "${CONFIG_DIR}" "${DATA_DIR}" "${LOGS_DIR}" "${RESULTS_DIR}"

# Dockeré•œåƒåç§°
IMAGE_NAME="jqquant:latest"

# æž„å»ºé•œåƒï¼ˆå¦‚æžœéœ€è¦ï¼‰
if [ "${1:-}" = "--build" ] || ! docker image inspect "${IMAGE_NAME}" >/dev/null 2>&1; then
    echo "æž„å»ºDockeré•œåƒ..."
    docker build -t "${IMAGE_NAME}" -f "${PROJECT_ROOT}/Dockerfile" "${PROJECT_ROOT}"
fi

# è¿è¡Œå®¹å™¨
echo "å¯åŠ¨Dockerå®¹å™¨..."
docker run -it --rm \
    --name jqquant-container \
    -v "${CONFIG_DIR}:/app/config:ro" \
    -v "${DATA_DIR}:/app/data" \
    -v "${LOGS_DIR}:/app/logs" \
    -v "${RESULTS_DIR}:/app/results" \
    -e PYTHONUNBUFFERED=1 \
    "${IMAGE_NAME}" \
    python3 JQQuant.py "${@:2}"
```

### 4.3 è·¨å¹³å°å®‰è£…è„šæœ¬

**åˆ›å»º `scripts/install_cross_platform.sh`**ï¼š

```bash
#!/usr/bin/env bash
# è·¨å¹³å°å®‰è£…è„šæœ¬

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

# æ£€æµ‹æ“ä½œç³»ç»Ÿ
OS=$(uname -s)

# å®‰è£…ç›®å½•
case "$OS" in
    Linux*)
        INSTALL_DIR="${HOME}/.local/share/jqquant"
        BIN_DIR="${HOME}/.local/bin"
        ;;
    Darwin*)
        INSTALL_DIR="${HOME}/Library/Application Support/jqquant"
        BIN_DIR="${HOME}/.local/bin"
        ;;
    MINGW*|CYGWIN*)
        INSTALL_DIR="${APPDATA}/jqquant"
        BIN_DIR="${HOME}/.local/bin"
        ;;
    *)
        echo "ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ: $OS"
        exit 1
        ;;
esac

echo "å®‰è£…ç›®å½•: ${INSTALL_DIR}"
echo "äºŒè¿›åˆ¶ç›®å½•: ${BIN_DIR}"

# åˆ›å»ºç›®å½•
mkdir -p "${INSTALL_DIR}" "${BIN_DIR}"

# å¤åˆ¶æ–‡ä»¶
echo "å¤åˆ¶æ–‡ä»¶..."
rsync -a \
    --exclude ".git/" \
    --exclude "__pycache__/" \
    --exclude "venv/" \
    --exclude "*.pyc" \
    "${PROJECT_ROOT}/" "${INSTALL_DIR}/"

# åˆ›å»ºå¯åŠ¨è„šæœ¬
cat > "${BIN_DIR}/jqquant" <<EOF
#!/usr/bin/env bash
cd "${INSTALL_DIR}"
if [ -f venv/bin/activate ]; then
    source venv/bin/activate
fi
exec python3 JQQuant.py "\$@"
EOF

chmod +x "${BIN_DIR}/jqquant"

echo "âœ… å®‰è£…å®Œæˆï¼"
echo "   è¿è¡Œ: ${BIN_DIR}/jqquant"
```

### 4.4 Dockerå¤šé˜¶æ®µæž„å»ºï¼ˆä¼˜åŒ–ï¼‰

**ä¿®æ”¹ `Dockerfile`**ï¼š

```dockerfile
# é˜¶æ®µ1ï¼šæž„å»º
FROM python:3.12-slim as builder

WORKDIR /app

# å®‰è£…æž„å»ºä¾èµ–
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc g++ make wget \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£…TA-Lib
RUN wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz && \
    tar -xzf ta-lib-0.4.0-src.tar.gz && \
    cd ta-lib/ && \
    ./configure --prefix=/usr && \
    make && \
    make install && \
    cd .. && \
    rm -rf ta-lib ta-lib-0.4.0-src.tar.gz

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --upgrade pip && \
    pip install --user -r requirements.txt

# é˜¶æ®µ2ï¼šè¿è¡Œ
FROM python:3.12-slim

WORKDIR /app

# ä»Žæž„å»ºé˜¶æ®µå¤åˆ¶ä¾èµ–
COPY --from=builder /root/.local /root/.local
COPY --from=builder /usr/lib/libta_lib.so* /usr/lib/

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# åˆ›å»ºå¿…è¦ç›®å½•
RUN mkdir -p data logs results

# è®¾ç½®çŽ¯å¢ƒå˜é‡
ENV PYTHONUNBUFFERED=1 \
    PATH=/root/.local/bin:$PATH

# æš´éœ²ç«¯å£
EXPOSE 8000

# é»˜è®¤å‘½ä»¤
CMD ["python3", "JQQuant.py"]
```

---

## ðŸ“‹ å®Œæ•´å·¥ä½œæµæ€»ç»“

### æ—¥å¸¸å¼€å‘æµç¨‹

1. **åœ¨Cursorä¸­æ‰“å¼€ä¸»é¡¹ç›®**
   ```bash
   /home/taotao/dev/QuantTest/TRQuant
   ```

2. **ç¼–å†™ä»£ç **
   - åœ¨Cursorä¸­ç¼–è¾‘
   - ä½¿ç”¨Gitç®¡ç†ç‰ˆæœ¬

3. **è¿è¡Œæµ‹è¯•**
   ```bash
   JQQUANT_DEV_MODE=1 python JQQuant.py
   ```

4. **åŒæ­¥åˆ°å®‰è£…ç›®å½•**ï¼ˆå¯é€‰ï¼‰
   ```bash
   cd ~/.local/share/jqquant
   python scripts/sync_to_main_project_safe.py
   ```

5. **æäº¤Git**
   ```bash
   cd /home/taotao/dev/QuantTest/TRQuant
   git add .
   git commit -m "åŠŸèƒ½æè¿°"
   git push
   ```

### éƒ¨ç½²æµç¨‹

1. **æž„å»ºDockeré•œåƒ**
   ```bash
   cd /home/taotao/dev/QuantTest/TRQuant
   docker build -t jqquant:latest .
   ```

2. **è¿è¡Œå®¹å™¨**
   ```bash
   ./docker/run_cross_platform.sh
   ```

3. **è·¨å¹³å°å®‰è£…**
   ```bash
   ./scripts/install_cross_platform.sh
   ```

---

## âœ… æ£€æŸ¥æ¸…å•

### å¼€å‘çŽ¯å¢ƒ
- [ ] ä¸»é¡¹ç›®ç›®å½•å¯æ­£å¸¸æ‰“å¼€
- [ ] Cursorå¯ä»¥è¿è¡Œä»£ç 
- [ ] å¼€å‘æ¨¡å¼çŽ¯å¢ƒå˜é‡ç”Ÿæ•ˆ
- [ ] GUIå¯ä»¥æ­£å¸¸æ˜¾ç¤º

### å¿«æ·æ–¹å¼
- [ ] Dockå¿«æ·æ–¹å¼å¯ç”¨
- [ ] æ¡Œé¢å¿«æ·æ–¹å¼å¯ç”¨
- [ ] å¯åŠ¨è„šæœ¬æ­£ç¡®

### Docker
- [ ] Dockeré•œåƒå¯ä»¥æž„å»º
- [ ] å®¹å™¨å¯ä»¥è¿è¡Œ
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸
- [ ] è·¨å¹³å°è„šæœ¬å¯ç”¨

---

*å®Œæ•´æ–¹æ¡ˆæ–‡æ¡£ - æœ€åŽæ›´æ–°ï¼š2024-11-29*

