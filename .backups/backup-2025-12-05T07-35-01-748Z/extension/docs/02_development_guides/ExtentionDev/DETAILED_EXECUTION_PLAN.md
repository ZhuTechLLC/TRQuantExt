# TRQuant Cursor Extension è¯¦ç»†æ‰§è¡Œè®¡åˆ’

> åŸºäºExtentionDevæ–‡ä»¶å¤¹æ‰€æœ‰æ–‡æ¡£çš„æ·±åº¦åˆ†æ
> åˆ›å»ºæ—¥æœŸ: 2025-12-03
> ç›®æ ‡: å®ç°ç±»ä¼¼QuantConnectçš„å®Œæ•´é‡åŒ–æŠ•èµ„æ’ä»¶

---

## ğŸ“Š å½“å‰çŠ¶æ€æ€»è§ˆ

### âœ… å·²å®Œæˆæ¨¡å— (æ— éœ€ä¿®æ”¹ï¼Œåªéœ€éªŒè¯)

| ç±»åˆ« | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| **æ ¸å¿ƒå…¥å£** | `extension.ts` | âœ… å®Œæˆ |
| **TypeScriptå®¢æˆ·ç«¯** | `trquantClient.ts` | âœ… å®Œæˆ |
| **MCPæ³¨å†Œå™¨** | `mcpRegistrar.ts` | âœ… å®Œæˆ |
| **é¡¹ç›®é…ç½®ç®¡ç†** | `projectConfig.ts` | âœ… å®Œæˆ |
| **å›æµ‹ç®¡ç†å™¨** | `backtestManager.ts` | âœ… å®Œæˆ |
| **æ—¥å¿—ç³»ç»Ÿ** | `logger.ts` | âœ… å®Œæˆ |
| **é”™è¯¯å¤„ç†** | `errors.ts` | âœ… å®Œæˆ |
| **é…ç½®å·¥å…·** | `config.ts` | âœ… å®Œæˆ |

### âœ… å·²å®Œæˆå‘½ä»¤ (7ä¸ª)

| å‘½ä»¤ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| `getMarketStatus` | `getMarketStatus.ts` | è·å–å¸‚åœºçŠ¶æ€ |
| `getMainlines` | `getMainlines.ts` | è·å–æŠ•èµ„ä¸»çº¿ |
| `recommendFactors` | `recommendFactors.ts` | æ¨èå› å­ |
| `generateStrategy` | `generateStrategy.ts` | ç”Ÿæˆç­–ç•¥ä»£ç (PTrade/QMT) |
| `analyzeBacktest` | `analyzeBacktest.ts` | åˆ†æå›æµ‹ç»“æœ |
| `createProject` | `createProject.ts` | åˆ›å»ºé‡åŒ–é¡¹ç›® |
| `runBacktest` | `runBacktest.ts` | è¿è¡Œå›æµ‹ |

### âœ… å·²å®Œæˆè§†å›¾ (4ä¸ª)

| è§†å›¾ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| Dashboard | `dashboardPanel.ts` | ä¸»æ§åˆ¶é¢æ¿ |
| Market Panel | `marketPanel.ts` | å¸‚åœºä¿¡æ¯é¢æ¿ |
| Project Explorer | `projectExplorer.ts` | é¡¹ç›®èµ„æºç®¡ç†å™¨ |
| Welcome Panel | `welcomePanel.ts` | æ¬¢è¿é¡µé¢ |

### âœ… å·²å®ŒæˆPythonåç«¯

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| Bridgeé€šä¿¡ | `bridge.py` | JSON-stdioé€šä¿¡æ¡¥ |
| MCP Server | `mcp_server.py` | 5ä¸ªåŸºç¡€MCPå·¥å…· |
| ç­–ç•¥ç”Ÿæˆå™¨ | `strategy_generator.py` | PTrade/QMTç­–ç•¥æ¨¡æ¿ |
| å›æµ‹å¼•æ“ | `backtest_engine.py` | æœ¬åœ°å›æµ‹æ ¸å¿ƒ |

### âœ… å·²å®Œæˆæ–‡æ¡£

- `DESIGN.md` - ç³»ç»Ÿè®¾è®¡
- `INSTALLATION.md` - å®‰è£…æŒ‡å—
- `USAGE.md` - ä½¿ç”¨æ•™ç¨‹
- `README.md` - é¡¹ç›®è¯´æ˜
- `QUICK_START.md` - å¿«é€Ÿå¼€å§‹

### âœ… å·²å®ŒæˆCursorè§„åˆ™æ–‡ä»¶

- `trquant-architecture.mdc` - æ¶æ„è§„åˆ™
- `trquant-prompts.mdc` - AIæç¤ºè§„åˆ™
- `trquant-style.mdc` - ä»£ç é£æ ¼è§„åˆ™

---

## ğŸ”´ Phase 0: ç´§æ€¥ä¿®å¤ (ç«‹å³æ‰§è¡Œ)

### Task 0.1: æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
```
ä¼˜å…ˆçº§: ğŸ”´ ç´§æ€¥
é¢„è®¡æ—¶é—´: 10åˆ†é’Ÿ
çŠ¶æ€: â³ å¾…æ‰§è¡Œ

æ­¥éª¤:
1. cd /home/taotao/dev/QuantTest/TRQuant/extension
2. rm -rf dist
3. npm run compile
4. æ£€æŸ¥ç¼–è¯‘è¾“å‡ºæ˜¯å¦æœ‰é”™è¯¯
```

### Task 0.2: æ‰“åŒ…VSIX
```
ä¼˜å…ˆçº§: ğŸ”´ ç´§æ€¥
é¢„è®¡æ—¶é—´: 5åˆ†é’Ÿ
çŠ¶æ€: â³ å¾…æ‰§è¡Œ

æ­¥éª¤:
1. npx @vscode/vsce package --allow-missing-repository --no-dependencies
2. éªŒè¯ç”Ÿæˆ trquant-cursor-extension-0.1.0.vsix
```

### Task 0.3: å®‰è£…å¹¶æµ‹è¯•
```
ä¼˜å…ˆçº§: ğŸ”´ ç´§æ€¥
é¢„è®¡æ—¶é—´: 10åˆ†é’Ÿ
çŠ¶æ€: â³ å¾…æ‰§è¡Œ

æ­¥éª¤:
1. cursor --install-extension trquant-cursor-extension-0.1.0.vsix
2. é‡å¯Cursor
3. éªŒè¯ä¾§è¾¹æ å›¾æ ‡æ˜¾ç¤º
4. éªŒè¯å‘½ä»¤é¢æ¿å¯ç”¨ (Ctrl+Shift+P -> TRQuant)
5. éªŒè¯æ¬¢è¿é¡µé¢æ˜¾ç¤º
```

---

## ğŸŸ¡ Phase 1: TreeViewè¡¥å…… (æœ¬å‘¨)

### Task 1.1: å®ç°å¸‚åœºçŠ¶æ€TreeView
```
ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦
é¢„è®¡æ—¶é—´: 2å°æ—¶
æ–‡ä»¶: src/views/marketTreeView.ts

åŠŸèƒ½:
- æ˜¾ç¤ºå½“å‰å¸‚åœºRegime (Risk On/Off/Neutral)
- æ˜¾ç¤ºä¸»è¦æŒ‡æ•°è¶‹åŠ¿ (ä¸Šè¯/æ·±è¯/åˆ›ä¸šæ¿)
- æ˜¾ç¤ºé£æ ¼è½®åŠ¨çŠ¶æ€ (å¤§ç›˜/å°ç›˜, ä»·å€¼/æˆé•¿)
- å®šæ—¶è‡ªåŠ¨åˆ·æ–° (æ¯5åˆ†é’Ÿ)
- ç‚¹å‡»å±•å¼€è¯¦ç»†ä¿¡æ¯
```

### Task 1.2: å®ç°æŠ•èµ„ä¸»çº¿TreeView
```
ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦
é¢„è®¡æ—¶é—´: 2å°æ—¶
æ–‡ä»¶: src/views/mainlinesTreeView.ts

åŠŸèƒ½:
- æ˜¾ç¤ºTOP20æŠ•èµ„ä¸»çº¿åˆ—è¡¨
- æ˜¾ç¤ºè¯„åˆ†å’Œæ’åå˜åŒ–
- æ˜¾ç¤ºå…³è”è¡Œä¸š
- ç‚¹å‡»æŸ¥çœ‹ä¸»çº¿è¯¦æƒ…
- æ”¯æŒæœç´¢è¿‡æ»¤
```

### Task 1.3: å®ç°ç­–ç•¥ç®¡ç†TreeView
```
ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦
é¢„è®¡æ—¶é—´: 2å°æ—¶
æ–‡ä»¶: src/views/strategiesTreeView.ts

åŠŸèƒ½:
- åˆ—å‡ºé¡¹ç›®ä¸­æ‰€æœ‰ç­–ç•¥æ–‡ä»¶
- åŒºåˆ†å¹³å°ç±»å‹ (PTrade/QMTå›¾æ ‡)
- æ˜¾ç¤ºç­–ç•¥çŠ¶æ€ (è‰ç¨¿/å›æµ‹ä¸­/å·²éªŒè¯)
- å³é”®èœå•: è¿è¡Œå›æµ‹ã€ç¼–è¾‘ã€åˆ é™¤
- æœ€åä¿®æ”¹æ—¶é—´
```

### Task 1.4: æ›´æ–°package.jsonå¹¶æ³¨å†ŒTreeView
```
ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦
é¢„è®¡æ—¶é—´: 30åˆ†é’Ÿ

æ­¥éª¤:
1. æ·»åŠ æ–°çš„TreeViewå®šä¹‰åˆ°views
2. åœ¨extension.tsä¸­å¯¼å…¥å¹¶æ³¨å†Œ
3. é‡æ–°ç¼–è¯‘å¹¶æµ‹è¯•
```

---

## ğŸŸ¡ Phase 2: MCPå·¥å…·æ‰©å±• (æœ¬å‘¨)

### Task 2.1: æ‰©å±•MCPå·¥å…·é›†
```
ä¼˜å…ˆçº§: ğŸŸ¡ é‡è¦
é¢„è®¡æ—¶é—´: 1å¤©
æ–‡ä»¶: python/mcp_server.py

å½“å‰å·¥å…· (5ä¸ª):
- trquant_get_market_status
- trquant_get_mainlines
- trquant_recommend_factors
- trquant_generate_strategy
- trquant_analyze_backtest

éœ€è¦æ–°å¢ (7ä¸ª):
- trquant_create_project      # åˆ›å»ºé‡åŒ–é¡¹ç›®
- trquant_run_backtest        # è¿è¡Œå›æµ‹
- trquant_optimize_params     # å‚æ•°ä¼˜åŒ–
- trquant_get_realtime_data   # è·å–å®æ—¶æ•°æ®
- trquant_deploy_strategy     # éƒ¨ç½²ç­–ç•¥
- trquant_get_portfolio       # è·å–æŒä»“
- trquant_compare_strategies  # å¯¹æ¯”ç­–ç•¥
```

---

## ğŸŸ¢ Phase 3: ä¸“ä¸šå¯è§†åŒ– (ä¸‹å‘¨)

### Task 3.1: é›†æˆEChartså›¾è¡¨åº“
```
ä¼˜å…ˆçº§: ğŸŸ¢ ä¸€èˆ¬
é¢„è®¡æ—¶é—´: 3å¤©
æ–‡ä»¶: src/views/chartPanel.ts

åŠŸèƒ½:
- Kçº¿å›¾ (æ”¯æŒMA/MACD/KDJå åŠ )
- æ”¶ç›Šæ›²çº¿å›¾ (ä¸åŸºå‡†å¯¹æ¯”)
- å›æ’¤æ›²çº¿å›¾
- å› å­çƒ­åŠ›å›¾
- æŒä»“åˆ†å¸ƒé¥¼å›¾
- å›¾è¡¨äº¤äº’ (ç¼©æ”¾ã€æ ‡æ³¨ã€å¯¼å‡º)
```

### Task 3.2: å®ç°Dashboardå®æ—¶æ›´æ–°
```
ä¼˜å…ˆçº§: ğŸŸ¢ ä¸€èˆ¬
é¢„è®¡æ—¶é—´: 1å¤©
æ–‡ä»¶: src/views/dashboardPanel.ts

å¢å¼ºåŠŸèƒ½:
- WebSocketå®æ—¶è¡Œæƒ…æ¨é€
- æŒä»“å®æ—¶ç›‘æ§
- ç­–ç•¥è¿è¡ŒçŠ¶æ€æ›´æ–°
```

### Task 3.3: æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ
```
ä¼˜å…ˆçº§: ğŸŸ¢ ä¸€èˆ¬
é¢„è®¡æ—¶é—´: 2å¤©
æ–‡ä»¶: python/tools/report_generator.py

åŠŸèƒ½:
- HTMLæŠ¥å‘Šæ¨¡æ¿
- PDFå¯¼å‡º (weasyprint)
- Excelæ•°æ®å¯¼å‡º
- å›æµ‹æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆ
```

---

## ğŸŸ¢ Phase 4: ç­–ç•¥ä¼˜åŒ–å™¨ (ç¬¬2å‘¨)

### Task 4.1: å‚æ•°ä¼˜åŒ–å™¨
```
ä¼˜å…ˆçº§: ğŸŸ¢ ä¸€èˆ¬
é¢„è®¡æ—¶é—´: 3å¤©
æ–‡ä»¶: 
  - src/commands/optimizeStrategy.ts
  - python/tools/optimizer.py

åŠŸèƒ½:
- å‚æ•°ç©ºé—´å®šä¹‰ (JSON Schema)
- ç½‘æ ¼æœç´¢
- éšæœºæœç´¢
- è´å¶æ–¯ä¼˜åŒ–
- å¹¶è¡Œä»»åŠ¡ç®¡ç†
- 3Dç»“æœå¯è§†åŒ–
```

### Task 4.2: Walk-Forwardåˆ†æ
```
ä¼˜å…ˆçº§: ğŸŸ¢ ä¸€èˆ¬
é¢„è®¡æ—¶é—´: 2å¤©

åŠŸèƒ½:
- æ»šåŠ¨çª—å£å›æµ‹
- æ ·æœ¬å¤–éªŒè¯
- è¿‡æ‹Ÿåˆæ£€æµ‹
```

### Task 4.3: å› å­åˆ†æå·¥å…·
```
ä¼˜å…ˆçº§: ğŸŸ¢ ä¸€èˆ¬
é¢„è®¡æ—¶é—´: 2å¤©

åŠŸèƒ½:
- å› å­ICåˆ†æ
- å› å­è¡°å‡æ›²çº¿
- å¤šå› å­ç›¸å…³æ€§
- å› å­è´¡çŒ®åº¦åˆ†è§£
```

---

## ğŸ”µ Phase 5: å®ç›˜å¯¹æ¥ (ç¬¬3å‘¨)

### Task 5.1: PTradeå®ç›˜éƒ¨ç½²
```
ä¼˜å…ˆçº§: ğŸ”µ é•¿æœŸ
é¢„è®¡æ—¶é—´: 3å¤©
æ–‡ä»¶: src/commands/deployToPTrade.ts

åŠŸèƒ½:
- ä»£ç æ ¼å¼éªŒè¯ (PTradeå…¼å®¹æ€§æ£€æŸ¥)
- ä¸€é”®ä¸Šä¼ åˆ°PTradeå®¢æˆ·ç«¯
- ç­–ç•¥è¿è¡ŒçŠ¶æ€ç›‘æ§
```

### Task 5.2: QMTå®ç›˜éƒ¨ç½²
```
ä¼˜å…ˆçº§: ğŸ”µ é•¿æœŸ
é¢„è®¡æ—¶é—´: 3å¤©
æ–‡ä»¶: src/commands/deployToQMT.ts

åŠŸèƒ½:
- ä»£ç æ ¼å¼éªŒè¯ (QMTå…¼å®¹æ€§æ£€æŸ¥)
- miniQMTè¿æ¥
- æŒä»“åŒæ­¥
```

### Task 5.3: æŒä»“åŒæ­¥ä¸é£æ§
```
ä¼˜å…ˆçº§: ğŸ”µ é•¿æœŸ
é¢„è®¡æ—¶é—´: 2å¤©

åŠŸèƒ½:
- å®ç›˜æŒä»“è¯»å–
- æœ¬åœ°ä¸å®ç›˜å·®å¼‚æ£€æµ‹
- é£æ§é¢„è­¦é€šçŸ¥
```

---

## ğŸ”µ Phase 6: æ•°æ®æœåŠ¡å¢å¼º (ç¬¬4å‘¨)

### Task 6.1: ç»Ÿä¸€æ•°æ®æºç®¡ç†
```
ä¼˜å…ˆçº§: ğŸ”µ é•¿æœŸ
é¢„è®¡æ—¶é—´: 3å¤©
æ–‡ä»¶: python/data_service.py

åŠŸèƒ½:
- æŠ½è±¡æ•°æ®æ¥å£
- JQDataé€‚é…å™¨
- AKShareé€‚é…å™¨
- Baostocké€‚é…å™¨
- æ•°æ®ç¼“å­˜ (Redis/æœ¬åœ°)
```

### Task 6.2: å®æ—¶æ•°æ®è®¢é˜…
```
ä¼˜å…ˆçº§: ğŸ”µ é•¿æœŸ
é¢„è®¡æ—¶é—´: 2å¤©

åŠŸèƒ½:
- WebSocketè¡Œæƒ…æ¨é€
- Level2æ•°æ®æ¥å…¥
- èµ„é‡‘æµæ•°æ®
```

---

## ğŸ“ éœ€è¦åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

### Phase 0 (ç«‹å³)
```
æ— éœ€æ–°å»ºæ–‡ä»¶ï¼Œåªéœ€ç¼–è¯‘éªŒè¯
```

### Phase 1 (æœ¬å‘¨)
```
src/views/marketTreeView.ts       # å¸‚åœºçŠ¶æ€TreeView
src/views/mainlinesTreeView.ts    # æŠ•èµ„ä¸»çº¿TreeView
src/views/strategiesTreeView.ts   # ç­–ç•¥ç®¡ç†TreeView
```

### Phase 2 (æœ¬å‘¨)
```
python/mcp_server.py              # æ‰©å±•ç°æœ‰æ–‡ä»¶
```

### Phase 3 (ä¸‹å‘¨)
```
src/views/chartPanel.ts           # EChartså›¾è¡¨é¢æ¿
python/tools/report_generator.py  # æŠ¥å‘Šç”Ÿæˆå™¨
```

### Phase 4 (ç¬¬2å‘¨)
```
src/commands/optimizeStrategy.ts  # å‚æ•°ä¼˜åŒ–å‘½ä»¤
python/tools/optimizer.py         # ä¼˜åŒ–å™¨å¼•æ“
```

### Phase 5 (ç¬¬3å‘¨)
```
src/commands/deployToPTrade.ts    # PTradeéƒ¨ç½²
src/commands/deployToQMT.ts       # QMTéƒ¨ç½²
```

### Phase 6 (ç¬¬4å‘¨)
```
python/data_service.py            # ç»Ÿä¸€æ•°æ®æœåŠ¡
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### Phase 0 éªŒæ”¶ (ä»Šå¤©)
- [ ] `npm run compile` æ— é”™è¯¯
- [ ] `vsix` æ–‡ä»¶æˆåŠŸç”Ÿæˆ
- [ ] æ‰©å±•å®‰è£…åˆ°CursoræˆåŠŸ
- [ ] ä¾§è¾¹æ æ˜¾ç¤ºTRQuantå›¾æ ‡
- [ ] å‘½ä»¤é¢æ¿æ˜¾ç¤ºæ‰€æœ‰TRQuantå‘½ä»¤
- [ ] æ¬¢è¿é¡µé¢æ­£å¸¸æ˜¾ç¤º

### Phase 1 éªŒæ”¶ (æœ¬å‘¨)
- [ ] 3ä¸ªæ–°TreeViewå…¨éƒ¨æ˜¾ç¤º
- [ ] TreeViewæ•°æ®æ­£ç¡®åŠ è½½
- [ ] TreeViewäº¤äº’æ­£å¸¸ (ç‚¹å‡»ã€åˆ·æ–°)

### Phase 2 éªŒæ”¶ (æœ¬å‘¨)
- [ ] MCPå·¥å…·æ‰©å±•åˆ°12ä¸ª
- [ ] AIèƒ½è°ƒç”¨æ‰€æœ‰MCPå·¥å…·
- [ ] å·¥å…·è¿”å›æ ¼å¼æ­£ç¡®

### Phase 3 éªŒæ”¶ (ä¸‹å‘¨)
- [ ] EChartså›¾è¡¨æ­£å¸¸æ¸²æŸ“
- [ ] å›¾è¡¨äº¤äº’åŠŸèƒ½å®Œæ•´
- [ ] PDFæŠ¥å‘Šå¯å¯¼å‡º

### æœ€ç»ˆéªŒæ”¶ (4å‘¨å)
- [ ] å®Œæ•´QuantConnectå¼å·¥ä½œæµ
- [ ] é¡¹ç›®åˆ›å»ºâ†’å›æµ‹â†’ä¼˜åŒ–â†’éƒ¨ç½²å…¨æµç¨‹é€šç•…
- [ ] ä¸“ä¸šçº§å¯è§†åŒ–
- [ ] PTrade/QMTå®ç›˜éƒ¨ç½²å¯ç”¨
- [ ] æ–‡æ¡£å®Œæ•´ã€å¯è·¨å¹³å°ä½¿ç”¨

---

## ğŸ¯ æ‰§è¡Œé¡ºåº

```
ä»Šæ—¥:
  â”œâ”€â”€ Task 0.1: æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
  â”œâ”€â”€ Task 0.2: æ‰“åŒ…VSIX
  â””â”€â”€ Task 0.3: å®‰è£…å¹¶æµ‹è¯•

æœ¬å‘¨:
  â”œâ”€â”€ Task 1.1: å¸‚åœºçŠ¶æ€TreeView
  â”œâ”€â”€ Task 1.2: æŠ•èµ„ä¸»çº¿TreeView
  â”œâ”€â”€ Task 1.3: ç­–ç•¥ç®¡ç†TreeView
  â”œâ”€â”€ Task 1.4: æ›´æ–°package.json
  â””â”€â”€ Task 2.1: æ‰©å±•MCPå·¥å…·é›†

ä¸‹å‘¨:
  â”œâ”€â”€ Task 3.1: EChartså›¾è¡¨
  â”œâ”€â”€ Task 3.2: Dashboardå®æ—¶æ›´æ–°
  â””â”€â”€ Task 3.3: æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ

ç¬¬2å‘¨:
  â”œâ”€â”€ Task 4.1: å‚æ•°ä¼˜åŒ–å™¨
  â”œâ”€â”€ Task 4.2: Walk-Forwardåˆ†æ
  â””â”€â”€ Task 4.3: å› å­åˆ†æå·¥å…·

ç¬¬3å‘¨:
  â”œâ”€â”€ Task 5.1: PTradeéƒ¨ç½²
  â”œâ”€â”€ Task 5.2: QMTéƒ¨ç½²
  â””â”€â”€ Task 5.3: æŒä»“åŒæ­¥

ç¬¬4å‘¨:
  â”œâ”€â”€ Task 6.1: ç»Ÿä¸€æ•°æ®æº
  â””â”€â”€ Task 6.2: å®æ—¶æ•°æ®
```

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0*
*åˆ›å»ºæ—¥æœŸ: 2025-12-03*








