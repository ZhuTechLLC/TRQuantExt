# TRQuant Cursor Extension 完整开发项目书

## 一、项目愿景

打造**类QuantConnect体验的A股量化投资IDE**，在Cursor中实现：
- 📁 项目管理：创建、管理量化策略项目
- 📊 数据服务：实时/历史行情、财务数据
- 🧪 回测引擎：完整的策略回测能力
- 📈 可视化：专业级图表和报告
- 🤖 AI增强：通过MCP让AI主动调用量化工具
- 🚀 实盘对接：PTrade/QMT策略部署

---

## 二、当前完成状态 vs 目标功能

### ✅ 已完成（Phase 0-3）

| 功能 | 状态 | 说明 |
|------|------|------|
| 项目骨架 | ✅ 完成 | Extension结构、构建配置 |
| 获取市场状态 | ✅ 完成 | Regime分析、WebView展示 |
| 获取投资主线 | ✅ 完成 | TOP20主线、周期选择 |
| 推荐因子 | ✅ 完成 | 智能因子推荐、交互选择 |
| 生成策略 | ✅ 完成 | PTrade/QMT双平台 |
| 回测分析 | ✅ 完成 | 指标分析、诊断建议 |
| MCP Server | ✅ 完成 | 5个工具已实现 |

### 🔄 待开发（对标QuantConnect）

| QuantConnect功能 | TRQuant对应 | 优先级 | 复杂度 |
|------------------|-------------|--------|--------|
| 项目创建/管理 | ❌ 缺失 | P0 | 高 |
| 代码编辑器集成 | ❌ 缺失 | P0 | 中 |
| 本地回测引擎 | ❌ 缺失 | P0 | 高 |
| 实时数据订阅 | ❌ 缺失 | P1 | 高 |
| 图表可视化 | ⚠️ 基础 | P1 | 中 |
| 策略优化器 | ❌ 缺失 | P1 | 高 |
| 风险分析 | ⚠️ 基础 | P2 | 中 |
| 持仓管理 | ❌ 缺失 | P2 | 中 |
| 实盘部署 | ❌ 缺失 | P3 | 高 |
| 策略版本控制 | ❌ 缺失 | P2 | 低 |

---

## 三、补充开发任务列表

### Phase 4: 项目管理系统（2-3周）

#### 4.1 项目创建向导
```
任务ID: P4-001
优先级: P0
预计工时: 3天

功能描述:
- 命令: TRQuant: New Project
- 选择项目模板（多因子、动量、套利等）
- 配置项目参数（股票池、回测周期、资金规模）
- 自动生成项目结构和配置文件

技术实现:
- 使用QuickPick实现多步骤向导
- 生成.trquant/project.json配置文件
- 创建标准项目目录结构
```

#### 4.2 项目资源管理器
```
任务ID: P4-002
优先级: P0
预计工时: 5天

功能描述:
- 左侧边栏Tree View显示项目结构
- 策略文件、数据文件、配置文件分类
- 右键菜单：运行、回测、部署
- 文件状态指示（已修改、已回测等）

技术实现:
- 实现TreeDataProvider
- 自定义TreeItem图标和装饰
- 监听文件变化自动刷新
```

#### 4.3 项目配置管理
```
任务ID: P4-003
优先级: P1
预计工时: 2天

功能描述:
- 图形化配置编辑器（WebView）
- 股票池选择器
- 回测参数配置
- 风控参数配置

技术实现:
- Custom Editor Provider
- 配置JSON Schema验证
- 实时预览效果
```

---

### Phase 5: 本地回测引擎（3-4周）

#### 5.1 回测引擎核心
```
任务ID: P5-001
优先级: P0
预计工时: 10天

功能描述:
- 基于TRQuant核心的Python回测引擎
- 支持日频/分钟频回测
- 支持多股票组合回测
- 交易成本、滑点模拟

技术实现:
- 复用/扩展TRQuant的BacktestEngine
- 增量数据加载优化性能
- 进度反馈和取消支持
```

#### 5.2 回测任务管理
```
任务ID: P5-002
优先级: P0
预计工时: 3天

功能描述:
- 命令: TRQuant: Run Backtest
- 回测队列管理
- 后台运行，不阻塞IDE
- 实时进度显示

技术实现:
- 使用vscode.ProgressLocation.Window
- 子进程运行回测任务
- WebSocket推送进度
```

#### 5.3 回测结果管理
```
任务ID: P5-003
优先级: P1
预计工时: 4天

功能描述:
- 回测历史记录
- 结果对比功能
- 结果导出（PDF、Excel）
- 自动归档

技术实现:
- MongoDB存储回测结果
- 版本化回测记录
- 报告生成模板
```

---

### Phase 6: 专业可视化（2-3周）

#### 6.1 图表库集成
```
任务ID: P6-001
优先级: P1
预计工时: 5天

功能描述:
- 集成ECharts/Lightweight Charts
- K线图、收益曲线、回撤图
- 因子暴露热力图
- 相关性矩阵

技术实现:
- WebView嵌入专业图表库
- 双向数据绑定
- 图表交互（缩放、标注）
```

#### 6.2 实时监控面板
```
任务ID: P6-002
优先级: P2
预计工时: 4天

功能描述:
- Dashboard布局
- 实时行情展示
- 持仓监控
- 风险指标监控

技术实现:
- WebView Panel
- WebSocket实时数据推送
- 可定制布局
```

#### 6.3 报告生成系统
```
任务ID: P6-003
优先级: P1
预计工时: 3天

功能描述:
- 专业回测报告
- 策略分析报告
- 风险评估报告
- PDF/HTML导出

技术实现:
- 报告模板引擎
- 图表截图嵌入
- 品牌定制
```

---

### Phase 7: 策略优化器（2-3周）

#### 7.1 参数优化
```
任务ID: P7-001
优先级: P1
预计工时: 5天

功能描述:
- 命令: TRQuant: Optimize Strategy
- 网格搜索参数空间
- 并行优化任务
- 优化结果可视化

技术实现:
- 参数空间定义（JSON Schema）
- 多进程并行回测
- 3D散点图展示结果
```

#### 7.2 Walk-Forward分析
```
任务ID: P7-002
优先级: P2
预计工时: 4天

功能描述:
- 滚动窗口回测
- 过拟合检测
- 稳定性分析

技术实现:
- 时间窗口分割
- 参数稳定性评分
```

#### 7.3 因子分析工具
```
任务ID: P7-003
优先级: P1
预计工时: 3天

功能描述:
- 因子IC/IR分析
- 因子收益分解
- 因子相关性检测

技术实现:
- 复用TRQuant因子分析模块
- 可视化因子贡献
```

---

### Phase 8: 实盘对接（3-4周）

#### 8.1 PTrade实盘部署
```
任务ID: P8-001
优先级: P2
预计工时: 5天

功能描述:
- 命令: TRQuant: Deploy to PTrade
- 代码格式转换验证
- 一键部署到PTrade客户端
- 策略状态同步

技术实现:
- PTrade API对接
- 代码语法检查
- 部署日志
```

#### 8.2 QMT实盘部署
```
任务ID: P8-002
优先级: P2
预计工时: 5天

功能描述:
- 命令: TRQuant: Deploy to QMT
- QMT代码格式适配
- miniQMT连接管理
- 实盘监控

技术实现:
- xtquant SDK集成
- Windows VM远程部署
```

#### 8.3 持仓同步
```
任务ID: P8-003
优先级: P3
预计工时: 4天

功能描述:
- 实盘持仓导入
- 持仓风险监控
- 调仓建议

技术实现:
- 券商API持仓查询
- 持仓与策略对比
```

---

### Phase 9: 高级MCP工具（2周）

#### 9.1 扩展MCP工具集
```
任务ID: P9-001
优先级: P1
预计工时: 5天

新增MCP工具:
- trquant_create_project: 创建项目
- trquant_run_backtest: 运行回测
- trquant_optimize_params: 参数优化
- trquant_get_realtime_data: 实时数据
- trquant_deploy_strategy: 部署策略
- trquant_get_portfolio: 获取持仓
- trquant_compare_strategies: 策略对比
```

#### 9.2 AI工作流自动化
```
任务ID: P9-002
优先级: P2
预计工时: 3天

功能描述:
- AI自动完成"分析→选股→回测→优化"流程
- 自然语言描述需求，AI自动调用工具链
- 生成完整研究报告

技术实现:
- 工具链编排
- 上下文记忆
- 结果汇总
```

---

### Phase 10: 数据服务增强（2-3周）

#### 10.1 数据源管理
```
任务ID: P10-001
优先级: P1
预计工时: 4天

功能描述:
- 统一数据接口
- 多数据源切换（JQData、AKShare、Baostock）
- 数据缓存管理
- 数据更新调度

技术实现:
- 数据源适配器模式
- MongoDB数据缓存
- 增量更新机制
```

#### 10.2 实时数据订阅
```
任务ID: P10-002
优先级: P2
预计工时: 5天

功能描述:
- Level-1行情订阅
- 分钟线实时更新
- 资金流向监控
- 新闻/公告推送

技术实现:
- WebSocket数据流
- 订阅管理
- 数据压缩传输
```

---

## 四、技术架构升级

### 4.1 后端服务化

```
当前架构:
Extension <-> bridge.py (子进程) <-> TRQuant Core

目标架构:
Extension <-> REST API (FastAPI) <-> TRQuant Core
     └──> MCP Server ────────────────┘
     └──> WebSocket (实时数据) ───────┘
```

### 4.2 数据层升级

```
数据存储:
├── MongoDB: 回测结果、策略配置、用户数据
├── Redis: 实时数据缓存、会话管理
├── 本地文件: 策略代码、报告文件
└── 远程API: JQData、AKShare等数据源
```

### 4.3 前端架构

```
WebView技术栈:
├── React/Vue: 组件框架
├── ECharts: 专业图表
├── Ant Design: UI组件
└── WebSocket: 实时通信
```

---

## 五、开发里程碑

| 里程碑 | 目标 | 时间 |
|--------|------|------|
| M1 | 项目管理 + 基础回测 | 4周 |
| M2 | 专业可视化 | 3周 |
| M3 | 策略优化器 | 3周 |
| M4 | 实盘对接 | 4周 |
| M5 | 高级MCP + 数据增强 | 3周 |
| **总计** | **完整功能** | **17周** |

---

## 六、优先级排序（立即开始）

### 🔴 P0 - 核心功能（优先实现）

1. **项目创建向导** (P4-001)
2. **项目资源管理器** (P4-002)
3. **本地回测引擎核心** (P5-001)
4. **回测任务管理** (P5-002)

### 🟡 P1 - 重要功能

5. 图表库集成 (P6-001)
6. 报告生成系统 (P6-003)
7. 参数优化 (P7-001)
8. 扩展MCP工具集 (P9-001)
9. 数据源管理 (P10-001)

### 🟢 P2 - 增强功能

10. 实时监控面板 (P6-002)
11. Walk-Forward分析 (P7-002)
12. PTrade/QMT部署 (P8-001/002)
13. AI工作流自动化 (P9-002)
14. 实时数据订阅 (P10-002)

---

## 七、下一步行动

### 立即开始的任务

```bash
# 任务1: 项目创建向导
文件: extension/src/commands/createProject.ts
估时: 3天

# 任务2: 项目资源管理器
文件: extension/src/views/projectExplorer.ts
估时: 5天

# 任务3: 回测引擎集成
文件: extension/python/backtest_engine.py
估时: 10天
```

### 需要准备的资源

1. **ECharts**: 图表可视化
2. **FastAPI**: 后端服务化
3. **Redis**: 实时数据缓存
4. **测试数据**: 回测验证用历史数据

---

*文档版本: v2.0*
*创建日期: 2025-12-02*
*最后更新: 2025-12-02*







