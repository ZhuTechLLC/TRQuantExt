# TRQuant Cursor Extension 使用教程

## 目录

1. [快速开始](#快速开始)
2. [获取市场状态](#获取市场状态)
3. [查看投资主线](#查看投资主线)
4. [因子推荐](#因子推荐)
5. [生成策略代码](#生成策略代码)
6. [回测分析](#回测分析)
7. [使用 MCP 与 AI 对话](#使用-mcp-与-ai-对话)
8. [最佳实践](#最佳实践)

---

## 快速开始

### 打开命令面板

按 `Ctrl+Shift+P` (Windows/Linux) 或 `Cmd+Shift+P` (macOS)，输入 `TRQuant`：

```
TRQuant: 获取市场状态
TRQuant: 获取投资主线
TRQuant: 推荐因子
TRQuant: 生成策略代码
TRQuant: 分析回测结果
TRQuant: 启用 MCP Server
TRQuant: 查看日志
```

### 状态栏

右下角状态栏显示市场状态图标：
- 📈 Risk On（风险偏好上升）
- 📉 Risk Off（风险偏好下降）
- ➡️ Neutral（震荡）

点击可打开控制面板。

---

## 获取市场状态

### 操作步骤

1. 执行命令 `TRQuant: 获取市场状态`
2. 等待分析完成（约3-5秒）
3. 查看 WebView 面板

### 结果解读

**市场 Regime**:
| Regime | 含义 | 建议 |
|--------|------|------|
| risk_on | 风险偏好上升 | 配置成长股、高Beta |
| risk_off | 风险偏好下降 | 配置价值股、防御 |
| neutral | 震荡 | 均衡配置、中性策略 |

**指数趋势**:
- 沪深300、创业板指、上证50 的动量 Z-Score
- 正值表示上涨趋势，负值表示下跌趋势

**风格轮动**:
- 成长/价值/动量/质量 风格的相对强弱

### 后续操作

点击按钮：
- **复制为AI Prompt**: 将分析结果复制为 Prompt
- **刷新数据**: 重新获取最新状态

---

## 查看投资主线

### 操作步骤

1. 执行命令 `TRQuant: 获取投资主线`
2. 选择投资周期：
   - 📅 短期 (1-5天)
   - 📆 中期 (1-4周)
   - 📆 长期 (1月+)
3. 查看 TOP 20 投资主线

### 结果解读

每条主线包含：
- **排名**: 🥇🥈🥉 金银铜牌
- **评分**: 0-1 的综合评分
- **相关行业**: 涉及的行业板块
- **投资逻辑**: 主线的核心逻辑

### 使用技巧

- 短期主线适合追热点
- 中期主线适合波段
- 长期主线适合价值投资

---

## 因子推荐

### 操作步骤

1. 执行命令 `TRQuant: 推荐因子`
2. 自动获取市场状态并推荐因子
3. 点击因子卡片添加/移除
4. 使用选中因子生成策略

### 因子分类

| 类别 | 代表因子 |
|------|----------|
| 盈利能力 | ROE_ttm, ROA |
| 成长性 | revenue_growth, net_profit_growth |
| 估值 | PE_ttm, PB_lf, dividend_yield |
| 动量 | momentum_20d, relative_strength |
| 流动性 | turnover_rate |
| 波动率 | volatility_60d |
| 质量 | debt_to_equity, quality_score |

### 不同市场的因子选择

**Risk On（牛市）**:
- 侧重动量和成长因子
- momentum_20d, revenue_growth, beta

**Risk Off（熊市）**:
- 侧重价值和质量因子
- dividend_yield, PE_ttm, volatility_60d

**Neutral（震荡）**:
- 均衡配置
- ROE_ttm, PE_ttm, momentum_20d

---

## 生成策略代码

### 操作步骤

1. 执行命令 `TRQuant: 生成策略代码`
2. **Step 1**: 选择平台
   - 📊 PTrade (恒生)
   - 📈 QMT (迅投)
3. **Step 2**: 选择策略风格
   - 📈 多因子选股
   - 🚀 动量成长
   - 💰 价值投资
   - ⚖️ 市场中性
4. **Step 3**: 配置风控参数
   - 使用默认参数
   - 或自定义（单票仓位、止损、止盈）
5. 查看生成的 Python 代码

### 策略风格说明

| 风格 | 适用场景 | 特点 |
|------|----------|------|
| 多因子 | 各种市场 | 综合多因子打分 |
| 动量成长 | 牛市 | 追强势股 |
| 价值投资 | 熊市 | 低估值高分红 |
| 市场中性 | 震荡 | 多空对冲 |

### 代码保存

点击 **保存文件** 可保存：
- `xxx.py` - 策略代码
- `xxx_meta.json` - 策略元数据

---

## 回测分析

### 操作步骤

1. 执行命令 `TRQuant: 分析回测结果`
2. 选择数据来源：
   - 📂 从文件导入（JSON/CSV）
   - 📝 手动输入
   - 📋 从剪贴板
3. 查看分析报告

### 关键指标

| 指标 | 说明 | 良好标准 |
|------|------|----------|
| 总收益 | 回测期间总收益 | > 20% |
| 夏普比率 | 风险调整收益 | > 1.0 |
| 最大回撤 | 最大亏损幅度 | < 20% |
| 胜率 | 盈利交易占比 | > 50% |

### 综合评分

满分 100 分：
- 80+ 分：优秀
- 60-80 分：良好
- 40-60 分：一般
- 40- 分：较差

---

## 使用 MCP 与 AI 对话

### 启用 MCP

1. 执行命令 `TRQuant: 启用 MCP Server`
2. 重启 Cursor

### 示例对话

**获取市场状态**:
```
用户: 现在A股市场状态如何？

AI: 让我调用TRQuant工具查看...
[调用 trquant_market_status]

当前市场状态为 neutral（震荡），沪深300动量Z-Score为0.5...
```

**生成策略**:
```
用户: 帮我生成一个适合当前市场的PTrade多因子策略

AI: 我来分析市场并生成策略...
[调用 trquant_market_status]
[调用 trquant_recommend_factors]
[调用 trquant_generate_strategy]

已为您生成策略，使用了以下因子：ROE_ttm, PE_ttm, momentum_20d...
```

**分析回测**:
```
用户: 这个回测结果怎么样？收益25%，夏普1.5，回撤15%

AI: 让我分析这些指标...
[调用 trquant_analyze_backtest]

策略综合评分85分，表现优秀。诊断：
- ✅ 收益表现优秀
- ✅ 夏普比率优秀
- ✅ 回撤控制良好
```

---

## 最佳实践

### 1. 完整工作流

```
市场分析 → 主线识别 → 因子选择 → 策略生成 → 回测验证 → 优化迭代
```

### 2. 周期匹配

- 短期策略用短期因子（动量）
- 长期策略用长期因子（价值、质量）

### 3. 风险控制

- 单票不超过 10%
- 止损设置 5-8%
- 定期检视策略表现

### 4. 迭代优化

1. 每月回顾策略表现
2. 根据市场变化调整因子
3. 使用回测分析优化参数

### 5. 文档记录

- 保存策略代码和元数据
- 记录回测结果
- 建立策略版本控制

---

## 快捷键

| 操作 | 快捷键 |
|------|--------|
| 打开命令面板 | `Ctrl+Shift+P` |
| 查看日志 | 执行命令 `TRQuant: 查看日志` |
| 刷新状态 | 点击状态栏图标 |

---

## 获取帮助

- 查看日志：`TRQuant: 查看日志`
- 设计文档：`docs/DESIGN.md`
- 安装指南：`docs/INSTALLATION.md`







