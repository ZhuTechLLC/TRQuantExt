# 五维评分系统重构 - 详细执行方案

## 📊 任务分解与模型选择

### 阶段1：需求分析与架构设计

#### 任务1.1：PDF设计方案提取 ⚠️
- **复杂度**：中
- **推荐模型**：**Auto Mode** (PDF内容理解)
- **输出**：五维评分系统设计要点清单
- **状态**：待执行（需要PDF内容）

#### 任务1.2：现有代码分析 ✅
- **复杂度**：低
- **推荐模型**：**Auto Mode**
- **输出**：现有实现与PDF设计的差异分析
- **状态**：已完成（基于代码分析）

**发现**：
- 现有 `pro_engine.py` 已有五维评分框架
- 但UI层面没有独立的维度Tab
- 需要重构为每个维度独立Tab + 综合Tab

---

### 阶段2：核心引擎开发

#### 任务2.1：五维评分引擎重构 🔥
- **复杂度**：**高**
- **推荐模型**：**Max Mode** (核心算法)
- **文件**：`markets/ashare/mainline/five_dimension_engine.py` (新建)
- **功能**：
  - 每个维度独立计算引擎
  - 维度间数据共享机制
  - 综合评分计算
- **预计时间**：2-3小时

#### 任务2.2：维度数据获取器
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **文件**：`markets/ashare/mainline/dimension_data_fetcher.py` (新建)
- **功能**：
  - 资金维度数据获取
  - 动量维度数据获取
  - 热度维度数据获取（复用现有）
  - 政策维度数据获取（LLM分析）
  - 龙头维度数据获取
- **预计时间**：1-2小时

---

### 阶段3：UI组件开发

#### 任务3.1：创建维度Tab组件 🔥
- **复杂度**：**高**
- **推荐模型**：**Max Mode** (复杂UI逻辑)
- **目录**：`gui/widgets/dimension_tabs/` (新建)
- **文件**：
  - `funds_dimension_tab.py` - 资金维度Tab
  - `momentum_dimension_tab.py` - 动量维度Tab
  - `heat_dimension_tab.py` - 热度维度Tab
  - `policy_dimension_tab.py` - 政策维度Tab
  - `leader_dimension_tab.py` - 龙头维度Tab
- **功能**：
  - 每个Tab显示该维度的详细评分
  - 因子分解展示
  - 数据源透明显示
  - 实时计算和更新
- **预计时间**：3-4小时

#### 任务3.2：创建综合评分Tab
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **文件**：`gui/widgets/professional_mainline_tab.py` (新建)
- **功能**：
  - 汇总五维评分
  - 综合排名展示
  - 主线类型判断（短/中/长期）
  - 交易信号生成
- **预计时间**：1-2小时

#### 任务3.3：更新主面板集成
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **文件**：`gui/widgets/mainline_panel.py` (修改)
- **修改内容**：
  - 将"专业主线识别"Tab改为Tab容器
  - 内部包含6个子Tab（5个维度 + 1个综合）
- **预计时间**：1小时

---

### 阶段4：数据流与报告

#### 任务4.1：维度数据传递机制
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **功能**：确保各维度数据正确传递到综合评分
- **预计时间**：1小时

#### 任务4.2：五维评分报告生成器
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **文件**：`markets/ashare/mainline/five_dimension_report_generator.py` (新建)
- **功能**：生成包含五维评分详情的HTML报告
- **预计时间**：1-2小时

---

## 🎯 执行策略

### 推荐执行顺序

1. **阶段1**：需求分析（Auto Mode）
   - 提取PDF关键信息
   - 对比现有实现
   - 确定改进点

2. **阶段2**：核心引擎（Max Mode）
   - 五维评分引擎重构
   - 数据获取层优化

3. **阶段3**：UI开发（Max Mode）
   - 维度Tab组件开发
   - 综合评分Tab开发

4. **阶段4**：集成测试（Auto Mode）
   - 数据流验证
   - 报告生成
   - 端到端测试

---

## 📐 UI架构设计

### 新的Tab结构

```
投资主线 (MainlinePanel)
│
├── 📖 方法论
│
├── 🔍 主线识别 (旧版，保留)
│
├── 🎯 专业主线识别 (新版，五维评分系统)
│   │
│   ├── 子Tab 1: 💰 资金维度 (25分)
│   │   ├── 当日净流入排名
│   │   ├── 5日累计净流入排名
│   │   ├── 流入占比
│   │   └── 数据源：同花顺API
│   │
│   ├── 子Tab 2: 📈 动量维度 (20分)
│   │   ├── 涨跌幅排名
│   │   ├── 相对强度
│   │   ├── 趋势得分
│   │   └── 数据源：同花顺API
│   │
│   ├── 子Tab 3: 🔥 热度维度 (20分)
│   │   ├── 涨停股占比
│   │   ├── 成交量放大
│   │   ├── 关注度得分
│   │   └── 数据源：东方财富API + 热度评分模块
│   │
│   ├── 子Tab 4: 📜 政策维度 (20分)
│   │   ├── 政策支持力度
│   │   ├── 产业趋势
│   │   ├── 事件催化
│   │   └── 数据源：LLM分析（待实现）
│   │
│   ├── 子Tab 5: 👑 龙头维度 (15分)
│   │   ├── 龙头强度
│   │   ├── 跟风效应
│   │   ├── 大市值龙头
│   │   └── 数据源：同花顺API
│   │
│   └── 子Tab 6: 🎯 综合评分 (专业投资主线)
│       ├── 五维评分汇总
│       ├── 综合排名
│       ├── 主线类型判断
│       ├── 交易信号
│       └── 导出报告
│
├── 📊 热度评分 (独立模块，保留)
│
├── 🎯 个股筛选
│
├── 📋 调研笔记
│
├── 📈 回测验证
│
└── ⚡ 实时监控
```

---

## 🔧 技术实现要点

### 1. 维度Tab组件设计模式

每个维度Tab应包含：
- **方法论说明**：该维度的评分逻辑
- **数据源展示**：API、字段、示例数据
- **因子分解**：各因子的得分和权重
- **实时计算**：点击计算按钮后异步计算
- **结果展示**：排名表格、详情卡片

### 2. 数据共享机制

```python
# 共享数据获取结果
class DimensionDataManager:
    def __init__(self):
        self.shared_data = {}
    
    def fetch_all_dimension_data(self):
        # 一次性获取所有维度需要的数据
        # 避免重复API调用
        pass
```

### 3. 综合评分计算

```python
# 综合评分 = 资金×25% + 动量×20% + 热度×20% + 政策×20% + 龙头×15%
total_score = (
    funds_score * 0.25 +
    momentum_score * 0.20 +
    heat_score * 0.20 +
    policy_score * 0.20 +
    leader_score * 0.15
)
```

---

## 📋 具体执行清单

### 立即执行（Auto Mode）

1. ✅ 创建任务分解文档（已完成）
2. ⏳ 提取PDF关键信息（需要PDF内容）
3. ⏳ 对比现有实现（进行中）

### 核心开发（Max Mode）

4. ⏳ 创建五维评分引擎
5. ⏳ 创建维度数据获取器
6. ⏳ 创建5个维度Tab组件
7. ⏳ 创建综合评分Tab

### 集成测试（Auto Mode）

8. ⏳ 更新主面板集成
9. ⏳ 创建报告生成器
10. ⏳ 端到端测试

---

## ⚠️ 注意事项

1. **数据一致性**：确保各维度使用同一份基础数据
2. **异步计算**：每个维度Tab的计算不应阻塞UI
3. **错误处理**：API失败时应有降级方案
4. **性能优化**：避免重复数据获取
5. **用户体验**：每个Tab应有清晰的说明和反馈

---

*下一步：提取PDF内容，开始核心开发*

