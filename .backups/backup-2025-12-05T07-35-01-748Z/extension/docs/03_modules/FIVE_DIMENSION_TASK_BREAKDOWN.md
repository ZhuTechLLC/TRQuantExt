# 五维评分系统重构 - 详细任务分解

## 📋 基于PDF设计方案的任务分解

### 阶段1：需求分析与设计 ✅

#### ✅ 任务1.1：PDF内容提取
- **状态**：已完成
- **输出**：`docs/五维评分系统设计方案_提取.txt`
- **关键发现**：
  - 五个维度Tab：资金、热度、动量、政策、龙头
  - 每个Tab需要：评分逻辑、功能栏、可视化方式
  - 综合Tab：汇总五维评分，支持多周期切换
  - MongoDB数据结构设计
  - 个股筛选与联动功能

---

### 阶段2：核心引擎开发 🔥 **Max Mode**

#### 任务2.1：创建五维评分引擎
- **复杂度**：**高**
- **推荐模型**：**Max Mode**
- **文件**：`markets/ashare/mainline/five_dimension_engine.py` (新建)
- **功能要求**（基于PDF）：
  1. **资金维度** (30%权重)
     - 主力资金净流入额及连续流入天数
     - 大单成交占比
     - 融资融券余额变化
     - 时间衰减逻辑（指数衰减）
  
  2. **热度维度** (20%权重)
     - 板块热度指数（帖子/新闻提及量）
     - 涨停股数量及连板高度
     - 情绪指标（涨停封板率、炸板率）
     - 复用现有热度评分模块
  
  3. **动量维度** (20%权重)
     - 价格动量（近5日/10日累计涨幅）
     - 相对强度（相对大盘超额收益）
     - 成交量动量（量比、成交额突增）
     - 技术信号（突破均线、阶段新高）
     - 时间衰减 + 持续性加分
  
  4. **政策维度** (15%权重)
     - 政策强度（政策级别：国家级>地方）
     - 政策频度（一段时间内政策出现频率）
     - 事件影响（行业大会、产业规划）
     - 时效衰减（新近政策权重更高）
     - LLM分析（待实现）
  
  5. **龙头维度** (15%权重)
     - 龙头股高度（连续涨停天数、累计涨幅）
     - 梯队结构（一进二板、二进三板接力）
     - 市值龙头影响力（市值和成交占比）
     - 快速衰减（连续板高度一周内有效）

- **预计时间**：3-4小时

#### 任务2.2：创建维度数据获取器
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **文件**：`markets/ashare/mainline/dimension_data_fetcher.py` (新建)
- **功能**：为每个维度优化数据获取
- **预计时间**：2小时

---

### 阶段3：UI组件开发 🔥 **Max Mode**

#### 任务3.1：创建资金维度Tab
- **复杂度**：**高**
- **推荐模型**：**Max Mode**
- **文件**：`gui/widgets/dimension_tabs/funds_dimension_tab.py` (新建)
- **功能要求**（基于PDF）：
  - 时间窗口选择（近5日、20日、60日）
  - 按资金得分或净流入金额排序
  - 筛选器（行业类型、总市值规模）
  - 累计资金曲线图表
  - 柱状图/折线图/热力表可视化
- **预计时间**：2小时

#### 任务3.2：创建动量维度Tab
- **复杂度**：**高**
- **推荐模型**：**Max Mode**
- **文件**：`gui/widgets/dimension_tabs/momentum_dimension_tab.py` (新建)
- **功能要求**（基于PDF）：
  - 动量周期选择（3日/5日/1月）
  - 按动量得分或累计涨幅排序
  - 筛选器（排除波动过大、趋势走弱）
  - 切换基准功能（沪深300等）
  - 技术指标开关（MACD金叉等）
  - 趋势折线图/柱状图/雷达图/迷你趋势图
- **预计时间**：2小时

#### 任务3.3：创建热度维度Tab
- **复杂度**：中
- **推荐模型**：**Auto Mode**（可复用现有热度评分模块）
- **文件**：`gui/widgets/dimension_tabs/heat_dimension_tab.py` (新建)
- **功能要求**（基于PDF）：
  - 热度周期选择
  - 指标说明按钮
  - 刷新功能（实时抓取最新舆情）
  - 热力图/折线趋势图/堆叠柱状图/雷达图
- **预计时间**：1.5小时

#### 任务3.4：创建政策维度Tab
- **复杂度**：**高**（需要LLM集成）
- **推荐模型**：**Max Mode**
- **文件**：`gui/widgets/dimension_tabs/policy_dimension_tab.py` (新建)
- **功能要求**（基于PDF）：
  - 政策观察期选择（近1月/近半年）
  - 按政策得分排序
  - 筛选器（仅显示国家政策支撑）
  - 政策列表下拉（政策文件列表和摘要）
  - 关键词搜索框
  - 时间轴图/热力矩阵可视化
- **预计时间**：2.5小时

#### 任务3.5：创建龙头维度Tab
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **文件**：`gui/widgets/dimension_tabs/leader_dimension_tab.py` (新建)
- **功能要求**（基于PDF）：
  - 龙头监测周期选择
  - 按龙头维度得分排序
  - 筛选器（超强龙头出现的题材）
  - 代表个股显示（侧边栏）
  - 对比开关（对比两个主线的龙头结构）
  - 柱状图/图标提示/雷达图可视化
- **预计时间**：1.5小时

#### 任务3.6：创建综合评分Tab（专业投资主线）
- **复杂度**：**高**
- **推荐模型**：**Max Mode**
- **文件**：`gui/widgets/professional_mainline_tab.py` (新建)
- **功能要求**（基于PDF）：
  - **综合评分机制**：
    - 资金30% + 热度20% + 动量20% + 政策15% + 龙头15%
    - 支持动态权重策略
    - Min-Max归一化或Z-score标准化
  
  - **输出结构**：
    - 列表视图（主线名称、五维得分、综合得分、行业标签）
    - 热力分组（按行业归类）
    - 雷达图概览（多主线对比）
    - 详情入口
  
  - **多周期切换**：
    - 短期3-5日、中期15-30日、长期60-180日
    - 主线轨迹回顾（日期选择器）
  
  - **可视化**：
    - 专业金融风格（参考Bloomberg/Wind）
    - 雷达图联动列表
    - 评分解释浮层
- **预计时间**：3小时

---

### 阶段4：主面板集成 🔥 **Max Mode**

#### 任务4.1：重构主面板Tab结构
- **复杂度**：**高**
- **推荐模型**：**Max Mode**
- **文件**：`gui/widgets/mainline_panel.py` (修改)
- **修改内容**：
  - 将"专业主线识别"Tab改为Tab容器
  - 内部包含6个子Tab（5个维度 + 1个综合）
  - 保持其他Tab不变
- **预计时间**：1.5小时

---

### 阶段5：数据存储与报告 🔥 **Max Mode**

#### 任务5.1：MongoDB数据结构实现
- **复杂度**：**高**
- **推荐模型**：**Max Mode**
- **文件**：`markets/ashare/mainline/five_dimension_storage.py` (新建)
- **功能要求**（基于PDF）：
  - `theme_dimension_scores` 集合（主线维度评分）
  - `stock_dimension_scores` 集合（个股维度评分）
  - `mainline_results` 集合（主线识别结果）
  - 索引设计（date, theme_id, period等）
- **预计时间**：2小时

#### 任务5.2：五维评分报告生成器
- **复杂度**：中
- **推荐模型**：**Auto Mode**
- **文件**：`markets/ashare/mainline/five_dimension_report_generator.py` (新建)
- **功能**：生成包含五维评分详情的HTML报告
- **预计时间**：2小时

---

### 阶段6：个股筛选与联动 🔥 **Max Mode**

#### 任务6.1：主线-个股联动功能
- **复杂度**：**高**
- **推荐模型**：**Max Mode**
- **功能要求**（基于PDF）：
  - 主线页联动代表个股（侧边栏）
  - 个股详情页的主线关联
  - 个股筛选Tab（按维度条件筛选）
- **预计时间**：3小时

---

## 🎯 执行策略总结

### 模型选择

| 阶段 | 任务 | 复杂度 | 推荐模型 | 理由 |
|------|------|--------|----------|------|
| 2.1 | 五维评分引擎 | 高 | **Max** | 核心算法，多维度逻辑 |
| 3.1 | 资金维度Tab | 高 | **Max** | 复杂UI + 图表 |
| 3.2 | 动量维度Tab | 高 | **Max** | 复杂UI + 技术指标 |
| 3.4 | 政策维度Tab | 高 | **Max** | LLM集成 + 复杂逻辑 |
| 3.6 | 综合评分Tab | 高 | **Max** | 多维度汇总 + 雷达图 |
| 4.1 | 主面板集成 | 高 | **Max** | Tab容器重构 |
| 5.1 | MongoDB存储 | 高 | **Max** | 数据结构设计 |
| 6.1 | 个股联动 | 高 | **Max** | 复杂交互逻辑 |
| 其他 | 数据获取/报告 | 中 | **Auto** | 相对简单 |

### 执行顺序

1. **阶段2**：核心引擎（Max Mode）- 基础
2. **阶段3**：UI组件（Max Mode）- 核心功能
3. **阶段4**：主面板集成（Max Mode）- 整合
4. **阶段5**：数据存储（Max Mode）- 持久化
5. **阶段6**：个股联动（Max Mode）- 增强功能

---

## ⏱️ 预计总时间

- **Max Mode任务**：约20小时
- **Auto Mode任务**：约6小时
- **总计**：约26小时

---

## 🚀 立即开始

**建议**：切换到 **Max Mode** 后，按顺序执行阶段2-6的任务。

*基于《市场主线识别模块五维评分系统设计方案.pdf》*

