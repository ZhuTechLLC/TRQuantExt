# 时间维度开发原则

## 核心思想

量化投资系统的每个模块，从数据采集到策略执行，都必须围绕**时间维度**进行设计。不同的投资周期（短期、中期、长期）决定了：
- 使用的数据类型和周期
- 采用的因子权重
- 策略的换仓频率
- 风险控制的阈值

## 时间周期定义

| 周期 | 时长 | 典型策略 | 数据频率 | 因子侧重 |
|------|------|---------|---------|---------|
| **短期** | 1-5天 | 动量突破、事件驱动 | 分钟/日线 | 动量、资金流、技术形态 |
| **中期** | 1-4周 | 趋势跟踪、板块轮动 | 日线/周线 | 均衡配置（动量+基本面） |
| **长期** | 1月+ | 价值投资、成长投资 | 周线/月线 | 价值、成长、质量因子 |

---

## 模块时间维度设计

### 1. 投资主线识别模块

**设计原则**：主线的有效性随时间变化，需要记录和分析。

```
数据结构：
{
    "timestamp": "2025-11-30T10:00:00",      # 记录时间点
    "analysis_date": "2025-11-30",           # 分析的日期
    "period": "short|medium|long",           # 分析周期
    "mainlines": [
        {
            "name": "人工智能",
            "scores": {...},
            "start_date": "2025-10-01",      # 主线启动日期
            "peak_date": "2025-11-15",       # 主线高峰日期（如有）
            "status": "rising|peak|fading",  # 当前状态
        }
    ],
    "historical_mainlines": [...]             # 历史主线轮动记录
}
```

**功能需求**：
- [ ] 支持查看历史任意时间点的主线识别结果
- [ ] 记录主线生命周期（启动、高峰、衰退）
- [ ] 板块轮动历史分析
- [ ] 不同周期的主线识别结果可能不同

### 2. 候选池构建模块

**设计原则**：候选池是特定时间点的快照，需按时间分类存储。

```
数据结构：
{
    "snapshot_date": "2025-11-30",           # 快照日期
    "period": "short|medium|long",           # 投资周期
    "mainlines_used": [...],                 # 使用的主线
    "stocks": [
        {
            "code": "000001.XSHE",
            "name": "平安银行",
            "mainline": "金融科技",
            "mainline_score": 85,
            "entry_date": "2025-11-25",      # 进入候选池日期
            "status": "active|exited",        # 状态
            "exit_date": null,                # 退出日期
        }
    ],
    "data_permission": {                     # 数据权限快照
        "mode": "historical|realtime",
        "date_range": ["2024-08-22", "2025-08-29"]
    }
}
```

**功能需求**：
- [ ] 按日期和周期存储候选池快照
- [ ] 记录股票进入/退出候选池的时间
- [ ] 支持回溯历史候选池
- [ ] 候选池变更日志

### 3. 因子筛选模块

**设计原则**：不同周期使用不同因子权重。

```python
FACTOR_WEIGHTS = {
    "short": {   # 短期：侧重动量和资金
        "momentum": 0.35,
        "flow": 0.30,
        "technical": 0.20,
        "value": 0.05,
        "growth": 0.05,
        "quality": 0.05
    },
    "medium": {  # 中期：均衡配置
        "momentum": 0.20,
        "flow": 0.15,
        "technical": 0.15,
        "value": 0.15,
        "growth": 0.20,
        "quality": 0.15
    },
    "long": {    # 长期：侧重价值和成长
        "momentum": 0.05,
        "flow": 0.05,
        "technical": 0.05,
        "value": 0.30,
        "growth": 0.35,
        "quality": 0.20
    }
}
```

**功能需求**：
- [ ] 因子计算支持不同时间窗口
- [ ] 短期因子：20日动量、5日资金流
- [ ] 中期因子：60日动量、月度财报
- [ ] 长期因子：年度ROE变化、3年复合增长

### 4. 策略开发模块

**设计原则**：不同周期策略的逻辑完全不同。

| 策略类型 | 换仓频率 | 止损阈值 | 目标收益 | 持仓数量 |
|---------|---------|---------|---------|---------|
| 短期策略 | 日内/日频 | 3-5% | 5-10% | 1-5只 |
| 中期策略 | 周频 | 8-10% | 20-30% | 5-15只 |
| 长期策略 | 月频 | 15-20% | 50%+ | 10-30只 |

**功能需求**：
- [ ] 策略模板按周期分类
- [ ] 参数预设随周期调整
- [ ] 回测区间建议（短期1个月，中期6个月，长期2年）

---

## 数据存储规范

### MongoDB集合命名规范

```
trquant/
├── mainline_mapped          # 主线映射（按日期+周期索引）
├── mainline_history         # 主线历史轮动
├── candidate_pool           # 候选池快照（按日期+周期索引）
├── candidate_pool_changes   # 候选池变更记录
├── factor_values            # 因子值（按日期+周期索引）
├── factor_performance       # 因子绩效
├── strategy_signals         # 策略信号
└── backtest_results         # 回测结果
```

### 索引设计

```javascript
// 主线映射
db.mainline_mapped.createIndex({"date": 1, "period": 1}, {unique: true})
db.mainline_mapped.createIndex({"timestamp": -1})

// 候选池
db.candidate_pool.createIndex({"snapshot_date": 1, "period": 1}, {unique: true})
db.candidate_pool.createIndex({"stocks.code": 1})

// 因子值
db.factor_values.createIndex({"date": 1, "period": 1, "factor_name": 1})
```

---

## 实施计划

### 第一阶段：基础架构（当前）
- [x] 投资主线识别 - 当前时间点
- [x] 候选池构建 - 基于当前主线
- [x] 因子筛选 - 短中长期权重
- [ ] 修复MongoDB集合名称不一致问题

### 第二阶段：历史回溯
- [ ] 主线历史查询（指定日期）
- [ ] 候选池快照存储
- [ ] 板块轮动分析

### 第三阶段：完整时间维度
- [ ] 主线生命周期追踪
- [ ] 候选池变更日志
- [ ] 多周期并行分析

---

## 使用流程

```
┌─────────────────────────────────────────────────────────────────┐
│                         选择投资周期                            │
│               ┌───────┐ ┌───────┐ ┌───────┐                    │
│               │ 短期  │ │ 中期  │ │ 长期  │                    │
│               └───┬───┘ └───┬───┘ └───┬───┘                    │
└───────────────────┼─────────┼─────────┼────────────────────────┘
                    │         │         │
                    ▼         ▼         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 1. 投资主线识别                                                  │
│    - 短期：事件驱动、资金热点                                     │
│    - 中期：行业趋势、政策导向                                     │
│    - 长期：产业变革、价值重估                                     │
└─────────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────┐
│ 2. 候选池构建                                                    │
│    - 从主线获取成分股（JQData）                                   │
│    - 按周期应用不同筛选条件                                       │
│    - 存储快照（日期+周期）                                        │
└─────────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────┐
│ 3. 因子筛选                                                      │
│    - 短期：动量35% + 资金流30% + 技术20%                         │
│    - 中期：动量20% + 资金流15% + 价值15% + 成长20%               │
│    - 长期：价值30% + 成长35% + 质量20%                           │
└─────────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────┐
│ 4. 策略开发                                                      │
│    - 短期策略：日频换仓、3%止损                                   │
│    - 中期策略：周频换仓、10%止损                                  │
│    - 长期策略：月频调仓、20%止损                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 变更日志

| 日期 | 版本 | 变更内容 |
|------|------|---------|
| 2025-11-30 | 1.0.0 | 创建时间维度开发原则文档 |







