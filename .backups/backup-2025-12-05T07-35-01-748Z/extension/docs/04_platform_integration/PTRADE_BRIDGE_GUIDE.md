# PTrade Bridge 使用指南

## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25







## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25





## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25


## 一、架构概述

```
┌─────────────────────────────────────────────────────────────────┐
│                         Cursor IDE                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ CLI 工具    │  │ Prompt 模板 │  │ 策略代码    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PTrade Bridge Service                         │
│                   http://127.0.0.1:8000                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略管理    │  │ 回测数据    │  │ 交易记录    │              │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘              │
└─────────┼────────────────┼────────────────┼─────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                         PTrade 系统                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 策略目录    │  │ 回测报告    │  │ 实盘交易    │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
└─────────────────────────────────────────────────────────────────┘
```

## 二、快速开始

### 2.1 启动 PTrade Bridge 服务

```bash
cd /home/taotao/dev/QuantTest/TRQuant
source venv/bin/activate
python -m ptrade_bridge.server
```

服务启动后：
- API 地址: http://127.0.0.1:8000
- API 文档: http://127.0.0.1:8000/docs

### 2.2 使用 CLI 工具

```bash
# 列出所有策略
python scripts/ptrade_cli.py strategies

# 查看策略详情
python scripts/ptrade_cli.py strategy momentum_strategy

# 列出回测结果
python scripts/ptrade_cli.py backtests

# 查看回测详情
python scripts/ptrade_cli.py backtest bt_xxx

# 列出交易记录
python scripts/ptrade_cli.py trades --limit 50

# 部署策略到 PTrade
python scripts/ptrade_cli.py deploy momentum_strategy

# 刷新数据
python scripts/ptrade_cli.py refresh

# 生成 Prompt
python scripts/ptrade_cli.py prompt strategy
python scripts/ptrade_cli.py prompt factor
python scripts/ptrade_cli.py prompt optimize
```

## 三、目录结构

```
JQQuant/
├── ptrade_bridge/           # PTrade Bridge 服务
│   ├── __init__.py
│   ├── models.py            # 数据模型
│   ├── service.py           # 核心服务
│   ├── api.py               # FastAPI 接口
│   └── server.py            # 服务启动脚本
├── scripts/
│   └── ptrade_cli.py        # CLI 工具
├── strategies/
│   └── ptrade/              # PTrade 策略代码
│       └── momentum_strategy.py
├── data/
│   └── ptrade/              # PTrade 数据
│       ├── backtest_results/  # 回测结果 JSON
│       ├── trade_records/     # 交易记录
│       └── positions/         # 持仓数据
├── prompts/                 # Prompt 模板
│   ├── system_prompt.md
│   ├── multifactor_strategy_prompt.md
│   ├── backtest_analysis_prompt.md
│   └── strategy_optimization_prompt.md
└── config/
    └── ptrade_bridge_config.json  # 配置文件
```

## 四、API 接口

### 4.1 策略管理

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /strategies | 获取所有策略 |
| GET | /strategies/{id} | 获取策略详情 |
| POST | /strategies | 创建策略 |
| PUT | /strategies/{id} | 更新策略 |
| DELETE | /strategies/{id} | 删除策略 |
| POST | /strategies/deploy | 部署策略 |
| POST | /strategies/stop | 停止策略 |

### 4.2 回测结果

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /backtests | 获取回测列表 |
| GET | /backtests/{id} | 获取回测详情 |

### 4.3 交易记录

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /trades | 获取交易记录 |

### 4.4 系统

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | / | 服务状态 |
| GET | /health | 健康检查 |
| POST | /refresh | 刷新数据 |

## 五、数据同步

### 5.1 从 PTrade 导出数据

1. 在 PTrade 中运行回测
2. 导出回测报告为 JSON 格式
3. 将 JSON 文件放入 `data/ptrade/backtest_results/` 目录
4. PTrade Bridge 会自动检测并加载

### 5.2 JSON 格式示例

```json
{
  "strategy_name": "多因子动量策略",
  "start_date": "2024-01-01",
  "end_date": "2024-11-25",
  "initial_capital": 1000000,
  "final_capital": 1150000,
  "metrics": {
    "annual_return": 0.165,
    "max_drawdown": 0.08,
    "sharpe_ratio": 1.85,
    "win_rate": 0.62
  },
  "trades": [
    {
      "date": "2024-01-15",
      "stock": "000001.XSHE",
      "action": "BUY",
      "price": 10.5,
      "quantity": 1000
    }
  ]
}
```

## 六、Cursor 集成工作流

### 6.1 生成策略

1. 在 Cursor 中打开 `prompts/multifactor_strategy_prompt.md`
2. 填写策略参数
3. 按 `Ctrl+K` 打开 AI 对话，粘贴 Prompt
4. AI 生成策略代码
5. 保存到 `strategies/ptrade/` 目录

### 6.2 分析回测

1. 从 PTrade 导出回测结果
2. 放入 `data/ptrade/backtest_results/`
3. 运行 `python scripts/ptrade_cli.py backtest <id>`
4. 复制结果到 Cursor，使用分析 Prompt

### 6.3 优化策略

1. 打开 `prompts/strategy_optimization_prompt.md`
2. 粘贴现有策略代码和回测指标
3. 让 AI 生成优化建议
4. 迭代改进

## 七、配置说明

### 7.1 配置文件

`config/ptrade_bridge_config.json`:

```json
{
  "strategies_dir": "strategies/ptrade",
  "data_dir": "data/ptrade",
  "ptrade_export_dir": "",
  "ptrade_strategies_dir": "",
  "host": "127.0.0.1",
  "port": 8000,
  "auto_sync": true,
  "sync_interval": 60
}
```

### 7.2 配置 PTrade 路径

如果要自动同步 PTrade 数据，配置：

```json
{
  "ptrade_export_dir": "C:/Ptrade/reports",
  "ptrade_strategies_dir": "C:/Ptrade/strategies"
}
```

## 八、常见问题

### Q1: 服务无法启动？

确保已安装依赖：
```bash
pip install fastapi uvicorn watchdog
```

### Q2: CLI 无法连接服务？

检查服务是否运行：
```bash
curl http://127.0.0.1:8000/health
```

### Q3: 回测数据未加载？

1. 检查 JSON 文件格式是否正确
2. 运行 `python scripts/ptrade_cli.py refresh`

---

> 文档版本: v1.0
> 更新日期: 2024-11-25














