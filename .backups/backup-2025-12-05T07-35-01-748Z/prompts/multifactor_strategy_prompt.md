# 多因子 → PTrade 策略生成 Prompt

> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。







> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。





> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。


> 每次生成策略时使用，替换 `{{ }}` 中的内容

---

现在请根据下面的多因子选股模型，为 **恒生 PTrade 平台** 生成一份可运行的 Python 策略脚本：

## 1. 标的池与基本设定

- 标的池：{{ 例如：中证800成分股；剔除ST、*ST，以及近60日日均成交额低于 3000 万的股票 }}
- 回测频率：日频（使用日线收盘价进行因子计算与调仓）
- 调仓周期：{{ 例如：每 20 个交易日调仓一次 }}
- 持仓数量：{{ 例如：每次持有 30 只股票，多头等权 }}

## 2. 因子定义

请实现以下因子，并为每个因子标准化（如 z-score 或分位数）：

- 价值因子：{{ 例如：过去一年平均 ROE 或者 1/PE }}
- 成长因子：{{ 例如：最近四个财报季度净利润同比增长率 }}
- 动量因子：{{ 例如：过去 60 个交易日收益率，剔除最近 5 日的短期波动 }}
- 波动因子：{{ 例如：过去 60 日收益率标准差，作为风险惩罚项 }}

## 3. 因子合成与打分

- 合成方式：
  - 总评分 = w1 * 价值因子标准分 + w2 * 成长因子标准分 + w3 * 动量因子标准分 - w4 * 波动因子标准分
  - 各因子权重：w1 = {{ 0.25 }}, w2 = {{ 0.25 }}, w3 = {{ 0.30 }}, w4 = {{ 0.20 }}
- 每次调仓时：
  - 在标的池内计算上述因子，并打分；
  - 按评分从高到低排序，选取前 N 只股票（N = 持仓数量）；
  - 组合等权分配（或略加权重倾斜，参考分数）。

## 4. 交易与风控规则

- 单个标的最大持仓权重：不超过组合市值的 {{ 例如：8% }}；
- 总仓位控制：目标总仓位 {{ 例如：80% }}，剩余 20% 现金；
- 交易费用：
  - 买入手续费：{{ 例如：万 2.5 }}，卖出同；
  - 默认忽略印花税，或根据 A 股规则设置。
- 换手约束：避免过度换手，每次调仓只对超出组合数量范围的股票进行调整，尽量保留前次高分股票。

## 5. PTrade 接口要求

- 请假设 PTrade Python 策略环境提供以下接口函数（如有不合理部分可在注释中说明并做合理假设）：
  - `initialize(context)`：初始化策略参数，设置回测周期、标的池等；
  - `before_trading_start(context)`：每日开盘前执行，用于检查持仓、生成当日目标持仓；
  - `handle_data(context, data)`：接收当日行情数据，在调仓日生成买卖指令；
  - 下单函数示例：`order_target_percent(symbol, target_pct)` 或 `order(symbol, volume)`；
  - 获取数据函数示例：`get_price(symbol, start_date, end_date, fields, frequency)`；
  - 获取财务因子示例：`get_fundamentals(query(...), date)`。
- 如 PTrade 实际接口存在差异，请在代码中以注释方式明确列出「需要替换为真实 PTrade API 的位置」。

## 6. 输出要求

- 请生成一份完整、可保存为 `mf_strategy_ptrade.py` 的 Python 策略代码；
- 在代码顶部集中定义参数（调仓周期、持仓数量、权重、交易费率等）；
- 在关键函数和逻辑处添加中文注释，说明用途和假设；
- 保证整体结构清晰，便于后续在 Cursor 中修改和迭代。














