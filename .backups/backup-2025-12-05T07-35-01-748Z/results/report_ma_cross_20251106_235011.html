<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JQQuant å›æµ‹æŠ¥å‘Š - MA Cross Strategy</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card.positive {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .metric-card.negative {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .metric-card.neutral {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
        }

        .metric-unit {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 400px;
        }

        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .strategy-explanation {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .strategy-explanation h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .strategy-explanation ul {
            margin-left: 20px;
        }

        .strategy-explanation li {
            margin: 10px 0;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: #666;
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin: 5px;
        }

        .badge-success {
            background: #4caf50;
            color: white;
        }

        .badge-warning {
            background: #ff9800;
            color: white;
        }

        .badge-danger {
            background: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š JQQuant å›æµ‹æŠ¥å‘Š</h1>
            <div class="subtitle" id="reportTitle">åŠ è½½ä¸­...</div>
        </header>

        <div class="content">
            <!-- å›æµ‹æ¦‚è§ˆ -->
            <section class="section">
                <h2>ğŸ“ˆ å›æµ‹æ¦‚è§ˆ</h2>
                <div class="metrics-grid" id="metricsGrid">
                    <!-- åŠ¨æ€ç”ŸæˆæŒ‡æ ‡å¡ç‰‡ -->
                </div>
            </section>

            <!-- ç­–ç•¥è¯´æ˜ -->
            <section class="section">
                <h2>ğŸ’¡ ç­–ç•¥åŸç†</h2>
                <div class="strategy-explanation">
                    <h4>ğŸ“Š åŒå‡çº¿äº¤å‰ç­–ç•¥ (Moving Average Crossover Strategy)</h4>
                    <p><strong>ç­–ç•¥ç±»å‹ï¼š</strong>è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥</p>
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
                    <ul>
                        <li>ä½¿ç”¨ä¸¤æ¡ç§»åŠ¨å¹³å‡çº¿ï¼ˆçŸ­æœŸå‡çº¿å’Œé•¿æœŸå‡çº¿ï¼‰æ¥åˆ¤æ–­å¸‚åœºè¶‹åŠ¿</li>
                        <li>å½“çŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿æ—¶ï¼Œäº§ç”Ÿä¹°å…¥ä¿¡å·ï¼ˆé‡‘å‰ï¼‰</li>
                        <li>å½“çŸ­æœŸå‡çº¿ä¸‹ç©¿é•¿æœŸå‡çº¿æ—¶ï¼Œäº§ç”Ÿå–å‡ºä¿¡å·ï¼ˆæ­»å‰ï¼‰</li>
                    </ul>
                    <p><strong>ç­–ç•¥å‚æ•°ï¼š</strong></p>
                    <ul>
                        <li>çŸ­æœŸå‡çº¿å‘¨æœŸï¼š5æ—¥ï¼ˆå¿«é€Ÿå“åº”ä»·æ ¼å˜åŒ–ï¼‰</li>
                        <li>é•¿æœŸå‡çº¿å‘¨æœŸï¼š20æ—¥ï¼ˆè¿‡æ»¤çŸ­æœŸæ³¢åŠ¨ï¼‰</li>
                    </ul>
                    <div class="info-box">
                        <strong>ğŸ’¡ ç­–ç•¥ä¼˜åŠ¿ï¼š</strong>
                        <ul>
                            <li>ç®€å•æ˜“æ‡‚ï¼Œæ˜“äºå®ç°</li>
                            <li>èƒ½å¤Ÿæ•æ‰ä¸­é•¿æœŸè¶‹åŠ¿</li>
                            <li>äº¤æ˜“ä¿¡å·æ˜ç¡®ï¼Œæ‰§è¡Œç®€å•</li>
                        </ul>
                    </div>
                    <div class="warning-box">
                        <strong>âš ï¸ ç­–ç•¥é£é™©ï¼š</strong>
                        <ul>
                            <li>åœ¨éœ‡è¡å¸‚åœºä¸­å®¹æ˜“äº§ç”Ÿå‡ä¿¡å·</li>
                            <li>å­˜åœ¨æ»åæ€§ï¼Œå¯èƒ½é”™è¿‡æœ€ä½³ä¹°å–ç‚¹</li>
                            <li>éœ€è¦è¶³å¤Ÿçš„å¸‚åœºè¶‹åŠ¿æ‰èƒ½ç›ˆåˆ©</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- ä»£ç è¯´æ˜ -->
            <section class="section">
                <h2>ğŸ’» ä»£ç è¯´æ˜</h2>
                <h3>ç­–ç•¥å®ç°ä»£ç </h3>
                <div class="code-block">
<span style="color: #5c6370;"># å‡çº¿äº¤å‰ç­–ç•¥æ ¸å¿ƒé€»è¾‘</span>
<span style="color: #c678dd;">class</span> <span style="color: #61afef;">MACrossStrategy</span>(BaseStrategy):
    <span style="color: #c678dd;">def</span> <span style="color: #61afef;">__init__</span>(<span style="color: #e06c75;">self</span>, short_window=<span style="color: #d19a66;">5</span>, long_window=<span style="color: #d19a66;">20</span>):
        <span style="color: #e06c75;">self</span>.short_window = short_window  <span style="color: #5c6370;"># çŸ­æœŸå‡çº¿å‘¨æœŸ</span>
        <span style="color: #e06c75;">self</span>.long_window = long_window    <span style="color: #5c6370;"># é•¿æœŸå‡çº¿å‘¨æœŸ</span>
    
    <span style="color: #c678dd;">def</span> <span style="color: #61afef;">handle_data</span>(<span style="color: #e06c75;">self</span>, data, date):
        <span style="color: #5c6370;"># è®¡ç®—çŸ­æœŸå’Œé•¿æœŸç§»åŠ¨å¹³å‡çº¿</span>
        short_ma = data[<span style="color: #98c379;">'close'</span>].rolling(window=<span style="color: #e06c75;">self</span>.short_window).mean()
        long_ma = data[<span style="color: #98c379;">'close'</span>].rolling(window=<span style="color: #e06c75;">self</span>.long_window).mean()
        
        <span style="color: #5c6370;"># åˆ¤æ–­å‡çº¿äº¤å‰ä¿¡å·</span>
        <span style="color: #c678dd;">if</span> short_ma.iloc[-<span style="color: #d19a66;">1</span>] > long_ma.iloc[-<span style="color: #d19a66;">1</span>] <span style="color: #c678dd;">and</span> short_ma.iloc[-<span style="color: #d19a66;">2</span>] <= long_ma.iloc[-<span style="color: #d19a66;">2</span>]:
            <span style="color: #5c6370;"># é‡‘å‰ï¼šä¹°å…¥ä¿¡å·</span>
            order_manager.create_order(security, <span style="color: #d19a66;">100</span>, OrderType.MARKET)
        <span style="color: #c678dd;">elif</span> short_ma.iloc[-<span style="color: #d19a66;">1</span>] < long_ma.iloc[-<span style="color: #d19a66;">1</span>] <span style="color: #c678dd;">and</span> short_ma.iloc[-<span style="color: #d19a66;">2</span>] >= long_ma.iloc[-<span style="color: #d19a66;">2</span>]:
            <span style="color: #5c6370;"># æ­»å‰ï¼šå–å‡ºä¿¡å·</span>
            order_manager.create_order(security, -position.amount, OrderType.MARKET)
                </div>
                
                <h3>ä»£ç è¯´æ˜</h3>
                <div class="info-box">
                    <p><strong>1. ç­–ç•¥åˆå§‹åŒ–ï¼š</strong></p>
                    <p>ç­–ç•¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šçŸ­æœŸå‡çº¿å‘¨æœŸï¼ˆé»˜è®¤5æ—¥ï¼‰å’Œé•¿æœŸå‡çº¿å‘¨æœŸï¼ˆé»˜è®¤20æ—¥ï¼‰ã€‚</p>
                    
                    <p><strong>2. æ•°æ®å¤„ç†ï¼š</strong></p>
                    <p>åœ¨æ¯ä¸ªäº¤æ˜“æ—¥ï¼Œç­–ç•¥ä¼šè®¡ç®—å½“å‰è‚¡ç¥¨çš„çŸ­æœŸå’Œé•¿æœŸç§»åŠ¨å¹³å‡çº¿ã€‚</p>
                    
                    <p><strong>3. ä¿¡å·ç”Ÿæˆï¼š</strong></p>
                    <ul>
                        <li><strong>ä¹°å…¥ä¿¡å·ï¼ˆé‡‘å‰ï¼‰ï¼š</strong>å½“çŸ­æœŸå‡çº¿ä»ä¸‹æ–¹ç©¿è¶Šé•¿æœŸå‡çº¿æ—¶è§¦å‘</li>
                        <li><strong>å–å‡ºä¿¡å·ï¼ˆæ­»å‰ï¼‰ï¼š</strong>å½“çŸ­æœŸå‡çº¿ä»ä¸Šæ–¹ç©¿è¶Šé•¿æœŸå‡çº¿æ—¶è§¦å‘</li>
                    </ul>
                    
                    <p><strong>4. è®¢å•æ‰§è¡Œï¼š</strong></p>
                    <p>æ ¹æ®ä¿¡å·åˆ›å»ºå¸‚ä»·å•ï¼Œä¹°å…¥æ—¶å›ºå®šæ•°é‡100è‚¡ï¼Œå–å‡ºæ—¶å…¨éƒ¨æŒä»“ã€‚</p>
                </div>
            </section>

            <!-- ç»“æœåˆ†æ -->
            <section class="section">
                <h2>ğŸ“Š ç»“æœåˆ†æ</h2>
                <div id="resultAnalysis">
                    <!-- åŠ¨æ€ç”Ÿæˆç»“æœåˆ†æ -->
                </div>
            </section>

            <!-- å›¾è¡¨å±•ç¤º -->
            <section class="section">
                <h2>ğŸ“‰ å¯è§†åŒ–å›¾è¡¨</h2>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </section>
        </div>

        <footer>
            <p>JQQuant é‡åŒ–å›æµ‹ç³»ç»Ÿ | æŠ¥å‘Šç”Ÿæˆæ—¶é—´: <span id="reportTime"></span></p>
        </footer>
    </div>

    <script>
        // åµŒå…¥çš„å›æµ‹æ•°æ®
        const reportData = {
            "strategy": "ma_cross",
            "start_date": "2024-07-29",
            "end_date": "2025-08-05",
            "securities": ["000001.XSHE"],
            "summary": {
                "initial_cash": 1000000,
                "current_cash": 999784.5600402001,
                "total_value": 999784.5600402001,
                "total_profit": -215.43995979987085,
                "total_profit_rate": -0.00021543995979987084,
                "positions_count": 0,
                "positions": {}
            },
            "metrics": {
                "total_return": -0.00021543995979987084,
                "annual_return": -0.00021891441748755902,
                "sharpe_ratio": -1.0287159861889688,
                "max_drawdown": 0.00046215290957296297,
                "total_trades": 248
            }
        };

        // ç”ŸæˆæŠ¥å‘Š
        function generateReport() {
            generateHeader();
            generateMetrics();
            generateResultAnalysis();
            generateCharts();
        }

        // ç”Ÿæˆæ ‡é¢˜
        function generateHeader() {
            const title = document.getElementById('reportTitle');
            title.textContent = `${reportData.strategy.toUpperCase()} ç­–ç•¥ | ${reportData.start_date} è‡³ ${reportData.end_date}`;
            
            const reportTime = document.getElementById('reportTime');
            reportTime.textContent = new Date().toLocaleString('zh-CN');
        }

        // ç”ŸæˆæŒ‡æ ‡å¡ç‰‡
        function generateMetrics() {
            const grid = document.getElementById('metricsGrid');
            const summary = reportData.summary;
            const metrics = reportData.metrics;

            const metricCards = [
                {
                    label: 'åˆå§‹èµ„é‡‘',
                    value: formatNumber(summary.initial_cash),
                    unit: 'å…ƒ',
                    class: 'neutral'
                },
                {
                    label: 'æœ€ç»ˆèµ„äº§',
                    value: formatNumber(summary.total_value),
                    unit: 'å…ƒ',
                    class: summary.total_value >= summary.initial_cash ? 'positive' : 'negative'
                },
                {
                    label: 'æ€»æ”¶ç›Šç‡',
                    value: (metrics.total_return * 100).toFixed(2),
                    unit: '%',
                    class: metrics.total_return >= 0 ? 'positive' : 'negative'
                },
                {
                    label: 'å¹´åŒ–æ”¶ç›Šç‡',
                    value: (metrics.annual_return * 100).toFixed(2),
                    unit: '%',
                    class: metrics.annual_return >= 0 ? 'positive' : 'negative'
                },
                {
                    label: 'å¤æ™®æ¯”ç‡',
                    value: metrics.sharpe_ratio.toFixed(2),
                    unit: '',
                    class: metrics.sharpe_ratio >= 1 ? 'positive' : metrics.sharpe_ratio >= 0 ? 'neutral' : 'negative'
                },
                {
                    label: 'æœ€å¤§å›æ’¤',
                    value: (metrics.max_drawdown * 100).toFixed(2),
                    unit: '%',
                    class: metrics.max_drawdown <= 0.1 ? 'positive' : metrics.max_drawdown <= 0.2 ? 'neutral' : 'negative'
                },
                {
                    label: 'æ€»äº¤æ˜“æ¬¡æ•°',
                    value: metrics.total_trades,
                    unit: 'æ¬¡',
                    class: 'neutral'
                },
                {
                    label: 'æŒä»“æ•°é‡',
                    value: summary.positions_count,
                    unit: 'åª',
                    class: 'neutral'
                }
            ];

            grid.innerHTML = metricCards.map(card => `
                <div class="metric-card ${card.class}">
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                    <div class="metric-unit">${card.unit}</div>
                </div>
            `).join('');
        }

        // ç”Ÿæˆç»“æœåˆ†æ
        function generateResultAnalysis() {
            const container = document.getElementById('resultAnalysis');
            const summary = reportData.summary;
            const metrics = reportData.metrics;

            let analysis = '';
            
            // æ”¶ç›Šåˆ†æ
            const profitRate = metrics.total_return * 100;
            const profitStatus = profitRate >= 0 ? 'positive' : 'negative';
            const profitBadge = profitRate >= 0 ? 'badge-success' : 'badge-danger';
            
            analysis += `
                <h3>ğŸ’° æ”¶ç›Šåˆ†æ</h3>
                <div class="${profitStatus === 'positive' ? 'success-box' : 'warning-box'}">
                    <p><strong>æ€»æ”¶ç›Šï¼š</strong> 
                        <span class="badge ${profitBadge}">${profitRate >= 0 ? '+' : ''}${profitRate.toFixed(2)}%</span>
                    </p>
                    <p>åˆå§‹èµ„é‡‘ï¼š${formatNumber(summary.initial_cash)} å…ƒ</p>
                    <p>æœ€ç»ˆèµ„äº§ï¼š${formatNumber(summary.total_value)} å…ƒ</p>
                    <p>ç›ˆäºé‡‘é¢ï¼š${profitRate >= 0 ? '+' : ''}${formatNumber(summary.total_profit)} å…ƒ</p>
                </div>
            `;

            // é£é™©åˆ†æ
            const sharpeStatus = metrics.sharpe_ratio >= 1 ? 'positive' : metrics.sharpe_ratio >= 0 ? 'neutral' : 'negative';
            const drawdownStatus = metrics.max_drawdown <= 0.1 ? 'positive' : metrics.max_drawdown <= 0.2 ? 'neutral' : 'negative';
            
            analysis += `
                <h3>âš ï¸ é£é™©åˆ†æ</h3>
                <div class="metrics-grid">
                    <div class="metric-card ${sharpeStatus}">
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                        <div class="metric-value">${metrics.sharpe_ratio.toFixed(2)}</div>
                        <div class="metric-unit">${getSharpeRating(metrics.sharpe_ratio)}</div>
                    </div>
                    <div class="metric-card ${drawdownStatus}">
                        <div class="metric-label">æœ€å¤§å›æ’¤</div>
                        <div class="metric-value">${(metrics.max_drawdown * 100).toFixed(2)}</div>
                        <div class="metric-unit">%</div>
                    </div>
                </div>
                <div class="info-box">
                    <p><strong>å¤æ™®æ¯”ç‡è¯´æ˜ï¼š</strong></p>
                    <ul>
                        <li>${metrics.sharpe_ratio >= 1 ? 'âœ… ä¼˜ç§€ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°è‰¯å¥½' : metrics.sharpe_ratio >= 0 ? 'âš ï¸ ä¸€èˆ¬ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸€èˆ¬' : 'âŒ è¾ƒå·®ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸ä½³'}</li>
                        <li>å¤æ™®æ¯”ç‡ = (æ”¶ç›Šç‡ - æ— é£é™©åˆ©ç‡) / æ”¶ç›Šç‡æ ‡å‡†å·®</li>
                        <li>é€šå¸¸è®¤ä¸ºå¤æ™®æ¯”ç‡ > 1 ä¸ºè‰¯å¥½ï¼Œ> 2 ä¸ºä¼˜ç§€</li>
                    </ul>
                    <p><strong>æœ€å¤§å›æ’¤è¯´æ˜ï¼š</strong></p>
                    <ul>
                        <li>æœ€å¤§å›æ’¤ ${(metrics.max_drawdown * 100).toFixed(2)}% ${metrics.max_drawdown <= 0.1 ? 'ï¼Œé£é™©æ§åˆ¶è‰¯å¥½' : metrics.max_drawdown <= 0.2 ? 'ï¼Œé£é™©æ§åˆ¶ä¸€èˆ¬' : 'ï¼Œé£é™©æ§åˆ¶éœ€è¦æ”¹è¿›'}</li>
                        <li>æœ€å¤§å›æ’¤åæ˜ äº†ç­–ç•¥åœ¨æœ€åæƒ…å†µä¸‹çš„æŸå¤±</li>
                        <li>é€šå¸¸è®¤ä¸ºæœ€å¤§å›æ’¤ < 10% ä¸ºè‰¯å¥½ï¼Œ< 20% ä¸ºå¯æ¥å—</li>
                    </ul>
                </div>
            `;

            // äº¤æ˜“åˆ†æ
            analysis += `
                <h3>ğŸ“Š äº¤æ˜“åˆ†æ</h3>
                <div class="info-box">
                    <p><strong>æ€»äº¤æ˜“æ¬¡æ•°ï¼š</strong> ${metrics.total_trades} æ¬¡</p>
                    <p><strong>å¹³å‡æŒä»“æ•°é‡ï¼š</strong> ${summary.positions_count} åª</p>
                    <p><strong>äº¤æ˜“é¢‘ç‡ï¼š</strong> ${calculateTradeFrequency()} æ¬¡/æœˆ</p>
                </div>
            `;

            // ç»¼åˆè¯„ä»·
            analysis += `
                <h3>ğŸ“ ç»¼åˆè¯„ä»·</h3>
                <div class="${getOverallRating() === 'good' ? 'success-box' : getOverallRating() === 'fair' ? 'info-box' : 'warning-box'}">
                    ${generateOverallComment()}
                </div>
            `;

            container.innerHTML = analysis;
        }

        // ç”Ÿæˆå›¾è¡¨
        function generateCharts() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            // æ¨¡æ‹Ÿæ•°æ®ï¼ˆå®é™…åº”è¯¥ä»reportData.portfolio_historyè·å–ï¼‰
            const dates = generateDateRange(reportData.start_date, reportData.end_date);
            const values = generateSimulatedValues(reportData.summary.initial_cash, reportData.metrics.total_return, dates.length);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'æ€»èµ„äº§',
                        data: values,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'åˆå§‹èµ„é‡‘',
                        data: Array(dates.length).fill(reportData.summary.initial_cash),
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'å›æµ‹æœŸé—´èµ„äº§å˜åŒ–æ›²çº¿',
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value) + ' å…ƒ';
                                }
                            }
                        }
                    }
                }
            });
        }

        // è¾…åŠ©å‡½æ•°
        function formatNumber(num) {
            return new Intl.NumberFormat('zh-CN').format(num.toFixed(2));
        }

        function getSharpeRating(sharpe) {
            if (sharpe >= 2) return 'ä¼˜ç§€';
            if (sharpe >= 1) return 'è‰¯å¥½';
            if (sharpe >= 0) return 'ä¸€èˆ¬';
            return 'è¾ƒå·®';
        }

        function calculateTradeFrequency() {
            const start = new Date(reportData.start_date);
            const end = new Date(reportData.end_date);
            const months = (end - start) / (1000 * 60 * 60 * 24 * 30);
            return (reportData.metrics.total_trades / months).toFixed(1);
        }

        function getOverallRating() {
            const metrics = reportData.metrics;
            let score = 0;
            
            if (metrics.total_return >= 0) score += 2;
            if (metrics.sharpe_ratio >= 1) score += 2;
            if (metrics.max_drawdown <= 0.1) score += 1;
            
            if (score >= 4) return 'good';
            if (score >= 2) return 'fair';
            return 'poor';
        }

        function generateOverallComment() {
            const metrics = reportData.metrics;
            
            let comment = '<p><strong>ç­–ç•¥è¡¨ç°è¯„ä»·ï¼š</strong></p><ul>';
            
            if (metrics.total_return >= 0) {
                comment += '<li>âœ… ç­–ç•¥åœ¨å›æµ‹æœŸé—´å®ç°äº†æ­£æ”¶ç›Š</li>';
            } else {
                comment += '<li>âŒ ç­–ç•¥åœ¨å›æµ‹æœŸé—´å‡ºç°äºæŸï¼Œéœ€è¦ä¼˜åŒ–</li>';
            }
            
            if (metrics.sharpe_ratio >= 1) {
                comment += '<li>âœ… é£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°è‰¯å¥½</li>';
            } else if (metrics.sharpe_ratio >= 0) {
                comment += '<li>âš ï¸ é£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸€èˆ¬</li>';
            } else {
                comment += '<li>âŒ é£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸ä½³</li>';
            }
            
            if (metrics.max_drawdown <= 0.1) {
                comment += '<li>âœ… æœ€å¤§å›æ’¤æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…</li>';
            } else if (metrics.max_drawdown <= 0.2) {
                comment += '<li>âš ï¸ æœ€å¤§å›æ’¤è¾ƒå¤§ï¼Œéœ€è¦æ³¨æ„é£é™©æ§åˆ¶</li>';
            } else {
                comment += '<li>âŒ æœ€å¤§å›æ’¤è¿‡å¤§ï¼Œé£é™©æ§åˆ¶éœ€è¦æ”¹è¿›</li>';
            }
            
            comment += '</ul>';
            
            comment += '<p><strong>æ”¹è¿›å»ºè®®ï¼š</strong></p><ul>';
            comment += '<li>è€ƒè™‘è°ƒæ•´å‡çº¿å‘¨æœŸå‚æ•°ï¼Œä¼˜åŒ–ä¹°å–ä¿¡å·</li>';
            comment += '<li>æ·»åŠ æ­¢æŸå’Œæ­¢ç›ˆæœºåˆ¶ï¼Œæ§åˆ¶é£é™©</li>';
            comment += '<li>ç»“åˆå…¶ä»–æŠ€æœ¯æŒ‡æ ‡ï¼Œæé«˜ä¿¡å·å‡†ç¡®æ€§</li>';
            comment += '<li>ä¼˜åŒ–ä»“ä½ç®¡ç†ï¼Œé¿å…è¿‡åº¦äº¤æ˜“</li>';
            comment += '</ul>';
            
            return comment;
        }

        function generateDateRange(start, end) {
            const dates = [];
            const startDate = new Date(start);
            const endDate = new Date(end);
            const current = new Date(startDate);
            
            while (current <= endDate) {
                dates.push(current.toLocaleDateString('zh-CN'));
                current.setDate(current.getDate() + 1);
            }
            
            // å¦‚æœæ—¥æœŸå¤ªå¤šï¼Œåªå–éƒ¨åˆ†
            if (dates.length > 100) {
                const step = Math.floor(dates.length / 50);
                return dates.filter((_, i) => i % step === 0);
            }
            
            return dates;
        }

        function generateSimulatedValues(initial, returnRate, count) {
            const values = [initial];
            const dailyReturn = Math.pow(1 + returnRate, 1 / count) - 1;
            
            for (let i = 1; i < count; i++) {
                const randomFactor = 1 + (Math.random() - 0.5) * 0.02; // æ·»åŠ ä¸€äº›éšæœºæ³¢åŠ¨
                values.push(values[i - 1] * (1 + dailyReturn * randomFactor));
            }
            
            return values;
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.addEventListener('DOMContentLoaded', generateReport);
    </script>
</body>
</html>


