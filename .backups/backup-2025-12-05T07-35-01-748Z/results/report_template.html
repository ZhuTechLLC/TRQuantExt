<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JQQuant å›æµ‹æŠ¥å‘Š</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js@2.26.0/dist/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card.positive {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .metric-card.negative {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .metric-card.neutral {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
        }

        .metric-unit {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .code-block .keyword { color: #c678dd; }
        .code-block .string { color: #98c379; }
        .code-block .comment { color: #5c6370; }
        .code-block .function { color: #61afef; }
        .code-block .number { color: #d19a66; }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background: #667eea;
            color: white;
        }

        table tr:hover {
            background: #f5f5f5;
        }

        .strategy-explanation {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .strategy-explanation h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .strategy-explanation ul {
            margin-left: 20px;
        }

        .strategy-explanation li {
            margin: 10px 0;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: #666;
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            margin: 5px;
        }

        .badge-success {
            background: #4caf50;
            color: white;
        }

        .badge-warning {
            background: #ff9800;
            color: white;
        }

        .badge-danger {
            background: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š JQQuant å›æµ‹æŠ¥å‘Š</h1>
            <div class="subtitle" id="reportTitle">åŠ è½½ä¸­...</div>
        </header>

        <div class="content">
            <!-- å›æµ‹æ¦‚è§ˆ -->
            <section class="section">
                <h2>ğŸ“ˆ å›æµ‹æ¦‚è§ˆ</h2>
                <div class="metrics-grid" id="metricsGrid">
                    <!-- åŠ¨æ€ç”ŸæˆæŒ‡æ ‡å¡ç‰‡ -->
                </div>
            </section>

            <!-- ç­–ç•¥è¯´æ˜ -->
            <section class="section">
                <h2>ğŸ’¡ ç­–ç•¥åŸç†</h2>
                <div class="strategy-explanation" id="strategyExplanation">
                    <!-- åŠ¨æ€ç”Ÿæˆç­–ç•¥è¯´æ˜ -->
                </div>
            </section>

            <!-- ä»£ç è¯´æ˜ -->
            <section class="section">
                <h2>ğŸ’» ä»£ç è¯´æ˜</h2>
                <div id="codeExplanation">
                    <!-- åŠ¨æ€ç”Ÿæˆä»£ç è¯´æ˜ -->
                </div>
            </section>

            <!-- ç»“æœåˆ†æ -->
            <section class="section">
                <h2>ğŸ“Š ç»“æœåˆ†æ</h2>
                <div id="resultAnalysis">
                    <!-- åŠ¨æ€ç”Ÿæˆç»“æœåˆ†æ -->
                </div>
            </section>

            <!-- å›¾è¡¨å±•ç¤º -->
            <section class="section">
                <h2>ğŸ“‰ å¯è§†åŒ–å›¾è¡¨</h2>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </section>
        </div>

        <footer>
            <p>JQQuant é‡åŒ–å›æµ‹ç³»ç»Ÿ | æŠ¥å‘Šç”Ÿæˆæ—¶é—´: <span id="reportTime"></span></p>
        </footer>
    </div>

    <script>
        // ä»URLå‚æ•°è·å–JSONæ–‡ä»¶è·¯å¾„ï¼Œæˆ–ä½¿ç”¨é»˜è®¤è·¯å¾„
        const urlParams = new URLSearchParams(window.location.search);
        const jsonFile = urlParams.get('file') || 'backtest_ma_cross_20251106_235011.json';
        
        let reportData = null;

        // åŠ è½½JSONæ•°æ® - æ”¯æŒå¤šç§æ–¹å¼
        async function loadReportData() {
            // æ–¹æ³•1: å°è¯•ç›´æ¥fetchï¼ˆéœ€è¦HTTPæœåŠ¡å™¨ï¼‰
            try {
                const response = await fetch(jsonFile);
                if (response.ok) {
                    reportData = await response.json();
                    generateReport();
                    return;
                }
            } catch (error) {
                console.log('Fetch failed, trying alternative methods...');
            }

            // æ–¹æ³•2: å°è¯•ä½¿ç”¨FileReaderï¼ˆç”¨æˆ·é€‰æ‹©æ–‡ä»¶ï¼‰
            // å¦‚æœæ˜¯åœ¨file://åè®®ä¸‹ï¼Œæä¾›æ–‡ä»¶é€‰æ‹©åŠŸèƒ½
            if (window.location.protocol === 'file:') {
                showFileSelector();
                return;
            }

            // æ–¹æ³•3: å°è¯•è¯»å–åµŒå…¥çš„æ•°æ®
            if (window.reportData) {
                reportData = window.reportData;
                generateReport();
                return;
            }

            // å¦‚æœéƒ½å¤±è´¥äº†ï¼Œæ˜¾ç¤ºé”™è¯¯
            showError('æ— æ³•åŠ è½½å›æµ‹æ•°æ®ã€‚è¯·ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€ï¼š\n1. é€šè¿‡HTTPæœåŠ¡å™¨è®¿é—®ï¼ˆæ¨èï¼‰\n2. ä½¿ç”¨æ–‡ä»¶é€‰æ‹©å™¨é€‰æ‹©JSONæ–‡ä»¶');
        }

        // æ˜¾ç¤ºæ–‡ä»¶é€‰æ‹©å™¨
        function showFileSelector() {
            const container = document.querySelector('.container');
            const originalHTML = container.innerHTML; // ä¿å­˜åŸå§‹HTML
            
            container.innerHTML = `
                <div style="text-align: center; padding: 50px;">
                    <h2>ğŸ“ é€‰æ‹©å›æµ‹ç»“æœæ–‡ä»¶</h2>
                    <p style="margin: 20px 0; color: #666;">ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©JSONæ–‡ä»¶ï¼š</p>
                    <input type="file" id="jsonFileInput" accept=".json" style="padding: 10px; margin: 20px; font-size: 16px;">
                    <div id="fileInfo" style="margin-top: 20px; color: #666;"></div>
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                        <h3 style="margin-bottom: 10px;">ğŸ’¡ æç¤ºï¼š</h3>
                        <p>æ¨èä½¿ç”¨HTTPæœåŠ¡å™¨è®¿é—®ä»¥è·å¾—æœ€ä½³ä½“éªŒï¼š</p>
                        <code style="display: block; background: #e9ecef; padding: 10px; margin: 10px 0; border-radius: 5px;">
                            python -m http.server 8000
                        </code>
                        <p>ç„¶åè®¿é—®ï¼š<code>http://localhost:8000/results/report_template.html</code></p>
                    </div>
                </div>
            `;
            
            const fileInput = document.getElementById('jsonFileInput');
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('fileInfo').textContent = `æ­£åœ¨åŠ è½½: ${file.name}...`;
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            reportData = JSON.parse(e.target.result);
                            // æ¢å¤åŸå§‹HTMLç»“æ„
                            container.innerHTML = originalHTML;
                            // ç”ŸæˆæŠ¥å‘Š
                            generateReport();
                        } catch (error) {
                            document.getElementById('fileInfo').innerHTML = 
                                `<span style="color: #f44336;">âŒ JSONæ–‡ä»¶æ ¼å¼é”™è¯¯: ${error.message}</span>`;
                        }
                    };
                    reader.readAsText(file);
                }
            });
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            document.body.innerHTML = `
                <div style="text-align: center; padding: 50px; max-width: 800px; margin: 50px auto;">
                    <h2 style="color: #f44336;">âš ï¸ æ— æ³•åŠ è½½å›æµ‹æ•°æ®</h2>
                    <p style="margin: 20px 0; color: #666;">${message}</p>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px; text-align: left;">
                        <h3>è§£å†³æ–¹æ¡ˆï¼š</h3>
                        <ol style="line-height: 2;">
                            <li><strong>ä½¿ç”¨HTTPæœåŠ¡å™¨ï¼ˆæ¨èï¼‰ï¼š</strong><br>
                                åœ¨é¡¹ç›®ç›®å½•è¿è¡Œï¼š<code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px;">python -m http.server 8000</code><br>
                                ç„¶åè®¿é—®ï¼š<code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px;">http://localhost:8000/results/report_template.html</code>
                            </li>
                            <li><strong>ä½¿ç”¨æ–‡ä»¶é€‰æ‹©å™¨ï¼š</strong><br>
                                é¡µé¢ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ–‡ä»¶é€‰æ‹©å™¨ï¼Œé€‰æ‹©JSONæ–‡ä»¶å³å¯
                            </li>
                            <li><strong>ç›´æ¥åµŒå…¥æ•°æ®ï¼š</strong><br>
                                å°†JSONæ•°æ®å¤åˆ¶åˆ°HTMLæ–‡ä»¶çš„ <code>&lt;script&gt;</code> æ ‡ç­¾ä¸­
                            </li>
                        </ol>
                    </div>
                </div>
            `;
        }


        // ç”ŸæˆæŠ¥å‘Š
        function generateReport() {
            generateHeader();
            generateMetrics();
            generateStrategyExplanation();
            generateCodeExplanation();
            generateResultAnalysis();
            generateCharts();
        }

        // ç”Ÿæˆæ ‡é¢˜
        function generateHeader() {
            const title = document.getElementById('reportTitle');
            title.textContent = `${reportData.strategy.toUpperCase()} ç­–ç•¥ | ${reportData.start_date} è‡³ ${reportData.end_date}`;
            
            const reportTime = document.getElementById('reportTime');
            reportTime.textContent = new Date().toLocaleString('zh-CN');
        }

        // ç”ŸæˆæŒ‡æ ‡å¡ç‰‡
        function generateMetrics() {
            const grid = document.getElementById('metricsGrid');
            const summary = reportData.summary;
            const metrics = reportData.metrics;

            const metricCards = [
                {
                    label: 'åˆå§‹èµ„é‡‘',
                    value: formatNumber(summary.initial_cash),
                    unit: 'å…ƒ',
                    class: 'neutral'
                },
                {
                    label: 'æœ€ç»ˆèµ„äº§',
                    value: formatNumber(summary.total_value),
                    unit: 'å…ƒ',
                    class: summary.total_value >= summary.initial_cash ? 'positive' : 'negative'
                },
                {
                    label: 'æ€»æ”¶ç›Šç‡',
                    value: (metrics.total_return * 100).toFixed(2),
                    unit: '%',
                    class: metrics.total_return >= 0 ? 'positive' : 'negative'
                },
                {
                    label: 'å¹´åŒ–æ”¶ç›Šç‡',
                    value: (metrics.annual_return * 100).toFixed(2),
                    unit: '%',
                    class: metrics.annual_return >= 0 ? 'positive' : 'negative'
                },
                {
                    label: 'å¤æ™®æ¯”ç‡',
                    value: metrics.sharpe_ratio.toFixed(2),
                    unit: '',
                    class: metrics.sharpe_ratio >= 1 ? 'positive' : metrics.sharpe_ratio >= 0 ? 'neutral' : 'negative'
                },
                {
                    label: 'æœ€å¤§å›æ’¤',
                    value: (metrics.max_drawdown * 100).toFixed(2),
                    unit: '%',
                    class: metrics.max_drawdown <= 0.1 ? 'positive' : metrics.max_drawdown <= 0.2 ? 'neutral' : 'negative'
                },
                {
                    label: 'æ€»äº¤æ˜“æ¬¡æ•°',
                    value: metrics.total_trades,
                    unit: 'æ¬¡',
                    class: 'neutral'
                },
                {
                    label: 'æŒä»“æ•°é‡',
                    value: summary.positions_count,
                    unit: 'åª',
                    class: 'neutral'
                }
            ];

            grid.innerHTML = metricCards.map(card => `
                <div class="metric-card ${card.class}">
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                    <div class="metric-unit">${card.unit}</div>
                </div>
            `).join('');
        }

        // ç”Ÿæˆç­–ç•¥è¯´æ˜
        function generateStrategyExplanation() {
            const container = document.getElementById('strategyExplanation');
            const strategy = reportData.strategy;

            if (strategy === 'ma_cross') {
                container.innerHTML = `
                    <h4>ğŸ“Š åŒå‡çº¿äº¤å‰ç­–ç•¥ (Moving Average Crossover Strategy)</h4>
                    <p><strong>ç­–ç•¥ç±»å‹ï¼š</strong>è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥</p>
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
                    <ul>
                        <li>ä½¿ç”¨ä¸¤æ¡ç§»åŠ¨å¹³å‡çº¿ï¼ˆçŸ­æœŸå‡çº¿å’Œé•¿æœŸå‡çº¿ï¼‰æ¥åˆ¤æ–­å¸‚åœºè¶‹åŠ¿</li>
                        <li>å½“çŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿æ—¶ï¼Œäº§ç”Ÿä¹°å…¥ä¿¡å·ï¼ˆé‡‘å‰ï¼‰</li>
                        <li>å½“çŸ­æœŸå‡çº¿ä¸‹ç©¿é•¿æœŸå‡çº¿æ—¶ï¼Œäº§ç”Ÿå–å‡ºä¿¡å·ï¼ˆæ­»å‰ï¼‰</li>
                    </ul>
                    <p><strong>ç­–ç•¥å‚æ•°ï¼š</strong></p>
                    <ul>
                        <li>çŸ­æœŸå‡çº¿å‘¨æœŸï¼š5æ—¥ï¼ˆå¿«é€Ÿå“åº”ä»·æ ¼å˜åŒ–ï¼‰</li>
                        <li>é•¿æœŸå‡çº¿å‘¨æœŸï¼š20æ—¥ï¼ˆè¿‡æ»¤çŸ­æœŸæ³¢åŠ¨ï¼‰</li>
                    </ul>
                    <div class="info-box">
                        <strong>ğŸ’¡ ç­–ç•¥ä¼˜åŠ¿ï¼š</strong>
                        <ul>
                            <li>ç®€å•æ˜“æ‡‚ï¼Œæ˜“äºå®ç°</li>
                            <li>èƒ½å¤Ÿæ•æ‰ä¸­é•¿æœŸè¶‹åŠ¿</li>
                            <li>äº¤æ˜“ä¿¡å·æ˜ç¡®ï¼Œæ‰§è¡Œç®€å•</li>
                        </ul>
                    </div>
                    <div class="warning-box">
                        <strong>âš ï¸ ç­–ç•¥é£é™©ï¼š</strong>
                        <ul>
                            <li>åœ¨éœ‡è¡å¸‚åœºä¸­å®¹æ˜“äº§ç”Ÿå‡ä¿¡å·</li>
                            <li>å­˜åœ¨æ»åæ€§ï¼Œå¯èƒ½é”™è¿‡æœ€ä½³ä¹°å–ç‚¹</li>
                            <li>éœ€è¦è¶³å¤Ÿçš„å¸‚åœºè¶‹åŠ¿æ‰èƒ½ç›ˆåˆ©</li>
                        </ul>
                    </div>
                `;
            } else if (strategy === 'adaptive_momentum') {
                container.innerHTML = `
                    <h4>ğŸš€ è‡ªé€‚åº”åŠ¨é‡ç­–ç•¥ (Adaptive Momentum Strategy)</h4>
                    <p><strong>ç­–ç•¥ç±»å‹ï¼š</strong>è‡ªé€‚åº”åŠ¨é‡ç­–ç•¥</p>
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong></p>
                    <ul>
                        <li>é€šè¿‡å¤šå› ç´ å¸‚åœºç¯å¢ƒè¯†åˆ«æ¡†æ¶ï¼Œè‡ªåŠ¨è¯†åˆ«å½“å‰å¸‚åœºé˜¶æ®µï¼ˆè¶‹åŠ¿ã€é£é™©ã€é£æ ¼ï¼‰</li>
                        <li>æ ¹æ®å¸‚åœºç¯å¢ƒåŠ¨æ€è°ƒæ•´ç­–ç•¥å‚æ•°ï¼ˆé€‰è‚¡æ ‡å‡†ã€ä»“ä½å¤§å°ã€æ­¢æŸæ­¢ç›ˆï¼‰</li>
                        <li>åœ¨ç‰›å¸‚é‡‡ç”¨æ¿€è¿›å‚æ•°ï¼Œåœ¨ç†Šå¸‚è‡ªåŠ¨å‡ä»“æˆ–æ¸…ä»“ï¼Œå®ç°çœŸæ­£çš„è‡ªé€‚åº”äº¤æ˜“</li>
                        <li>ç»“åˆåŠ¨é‡é€‰è‚¡å’ŒåŠ¨æ€ä»“ä½ç®¡ç†ï¼Œæå‡é£é™©è°ƒæ•´åæ”¶ç›Š</li>
                    </ul>
                    <p><strong>å¸‚åœºç¯å¢ƒè¯†åˆ«ï¼š</strong></p>
                    <ul>
                        <li><strong>è¶‹åŠ¿åˆ¤å®šå±‚ï¼š</strong>åŸºå‡†æŒ‡æ•°ä¸å‡çº¿å…³ç³»åˆ¤æ–­è¶‹åŠ¿æ–¹å‘ï¼ˆBullish/Bearish/Sidewaysï¼‰</li>
                        <li><strong>é£é™©åˆ¤å®šå±‚ï¼š</strong>æ³¢åŠ¨ç‡æŒ‡æ ‡åˆ¤æ–­å¸‚åœºææ…Œç¨‹åº¦ï¼ˆNormal/Elevated/Panicï¼‰</li>
                        <li><strong>é£æ ¼è½®åŠ¨å±‚ï¼š</strong>åˆ¤æ–­æˆé•¿vsä»·å€¼é£æ ¼</li>
                        <li>é€šè¿‡å†³ç­–æ ‘å°†å¸‚åœºç¯å¢ƒåˆ†ç±»ä¸º11ç§å¸‚åœºé˜¶æ®µ</li>
                    </ul>
                    <p><strong>ç­–ç•¥å‚æ•°ï¼ˆä¼šæ ¹æ®å¸‚åœºç¯å¢ƒåŠ¨æ€è°ƒæ•´ï¼‰ï¼š</strong></p>
                    <ul>
                        <li>ROC10æœ€å°å€¼ï¼š0.02ï¼ˆ10æ—¥å˜åŠ¨ç‡ç­›é€‰ï¼‰</li>
                        <li>ROC20æœ€å°å€¼ï¼š0.03ï¼ˆ20æ—¥å˜åŠ¨ç‡ç­›é€‰ï¼‰</li>
                        <li>æœ€å¤§æŒä»“æ•°ï¼š2-8åªï¼ˆæ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´ï¼‰</li>
                        <li>å•åªè‚¡ç¥¨ä»“ä½ï¼š10%-20%ï¼ˆæ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´ï¼‰</li>
                        <li>æ­¢æŸæ¯”ä¾‹ï¼š5%-12%ï¼ˆæ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´ï¼‰</li>
                        <li>æ­¢ç›ˆæ¯”ä¾‹ï¼š20%-70%ï¼ˆæ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´ï¼‰</li>
                    </ul>
                    <div class="info-box">
                        <strong>ğŸ’¡ ç­–ç•¥ä¼˜åŠ¿ï¼š</strong>
                        <ul>
                            <li>å¸‚åœºç¯å¢ƒè‡ªé€‚åº”ï¼Œèƒ½å¤Ÿé€‚åº”ä¸åŒå¸‚åœºé˜¶æ®µ</li>
                            <li>é£é™©æ§åˆ¶èƒ½åŠ›å¼ºï¼Œåœ¨ææ…Œç†Šå¸‚è‡ªåŠ¨æ¸…ä»“</li>
                            <li>å‚æ•°åŠ¨æ€ä¼˜åŒ–ï¼Œæ ¹æ®ä¸åŒå¸‚åœºé˜¶æ®µé‡‡ç”¨æœ€ä¼˜å‚æ•°ç»„åˆ</li>
                            <li>é£é™©è°ƒæ•´åæ”¶ç›Šä¼˜ç§€ï¼ŒSharpe Ratioé€šå¸¸è¾ƒé«˜</li>
                        </ul>
                    </div>
                    <div class="warning-box">
                        <strong>âš ï¸ ç­–ç•¥é£é™©ï¼š</strong>
                        <ul>
                            <li>å¸‚åœºç¯å¢ƒè¯†åˆ«å¯èƒ½ä¸å‡†ç¡®ï¼Œå¯¼è‡´å‚æ•°è°ƒæ•´é”™è¯¯</li>
                            <li>éœ€è¦æŒç»­ç›‘æ§å¸‚åœºç¯å¢ƒè¯†åˆ«å‡†ç¡®æ€§</li>
                            <li>åœ¨å¿«é€Ÿå˜åŒ–çš„å¸‚åœºä¸­å¯èƒ½ååº”æ»å</li>
                            <li>ç­–ç•¥å¤æ‚åº¦è¾ƒé«˜ï¼Œéœ€è¦å……åˆ†ç†è§£å¸‚åœºç¯å¢ƒè¯†åˆ«é€»è¾‘</li>
                        </ul>
                    </div>
                `;
            } else {
                container.innerHTML = `<p>ç­–ç•¥è¯´æ˜å¾…è¡¥å……</p>`;
            }
        }

        // ç”Ÿæˆä»£ç è¯´æ˜
        function generateCodeExplanation() {
            const container = document.getElementById('codeExplanation');
            const strategy = reportData.strategy;

            if (strategy === 'ma_cross') {
                container.innerHTML = `
                    <h3>ç­–ç•¥å®ç°ä»£ç </h3>
                    <div class="code-block">
<span class="comment"># å‡çº¿äº¤å‰ç­–ç•¥æ ¸å¿ƒé€»è¾‘</span>
<span class="keyword">class</span> <span class="function">MACrossStrategy</span>(BaseStrategy):
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, short_window=<span class="number">5</span>, long_window=<span class="number">20</span>):
        <span class="keyword">self</span>.short_window = short_window  <span class="comment"># çŸ­æœŸå‡çº¿å‘¨æœŸ</span>
        <span class="keyword">self</span>.long_window = long_window    <span class="comment"># é•¿æœŸå‡çº¿å‘¨æœŸ</span>
    
    <span class="keyword">def</span> <span class="function">handle_data</span>(<span class="keyword">self</span>, data, date):
        <span class="comment"># è®¡ç®—çŸ­æœŸå’Œé•¿æœŸç§»åŠ¨å¹³å‡çº¿</span>
        short_ma = data[<span class="string">'close'</span>].rolling(window=<span class="keyword">self</span>.short_window).mean()
        long_ma = data[<span class="string">'close'</span>].rolling(window=<span class="keyword">self</span>.long_window).mean()
        
        <span class="comment"># åˆ¤æ–­å‡çº¿äº¤å‰ä¿¡å·</span>
        <span class="keyword">if</span> short_ma.iloc[-<span class="number">1</span>] > long_ma.iloc[-<span class="number">1</span>] <span class="keyword">and</span> short_ma.iloc[-<span class="number">2</span>] <= long_ma.iloc[-<span class="number">2</span>]:
            <span class="comment"># é‡‘å‰ï¼šä¹°å…¥ä¿¡å·</span>
            order_manager.create_order(security, <span class="number">100</span>, OrderType.MARKET)
        <span class="keyword">elif</span> short_ma.iloc[-<span class="number">1</span>] < long_ma.iloc[-<span class="number">1</span>] <span class="keyword">and</span> short_ma.iloc[-<span class="number">2</span>] >= long_ma.iloc[-<span class="number">2</span>]:
            <span class="comment"># æ­»å‰ï¼šå–å‡ºä¿¡å·</span>
            order_manager.create_order(security, -position.amount, OrderType.MARKET)
                    </div>
                    
                    <h3>ä»£ç è¯´æ˜</h3>
                    <div class="info-box">
                        <p><strong>1. ç­–ç•¥åˆå§‹åŒ–ï¼š</strong></p>
                        <p>ç­–ç•¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šçŸ­æœŸå‡çº¿å‘¨æœŸï¼ˆé»˜è®¤5æ—¥ï¼‰å’Œé•¿æœŸå‡çº¿å‘¨æœŸï¼ˆé»˜è®¤20æ—¥ï¼‰ã€‚</p>
                        
                        <p><strong>2. æ•°æ®å¤„ç†ï¼š</strong></p>
                        <p>åœ¨æ¯ä¸ªäº¤æ˜“æ—¥ï¼Œç­–ç•¥ä¼šè®¡ç®—å½“å‰è‚¡ç¥¨çš„çŸ­æœŸå’Œé•¿æœŸç§»åŠ¨å¹³å‡çº¿ã€‚</p>
                        
                        <p><strong>3. ä¿¡å·ç”Ÿæˆï¼š</strong></p>
                        <ul>
                            <li><strong>ä¹°å…¥ä¿¡å·ï¼ˆé‡‘å‰ï¼‰ï¼š</strong>å½“çŸ­æœŸå‡çº¿ä»ä¸‹æ–¹ç©¿è¶Šé•¿æœŸå‡çº¿æ—¶è§¦å‘</li>
                            <li><strong>å–å‡ºä¿¡å·ï¼ˆæ­»å‰ï¼‰ï¼š</strong>å½“çŸ­æœŸå‡çº¿ä»ä¸Šæ–¹ç©¿è¶Šé•¿æœŸå‡çº¿æ—¶è§¦å‘</li>
                        </ul>
                        
                        <p><strong>4. è®¢å•æ‰§è¡Œï¼š</strong></p>
                        <p>æ ¹æ®ä¿¡å·åˆ›å»ºå¸‚ä»·å•ï¼Œä¹°å…¥æ—¶å›ºå®šæ•°é‡100è‚¡ï¼Œå–å‡ºæ—¶å…¨éƒ¨æŒä»“ã€‚</p>
                    </div>
                `;
            } else if (strategy === 'adaptive_momentum') {
                container.innerHTML = `
                    <h3>ç­–ç•¥å®ç°ä»£ç </h3>
                    <div class="code-block">
<span class="comment"># è‡ªé€‚åº”åŠ¨é‡ç­–ç•¥æ ¸å¿ƒé€»è¾‘</span>
<span class="keyword">class</span> <span class="function">AdaptiveMomentumStrategy</span>(BaseStrategy):
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, benchmark=<span class="string">"000300.XSHG"</span>, ...):
        <span class="keyword">self</span>.benchmark = benchmark
        <span class="keyword">self</span>.regime_detector = <span class="keyword">None</span>  <span class="comment"># å¸‚åœºç¯å¢ƒè¯†åˆ«å™¨</span>
        <span class="keyword">self</span>.current_regime = MarketRegime.NEUTRAL_SIDEWAYS
    
    <span class="keyword">def</span> <span class="function">before_trading_start</span>(<span class="keyword">self</span>, date):
        <span class="comment"># æ›´æ–°å¸‚åœºç¯å¢ƒè¯†åˆ«</span>
        new_regime = <span class="keyword">self</span>.regime_detector.update(date)
        <span class="keyword">if</span> new_regime != <span class="keyword">self</span>.current_regime:
            <span class="keyword">self</span>.current_regime = new_regime
            <span class="keyword">self</span>._adjust_strategy_parameters()  <span class="comment"># åŠ¨æ€è°ƒæ•´å‚æ•°</span>
    
    <span class="keyword">def</span> <span class="function">handle_data</span>(<span class="keyword">self</span>, data, date):
        <span class="comment"># 1. é€‰è‚¡ï¼šå¤šå› å­ç­›é€‰ + åŠ¨æ€è¯„åˆ†</span>
        candidates = <span class="keyword">self</span>._screen_stocks(data)
        
        <span class="comment"># 2. å†å¹³è¡¡ï¼šæ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´æŒä»“</span>
        <span class="keyword">self</span>._rebalance(candidates, date)
        
        <span class="comment"># 3. é£é™©æ§åˆ¶ï¼šæ­¢æŸæ­¢ç›ˆæ£€æŸ¥</span>
        <span class="keyword">self</span>._check_stop_loss_take_profit(date)
                    </div>
                    
                    <h3>ä»£ç è¯´æ˜</h3>
                    <div class="info-box">
                        <p><strong>1. ç­–ç•¥åˆå§‹åŒ–ï¼š</strong></p>
                        <p>ç­–ç•¥åˆå§‹åŒ–æ—¶åˆ›å»ºå¸‚åœºç¯å¢ƒè¯†åˆ«å™¨ï¼ˆMarketRegimeDetectorï¼‰ï¼Œç”¨äºè¯†åˆ«å½“å‰å¸‚åœºé˜¶æ®µã€‚è®¾ç½®é»˜è®¤å‚æ•°ï¼Œè¿™äº›å‚æ•°ä¼šæ ¹æ®å¸‚åœºç¯å¢ƒåŠ¨æ€è°ƒæ•´ã€‚</p>
                        
                        <p><strong>2. å¸‚åœºç¯å¢ƒè¯†åˆ«ï¼š</strong></p>
                        <p>åœ¨æ¯ä¸ªäº¤æ˜“æ—¥å¼€å§‹å‰ï¼ˆbefore_trading_startï¼‰ï¼Œç­–ç•¥ä¼šæ›´æ–°å¸‚åœºç¯å¢ƒè¯†åˆ«ã€‚å¦‚æœå¸‚åœºç¯å¢ƒå‘ç”Ÿå˜åŒ–ï¼Œä¼šè‡ªåŠ¨è°ƒæ•´ç­–ç•¥å‚æ•°ï¼ˆé€‰è‚¡æ ‡å‡†ã€ä»“ä½å¤§å°ã€æ­¢æŸæ­¢ç›ˆæ¯”ä¾‹ç­‰ï¼‰ã€‚</p>
                        
                        <p><strong>3. é€‰è‚¡é€»è¾‘ï¼š</strong></p>
                        <ul>
                            <li><strong>åˆæ­¥ç­›é€‰ï¼š</strong>ä½¿ç”¨ROC10ã€ROC20ã€æˆäº¤é‡ã€RSIç­‰æŠ€æœ¯æŒ‡æ ‡ç­›é€‰å€™é€‰è‚¡ç¥¨</li>
                            <li><strong>ç»¼åˆè¯„åˆ†ï¼š</strong>æ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´æƒé‡ï¼ˆç‰›å¸‚é‡è§†çŸ­æœŸåŠ¨é‡ï¼Œç†Šå¸‚æœ«æœŸé‡è§†è¶…è·Œåå¼¹ï¼‰</li>
                            <li><strong>é€‰æ‹©Top Nï¼š</strong>æ ¹æ®å¸‚åœºç¯å¢ƒé€‰æ‹©2-8åªè‚¡ç¥¨ï¼ˆç‰›å¸‚æŒä»“æ›´å¤šï¼Œç†Šå¸‚æŒä»“æ›´å°‘ï¼‰</li>
                        </ul>
                        
                        <p><strong>4. é£é™©æ§åˆ¶æœºåˆ¶ï¼š</strong></p>
                        <ul>
                            <li><strong>å¸‚åœºç¯å¢ƒè¯†åˆ«ï¼š</strong>åœ¨ææ…Œç†Šå¸‚è‡ªåŠ¨æ¸…ä»“</li>
                            <li><strong>åŠ¨æ€æ­¢æŸï¼š</strong>æ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´æ­¢æŸæ¯”ä¾‹ï¼ˆ5%-12%ï¼‰</li>
                            <li><strong>åŠ¨æ€æ­¢ç›ˆï¼š</strong>æ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´æ­¢ç›ˆæ¯”ä¾‹ï¼ˆ20%-70%ï¼‰</li>
                            <li><strong>ä»“ä½æ§åˆ¶ï¼š</strong>åœ¨é£é™©ç¯å¢ƒé™ä½ä»“ä½å’ŒæŒä»“æ•°</li>
                        </ul>
                        
                        <p><strong>5. å‚æ•°åŠ¨æ€è°ƒæ•´ï¼š</strong></p>
                        <p>ç­–ç•¥ä¼šæ ¹æ®11ç§å¸‚åœºé˜¶æ®µè‡ªåŠ¨è°ƒæ•´å‚æ•°ï¼š</p>
                        <ul>
                            <li>å…¨é¢ç‰›å¸‚ï¼šæ¿€è¿›å‚æ•°ï¼Œé«˜ä»“ä½ï¼Œå®½æ­¢æŸæ­¢ç›ˆ</li>
                            <li>ææ…Œç†Šå¸‚ï¼šä¿å®ˆå‚æ•°ï¼Œæ¸…ä»“æˆ–æœ€å°ä»“ä½</li>
                            <li>éœ‡è¡å¸‚åœºï¼šä¸­æ€§å‚æ•°ï¼Œä¸­ç­‰ä»“ä½</li>
                        </ul>
                    </div>
                `;
            } else {
                container.innerHTML = `<p>ä»£ç è¯´æ˜å¾…è¡¥å……</p>`;
            }
        }

        // ç”Ÿæˆç»“æœåˆ†æ
        function generateResultAnalysis() {
            const container = document.getElementById('resultAnalysis');
            const summary = reportData.summary;
            const metrics = reportData.metrics;

            let analysis = '';
            
            // æ”¶ç›Šåˆ†æ
            const profitRate = metrics.total_return * 100;
            const profitStatus = profitRate >= 0 ? 'positive' : 'negative';
            const profitBadge = profitRate >= 0 ? 'badge-success' : 'badge-danger';
            
            analysis += `
                <h3>ğŸ’° æ”¶ç›Šåˆ†æ</h3>
                <div class="${profitStatus === 'positive' ? 'success-box' : 'warning-box'}">
                    <p><strong>æ€»æ”¶ç›Šï¼š</strong> 
                        <span class="badge ${profitBadge}">${profitRate >= 0 ? '+' : ''}${profitRate.toFixed(2)}%</span>
                    </p>
                    <p>åˆå§‹èµ„é‡‘ï¼š${formatNumber(summary.initial_cash)} å…ƒ</p>
                    <p>æœ€ç»ˆèµ„äº§ï¼š${formatNumber(summary.total_value)} å…ƒ</p>
                    <p>ç›ˆäºé‡‘é¢ï¼š${profitRate >= 0 ? '+' : ''}${formatNumber(summary.total_profit)} å…ƒ</p>
                </div>
            `;

            // é£é™©åˆ†æ
            const sharpeStatus = metrics.sharpe_ratio >= 1 ? 'positive' : metrics.sharpe_ratio >= 0 ? 'neutral' : 'negative';
            const drawdownStatus = metrics.max_drawdown <= 0.1 ? 'positive' : metrics.max_drawdown <= 0.2 ? 'neutral' : 'negative';
            
            analysis += `
                <h3>âš ï¸ é£é™©åˆ†æ</h3>
                <div class="metrics-grid">
                    <div class="metric-card ${sharpeStatus}">
                        <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                        <div class="metric-value">${metrics.sharpe_ratio.toFixed(2)}</div>
                        <div class="metric-unit">${getSharpeRating(metrics.sharpe_ratio)}</div>
                    </div>
                    <div class="metric-card ${drawdownStatus}">
                        <div class="metric-label">æœ€å¤§å›æ’¤</div>
                        <div class="metric-value">${(metrics.max_drawdown * 100).toFixed(2)}</div>
                        <div class="metric-unit">%</div>
                    </div>
                </div>
                <div class="info-box">
                    <p><strong>å¤æ™®æ¯”ç‡è¯´æ˜ï¼š</strong></p>
                    <ul>
                        <li>${metrics.sharpe_ratio >= 1 ? 'âœ… ä¼˜ç§€ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°è‰¯å¥½' : metrics.sharpe_ratio >= 0 ? 'âš ï¸ ä¸€èˆ¬ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸€èˆ¬' : 'âŒ è¾ƒå·®ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸ä½³'}</li>
                        <li>å¤æ™®æ¯”ç‡ = (æ”¶ç›Šç‡ - æ— é£é™©åˆ©ç‡) / æ”¶ç›Šç‡æ ‡å‡†å·®</li>
                        <li>é€šå¸¸è®¤ä¸ºå¤æ™®æ¯”ç‡ > 1 ä¸ºè‰¯å¥½ï¼Œ> 2 ä¸ºä¼˜ç§€</li>
                    </ul>
                    <p><strong>æœ€å¤§å›æ’¤è¯´æ˜ï¼š</strong></p>
                    <ul>
                        <li>æœ€å¤§å›æ’¤ ${(metrics.max_drawdown * 100).toFixed(2)}% ${metrics.max_drawdown <= 0.1 ? 'ï¼Œé£é™©æ§åˆ¶è‰¯å¥½' : metrics.max_drawdown <= 0.2 ? 'ï¼Œé£é™©æ§åˆ¶ä¸€èˆ¬' : 'ï¼Œé£é™©æ§åˆ¶éœ€è¦æ”¹è¿›'}</li>
                        <li>æœ€å¤§å›æ’¤åæ˜ äº†ç­–ç•¥åœ¨æœ€åæƒ…å†µä¸‹çš„æŸå¤±</li>
                        <li>é€šå¸¸è®¤ä¸ºæœ€å¤§å›æ’¤ < 10% ä¸ºè‰¯å¥½ï¼Œ< 20% ä¸ºå¯æ¥å—</li>
                    </ul>
                </div>
            `;

            // äº¤æ˜“åˆ†æ
            analysis += `
                <h3>ğŸ“Š äº¤æ˜“åˆ†æ</h3>
                <div class="info-box">
                    <p><strong>æ€»äº¤æ˜“æ¬¡æ•°ï¼š</strong> ${metrics.total_trades} æ¬¡</p>
                    <p><strong>å¹³å‡æŒä»“æ•°é‡ï¼š</strong> ${summary.positions_count} åª</p>
                    <p><strong>äº¤æ˜“é¢‘ç‡ï¼š</strong> ${calculateTradeFrequency()} æ¬¡/æœˆ</p>
                </div>
            `;

            // ç»¼åˆè¯„ä»·
            analysis += `
                <h3>ğŸ“ ç»¼åˆè¯„ä»·</h3>
                <div class="${getOverallRating() === 'good' ? 'success-box' : getOverallRating() === 'fair' ? 'info-box' : 'warning-box'}">
                    ${generateOverallComment()}
                </div>
            `;

            container.innerHTML = analysis;
        }

        // ç”Ÿæˆå›¾è¡¨
        function generateCharts() {
            // ç”±äºå½“å‰JSONä¸­æ²¡æœ‰å†å²æ•°æ®ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„å›¾è¡¨
            // å®é™…ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ä»portfolio_historyä¸­è·å–çœŸå®æ•°æ®
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            // æ¨¡æ‹Ÿæ•°æ®ï¼ˆå®é™…åº”è¯¥ä»reportData.portfolio_historyè·å–ï¼‰
            const dates = generateDateRange(reportData.start_date, reportData.end_date);
            const values = generateSimulatedValues(reportData.summary.initial_cash, reportData.metrics.total_return, dates.length);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'æ€»èµ„äº§',
                        data: values,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'åˆå§‹èµ„é‡‘',
                        data: Array(dates.length).fill(reportData.summary.initial_cash),
                        borderColor: '#999',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'å›æµ‹æœŸé—´èµ„äº§å˜åŒ–æ›²çº¿',
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value) + ' å…ƒ';
                                }
                            }
                        }
                    }
                }
            });
        }

        // è¾…åŠ©å‡½æ•°
        function formatNumber(num) {
            return new Intl.NumberFormat('zh-CN').format(num.toFixed(2));
        }

        function getSharpeRating(sharpe) {
            if (sharpe >= 2) return 'ä¼˜ç§€';
            if (sharpe >= 1) return 'è‰¯å¥½';
            if (sharpe >= 0) return 'ä¸€èˆ¬';
            return 'è¾ƒå·®';
        }

        function calculateTradeFrequency() {
            const start = new Date(reportData.start_date);
            const end = new Date(reportData.end_date);
            const months = (end - start) / (1000 * 60 * 60 * 24 * 30);
            return (reportData.metrics.total_trades / months).toFixed(1);
        }

        function getOverallRating() {
            const metrics = reportData.metrics;
            let score = 0;
            
            if (metrics.total_return >= 0) score += 2;
            if (metrics.sharpe_ratio >= 1) score += 2;
            if (metrics.max_drawdown <= 0.1) score += 1;
            
            if (score >= 4) return 'good';
            if (score >= 2) return 'fair';
            return 'poor';
        }

        function generateOverallComment() {
            const metrics = reportData.metrics;
            const summary = reportData.summary;
            
            let comment = '<p><strong>ç­–ç•¥è¡¨ç°è¯„ä»·ï¼š</strong></p><ul>';
            
            if (metrics.total_return >= 0) {
                comment += '<li>âœ… ç­–ç•¥åœ¨å›æµ‹æœŸé—´å®ç°äº†æ­£æ”¶ç›Š</li>';
            } else {
                comment += '<li>âŒ ç­–ç•¥åœ¨å›æµ‹æœŸé—´å‡ºç°äºæŸï¼Œéœ€è¦ä¼˜åŒ–</li>';
            }
            
            if (metrics.sharpe_ratio >= 1) {
                comment += '<li>âœ… é£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°è‰¯å¥½</li>';
            } else if (metrics.sharpe_ratio >= 0) {
                comment += '<li>âš ï¸ é£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸€èˆ¬</li>';
            } else {
                comment += '<li>âŒ é£é™©è°ƒæ•´åæ”¶ç›Šè¡¨ç°ä¸ä½³</li>';
            }
            
            if (metrics.max_drawdown <= 0.1) {
                comment += '<li>âœ… æœ€å¤§å›æ’¤æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…</li>';
            } else if (metrics.max_drawdown <= 0.2) {
                comment += '<li>âš ï¸ æœ€å¤§å›æ’¤è¾ƒå¤§ï¼Œéœ€è¦æ³¨æ„é£é™©æ§åˆ¶</li>';
            } else {
                comment += '<li>âŒ æœ€å¤§å›æ’¤è¿‡å¤§ï¼Œé£é™©æ§åˆ¶éœ€è¦æ”¹è¿›</li>';
            }
            
            comment += '</ul>';
            
            comment += '<p><strong>æ”¹è¿›å»ºè®®ï¼š</strong></p><ul>';
            comment += '<li>è€ƒè™‘è°ƒæ•´å‡çº¿å‘¨æœŸå‚æ•°ï¼Œä¼˜åŒ–ä¹°å–ä¿¡å·</li>';
            comment += '<li>æ·»åŠ æ­¢æŸå’Œæ­¢ç›ˆæœºåˆ¶ï¼Œæ§åˆ¶é£é™©</li>';
            comment += '<li>ç»“åˆå…¶ä»–æŠ€æœ¯æŒ‡æ ‡ï¼Œæé«˜ä¿¡å·å‡†ç¡®æ€§</li>';
            comment += '<li>ä¼˜åŒ–ä»“ä½ç®¡ç†ï¼Œé¿å…è¿‡åº¦äº¤æ˜“</li>';
            comment += '</ul>';
            
            return comment;
        }

        function generateDateRange(start, end) {
            const dates = [];
            const startDate = new Date(start);
            const endDate = new Date(end);
            const current = new Date(startDate);
            
            while (current <= endDate) {
                dates.push(current.toLocaleDateString('zh-CN'));
                current.setDate(current.getDate() + 1);
            }
            
            // å¦‚æœæ—¥æœŸå¤ªå¤šï¼Œåªå–éƒ¨åˆ†
            if (dates.length > 100) {
                const step = Math.floor(dates.length / 50);
                return dates.filter((_, i) => i % step === 0);
            }
            
            return dates;
        }

        function generateSimulatedValues(initial, returnRate, count) {
            const values = [initial];
            const dailyReturn = Math.pow(1 + returnRate, 1 / count) - 1;
            
            for (let i = 1; i < count; i++) {
                const randomFactor = 1 + (Math.random() - 0.5) * 0.02; // æ·»åŠ ä¸€äº›éšæœºæ³¢åŠ¨
                values.push(values[i - 1] * (1 + dailyReturn * randomFactor));
            }
            
            return values;
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.addEventListener('DOMContentLoaded', loadReportData);
    </script>
</body>
</html>

