---
title: "2.2 市盈率因子（PE）"
description: "深入学习PE因子的多种计算方式、行业中性化处理和A股应用技巧"
lang: "zh-CN"
layout: "/src/layouts/Layout.astro"
currentBook: "ashare-quantitative"
currentChapter: "ashare-quantitative-chapter2"
updateDate: "2025-01-26"
---

# 📈 2.2 市盈率因子（PE）

> **核心摘要：**
> 
> 市盈率（PE）是最常用的估值指标，也是价值因子的核心组成。本节深入讲解PE因子的多种计算方式、行业中性化处理、A股PE因子的特点和应用技巧。

## 📋 章节概览

<div class="section-overview">
  <div class="overview-item">
    <span class="item-icon">📊</span>
    <a href="#pe-calculation">PE的计算方式</a>
    <span class="item-desc">TTM、静态、动态PE的区别</span>
  </div>
  <div class="overview-item">
    <span class="item-icon">🔄</span>
    <a href="#ep-factor">EP因子（盈利收益率）</a>
    <span class="item-desc">PE的倒数，便于因子处理</span>
  </div>
  <div class="overview-item">
    <span class="item-icon">🏭</span>
    <a href="#industry-neutralize">行业中性化处理</a>
    <span class="item-desc">消除行业估值差异的影响</span>
  </div>
  <div class="overview-item">
    <span class="item-icon">📈</span>
    <a href="#backtest">A股PE因子回测</a>
    <span class="item-desc">PE因子在A股的有效性验证</span>
  </div>
</div>

---

<h2 id="pe-calculation">📊 PE的计算方式</h2>

### PE的基本定义

<div class="tip-box">
  <h4>📊 市盈率（PE）的本质</h4>
  <ul>
    <li><strong>基本公式：</strong>PE = 市值 / 净利润 = 股价 / 每股收益</li>
    <li><strong>经济含义：</strong>以当前盈利水平，多少年能收回投资成本</li>
    <li><strong>参考：</strong>第一册5.5节估值方法</li>
  </ul>
</div>

### 三种PE计算方式

<div class="comparison-table">
  <table>
    <thead>
      <tr>
        <th>类型</th>
        <th>计算公式</th>
        <th>优点</th>
        <th>缺点</th>
        <th>适用场景</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>PE_TTM</strong></td>
        <td>市值 / 过去12个月净利润</td>
        <td>数据最新，反映实际盈利</td>
        <td>受季节性影响</td>
        <td>量化因子首选</td>
      </tr>
      <tr>
        <td><strong>静态PE</strong></td>
        <td>市值 / 上年度净利润</td>
        <td>数据稳定，便于比较</td>
        <td>滞后性强</td>
        <td>年度比较</td>
      </tr>
      <tr>
        <td><strong>动态PE</strong></td>
        <td>市值 / 预测净利润</td>
        <td>前瞻性强</td>
        <td>依赖预测准确性</td>
        <td>成长股估值</td>
      </tr>
    </tbody>
  </table>
</div>

### PE_TTM的计算方法

**TTM（Trailing Twelve Months）** 指过去12个月滚动数据：

```python
# 假设当前为2024年Q2
TTM净利润 = Q2_2024 + Q1_2024 + Q4_2023 + Q3_2023
         = 当季净利润 + 上季净利润 + 上年Q4 + 上年Q3

# 或者使用年报数据调整
TTM净利润 = 上年度净利润 + 当年累计净利润 - 去年同期累计净利润
```

**JQData获取PE_TTM：**

```python
from jqdata import *

# 获取PE_TTM
pe_ttm = get_valuation(stock, fields=['pe_ratio'])
```

---

<h2 id="ep-factor">🔄 EP因子（盈利收益率）</h2>

### 为什么使用EP而非PE

<div class="tip-box">
  <h4>🔄 EP = 1/PE = 净利润/市值</h4>
  <ul>
    <li><strong>方向一致：</strong>EP越高越好，便于因子排序（PE是越低越好）</li>
    <li><strong>处理亏损：</strong>亏损股PE为负，EP也为负，可以统一处理</li>
    <li><strong>便于比较：</strong>EP可以与债券收益率、无风险利率直接比较</li>
    <li><strong>线性关系：</strong>EP与收益率的关系更接近线性</li>
  </ul>
</div>

### EP因子的计算

```python
import pandas as pd
import numpy as np
from jqdata import *

def calculate_ep_factor(stocks, date):
    """
    计算EP因子
    
    参数:
        stocks: 股票列表
        date: 计算日期
    
    返回:
        EP因子Series
    """
    # 获取市值和净利润
    valuation = get_valuation(stocks, date, fields=['market_cap'])
    
    # 获取TTM净利润
    q = query(
        income.code, 
        income.net_profit
    ).filter(income.code.in_(stocks))
    profit = get_fundamentals(q, date)
    
    # 计算EP = 净利润 / 市值
    ep = profit['net_profit'] / valuation['market_cap']
    
    # 处理极端值（Winsorize到1%-99%分位）
    ep = ep.clip(ep.quantile(0.01), ep.quantile(0.99))
    
    # 标准化（Z-score）
    ep_zscore = (ep - ep.mean()) / ep.std()
    
    return ep_zscore
```

---

<h2 id="industry-neutralize">🏭 行业中性化处理</h2>

### 为什么需要行业中性化

<div class="tip-box">
  <h4>🏭 行业估值差异巨大</h4>
  <p><strong>问题：</strong>不同行业的PE水平差异很大，直接比较会导致因子偏向低估值行业。</p>
  <p><strong>A股行业PE差异示例（2024年）：</strong></p>
  <ul>
    <li><strong>银行：</strong>PE约5-7倍</li>
    <li><strong>地产：</strong>PE约8-12倍</li>
    <li><strong>消费：</strong>PE约20-30倍</li>
    <li><strong>医药：</strong>PE约25-40倍</li>
    <li><strong>科技：</strong>PE约30-50倍</li>
  </ul>
  <p><strong>后果：</strong>不做行业中性化，价值因子会持续超配银行、地产，低配科技、医药</p>
</div>

### 行业中性化方法

<div class="comparison-table">
  <table>
    <thead>
      <tr>
        <th>方法</th>
        <th>原理</th>
        <th>优点</th>
        <th>缺点</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>行业内排名</strong></td>
        <td>在行业内对因子进行排名</td>
        <td>简单直观</td>
        <td>丢失绝对值信息</td>
      </tr>
      <tr>
        <td><strong>行业内标准化</strong></td>
        <td>在行业内计算Z-score</td>
        <td>保留相对信息</td>
        <td>小行业样本少</td>
      </tr>
      <tr>
        <td><strong>回归残差</strong></td>
        <td>对行业哑变量回归取残差</td>
        <td>统计严谨</td>
        <td>计算复杂</td>
      </tr>
    </tbody>
  </table>
</div>

### 行业中性化代码示例

```python
import pandas as pd
import numpy as np
import statsmodels.api as sm

def industry_neutralize(factor_df, industry_df, method='zscore'):
    """
    行业中性化处理
    
    参数:
        factor_df: 因子值DataFrame，index为股票代码
        industry_df: 行业分类DataFrame
        method: 'zscore'（行业内标准化）或 'regression'（回归残差）
    
    返回:
        行业中性化后的因子值
    """
    if method == 'zscore':
        # 方法1：行业内标准化
        def zscore_within_industry(group):
            if len(group) < 3:  # 样本太少则跳过
                return group
            return (group - group.mean()) / group.std()
        
        neutralized = factor_df.groupby(
            industry_df['industry']
        ).transform(zscore_within_industry)
        
    elif method == 'regression':
        # 方法2：回归残差法
        # 创建行业哑变量
        industry_dummies = pd.get_dummies(
            industry_df['industry'], 
            prefix='ind'
        )
        
        # 回归：factor = α + Σ(β_i × industry_i) + ε
        model = sm.OLS(factor_df, industry_dummies)
        results = model.fit()
        
        # 残差即为行业中性化后的因子
        neutralized = results.resid
    
    return neutralized
```

---

<h2 id="backtest">📈 A股PE因子回测</h2>

### 回测设置

<div class="comparison-table">
  <table>
    <thead>
      <tr>
        <th>参数</th>
        <th>设置</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>回测区间</strong></td>
        <td>2010-01-01 至 2024-12-31</td>
      </tr>
      <tr>
        <td><strong>股票池</strong></td>
        <td>中证500成分股</td>
      </tr>
      <tr>
        <td><strong>因子</strong></td>
        <td>EP_TTM（行业中性化）</td>
      </tr>
      <tr>
        <td><strong>分组</strong></td>
        <td>按因子值分5组</td>
      </tr>
      <tr>
        <td><strong>调仓频率</strong></td>
        <td>月度</td>
      </tr>
      <tr>
        <td><strong>权重</strong></td>
        <td>等权</td>
      </tr>
      <tr>
        <td><strong>交易成本</strong></td>
        <td>双边0.3%</td>
      </tr>
    </tbody>
  </table>
</div>

### 回测结果

<div class="comparison-table">
  <table>
    <thead>
      <tr>
        <th>分组</th>
        <th>年化收益</th>
        <th>年化波动</th>
        <th>夏普比率</th>
        <th>最大回撤</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>第1组（低EP）</strong></td>
        <td>6.2%</td>
        <td>28%</td>
        <td>0.22</td>
        <td>55%</td>
      </tr>
      <tr>
        <td><strong>第2组</strong></td>
        <td>8.5%</td>
        <td>26%</td>
        <td>0.33</td>
        <td>48%</td>
      </tr>
      <tr>
        <td><strong>第3组</strong></td>
        <td>10.1%</td>
        <td>25%</td>
        <td>0.40</td>
        <td>45%</td>
      </tr>
      <tr>
        <td><strong>第4组</strong></td>
        <td>11.8%</td>
        <td>24%</td>
        <td>0.49</td>
        <td>42%</td>
      </tr>
      <tr>
        <td><strong>第5组（高EP）</strong></td>
        <td>13.5%</td>
        <td>25%</td>
        <td>0.54</td>
        <td>40%</td>
      </tr>
      <tr>
        <td><strong>多空收益</strong></td>
        <td>7.3%</td>
        <td>12%</td>
        <td>0.61</td>
        <td>25%</td>
      </tr>
    </tbody>
  </table>
</div>

### PE因子的周期性

<div class="exchange-grid">
  <div class="exchange-card">
    <div class="exchange-header">
      <span class="exchange-icon">📈</span>
      <h3>价值风格强势期</h3>
    </div>
    <div class="exchange-content">
      <p><strong>时间：</strong>2016-2018、2021-2023</p>
      <p><strong>特征：</strong>PE因子多空收益超过10%</p>
      <p><strong>原因：</strong>市场风险偏好下降，资金追求确定性</p>
    </div>
  </div>

  <div class="exchange-card">
    <div class="exchange-header">
      <span class="exchange-icon">📉</span>
      <h3>价值风格弱势期</h3>
    </div>
    <div class="exchange-content">
      <p><strong>时间：</strong>2013-2015、2019-2020</p>
      <p><strong>特征：</strong>PE因子多空收益为负</p>
      <p><strong>原因：</strong>成长股牛市，资金追逐高成长</p>
    </div>
  </div>
</div>

---

## 💎 核心要点总结

<div class="key-points">
  <div class="key-point">
    <h4>📊 PE_TTM是首选</h4>
    <p>量化因子优先使用PE_TTM，数据最新，反映实际盈利</p>
  </div>
  <div class="key-point">
    <h4>🔄 使用EP更方便</h4>
    <p>EP = 1/PE，方向一致，便于因子处理和比较</p>
  </div>
  <div class="key-point">
    <h4>🏭 行业中性化必须</h4>
    <p>不同行业PE差异大，必须进行行业中性化处理</p>
  </div>
  <div class="key-point">
    <h4>📈 A股长期有效</h4>
    <p>PE因子在A股长期有效，但存在周期性，需要结合市场风格</p>
  </div>
</div>

---

## 🔮 总结与展望

<div class="summary-outlook">
  <h3>本节回顾</h3>
  <p>本节深入讲解了PE因子的计算方式、EP因子的优势、行业中性化处理方法，以及A股PE因子的回测验证。</p>
  
  <h3>下节预告</h3>
  <p>下一节将学习市净率因子（PB），包括PB的计算方法、适用行业分析、净资产质量调整等内容。</p>
  
  <a href="/ashare-book4/002_Chapter2/2.3_PB_Factor_CN" class="next-section">
    继续学习：2.3 市净率因子（PB） →
  </a>
</div>
