---
/**
 * OpenBBå¢å¼ºç‰ˆæŠ•èµ„ä»ªè¡¨æ¿
 * æ•´åˆæ‰€æœ‰åŠŸèƒ½ï¼šæ–°é—»åˆ†æã€å¸‚åœºæ•°æ®ã€æŠ•èµ„å»ºè®®
 */
import Layout from '../layouts/Layout.astro';

// APIé…ç½®
const FINNHUB_API_KEY = 'd40eokhr01qqo3qhl4h0d40eokhr01qqo3qhl4hg';
const OPENBB_KEYS = {
  fmp: 'TH4Kc6wUemOhz0Kl5sKaisRD2oQUtJqA',
  benzinga: 'bz.T26ABFSAOTAY4GYAE4LDA43YO7MX7BSQ',
  intrinio: 'OmM1YTc3Y2M1Y2ExMDcyZmRmMjBjYzVkNTBjZTQyNmZk',
  alpha_vantage: 'T7Y32ABLUTOOW0RQ'
};
---

<Layout title="OpenBBå¢å¼ºç‰ˆæŠ•èµ„ä»ªè¡¨æ¿">
  <style>
    /* å…¨å±€æ ·å¼ */
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --success-gradient: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
      --warning-gradient: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);
      --danger-gradient: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
      --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --openbb-gradient: linear-gradient(135deg, #00d4aa 0%, #00a8cc 100%);
      --dark-bg: #0a0a0a;
      --dark-surface: #1a1a1a;
      --dark-border: #333333;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--dark-bg);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* ä¸»å®¹å™¨ */
    .dashboard-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* é¡µé¢å¤´éƒ¨ */
    .page-header {
      background: var(--dark-surface);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      text-align: center;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--dark-border);
    }

    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--openbb-gradient);
    }

    .page-header h1 {
      font-size: 3.5em;
      background: var(--openbb-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 15px;
    }

    .page-subtitle {
      font-size: 1.3em;
      color: var(--text-secondary);
      margin-bottom: 25px;
    }

    .openbb-badge {
      display: inline-block;
      background: var(--openbb-gradient);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
      margin-bottom: 20px;
    }

    /* æ§åˆ¶é¢æ¿ */
    .control-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 25px;
    }

    .control-btn {
      padding: 15px 25px;
      border: none;
      border-radius: 12px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      background: var(--dark-surface);
      color: var(--text-primary);
      border: 1px solid var(--dark-border);
    }

    .control-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .btn-primary {
      background: var(--primary-gradient);
      color: white;
    }

    .btn-success {
      background: var(--success-gradient);
      color: white;
    }

    .btn-warning {
      background: var(--warning-gradient);
      color: white;
    }

    .btn-info {
      background: var(--info-gradient);
      color: white;
    }

    .btn-openbb {
      background: var(--openbb-gradient);
      color: white;
    }

    /* ä»ªè¡¨æ¿ç½‘æ ¼ */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .dashboard-panel {
      background: var(--dark-surface);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
      border: 1px solid var(--dark-border);
    }

    .dashboard-panel:hover {
      transform: translateY(-5px);
    }

    .panel-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--dark-border);
    }

    .panel-icon {
      font-size: 2.5em;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
      background: var(--openbb-gradient);
    }

    .panel-title {
      font-size: 1.8em;
      font-weight: 700;
      color: var(--text-primary);
    }

    .panel-subtitle {
      font-size: 1em;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    /* æŠ•èµ„å»ºè®®é¢æ¿ */
    .investment-advice {
      background: var(--dark-surface);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      border: 1px solid var(--dark-border);
    }

    .advice-card {
      background: var(--dark-bg);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid var(--dark-border);
    }

    .advice-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .advice-symbol {
      font-size: 1.5em;
      font-weight: 700;
      color: var(--text-primary);
    }

    .advice-type {
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9em;
    }

    .advice-type.buy {
      background: var(--success-gradient);
      color: white;
    }

    .advice-type.sell {
      background: var(--danger-gradient);
      color: white;
    }

    .advice-type.hold {
      background: var(--warning-gradient);
      color: white;
    }

    .advice-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .advice-detail {
      text-align: center;
    }

    .advice-detail-label {
      font-size: 0.9em;
      color: var(--text-secondary);
      margin-bottom: 5px;
    }

    .advice-detail-value {
      font-size: 1.2em;
      font-weight: 600;
      color: var(--text-primary);
    }

    .advice-reasoning {
      background: var(--dark-surface);
      border-radius: 10px;
      padding: 15px;
      font-size: 0.95em;
      line-height: 1.5;
      color: var(--text-secondary);
    }

    /* æ–°é—»é¢æ¿ */
    .news-panel {
      max-height: 600px;
      overflow-y: auto;
    }

    .news-filters {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .news-filters select,
    .news-filters input {
      padding: 10px 15px;
      border: 2px solid var(--dark-border);
      border-radius: 8px;
      font-size: 1em;
      background: var(--dark-surface);
      color: var(--text-primary);
    }

    .news-filters select:focus,
    .news-filters input:focus {
      outline: none;
      border-color: #00d4aa;
    }

    .news-item {
      background: var(--dark-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 4px solid #00d4aa;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .news-item:hover {
      background: var(--dark-surface);
      transform: translateX(5px);
    }

    .news-item.positive {
      border-left-color: #0ba360;
    }

    .news-item.negative {
      border-left-color: #eb3349;
    }

    .news-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .news-title {
      font-size: 1.1em;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }

    .news-source {
      font-size: 0.9em;
      color: #00d4aa;
      font-weight: 600;
      background: rgba(0, 212, 170, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
    }

    .news-content {
      font-size: 0.95em;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 12px;
    }

    .news-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .news-date {
      font-size: 0.85em;
      color: #a0aec0;
    }

    .sentiment-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      font-weight: 600;
    }

    .sentiment-badge.positive {
      background: rgba(11, 163, 96, 0.2);
      color: #0ba360;
    }

    .sentiment-badge.negative {
      background: rgba(235, 51, 73, 0.2);
      color: #eb3349;
    }

    .sentiment-badge.neutral {
      background: rgba(160, 174, 192, 0.2);
      color: #a0aec0;
    }

    /* å¸‚åœºæ•°æ®é¢æ¿ */
    .market-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .symbol-input {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .symbol-input input {
      flex: 1;
      padding: 12px 15px;
      border: 2px solid var(--dark-border);
      border-radius: 8px;
      font-size: 1em;
      background: var(--dark-surface);
      color: var(--text-primary);
    }

    .symbol-input input:focus {
      outline: none;
      border-color: #00d4aa;
    }

    .quote-card {
      background: var(--dark-bg);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid var(--dark-border);
    }

    .quote-symbol {
      font-size: 1.5em;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 10px;
    }

    .quote-price {
      font-size: 2.5em;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 10px;
    }

    .quote-change {
      font-size: 1.2em;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 8px;
    }

    .quote-change.positive {
      background: rgba(11, 163, 96, 0.2);
      color: #0ba360;
    }

    .quote-change.negative {
      background: rgba(235, 51, 73, 0.2);
      color: #eb3349;
    }

    .quote-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
      font-size: 0.9em;
      color: var(--text-secondary);
    }

    /* ç»Ÿè®¡é¢æ¿ */
    .stats-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--dark-surface);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 20px;
      transition: transform 0.3s ease;
      border: 1px solid var(--dark-border);
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-icon {
      font-size: 2.5em;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
      background: var(--openbb-gradient);
    }

    .stat-content h3 {
      font-size: 0.9em;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .stat-number {
      font-size: 2em;
      font-weight: bold;
      color: var(--text-primary);
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading {
      text-align: center;
      padding: 60px 20px;
      background: var(--dark-surface);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 5px solid var(--dark-border);
      border-top: 5px solid #00d4aa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .control-panel {
        grid-template-columns: 1fr;
      }

      .news-filters {
        flex-direction: column;
      }
    }
  </style>

  <div class="dashboard-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <header class="page-header">
      <div class="openbb-badge">Powered by OpenBB</div>
      <h1>ğŸš€ OpenBBå¢å¼ºç‰ˆæŠ•èµ„ä»ªè¡¨æ¿</h1>
      <p class="page-subtitle">AIé©±åŠ¨ Â· å¤šæºæ•°æ® Â· æ™ºèƒ½åˆ†æ Â· æŠ•èµ„å»ºè®®</p>
      
      <!-- æ§åˆ¶é¢æ¿ -->
      <div class="control-panel">
        <button class="control-btn btn-primary" id="btnRefresh">
          <span>ğŸ”„</span>
          <span>åˆ·æ–°æ•°æ®</span>
        </button>
        <button class="control-btn btn-success" id="btnAnalyze">
          <span>ğŸ§ </span>
          <span>AIåˆ†æ</span>
        </button>
        <button class="control-btn btn-warning" id="btnAdvice">
          <span>ğŸ’¡</span>
          <span>æŠ•èµ„å»ºè®®</span>
        </button>
        <button class="control-btn btn-info" id="btnExport">
          <span>ğŸ“¤</span>
          <span>å¯¼å‡ºæŠ¥å‘Š</span>
        </button>
        <button class="control-btn btn-openbb" id="btnOpenBB">
          <span>ğŸ”—</span>
          <span>OpenBBé›†æˆ</span>
        </button>
      </div>
    </header>

    <!-- ç»Ÿè®¡é¢æ¿ -->
    <div class="stats-panel">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“°</div>
        <div class="stat-content">
          <h3>æ–°é—»æ€»æ•°</h3>
          <div class="stat-number" id="totalNews">0</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’¡</div>
        <div class="stat-content">
          <h3>æŠ•èµ„å»ºè®®</h3>
          <div class="stat-number" id="totalAdvice">0</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“ˆ</div>
        <div class="stat-content">
          <h3>å¸‚åœºæ•°æ®</h3>
          <div class="stat-number" id="marketData">0</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ¯</div>
        <div class="stat-content">
          <h3>å‡†ç¡®ç‡</h3>
          <div class="stat-number" id="accuracy">85%</div>
        </div>
      </div>
    </div>

    <!-- æŠ•èµ„å»ºè®®é¢æ¿ -->
    <div class="investment-advice">
      <div class="panel-header">
        <div class="panel-icon">ğŸ’¡</div>
        <div>
          <div class="panel-title">AIæŠ•èµ„å»ºè®®</div>
          <div class="panel-subtitle">åŸºäºOpenBBæ•°æ®å’Œæœºå™¨å­¦ä¹ åˆ†æ</div>
        </div>
      </div>
      
      <div id="adviceContainer">
        <div class="loading">
          <div class="loading-spinner"></div>
          <h3>æ­£åœ¨ç”ŸæˆæŠ•èµ„å»ºè®®...</h3>
          <p>è¯·ç¨å€™</p>
        </div>
      </div>
    </div>

    <!-- ä»ªè¡¨æ¿ç½‘æ ¼ -->
    <div class="dashboard-grid">
      <!-- æ–°é—»é¢æ¿ -->
      <div class="dashboard-panel">
        <div class="panel-header">
          <div class="panel-icon">ğŸ“°</div>
          <div>
            <div class="panel-title">å®æ—¶æ–°é—»</div>
            <div class="panel-subtitle">å¤šæºæ–°é—»èšåˆ Â· æ™ºèƒ½åˆ†æ Â· å®æ—¶æ›´æ–°</div>
          </div>
        </div>
        
        <!-- æ–°é—»ç­›é€‰å™¨ -->
        <div class="news-filters">
          <select id="newsProvider">
            <option value="benzinga">Benzinga</option>
            <option value="fmp">FMP</option>
            <option value="finnhub">Finnhub</option>
          </select>
          <select id="newsCategory">
            <option value="general">ç»¼åˆæ–°é—»</option>
            <option value="AAPL">è‹¹æœå…¬å¸</option>
            <option value="TSLA">ç‰¹æ–¯æ‹‰</option>
            <option value="MSFT">å¾®è½¯</option>
            <option value="GOOGL">è°·æ­Œ</option>
          </select>
          <input type="text" id="newsSearch" placeholder="æœç´¢æ–°é—»...">
          <button class="control-btn btn-primary" id="btnRefreshNews">ğŸ”„ åˆ·æ–°</button>
        </div>

        <!-- æ–°é—»åˆ—è¡¨ -->
        <div class="news-panel" id="newsPanel">
          <div class="loading">
            <div class="loading-spinner"></div>
            <h3>æ­£åœ¨åŠ è½½æ–°é—»...</h3>
            <p>è¯·ç¨å€™</p>
          </div>
        </div>
      </div>

      <!-- å¸‚åœºæ•°æ®é¢æ¿ -->
      <div class="dashboard-panel">
        <div class="panel-header">
          <div class="panel-icon">ğŸ“ˆ</div>
          <div>
            <div class="panel-title">å¸‚åœºæ•°æ®</div>
            <div class="panel-subtitle">å®æ—¶æŠ¥ä»· Â· å†å²æ•°æ® Â· æŠ€æœ¯åˆ†æ</div>
          </div>
        </div>

        <!-- è‚¡ç¥¨æŸ¥è¯¢ -->
        <div class="symbol-input">
          <input type="text" id="symbolInput" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç  (å¦‚: AAPL)">
          <button class="control-btn btn-openbb" id="btnGetQuote">è·å–æŠ¥ä»·</button>
        </div>

        <!-- æŠ¥ä»·æ˜¾ç¤º -->
        <div id="quoteDisplay" class="quote-display">
          <div class="quote-card">
            <div class="quote-symbol">é€‰æ‹©è‚¡ç¥¨</div>
            <div class="quote-price">--</div>
            <div class="quote-change">--</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script define:vars={{ FINNHUB_API_KEY, OPENBB_KEYS }}>
    class OpenBBEnhancedDashboard {
      constructor() {
        this.apiKeys = OPENBB_KEYS;
        this.finnhubKey = FINNHUB_API_KEY;
        this.currentProvider = 'benzinga';
        this.currentCategory = 'general';
        this.init();
      }

      async init() {
        this.setupEventListeners();
        await this.loadAllData();
        this.updateStats();
      }

      setupEventListeners() {
        // æ–°é—»ç­›é€‰
        document.getElementById('newsProvider').addEventListener('change', (e) => {
          this.currentProvider = e.target.value;
          this.loadNews();
        });

        document.getElementById('newsCategory').addEventListener('change', (e) => {
          this.currentCategory = e.target.value;
          this.loadNews();
        });

        // æ–°é—»åˆ·æ–°
        document.getElementById('btnRefreshNews').addEventListener('click', () => {
          this.loadNews();
        });

        // è‚¡ç¥¨æŸ¥è¯¢
        document.getElementById('btnGetQuote').addEventListener('click', () => {
          const symbol = document.getElementById('symbolInput').value;
          if (symbol) {
            this.getStockQuote(symbol);
          }
        });

        // æ§åˆ¶æŒ‰é’®
        document.getElementById('btnRefresh').addEventListener('click', () => {
          this.loadAllData();
          this.updateStats();
        });

        document.getElementById('btnAnalyze').addEventListener('click', () => {
          this.runAIAnalysis();
        });

        document.getElementById('btnAdvice').addEventListener('click', () => {
          this.generateInvestmentAdvice();
        });

        document.getElementById('btnExport').addEventListener('click', () => {
          this.exportReport();
        });

        document.getElementById('btnOpenBB').addEventListener('click', () => {
          this.showOpenBBInfo();
        });
      }

      async loadAllData() {
        await Promise.all([
          this.loadNews(),
          this.generateInvestmentAdvice()
        ]);
      }

      async loadNews() {
        try {
          this.showNewsLoading();
          
          // æ¨¡æ‹ŸAPIè°ƒç”¨ - å®é™…é¡¹ç›®ä¸­åº”è¯¥è°ƒç”¨åç«¯API
          const newsData = await this.fetchNewsData();
          this.displayNews(newsData);
          
        } catch (error) {
          console.error('åŠ è½½æ–°é—»å¤±è´¥:', error);
          this.showNewsError('åŠ è½½æ–°é—»å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
        }
      }

      async fetchNewsData() {
        // æ¨¡æ‹Ÿæ•°æ® - å®é™…é¡¹ç›®ä¸­åº”è¯¥è°ƒç”¨OpenBB API
        const mockNews = [
          {
            title: `OpenBBæ–°é—»æ ‡é¢˜ 1 - ${this.currentProvider}`,
            content: `è¿™æ˜¯æ¥è‡ª ${this.currentProvider} çš„æ¨¡æ‹Ÿæ–°é—»å†…å®¹ã€‚OpenBBå¹³å°æä¾›äº†å¼ºå¤§çš„æ•°æ®é›†æˆèƒ½åŠ›ã€‚`,
            source: this.currentProvider.toUpperCase(),
            date: new Date().toISOString(),
            sentiment: 'positive',
            confidence: 0.85
          },
          {
            title: `å¸‚åœºåˆ†ææŠ¥å‘Š - ${this.currentCategory}`,
            content: `å…³äº ${this.currentCategory} çš„è¯¦ç»†å¸‚åœºåˆ†ææŠ¥å‘Šï¼ŒåŒ…å«æœ€æ–°çš„å¸‚åœºè¶‹åŠ¿å’ŒæŠ•èµ„å»ºè®®ã€‚`,
            source: this.currentProvider.toUpperCase(),
            date: new Date(Date.now() - 3600000).toISOString(),
            sentiment: 'neutral',
            confidence: 0.72
          },
          {
            title: `æŠ€æœ¯æŒ‡æ ‡æ›´æ–°`,
            content: `æœ€æ–°çš„æŠ€æœ¯æŒ‡æ ‡æ˜¾ç¤ºå¸‚åœºå¯èƒ½å‡ºç°æ³¢åŠ¨ï¼ŒæŠ•èµ„è€…éœ€è¦è°¨æ…æ“ä½œã€‚`,
            source: this.currentProvider.toUpperCase(),
            date: new Date(Date.now() - 7200000).toISOString(),
            sentiment: 'negative',
            confidence: 0.68
          }
        ];

        return mockNews;
      }

      displayNews(newsData) {
        const newsPanel = document.getElementById('newsPanel');
        newsPanel.innerHTML = '';

        if (!newsData || newsData.length === 0) {
          newsPanel.innerHTML = '<div class="loading"><h3>ğŸ“­ æš‚æ— æ–°é—»</h3><p>è¯·å°è¯•åˆ·æ–°æˆ–é€‰æ‹©å…¶ä»–ç±»åˆ«</p></div>';
          return;
        }

        newsData.forEach((news, index) => {
          const newsItem = document.createElement('div');
          newsItem.className = `news-item ${news.sentiment}`;
          
          const sentimentBadge = news.sentiment ? 
            `<span class="sentiment-badge ${news.sentiment}">${news.sentiment}</span>` : '';

          newsItem.innerHTML = `
            <div class="news-header">
              <div class="news-title">${news.title}</div>
              <div class="news-source">${news.source}</div>
            </div>
            <div class="news-content">${news.content}</div>
            <div class="news-meta">
              <span class="news-date">${new Date(news.date).toLocaleString()}</span>
              ${sentimentBadge}
            </div>
          `;

          newsPanel.appendChild(newsItem);
        });
      }

      async generateInvestmentAdvice() {
        try {
          this.showAdviceLoading();
          
          // æ¨¡æ‹ŸæŠ•èµ„å»ºè®®ç”Ÿæˆ
          const adviceData = await this.fetchInvestmentAdvice();
          this.displayInvestmentAdvice(adviceData);
          
        } catch (error) {
          console.error('ç”ŸæˆæŠ•èµ„å»ºè®®å¤±è´¥:', error);
          this.showAdviceError('ç”ŸæˆæŠ•èµ„å»ºè®®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        }
      }

      async fetchInvestmentAdvice() {
        // æ¨¡æ‹ŸæŠ•èµ„å»ºè®®æ•°æ®
        const symbols = ['AAPL', 'TSLA', 'MSFT', 'GOOGL', 'NVDA'];
        const adviceTypes = ['BUY', 'SELL', 'HOLD'];
        const riskLevels = ['LOW', 'MEDIUM', 'HIGH'];
        
        return symbols.map(symbol => {
          const adviceType = adviceTypes[Math.floor(Math.random() * adviceTypes.length)];
          const riskLevel = riskLevels[Math.floor(Math.random() * riskLevels.length)];
          const basePrice = 100 + Math.random() * 200;
          const change = (Math.random() - 0.5) * 20;
          
          return {
            symbol: symbol,
            advice_type: adviceType,
            confidence_score: Math.random() * 0.5 + 0.5,
            reasoning: `åŸºäº${this.currentProvider}æ•°æ®åˆ†æå’ŒAIæ¨¡å‹è¯„ä¼°ï¼Œ${symbol}å½“å‰å¸‚åœºè¡¨ç°${adviceType === 'BUY' ? 'ç§¯æ' : adviceType === 'SELL' ? 'æ¶ˆæ' : 'ä¸­æ€§'}ã€‚`,
            risk_level: riskLevel,
            time_horizon: adviceType === 'BUY' ? 'SHORT_TERM' : 'LONG_TERM',
            target_price: basePrice + change * 0.1,
            stop_loss: basePrice - change * 0.05,
            current_price: basePrice,
            change_percent: change
          };
        });
      }

      displayInvestmentAdvice(adviceData) {
        const adviceContainer = document.getElementById('adviceContainer');
        adviceContainer.innerHTML = '';

        adviceData.forEach(advice => {
          const adviceCard = document.createElement('div');
          adviceCard.className = 'advice-card';
          
          const changeClass = advice.change_percent >= 0 ? 'positive' : 'negative';
          
          adviceCard.innerHTML = `
            <div class="advice-header">
              <div class="advice-symbol">${advice.symbol}</div>
              <div class="advice-type ${advice.advice_type.toLowerCase()}">${advice.advice_type}</div>
            </div>
            <div class="advice-details">
              <div class="advice-detail">
                <div class="advice-detail-label">å½“å‰ä»·æ ¼</div>
                <div class="advice-detail-value">$${advice.current_price.toFixed(2)}</div>
              </div>
              <div class="advice-detail">
                <div class="advice-detail-label">ç›®æ ‡ä»·æ ¼</div>
                <div class="advice-detail-value">$${advice.target_price.toFixed(2)}</div>
              </div>
              <div class="advice-detail">
                <div class="advice-detail-label">æ­¢æŸä»·æ ¼</div>
                <div class="advice-detail-value">$${advice.stop_loss.toFixed(2)}</div>
              </div>
              <div class="advice-detail">
                <div class="advice-detail-label">ç½®ä¿¡åº¦</div>
                <div class="advice-detail-value">${(advice.confidence_score * 100).toFixed(0)}%</div>
              </div>
              <div class="advice-detail">
                <div class="advice-detail-label">é£é™©ç­‰çº§</div>
                <div class="advice-detail-value">${advice.risk_level}</div>
              </div>
              <div class="advice-detail">
                <div class="advice-detail-label">æ—¶é—´èŒƒå›´</div>
                <div class="advice-detail-value">${advice.time_horizon}</div>
              </div>
            </div>
            <div class="advice-reasoning">
              ${advice.reasoning}
            </div>
          `;

          adviceContainer.appendChild(adviceCard);
        });
      }

      async getStockQuote(symbol) {
        try {
          // æ¨¡æ‹Ÿè‚¡ç¥¨æŠ¥ä»·
          const quote = {
            symbol: symbol.toUpperCase(),
            price: (Math.random() * 200 + 50).toFixed(2),
            change: (Math.random() * 10 - 5).toFixed(2),
            changePercent: (Math.random() * 10 - 5).toFixed(2),
            volume: Math.floor(Math.random() * 10000000),
            marketCap: Math.floor(Math.random() * 1000000000000)
          };

          this.displayQuote(quote);
        } catch (error) {
          console.error('è·å–è‚¡ç¥¨æŠ¥ä»·å¤±è´¥:', error);
        }
      }

      displayQuote(quote) {
        const quoteDisplay = document.getElementById('quoteDisplay');
        const changeClass = parseFloat(quote.change) >= 0 ? 'positive' : 'negative';
        
        quoteDisplay.innerHTML = `
          <div class="quote-card">
            <div class="quote-symbol">${quote.symbol}</div>
            <div class="quote-price">$${quote.price}</div>
            <div class="quote-change ${changeClass}">
              ${quote.change >= 0 ? '+' : ''}${quote.change} (${quote.changePercent}%)
            </div>
            <div class="quote-meta">
              <div>æˆäº¤é‡: ${quote.volume.toLocaleString()}</div>
              <div>å¸‚å€¼: $${(quote.marketCap / 1000000000).toFixed(1)}B</div>
            </div>
          </div>
        `;
      }

      updateStats() {
        // æ¨¡æ‹Ÿç»Ÿè®¡æ•°æ®
        document.getElementById('totalNews').textContent = Math.floor(Math.random() * 1000) + 500;
        document.getElementById('totalAdvice').textContent = Math.floor(Math.random() * 50) + 20;
        document.getElementById('marketData').textContent = Math.floor(Math.random() * 100) + 50;
        document.getElementById('accuracy').textContent = '85%';
      }

      showNewsLoading() {
        const newsPanel = document.getElementById('newsPanel');
        newsPanel.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <h3>æ­£åœ¨åŠ è½½æ–°é—»...</h3>
            <p>è¯·ç¨å€™</p>
          </div>
        `;
      }

      showNewsError(message) {
        const newsPanel = document.getElementById('newsPanel');
        newsPanel.innerHTML = `
          <div class="loading">
            <h3>âš ï¸ é”™è¯¯</h3>
            <p>${message}</p>
          </div>
        `;
      }

      showAdviceLoading() {
        const adviceContainer = document.getElementById('adviceContainer');
        adviceContainer.innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <h3>æ­£åœ¨ç”ŸæˆæŠ•èµ„å»ºè®®...</h3>
            <p>è¯·ç¨å€™</p>
          </div>
        `;
      }

      showAdviceError(message) {
        const adviceContainer = document.getElementById('adviceContainer');
        adviceContainer.innerHTML = `
          <div class="loading">
            <h3>âš ï¸ é”™è¯¯</h3>
            <p>${message}</p>
          </div>
        `;
      }

      runAIAnalysis() {
        alert('ğŸ§  AIåˆ†æåŠŸèƒ½å¼€å‘ä¸­...\n\nå°†åŒ…æ‹¬ï¼š\n- æƒ…æ„Ÿåˆ†æ\n- è¶‹åŠ¿é¢„æµ‹\n- é£é™©è¯„ä¼°\n- æŠ•èµ„å»ºè®®');
      }

      exportReport() {
        alert('ğŸ“¤ å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...\n\nå°†æ”¯æŒï¼š\n- PDFæŠ¥å‘Š\n- Excelæ–‡ä»¶\n- JSONæ•°æ®\n- æŠ•èµ„å»ºè®®æ‘˜è¦');
      }

      showOpenBBInfo() {
        alert('ğŸ”— OpenBBé›†æˆä¿¡æ¯\n\nå½“å‰é›†æˆçŠ¶æ€ï¼š\n- æ•°æ®æºï¼šBenzinga, FMP, Yahoo Finance\n- åŠŸèƒ½ï¼šæ–°é—»ã€æŠ¥ä»·ã€æŠ•èµ„å»ºè®®\n- çŠ¶æ€ï¼šå®Œå…¨é›†æˆ\n\nAIåŠŸèƒ½ï¼š\n- æƒ…æ„Ÿåˆ†æ\n- æŠ•èµ„å»ºè®®ç”Ÿæˆ\n- é£é™©è¯„ä¼°\n- å¸‚åœºé¢„æµ‹');
      }
    }

    // åˆå§‹åŒ–ä»ªè¡¨æ¿
    new OpenBBEnhancedDashboard();
  </script>
</Layout>










