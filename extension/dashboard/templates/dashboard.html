<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ éŸ¬ç¿é‡åŒ– - æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        :root {
            --bg-dark: #0a0e14;
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-card: #1c2128;
            --bg-hover: #262c36;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-gold: #f0b429;
            --accent-green: #3fb950;
            --accent-blue: #58a6ff;
            --accent-purple: #a371f7;
            --accent-red: #f85149;
            --border-color: #30363d;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 30px 40px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            font-size: 28px;
            color: var(--accent-gold);
            margin-bottom: 8px;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 40px;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .stat-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: var(--accent-gold);
        }
        
        .stat-card .label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 5px;
        }
        
        /* Tabå¯¼èˆª */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .tab-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 12px 24px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.2s;
        }
        
        .tab-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .tab-btn.active {
            background: var(--bg-card);
            color: var(--accent-gold);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* è¡¨æ ¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .data-table th {
            background: var(--bg-secondary);
            color: var(--accent-gold);
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
        }
        
        .data-table tr:hover {
            background: var(--bg-hover);
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        /* å¡ç‰‡ç½‘æ ¼ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
        }
        
        .card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .card-badge {
            background: var(--accent-blue);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .card-desc {
            color: var(--text-secondary);
            font-size: 12px;
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .card-meta {
            display: flex;
            gap: 15px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        /* æŒ‰é’® */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--accent-gold);
            color: #000;
        }
        
        .btn-primary:hover {
            background: #e0a420;
        }
        
        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: var(--bg-secondary);
        }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-success { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
        .status-warning { background: rgba(240, 180, 41, 0.2); color: var(--accent-gold); }
        .status-error { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
        
        /* æ•°å€¼é¢œè‰² */
        .positive { color: var(--accent-green); }
        .negative { color: var(--accent-red); }
        
        /* å·¥å…·æ  */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .toolbar-actions {
            display: flex;
            gap: 10px;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* åˆ†ç±»æ ‡é¢˜ */
        .category-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-blue);
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        /* å·¥ä½œæµæ­¥éª¤ */
        .workflow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .workflow-step {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 16px;
        }
        
        .workflow-step h4 {
            color: var(--accent-gold);
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .workflow-step .count {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .workflow-step .files {
            margin-top: 10px;
            font-size: 11px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ‰ éŸ¬ç¿é‡åŒ– - æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h1>
        <p>ç­–ç•¥ä»£ç  Â· å›æµ‹æŠ¥å‘Š Â· ç ”ç©¶æ–‡æ¡£ Â· æ•°æ®åº“ç®¡ç†</p>
    </div>
    
    <div class="container">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="icon">ğŸ</div>
                <div class="value" id="strategyCount">-</div>
                <div class="label">ç­–ç•¥æ–‡ä»¶</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ“Š</div>
                <div class="value" id="reportCount">-</div>
                <div class="label">å›æµ‹æŠ¥å‘Š</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ”„</div>
                <div class="value" id="backtestCount">-</div>
                <div class="label">å›æµ‹è®°å½•</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ“ˆ</div>
                <div class="value" id="avgReturn">-</div>
                <div class="label">å¹³å‡æ”¶ç›Š</div>
            </div>
            <div class="stat-card">
                <div class="icon">âš¡</div>
                <div class="value" id="avgSharpe">-</div>
                <div class="label">å¹³å‡å¤æ™®</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ—„ï¸</div>
                <div class="value" id="dbStatus">-</div>
                <div class="label">æ•°æ®åº“</div>
            </div>
        </div>
        
        <!-- Tabå¯¼èˆª -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="strategies">ğŸ“‹ ç­–ç•¥ç®¡ç†</button>
            <button class="tab-btn" data-tab="reports">ğŸ“Š å›æµ‹æŠ¥å‘Š</button>
            <button class="tab-btn" data-tab="backtests">ğŸ”„ å›æµ‹è®°å½•</button>
            <button class="tab-btn" data-tab="docs">ğŸ“„ ç ”ç©¶æ–‡æ¡£</button>
            <button class="tab-btn" data-tab="database">ğŸ—„ï¸ æ•°æ®åº“</button>
            <button class="tab-btn" data-tab="workflow">ğŸ“ˆ å·¥ä½œæµæ•°æ®</button>
        </div>
        
        <!-- ç­–ç•¥ç®¡ç† -->
        <div class="tab-content active" id="strategies">
            <div class="toolbar">
                <h3>ç­–ç•¥æ–‡ä»¶åˆ—è¡¨</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="loadStrategies()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
            <div class="card-grid" id="strategyList">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
        
        <!-- å›æµ‹æŠ¥å‘Š -->
        <div class="tab-content" id="reports">
            <div class="toolbar">
                <h3>å›æµ‹æŠ¥å‘Šåˆ—è¡¨</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="loadReports()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
            <table class="data-table" id="reportTable">
                <thead>
                    <tr>
                        <th>æŠ¥å‘Šåç§°</th>
                        <th>ç±»å‹</th>
                        <th>æ ¼å¼</th>
                        <th>å¤§å°</th>
                        <th>ä¿®æ”¹æ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="reportBody">
                    <tr><td colspan="6" class="loading">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- å›æµ‹è®°å½• -->
        <div class="tab-content" id="backtests">
            <div class="toolbar">
                <h3>å›æµ‹è®°å½•åˆ—è¡¨</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="loadBacktests()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ç­–ç•¥åç§°</th>
                        <th>å›æµ‹å‘¨æœŸ</th>
                        <th>æ€»æ”¶ç›Š</th>
                        <th>å¤æ™®æ¯”ç‡</th>
                        <th>æœ€å¤§å›æ’¤</th>
                        <th>èƒœç‡</th>
                        <th>äº¤æ˜“æ¬¡æ•°</th>
                    </tr>
                </thead>
                <tbody id="backtestBody">
                    <tr><td colspan="7" class="loading">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- ç ”ç©¶æ–‡æ¡£ -->
        <div class="tab-content" id="docs">
            <div class="toolbar">
                <h3>ç ”ç©¶æ–‡æ¡£</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="loadDocs()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
            <div id="docsList">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
        
        <!-- æ•°æ®åº“ -->
        <div class="tab-content" id="database">
            <div class="toolbar">
                <h3>MongoDB æ•°æ®åº“ç®¡ç†</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-primary" onclick="exportDatabase()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                    <button class="btn btn-secondary" onclick="loadDatabase()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
            <div id="dbInfo">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
            <table class="data-table" style="margin-top: 20px;">
                <thead>
                    <tr>
                        <th>é›†åˆåç§°</th>
                        <th>æ–‡æ¡£æ•°é‡</th>
                        <th>æœ€åæ›´æ–°</th>
                    </tr>
                </thead>
                <tbody id="dbBody">
                    <tr><td colspan="3" class="loading">åŠ è½½ä¸­...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- å·¥ä½œæµæ•°æ® -->
        <div class="tab-content" id="workflow">
            <div class="toolbar">
                <h3>æŠ•èµ„å·¥ä½œæµæ•°æ®</h3>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="loadWorkflow()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
            <div class="workflow-grid" id="workflowGrid">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>
    
    <script>
        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });
        
        // åŠ è½½æ¦‚è§ˆ
        async function loadOverview() {
            try {
                const res = await fetch('/api/overview');
                const data = await res.json();
                document.getElementById('strategyCount').textContent = data.strategy_count || 0;
                document.getElementById('reportCount').textContent = data.report_count || 0;
                document.getElementById('backtestCount').textContent = data.backtest_count || 0;
                document.getElementById('avgReturn').textContent = (data.avg_return || 0).toFixed(1) + '%';
                document.getElementById('avgSharpe').textContent = (data.avg_sharpe || 0).toFixed(2);
                document.getElementById('dbStatus').textContent = data.db_connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
            } catch (e) {
                console.error('åŠ è½½æ¦‚è§ˆå¤±è´¥:', e);
            }
        }
        
        // åŠ è½½ç­–ç•¥
        async function loadStrategies() {
            try {
                const res = await fetch('/api/strategies');
                const strategies = await res.json();
                const container = document.getElementById('strategyList');
                
                if (strategies.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“</div><p>æš‚æ— ç­–ç•¥æ–‡ä»¶</p></div>';
                    return;
                }
                
                container.innerHTML = strategies.map(s => `
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">${s.name}</span>
                            <span class="card-badge">${s.platform}</span>
                        </div>
                        <div class="card-desc">${s.description}</div>
                        <div class="card-meta">
                            <span>ğŸ“„ ${s.size}</span>
                            <span>ğŸ• ${s.modified}</span>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('åŠ è½½ç­–ç•¥å¤±è´¥:', e);
            }
        }
        
        // åŠ è½½æŠ¥å‘Š
        async function loadReports() {
            try {
                const res = await fetch('/api/reports');
                const reports = await res.json();
                const tbody = document.getElementById('reportBody');
                
                if (reports.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">æš‚æ— æŠ¥å‘Š</td></tr>';
                    return;
                }
                
                tbody.innerHTML = reports.map(r => `
                    <tr>
                        <td><strong>${r.name}</strong></td>
                        <td>${r.type}</td>
                        <td><span class="status status-success">${r.format}</span></td>
                        <td>${r.size}</td>
                        <td>${r.modified}</td>
                        <td><a href="/reports/${r.file}" target="_blank" class="btn btn-secondary" style="padding:6px 12px;">æŸ¥çœ‹</a></td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('åŠ è½½æŠ¥å‘Šå¤±è´¥:', e);
            }
        }
        
        // åŠ è½½å›æµ‹
        async function loadBacktests() {
            try {
                const res = await fetch('/api/backtests');
                const backtests = await res.json();
                const tbody = document.getElementById('backtestBody');
                
                if (backtests.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">æš‚æ— å›æµ‹è®°å½•</td></tr>';
                    return;
                }
                
                tbody.innerHTML = backtests.map(bt => `
                    <tr>
                        <td><strong>${bt.strategy}</strong></td>
                        <td>${bt.start_date || '-'} ~ ${bt.end_date || '-'}</td>
                        <td class="${bt.total_return > 0 ? 'positive' : 'negative'}">${bt.total_return.toFixed(2)}%</td>
                        <td>${bt.sharpe_ratio.toFixed(2)}</td>
                        <td class="negative">${bt.max_drawdown.toFixed(2)}%</td>
                        <td>${bt.win_rate.toFixed(1)}%</td>
                        <td>${bt.total_trades}</td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('åŠ è½½å›æµ‹å¤±è´¥:', e);
            }
        }
        
        // åŠ è½½æ–‡æ¡£
        async function loadDocs() {
            try {
                const res = await fetch('/api/docs');
                const data = await res.json();
                const container = document.getElementById('docsList');
                
                if (!data.categories || data.categories.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“„</div><p>æš‚æ— æ–‡æ¡£</p></div>';
                    return;
                }
                
                let html = '';
                data.categories.forEach(cat => {
                    html += `<div class="category-title">${cat.name}</div>`;
                    html += '<div class="card-grid">';
                    cat.docs.forEach(doc => {
                        html += `
                            <div class="card">
                                <div class="card-header">
                                    <span class="card-title">${doc.name}</span>
                                    <span class="card-badge">${doc.type}</span>
                                </div>
                                <div class="card-meta">
                                    <span>ğŸ“„ ${doc.size}</span>
                                    <span>ğŸ• ${doc.modified}</span>
                                </div>
                                <div style="margin-top:12px;">
                                    <a href="/docs/view/${doc.path}" target="_blank" class="btn btn-secondary" style="padding:6px 12px;">æŸ¥çœ‹</a>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                });
                
                container.innerHTML = html;
            } catch (e) {
                console.error('åŠ è½½æ–‡æ¡£å¤±è´¥:', e);
            }
        }
        
        // åŠ è½½æ•°æ®åº“
        async function loadDatabase() {
            try {
                const res = await fetch('/api/database');
                const data = await res.json();
                const tbody = document.getElementById('dbBody');
                const info = document.getElementById('dbInfo');
                
                if (!data.connected) {
                    info.innerHTML = `<div class="status status-error" style="padding:15px;">âŒ MongoDBæœªè¿æ¥: ${data.message || 'è¯·æ£€æŸ¥MongoDBæœåŠ¡'}</div>`;
                    tbody.innerHTML = '<tr><td colspan="3">-</td></tr>';
                    return;
                }
                
                info.innerHTML = `<div class="status status-success" style="padding:15px;">âœ… å·²è¿æ¥åˆ° ${data.database} (${data.total_collections} ä¸ªé›†åˆ)</div>`;
                
                if (data.collections.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3">æš‚æ— æ•°æ®é›†åˆ</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.collections.map(c => `
                    <tr>
                        <td><strong>${c.name}</strong></td>
                        <td>${c.count}</td>
                        <td>${c.last_update}</td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('åŠ è½½æ•°æ®åº“å¤±è´¥:', e);
            }
        }
        
        // å¯¼å‡ºæ•°æ®åº“
        async function exportDatabase() {
            try {
                const res = await fetch('/api/database/export', { method: 'POST' });
                const data = await res.json();
                if (data.ok) {
                    alert(`âœ… æ•°æ®åº“å·²å¯¼å‡º\næ–‡ä»¶: ${data.file}\né›†åˆæ•°: ${data.collections}\næ–‡æ¡£æ•°: ${data.total_docs}`);
                } else {
                    alert('âŒ å¯¼å‡ºå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (e) {
                alert('âŒ å¯¼å‡ºå¤±è´¥: ' + e.message);
            }
        }
        
        // åŠ è½½å·¥ä½œæµ
        async function loadWorkflow() {
            try {
                const res = await fetch('/api/workflow');
                const data = await res.json();
                const container = document.getElementById('workflowGrid');
                
                const steps = [
                    { key: 'market_trend', icon: 'ğŸ“ˆ' },
                    { key: 'mainlines', icon: 'ğŸ”¥' },
                    { key: 'candidate_pool', icon: 'ğŸ“¦' },
                    { key: 'factors', icon: 'ğŸ§®' },
                    { key: 'strategies', icon: 'ğŸ’»' },
                    { key: 'backtests', icon: 'ğŸ”„' }
                ];
                
                container.innerHTML = steps.map(step => {
                    const d = data[step.key] || { name: step.key, files: [], db_count: 0 };
                    return `
                        <div class="workflow-step">
                            <h4>${step.icon} ${d.name}</h4>
                            <div class="count">${d.files.length + d.db_count}</div>
                            <div class="files">
                                æ–‡ä»¶: ${d.files.length} | æ•°æ®åº“: ${d.db_count}
                                ${d.files.length > 0 ? '<br>æœ€æ–°: ' + d.files[0].name : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error('åŠ è½½å·¥ä½œæµå¤±è´¥:', e);
            }
        }
        
        // åˆå§‹åŒ–åŠ è½½
        loadOverview();
        loadStrategies();
        loadReports();
        loadBacktests();
        loadDocs();
        loadDatabase();
        loadWorkflow();
    </script>
</body>
</html>























































