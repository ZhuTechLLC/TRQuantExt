(()=>{"use strict";var n={3:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.TRQuantClient=void 0;const o=s(t(317)),c=s(t(928)),d=t(628),l=t(478),p=t(799);e.TRQuantClient=class{MODULE="TRQuantClient";extensionPath;configManager;constructor(n){this.extensionPath=n.extensionPath,this.configManager=l.ConfigManager.getInstance(),d.logger.info("TRQuantClientåˆå§‹åŒ–å®Œæˆ",this.MODULE)}async getMarketStatus(n){return this.callBridge("get_market_status",{universe:n?.universe||"CN_EQ",as_of:n?.as_of||this.getTodayDate(),lookback_days:n?.lookback_days||60})}async getMainlines(n){return this.callBridge("get_mainlines",{top_n:n?.top_n||20,time_horizon:n?.time_horizon||"short"})}async recommendFactors(n){return this.callBridge("recommend_factors",{market_regime:n?.market_regime,mainlines:n?.mainlines,top_n:n?.top_n||10})}async generateStrategy(n){p.ErrorHandler.validateRequired(n,["factors"]);const e={max_position:n.risk_params?.max_position||this.configManager.get("defaultRiskParams").maxPosition,stop_loss:n.risk_params?.stop_loss||this.configManager.get("defaultRiskParams").stopLoss,take_profit:n.risk_params?.take_profit||this.configManager.get("defaultRiskParams").takeProfit};return this.callBridge("generate_strategy",{factors:n.factors,style:n.style||this.configManager.get("defaultStyle"),platform:n.platform||this.configManager.get("defaultPlatform"),risk_params:e})}async analyzeBacktest(n){return this.callBridge("analyze_backtest",n)}async assessRisk(n){return p.ErrorHandler.validateRequired(n,["portfolio"]),this.callBridge("risk_assessment",n)}async healthCheck(){try{return(await this.callBridge("health_check",{})).ok}catch{return!1}}async callBridge(n,e){const t=Date.now();d.logger.debug(`è°ƒç”¨Bridge: ${n}`,this.MODULE,{params:e});try{const a=await this.executeSubprocess(n,e),r=Date.now()-t;return d.logger.info(`Bridgeè°ƒç”¨å®Œæˆ: ${n}`,this.MODULE,{duration:`${r}ms`,ok:a.ok}),a}catch(e){const a=Date.now()-t;throw d.logger.error(`Bridgeè°ƒç”¨å¤±è´¥: ${n}`,this.MODULE,{duration:`${a}ms`,error:e instanceof Error?e.message:String(e)}),e}}executeSubprocess(n,e){return new Promise((t,a)=>{const r=this.configManager.getPythonPath(this.extensionPath),i=c.join(this.extensionPath,"python","bridge.py"),s=this.configManager.get("timeout"),l={action:n,params:e},g=JSON.stringify(l);d.logger.debug(`æ‰§è¡ŒPython: ${r}`,this.MODULE,{bridgePath:i});const u={...process.env,PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(this.extensionPath),PYTHONPATH:c.join(this.extensionPath,"python")},m=o.spawn(r,[i],{cwd:c.join(this.extensionPath,"python"),env:u,stdio:["pipe","pipe","pipe"]});let v="",f="";m.stdout?.on("data",n=>{v+=n.toString()}),m.stderr?.on("data",n=>{f+=n.toString()});const h=setTimeout(()=>{m.kill("SIGTERM"),a(new p.TRQuantError(p.ErrorCode.TIMEOUT,`æ“ä½œè¶…æ—¶ (${s}ms)`,{action:n}))},s);m.on("close",e=>{if(clearTimeout(h),0!==e)return d.logger.error(`Pythonè¿›ç¨‹é€€å‡º: ${e}`,this.MODULE,{stderr:f}),void a(new p.PythonError(f||`è¿›ç¨‹é€€å‡ºç : ${e}`,{action:n,code:e,stderr:f}));try{const n=JSON.parse(v.trim());t(n)}catch(n){d.logger.error("å“åº”è§£æå¤±è´¥",this.MODULE,{stdout:v}),a(new p.TRQuantError(p.ErrorCode.BRIDGE_RESPONSE_PARSE_ERROR,"æ— æ³•è§£æåç«¯å“åº”",{stdout:v,parseError:n instanceof Error?n.message:String(n)}))}}),m.on("error",n=>{clearTimeout(h),d.logger.error("è¿›ç¨‹å¯åŠ¨å¤±è´¥",this.MODULE,{error:n.message}),n.message.includes("ENOENT")?a(new p.TRQuantError(p.ErrorCode.PYTHON_NOT_FOUND,`Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°: ${r}`,{pythonPath:r})):a(new p.PythonError(n.message,{error:n}))}),m.stdin?.write(g),m.stdin?.end()})}getTodayDate(){return(new Date).toISOString().split("T")[0]}dispose(){d.logger.info("TRQuantClientå·²é‡Šæ”¾",this.MODULE)}}},4:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.WorkbenchPanel=void 0,e.registerWorkbenchPanel=function(n,e){console.log("[WorkbenchPanel] æ³¨å†Œå·¥ä½œå°é¢æ¿å‘½ä»¤");const t=o.commands.registerCommand("trquant.openWorkbench",()=>{l.createOrShow(n.extensionUri,e)});n.subscriptions.push(t),c.logger.info("é‡åŒ–å·¥ä½œå°é¢æ¿å·²æ³¨å†Œ",d)};const o=s(t(398)),c=t(628),d="WorkbenchPanel";class l{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_marketStatus=null;_mainlines=[];_factors=[];constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._panel.webview.onDidReceiveMessage(n=>this.handleMessage(n),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent(),this.refreshAllData()}static createOrShow(n,e){const t=o.ViewColumn.One;if(l.currentPanel)return l.currentPanel._panel.reveal(t),l.currentPanel;const a=o.window.createWebviewPanel("trquantWorkbench","âš¡ TRQuant é‡åŒ–å·¥ä½œå°",t,{enableScripts:!0,retainContextWhenHidden:!0});return l.currentPanel=new l(a,n,e),l.currentPanel}async handleMessage(n){switch(console.log("[WorkbenchPanel] æ”¶åˆ°æ¶ˆæ¯:",n.command),n.command){case"refreshAll":await this.refreshAllData();break;case"refreshMarket":await this.refreshMarketStatus();break;case"refreshMainlines":await this.refreshMainlines();break;case"refreshFactors":await this.refreshFactors();break;case"createProject":o.commands.executeCommand("trquant.createProject");break;case"generateStrategy":o.commands.executeCommand("trquant.generateStrategy");break;case"runBacktest":o.commands.executeCommand("trquant.runBacktest");break;case"optimizeStrategy":o.commands.executeCommand("trquant.optimizeStrategy");break;case"openWorkflowPanel":o.commands.executeCommand("trquant.launchDesktopSystem");break;default:c.logger.warn(`æœªçŸ¥å‘½ä»¤: ${n.command}`,d)}}async refreshAllData(){await Promise.all([this.refreshMarketStatus(),this.refreshMainlines(),this.refreshFactors()])}async refreshMarketStatus(){try{const n=await this._client.getMarketStatus({});n.ok&&n.data&&(this._marketStatus=n.data,this._panel.webview.postMessage({command:"updateMarketStatus",data:n.data}),this.updateContent())}catch(n){c.logger.error(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${n}`,d)}}async refreshMainlines(){try{const n=await this._client.getMainlines({time_horizon:"short",top_n:5});n.ok&&n.data&&(this._mainlines=n.data,this._panel.webview.postMessage({command:"updateMainlines",data:n.data}),this.updateContent())}catch(n){c.logger.error(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${n}`,d)}}async refreshFactors(){try{const n=this._marketStatus?.regime||"neutral",e=await this._client.recommendFactors({market_regime:n,top_n:5});e.ok&&e.data&&(this._factors=e.data,this._panel.webview.postMessage({command:"updateFactors",data:e.data}),this.updateContent())}catch(n){c.logger.error(`è·å–æ¨èå› å­å¤±è´¥: ${n}`,d)}}updateContent(){this._panel.webview.html=this.generateHtml()}getRegimeText(n){return n?{risk_on:"é£é™©åå¥½ä¸Šå‡",risk_off:"é£é™©åå¥½ä¸‹é™",neutral:"éœ‡è¡å¸‚åœº"}[n]||n:""}generateHtml(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>TRQuant é‡åŒ–å·¥ä½œå°</title>\n    \x3c!-- ç«‹å³ç¦ç”¨ Service Workerï¼ˆå¿…é¡»åœ¨ä»»ä½•è„šæœ¬æ‰§è¡Œå‰ï¼‰ --\x3e\n    <script>\n        (function() {\n            // æ£€æµ‹æ˜¯å¦ä¸º VS Code webview ç¯å¢ƒ\n            const isWebview = \n                location.protocol === 'vscode-webview:' ||\n                typeof acquireVsCodeApi === 'function';\n            \n            // å…³é”®ï¼šæ²¡æœ‰ serviceWorker å°±ä¸è¦ç»§ç»­ï¼ˆé¿å…åœ¨ä¸æ”¯æŒçš„ç¯å¢ƒé‡Œè°ƒç”¨ SW APIï¼‰\n            if (!('serviceWorker' in navigator) || !navigator.serviceWorker) return;\n            \n            // åœ¨ webview é‡Œï¼Œç›´æ¥é˜»æ–­ registerï¼ˆä¸è¦ getRegistrations / unregisterï¼‰\n            if (isWebview) {\n                try {\n                    navigator.serviceWorker.register = function() {\n                        console.warn('[TRQuant WorkbenchPanel] SW register blocked in webview');\n                        try { \n                            // æ‰“å°è°ƒç”¨æ ˆä»¥å®šä½æ³¨å†Œæ¥æº\n                            console.warn(new Error('[TRQuant WorkbenchPanel] SW register stack').stack); \n                        } catch(e) {\n                            console.warn('[TRQuant WorkbenchPanel] Stack trace error:', e);\n                        }\n                        return Promise.reject(new Error('Service Worker disabled in VS Code webview'));\n                    };\n                } catch(e) {\n                    console.warn('[TRQuant WorkbenchPanel] Failed to block Service Worker:', e);\n                }\n            }\n        })();\n    <\/script>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --bg-hover: #262c36;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-purple: #a371f7;\n            --accent-red: #f85149;\n            --border-color: #30363d;\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            min-height: 100vh;\n            padding: 24px;\n        }\n        \n        .header {\n            background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);\n            padding: 24px 32px;\n            border-radius: 12px;\n            margin-bottom: 24px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            border: 1px solid var(--border-color);\n        }\n        \n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .logo {\n            width: 48px;\n            height: 48px;\n            background: linear-gradient(135deg, #f0b429 0%, #e85d04 100%);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            color: #fff;\n        }\n        \n        .header-title h1 {\n            font-size: 24px;\n            font-weight: 700;\n            background: linear-gradient(90deg, var(--accent-gold), #fff);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n        }\n        \n        .header-title .subtitle {\n            font-size: 13px;\n            color: var(--text-muted);\n            margin-top: 4px;\n        }\n        \n        .header-btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 13px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .header-btn:hover {\n            background: var(--bg-hover);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .main-container {\n            max-width: 1600px;\n            margin: 0 auto;\n        }\n        \n        .grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n            gap: 20px;\n            margin-bottom: 24px;\n        }\n        \n        .card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            transition: all 0.2s;\n        }\n        \n        .card:hover {\n            border-color: var(--accent-blue);\n            transform: translateY(-2px);\n        }\n        \n        .card-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        \n        .card-title {\n            font-size: 16px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .card-body {\n            color: var(--text-secondary);\n        }\n        \n        .market-grid {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 12px;\n            margin-bottom: 24px;\n        }\n        \n        .market-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 16px;\n            text-align: center;\n        }\n        \n        .market-card .label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n        }\n        \n        .market-card .value {\n            font-size: 20px;\n            font-weight: 700;\n        }\n        \n        .quick-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n        }\n        \n        .quick-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            cursor: pointer;\n            transition: all 0.2s;\n            text-align: center;\n        }\n        \n        .quick-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .quick-icon {\n            font-size: 32px;\n            margin-bottom: 12px;\n        }\n        \n        .quick-title {\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .quick-desc {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .list-item {\n            padding: 12px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            margin-bottom: 8px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 32px;\n            color: var(--text-muted);\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <div class="logo">âš¡</div>\n            <div class="header-title">\n                <h1>TRQuant é‡åŒ–å·¥ä½œå°</h1>\n                <div class="subtitle">ä¸“ä¸šé‡åŒ–æŠ•èµ„åˆ†æå¹³å°</div>\n            </div>\n        </div>\n        <div>\n            <button class="header-btn" onclick="vscode.postMessage({command: 'refreshAll'})">\n                ğŸ”„ åˆ·æ–°æ•°æ®\n            </button>\n        </div>\n    </div>\n    \n    <div class="main-container">\n        \x3c!-- å¸‚åœºçŠ¶æ€ --\x3e\n        <div class="market-grid" id="marketGrid">\n            <div class="market-card">\n                <div class="label">å¸‚åœºçŠ¶æ€</div>\n                <div class="value" id="marketRegime">${this.getRegimeText(this._marketStatus?.regime)||"åŠ è½½ä¸­..."}</div>\n            </div>\n            <div class="market-card">\n                <div class="label">ä¸Šè¯æŒ‡æ•°</div>\n                <div class="value" id="shIndex">-</div>\n            </div>\n            <div class="market-card">\n                <div class="label">æ·±è¯æˆæŒ‡</div>\n                <div class="value" id="szIndex">-</div>\n            </div>\n            <div class="market-card">\n                <div class="label">åˆ›ä¸šæ¿æŒ‡</div>\n                <div class="value" id="cyIndex">-</div>\n            </div>\n            <div class="market-card">\n                <div class="label">é£æ ¼è½®åŠ¨</div>\n                <div class="value" id="marketStyle">${this._marketStatus?.style_rotation||"-"}</div>\n            </div>\n        </div>\n        \n        \x3c!-- æ ¸å¿ƒåŠŸèƒ½ --\x3e\n        <div class="quick-grid">\n            <div class="quick-card" onclick="vscode.postMessage({command: 'createProject'})">\n                <div class="quick-icon">ğŸ“</div>\n                <div class="quick-title">æ–°å»ºé¡¹ç›®</div>\n                <div class="quick-desc">åˆ›å»ºé‡åŒ–ç­–ç•¥é¡¹ç›®</div>\n            </div>\n            <div class="quick-card" onclick="vscode.postMessage({command: 'generateStrategy'})">\n                <div class="quick-icon">ğŸ¤–</div>\n                <div class="quick-title">ç”Ÿæˆç­–ç•¥</div>\n                <div class="quick-desc">AIæ™ºèƒ½ç”Ÿæˆç­–ç•¥ä»£ç </div>\n            </div>\n            <div class="quick-card" onclick="vscode.postMessage({command: 'runBacktest'})">\n                <div class="quick-icon">ğŸ§ª</div>\n                <div class="quick-title">è¿è¡Œå›æµ‹</div>\n                <div class="quick-desc">ç­–ç•¥å›æµ‹éªŒè¯</div>\n            </div>\n            <div class="quick-card" onclick="vscode.postMessage({command: 'optimizeStrategy'})">\n                <div class="quick-icon">ğŸ”</div>\n                <div class="quick-title">ç­–ç•¥ä¼˜åŒ–</div>\n                <div class="quick-desc">åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥</div>\n            </div>\n        </div>\n        \n        \x3c!-- æŠ•èµ„ä¸»çº¿ & æ¨èå› å­ --\x3e\n        <div class="grid">\n            <div class="card">\n                <div class="card-header">\n                    <div class="card-title">ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP5</div>\n                    <button class="header-btn" style="padding: 6px 12px; font-size: 12px;" onclick="vscode.postMessage({command: 'refreshMainlines'})">åˆ·æ–°</button>\n                </div>\n                <div class="card-body">\n                    <div id="mainlineList">\n                        ${this._mainlines.length>0?this._mainlines.map((n,e)=>`\n                                <div class="list-item">\n                                    <div>\n                                        <strong>${e+1}. ${n.name}</strong>\n                                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">${n.industries?.join(", ")||""}</div>\n                                    </div>\n                                    <div style="color: var(--accent-gold); font-weight: 600;">${n.score?.toFixed(2)||"0.00"}</div>\n                                </div>\n                            `).join(""):'<div class="empty-state">ç‚¹å‡»åˆ·æ–°è·å–æŠ•èµ„ä¸»çº¿</div>'}\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <div class="card-title">ğŸ“Š æ¨èå› å­</div>\n                    <button class="header-btn" style="padding: 6px 12px; font-size: 12px;" onclick="vscode.postMessage({command: 'refreshFactors'})">åˆ·æ–°</button>\n                </div>\n                <div class="card-body">\n                    <div id="factorList">\n                        ${this._factors.length>0?this._factors.map((n,e)=>`\n                                <div class="list-item">\n                                    <div>\n                                        <strong>${n.name||`å› å­ ${e+1}`}</strong>\n                                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">${n.category||""}</div>\n                                    </div>\n                                    <div style="color: var(--accent-purple); font-weight: 600;">${n.weight?.toFixed(2)||"0.00"}</div>\n                                </div>\n                            `).join(""):'<div class="empty-state">ç‚¹å‡»åˆ·æ–°è·å–æ¨èå› å­</div>'}\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- å·¥ä½œæµå…¥å£ --\x3e\n        <div class="card">\n            <div class="card-header">\n                <div class="card-title">ğŸ–¥ï¸ å®Œæ•´å·¥ä½œæµ</div>\n            </div>\n            <div class="card-body">\n                <p style="margin-bottom: 16px; color: var(--text-secondary);">\n                    æ‰“å¼€æ¡Œé¢ç³»ç»ŸæŸ¥çœ‹å®Œæ•´çš„8æ­¥éª¤æŠ•èµ„å·¥ä½œæµï¼ŒåŒ…æ‹¬ä¿¡æ¯è·å–ã€å¸‚åœºè¶‹åŠ¿ã€æŠ•èµ„ä¸»çº¿ã€å€™é€‰æ± ã€å› å­æ„å»ºã€ç­–ç•¥å¼€å‘ã€å›æµ‹éªŒè¯å’Œå®ç›˜äº¤æ˜“ã€‚\n                </p>\n                <button class="header-btn" style="width: 100%;" onclick="vscode.postMessage({command: 'openWorkflowPanel'})">\n                    ğŸ–¥ï¸ æ‰“å¼€æ¡Œé¢ç³»ç»Ÿ\n                </button>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        // Service Worker å·²åœ¨ <head> ä¸­ç¦ç”¨ï¼Œè¿™é‡Œä¸å†é‡å¤\n        const vscode = acquireVsCodeApi();\n        \n        // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯\n        window.addEventListener('message', event => {\n            const message = event.data;\n            switch (message.command) {\n                case 'updateMarketStatus':\n                    if (message.data) {\n                        const regimeMap = {\n                            'risk_on': 'é£é™©åå¥½ä¸Šå‡',\n                            'risk_off': 'é£é™©åå¥½ä¸‹é™',\n                            'neutral': 'éœ‡è¡å¸‚åœº'\n                        };\n                        const regimeText = regimeMap[message.data.regime] || message.data.regime || '-';\n                        document.getElementById('marketRegime').textContent = regimeText;\n                        document.getElementById('marketStyle').textContent = message.data.style_rotation || '-';\n                        if (message.data.indices && message.data.indices.length >= 3) {\n                            document.getElementById('shIndex').textContent = message.data.indices[0]?.value?.toFixed(2) || '-';\n                            document.getElementById('szIndex').textContent = message.data.indices[1]?.value?.toFixed(2) || '-';\n                            document.getElementById('cyIndex').textContent = message.data.indices[2]?.value?.toFixed(2) || '-';\n                        }\n                    }\n                    break;\n                case 'updateMainlines':\n                    const mainlineList = document.getElementById('mainlineList');\n                    if (message.data && message.data.length > 0) {\n                        mainlineList.innerHTML = message.data.map((m, i) => \`\n                            <div class="list-item">\n                                <div>\n                                    <strong>\${i + 1}. \${m.name}</strong>\n                                    <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">\${m.industries?.join(', ') || ''}</div>\n                                </div>\n                                <div style="color: var(--accent-gold); font-weight: 600;">\${m.score?.toFixed(2) || '0.00'}</div>\n                            </div>\n                        \`).join('');\n                    } else {\n                        mainlineList.innerHTML = '<div class="empty-state">æš‚æ— æ•°æ®</div>';\n                    }\n                    break;\n                case 'updateFactors':\n                    const factorList = document.getElementById('factorList');\n                    if (message.data && message.data.length > 0) {\n                        factorList.innerHTML = message.data.map((f, i) => \`\n                            <div class="list-item">\n                                <div>\n                                    <strong>\${f.name || \`å› å­ \${i + 1}\`}</strong>\n                                    <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">\${f.category || ''}</div>\n                                </div>\n                                <div style="color: var(--accent-purple); font-weight: 600;">\${f.weight?.toFixed(2) || '0.00'}</div>\n                            </div>\n                        \`).join('');\n                    } else {\n                        factorList.innerHTML = '<div class="empty-state">æš‚æ— æ•°æ®</div>';\n                    }\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>`}dispose(){for(l.currentPanel=void 0;this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.WorkbenchPanel=l},126:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MainDashboard=void 0,e.registerMainDashboard=function(n,e){try{const t=o.commands.registerCommand("trquant.openDashboard",()=>{g.createOrShow(n.extensionUri,e)});n.subscriptions.push(t),l.logger.info("æŠ•èµ„å·¥ä½œæµä»ªè¡¨ç›˜å·²æ³¨å†Œ",p)}catch(n){n.message&&n.message.includes("already exists")?l.logger.debug("å‘½ä»¤ trquant.openDashboard å·²å­˜åœ¨ï¼Œè·³è¿‡æ³¨å†Œ",p):l.logger.error(`æ³¨å†Œä¸»æ§åˆ¶å°å¤±è´¥: ${n}`,p)}},e.showMainDashboard=function(n,e){g.createOrShow(n,e)};const o=s(t(398)),c=s(t(896)),d=s(t(928)),l=t(628),p="MainDashboard";class g{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_marketStatus=null;_mainlines=[];_factors=[];constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._panel.webview.onDidReceiveMessage(n=>this.handleMessage(n),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent(),this.refreshAllData()}static createOrShow(n,e){const t=o.ViewColumn.One;if(g.currentPanel)return g.currentPanel._panel.reveal(t),g.currentPanel;const a=o.window.createWebviewPanel("trquantDashboard","ğŸ‰ éŸ¬ç¿é‡åŒ–å·¥ä½œå°",t,{enableScripts:!0,retainContextWhenHidden:!0});return g.currentPanel=new g(a,n,e),g.currentPanel}async handleMessage(n){switch(console.log("[MainDashboard] æ”¶åˆ°æ¶ˆæ¯:",n.command),n.command){case"openStep":await this.openWorkflowStep(n.step);break;case"refreshAll":await this.refreshAllData();break;case"refreshMarket":await this.refreshMarketStatus();break;case"refreshMainlines":await this.refreshMainlines();break;case"refreshFactors":await this.refreshFactors();break;case"createProject":console.log("[MainDashboard] æ‰§è¡Œ createProject å‘½ä»¤"),await o.commands.executeCommand("trquant.createProject");break;case"openProject":o.commands.executeCommand("trquant.openProject");break;case"openBacktestConfig":o.commands.executeCommand("trquant.openBacktestConfig");break;case"generateStrategy":o.commands.executeCommand("trquant.generateStrategy");break;case"showLogs":o.commands.executeCommand("trquant.showLogs");break;case"openSettings":o.commands.executeCommand("trquant.openSettings");break;case"openFileManager":o.commands.executeCommand("trquant.openFileManager");break;case"launchFileDashboard":await this.launchFileDashboard();break;case"openKnowledgeBase":o.commands.executeCommand("trquant.openKnowledgeBase");break;case"openAShareManual":o.commands.executeCommand("trquant.openAShareManual");break;case"launchAShareManual":await this.launchAShareManual();break;case"runFullWorkflow":await this.runFullWorkflow();break;case"openWorkflowPanel":console.log("[MainDashboard] å‡†å¤‡å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ");try{await o.commands.executeCommand("trquant.openWorkflowPanel"),console.log("[MainDashboard] æ¡Œé¢ç³»ç»Ÿå¯åŠ¨å‘½ä»¤å·²æ‰§è¡Œ")}catch(n){console.error("[MainDashboard] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥:",n),o.window.showErrorMessage(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${n}`)}break;case"generateInvestmentReport":await this.generateInvestmentReport();break;case"syncFileChanges":await this.syncFileChanges();break;case"exportDatabase":await this.exportDatabase();break;case"openFile":await this.openFile(n.path);break;case"optimizeStrategy":o.commands.executeCommand("trquant.optimizeStrategy");break;case"runBacktest":o.commands.executeCommand("trquant.runBacktest")}}async openWorkflowStep(n){const e={1:{id:"data_source",name:"ä¿¡æ¯è·å–"},2:{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿"},3:{id:"mainline",name:"æŠ•èµ„ä¸»çº¿"},4:{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º"},5:{id:"factor",name:"å› å­æ„å»º"},6:{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ"},7:{id:"backtest",name:"å›æµ‹éªŒè¯"},8:{id:"trading",name:"å®ç›˜äº¤æ˜“"}}[n];if(e)if(7!==n)if(8!==n){this._panel.webview.postMessage({command:"stepStarted",step:n,stepId:e.id,stepName:e.name});try{const t=await this._client.callBridge("run_workflow_step",{step_id:e.id}),a=t.summary||(t.ok?"æ‰§è¡ŒæˆåŠŸ":"æ‰§è¡Œå¤±è´¥"),r=t.data||{};this._panel.webview.postMessage({command:"stepResult",step:n,stepId:e.id,stepName:e.name,success:t.ok,summary:a,details:r,error:t.error})}catch(t){l.logger.error(`æ­¥éª¤${n}æ‰§è¡Œå¤±è´¥: ${t}`,p),this._panel.webview.postMessage({command:"stepResult",step:n,stepId:e.id,stepName:e.name,success:!1,summary:`æ‰§è¡Œå¤±è´¥: ${t}`,details:{},error:String(t)})}}else o.commands.executeCommand("trquant.openTrading");else o.commands.executeCommand("trquant.openBacktestConfig")}async refreshAllData(){this._panel.webview.postMessage({command:"loadingStart"}),await Promise.all([this.refreshMarketStatus(),this.refreshMainlines(),this.refreshFactors()]),this._panel.webview.postMessage({command:"loadingEnd"})}async refreshMarketStatus(){try{const n=await this._client.getMarketStatus();if(n.ok&&n.data){this._marketStatus=n.data;const e={regime:this._marketStatus.regime,regime_cn:this.getRegimeCN(this._marketStatus.regime),indices:this.formatIndices(this._marketStatus.index_trend),style_rotation:this._marketStatus.style_rotation?.[0]?.style||"å‡è¡¡"};this._panel.webview.postMessage({command:"marketStatusUpdated",data:e})}}catch(n){l.logger.error(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${n}`,p)}}getRegimeCN(n){return{risk_on:"é£é™©åå¥½",risk_off:"é£é™©è§„é¿",neutral:"ä¸­æ€§"}[n]||n}formatIndices(n){const e=[],t={sh_index:"ä¸Šè¯æŒ‡æ•°",sz_index:"æ·±è¯æˆæŒ‡",cy_index:"åˆ›ä¸šæ¿æŒ‡"};for(const[a,r]of Object.entries(n||{}))e.push({name:t[a]||a,value:r?.zscore||0,change:r?.change_pct||0});return e}async refreshMainlines(){try{const n=await this._client.getMainlines({time_horizon:"short",top_n:5});n.ok&&n.data&&(this._mainlines=n.data,this._panel.webview.postMessage({command:"mainlinesUpdated",data:this._mainlines}))}catch(n){l.logger.error(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${n}`,p)}}async refreshFactors(){try{const n=this._marketStatus?.regime||"neutral",e=await this._client.recommendFactors({market_regime:n,top_n:5});e.ok&&e.data&&(this._factors=e.data,this._panel.webview.postMessage({command:"factorsUpdated",data:this._factors}))}catch(n){l.logger.error(`è·å–æ¨èå› å­å¤±è´¥: ${n}`,p)}}async runFullWorkflow(){l.logger.info("=== ä¸€é”®æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ ===",p);const n=[{id:"step1",name:"ğŸ“¡ ä¿¡æ¯è·å–",action:"check_data_sources"},{id:"step2",name:"ğŸ“ˆ å¸‚åœºè¶‹åŠ¿",action:"analyze_market_trend"},{id:"step3",name:"ğŸ”¥ æŠ•èµ„ä¸»çº¿",action:"identify_mainlines"},{id:"step4",name:"ğŸ“¦ å€™é€‰æ± æ„å»º",action:"build_candidate_pool"},{id:"step5",name:"ğŸ“Š å› å­æ¨è",action:"recommend_factors"},{id:"step6",name:"ğŸ› ï¸ ç­–ç•¥ç”Ÿæˆ",action:"generate_strategy"},{id:"step7",name:"ğŸ”„ å›æµ‹éªŒè¯",action:"run_backtest"},{id:"step8",name:"ğŸš€ äº¤æ˜“æ£€æŸ¥",action:"check_broker"}];await o.window.withProgress({location:o.ProgressLocation.Notification,title:"ğŸ‰ æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ",cancellable:!0},async(e,t)=>{const a=[];let r=!1;for(let i=0;i<n.length;i++){if(t.isCancellationRequested){o.window.showWarningMessage("å·¥ä½œæµå·²å–æ¶ˆ");break}const s=n[i];e.report({message:`(${i+1}/${n.length}) ${s.name}`,increment:100/n.length});try{l.logger.info(`æ‰§è¡Œæ­¥éª¤: ${s.name}`,p);const e=i+1;this._panel.webview.postMessage({command:"workflowProgress",data:{currentStep:e,stepName:s.name,progress:(i+1)/n.length*100,status:"running"}});const t=await this._client.callBridge("run_workflow_step",{step_id:s.action});t.ok?(a.push({step:s.name,success:!0,data:t.data}),this._panel.webview.postMessage({command:"workflowStepResult",data:{stepId:e,stepName:s.name,result:t.data,success:!0}})):(r=!0,a.push({step:s.name,success:!1,error:t.error})),await new Promise(n=>setTimeout(n,500))}catch(n){r=!0;const e=n instanceof Error?n.message:String(n);l.logger.error(`æ­¥éª¤ ${s.name} å¤±è´¥: ${e}`,p),a.push({step:s.name,success:!1,error:e})}}this._panel.webview.postMessage({command:"workflowComplete",data:{results:a,hasError:r}}),r?o.window.showWarningMessage("âš ï¸ å·¥ä½œæµå®Œæˆï¼Œéƒ¨åˆ†æ­¥éª¤æœ‰é”™è¯¯"):o.window.showInformationMessage("âœ… å®Œæ•´æŠ•èµ„å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼"),await this.refreshAllData()})}async launchAShareManual(){l.logger.info("=== å¯åŠ¨Aè‚¡å®æ“æ‰‹å†Œ ===",p);try{const n=o.workspace.workspaceFolders?.[0];if(!n)return void o.window.showErrorMessage("è¯·å…ˆæ‰“å¼€TRQuantå·¥ä½œåŒº");const e=d.join(n.uri.fsPath,"extension","AShare-manual");if(l.logger.info(`æ‰‹å†Œè·¯å¾„: ${e}`,p),!c.existsSync(e))return o.window.showErrorMessage(`Aè‚¡æ‰‹å†Œç›®å½•ä¸å­˜åœ¨: ${e}`),void l.logger.error(`ç›®å½•ä¸å­˜åœ¨: ${e}`,p);if(!c.existsSync(d.join(e,"package.json")))return void o.window.showErrorMessage("Aè‚¡æ‰‹å†Œé…ç½®æ–‡ä»¶ç¼ºå¤±");if(!c.existsSync(d.join(e,"node_modules"))){if("å®‰è£…"===await o.window.showWarningMessage("Aè‚¡æ‰‹å†Œéœ€è¦å®‰è£…ä¾èµ–ï¼Œæ˜¯å¦å®‰è£…ï¼Ÿ","å®‰è£…","å–æ¶ˆ")){const n=o.window.createTerminal({name:"Aè‚¡æ‰‹å†Œä¾èµ–å®‰è£…",cwd:e});n.show(),n.sendText('npm install && echo "ä¾èµ–å®‰è£…å®Œæˆï¼Œè¯·é‡æ–°ç‚¹å‡»Aè‚¡å®æ“æ‰‹å†Œ"')}return}const t=o.window.terminals.find(n=>"Aè‚¡æ‰‹å†ŒæœåŠ¡"===n.name);if(t)return l.logger.info("å‘ç°å·²å­˜åœ¨çš„æ‰‹å†ŒæœåŠ¡ç»ˆç«¯",p),t.show(),o.window.showInformationMessage("æ­£åœ¨æ‰“å¼€Aè‚¡æ‰‹å†Œ..."),void setTimeout(()=>{o.env.openExternal(o.Uri.parse("http://localhost:4321"))},500);l.logger.info("åˆ›å»ºæ–°ç»ˆç«¯å¯åŠ¨AstroæœåŠ¡",p);const a=o.window.createTerminal({name:"Aè‚¡æ‰‹å†ŒæœåŠ¡",cwd:e,env:{...process.env}});a.show(),a.sendText("npm run dev"),o.window.showInformationMessage("ğŸ“š æ­£åœ¨å¯åŠ¨Aè‚¡æ‰‹å†ŒæœåŠ¡å™¨..."),setTimeout(()=>{l.logger.info("å°è¯•æ‰“å¼€æµè§ˆå™¨",p),o.env.openExternal(o.Uri.parse("http://localhost:4321")),o.window.showInformationMessage("âœ… Aè‚¡é«˜å€è‚¡å®æ“æ‰‹å†Œå·²å¯åŠ¨")},3e3)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯åŠ¨å¤±è´¥: ${e}`,p),o.window.showErrorMessage(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${e}`)}}async launchFileDashboard(){l.logger.info("=== å¯åŠ¨Extension Dashboard ===",p);try{const n=o.workspace.workspaceFolders?.[0];if(!n)return void o.window.showErrorMessage("è¯·å…ˆæ‰“å¼€å·¥ä½œåŒº");const e=o.window.terminals.find(n=>"TRQuant Dashboard"===n.name);if(e)return l.logger.info("DashboardæœåŠ¡å·²åœ¨è¿è¡Œ",p),e.show(),o.window.showInformationMessage("ğŸ“ æ­£åœ¨æ‰“å¼€æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ..."),void setTimeout(()=>{o.env.openExternal(o.Uri.parse("http://localhost:5000"))},500);const t=d.join(n.uri.fsPath,"extension"),a=d.join(t,"start_dashboard.py");if(!c.existsSync(a))return void o.window.showErrorMessage(`Dashboardå¯åŠ¨è„šæœ¬ä¸å­˜åœ¨: ${a}`);l.logger.info(`Dashboardè„šæœ¬: ${a}`,p);const r=o.window.createTerminal({name:"TRQuant Dashboard",cwd:t});r.show();const i="win32"===process.platform,s=i?d.join(t,"venv","Scripts","activate.bat"):d.join(t,"venv","bin","activate"),g=i?d.join(n.uri.fsPath,"venv","Scripts","activate.bat"):d.join(n.uri.fsPath,"venv","bin","activate");let u="";c.existsSync(s)?(u=i?`"${s}" && python start_dashboard.py`:`source "${s}" && python start_dashboard.py`,l.logger.info("ä½¿ç”¨extension venv",p)):c.existsSync(g)?(u=i?`"${g}" && python start_dashboard.py`:`source "${g}" && python start_dashboard.py`,l.logger.info("ä½¿ç”¨å·¥ä½œåŒºæ ¹ç›®å½•venv",p)):(u=(i?"python":"python3")+" start_dashboard.py",l.logger.info("ä½¿ç”¨ç³»ç»ŸPython",p)),r.sendText(u),o.window.showInformationMessage("ğŸ“ æ­£åœ¨å¯åŠ¨Extension Dashboard..."),setTimeout(()=>{o.env.openExternal(o.Uri.parse("http://localhost:5000")),o.window.showInformationMessage("âœ… Extension Dashboardå·²å¯åŠ¨ - http://localhost:5000")},3e3)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯åŠ¨Dashboardå¤±è´¥: ${e}`,p),o.window.showErrorMessage(`å¯åŠ¨æ–‡ä»¶ç®¡ç†ç³»ç»Ÿå¤±è´¥: ${e}`)}}async generateInvestmentReport(){l.logger.info("ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...",p);try{o.window.showInformationMessage("ğŸ“Š æ­£åœ¨ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...");const n=await this._client.callBridge("generate_investment_report",{type:"full"});if(n.ok&&n.data){const e=n.data,t=e.path||e.file||"";o.window.showInformationMessage(`âœ… æŠ¥å‘Šå·²ç”Ÿæˆ: ${d.basename(t)}`,"æ‰“å¼€æŠ¥å‘Š").then(n=>{if("æ‰“å¼€æŠ¥å‘Š"===n){const n=o.workspace.workspaceFolders?.[0];if(n&&t){const e=d.join(n.uri.fsPath,t);o.env.openExternal(o.Uri.file(e))}}})}else o.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${n.error||"æœªçŸ¥é”™è¯¯"}`)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${e}`,p),o.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${e}`)}}async syncFileChanges(){l.logger.info("åŒæ­¥æ–‡ä»¶å˜åŒ–...",p);try{const n=await this._client.callBridge("sync_file_changes",{});if(n.ok&&n.data){const e=n.data,t=e.total_count||0,a=e.recent_files||[];if(t>0){const n=a.slice(0,3).map(n=>n.name).join(", ");o.window.showInformationMessage(`ğŸ”„ æ£€æµ‹åˆ° ${t} ä¸ªæ›´æ–°æ–‡ä»¶: ${n}${t>3?"...":""}`)}else o.window.showInformationMessage("âœ… æ–‡ä»¶å·²æ˜¯æœ€æ–°çŠ¶æ€")}}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`åŒæ­¥å¤±è´¥: ${e}`,p)}}async exportDatabase(){l.logger.info("å¯¼å‡ºæ•°æ®åº“...",p);try{o.window.showInformationMessage("ğŸ—„ï¸ æ­£åœ¨å¯¼å‡ºæ•°æ®åº“...");const n=await this._client.callBridge("export_database",{});if(n.ok&&n.data){const e=n.data;o.window.showInformationMessage(`âœ… æ•°æ®åº“å·²å¯¼å‡º: ${e.collections||0}ä¸ªé›†åˆ, ${e.total_docs||0}æ¡è®°å½•`,"æ‰“å¼€æ–‡ä»¶").then(n=>{if("æ‰“å¼€æ–‡ä»¶"===n){const n=o.workspace.workspaceFolders?.[0];n&&e.file&&o.env.openExternal(o.Uri.file(e.file))}})}else o.window.showErrorMessage(`å¯¼å‡ºå¤±è´¥: ${n.error||"è¯·ç¡®ä¿MongoDBå·²å¯åŠ¨"}`)}catch(n){const e=n instanceof Error?n.message:String(n);l.logger.error(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${e}`,p),o.window.showErrorMessage(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${e}`)}}async openFile(n){if(!n)return;const e=o.workspace.workspaceFolders?.[0];if(!e)return;const t=d.join(e.uri.fsPath,n),a=d.extname(n).toLowerCase();if([".py",".json",".yaml",".yml",".md",".txt"].includes(a)){const n=await o.workspace.openTextDocument(t);await o.window.showTextDocument(n)}else o.env.openExternal(o.Uri.file(t))}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</title>\n    \x3c!-- ç«‹å³ç¦ç”¨ Service Workerï¼ˆå¿…é¡»åœ¨ä»»ä½•è„šæœ¬æ‰§è¡Œå‰ï¼‰ --\x3e\n    <script>\n        (function() {\n            // æ£€æµ‹æ˜¯å¦ä¸º VS Code webview ç¯å¢ƒ\n            const isWebview = \n                location.protocol === \'vscode-webview:\' ||\n                typeof acquireVsCodeApi === \'function\';\n            \n            // å…³é”®ï¼šæ²¡æœ‰ serviceWorker å°±ä¸è¦ç»§ç»­ï¼ˆé¿å…åœ¨ä¸æ”¯æŒçš„ç¯å¢ƒé‡Œè°ƒç”¨ SW APIï¼‰\n            if (!(\'serviceWorker\' in navigator) || !navigator.serviceWorker) return;\n            \n            // åœ¨ webview é‡Œï¼Œç›´æ¥é˜»æ–­ registerï¼ˆä¸è¦ getRegistrations / unregisterï¼‰\n            if (isWebview) {\n                try {\n                    navigator.serviceWorker.register = function() {\n                        console.warn(\'[TRQuant MainDashboard] SW register blocked in webview\');\n                        try { \n                            // æ‰“å°è°ƒç”¨æ ˆä»¥å®šä½æ³¨å†Œæ¥æº\n                            console.warn(new Error(\'[TRQuant MainDashboard] SW register stack\').stack); \n                        } catch(e) {\n                            console.warn(\'[TRQuant MainDashboard] Stack trace error:\', e);\n                        }\n                        return Promise.reject(new Error(\'Service Worker disabled in VS Code webview\'));\n                    };\n                } catch(e) {\n                    console.warn(\'[TRQuant MainDashboard] Failed to block Service Worker:\', e);\n                }\n            }\n        })();\n    <\/script>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --bg-hover: #262c36;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-purple: #a371f7;\n            --accent-red: #f85149;\n            --accent-orange: #f0883e;\n            --border-color: #30363d;\n            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            --gradient-gold: linear-gradient(135deg, #f0b429 0%, #e85d04 100%);\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: \'SF Pro Display\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n        \n        /* é¡¶éƒ¨æ ‡é¢˜æ  */\n        .header {\n            background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);\n            padding: 24px 32px;\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .logo {\n            width: 48px;\n            height: 48px;\n            background: var(--gradient-gold);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            color: #fff;\n            box-shadow: 0 4px 12px rgba(240, 180, 41, 0.3);\n        }\n        \n        .header-title h1 {\n            font-size: 24px;\n            font-weight: 700;\n            background: linear-gradient(90deg, var(--accent-gold), #fff);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            letter-spacing: 1px;\n        }\n        \n        .header-title .subtitle {\n            font-size: 13px;\n            color: var(--text-muted);\n            margin-top: 4px;\n        }\n        \n        .header-right {\n            display: flex;\n            gap: 12px;\n        }\n        \n        .header-btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 13px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .header-btn:hover {\n            background: var(--bg-hover);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .header-btn.primary {\n            background: var(--gradient-primary);\n            border: none;\n            color: #fff;\n        }\n        \n        .header-btn.primary:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        }\n        \n        /* ä¸»å®¹å™¨ */\n        .main-container {\n            padding: 24px 32px;\n            max-width: 1600px;\n            margin: 0 auto;\n        }\n        \n        /* å¸‚åœºçŠ¶æ€å¡ç‰‡ */\n        .market-section {\n            margin-bottom: 24px;\n        }\n        \n        .market-grid {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 16px;\n        }\n        \n        .market-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n            transition: all 0.2s;\n        }\n        \n        .market-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .market-card.regime {\n            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));\n            border-color: var(--accent-green);\n        }\n        \n        .market-card .label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        .market-card .value {\n            font-size: 24px;\n            font-weight: 700;\n        }\n        \n        .market-card .change {\n            font-size: 14px;\n            margin-top: 4px;\n        }\n        \n        .market-card .change.up { color: var(--accent-red); }\n        .market-card .change.down { color: var(--accent-green); }\n        \n        .market-card.regime .value {\n            color: var(--accent-green);\n        }\n        \n        /* åŒæ å¸ƒå±€ */\n        .content-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n            margin-bottom: 24px;\n        }\n        \n        .card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        \n        .card-header {\n            padding: 16px 20px;\n            background: rgba(0, 0, 0, 0.2);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .card-header h3 {\n            font-size: 15px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .card-header .actions {\n            display: flex;\n            gap: 8px;\n        }\n        \n        .card-header .btn-small {\n            padding: 6px 12px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            color: var(--text-secondary);\n            font-size: 12px;\n            cursor: pointer;\n        }\n        \n        .card-header .btn-small:hover {\n            background: var(--accent-blue);\n            border-color: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .card-body {\n            padding: 20px;\n        }\n        \n        /* æŠ•èµ„ä¸»çº¿åˆ—è¡¨ */\n        .mainline-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .mainline-item {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            transition: all 0.2s;\n            cursor: pointer;\n        }\n        \n        .mainline-item:hover {\n            background: var(--bg-hover);\n            transform: translateX(4px);\n        }\n        \n        .mainline-rank {\n            width: 28px;\n            height: 28px;\n            background: var(--gradient-gold);\n            border-radius: 6px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n            font-weight: 700;\n            color: #fff;\n        }\n        \n        .mainline-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }\n        .mainline-rank.bronze { background: linear-gradient(135deg, #d97706, #92400e); }\n        \n        .mainline-info {\n            flex: 1;\n        }\n        \n        .mainline-name {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .mainline-industries {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .mainline-score {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--accent-gold);\n        }\n        \n        /* å› å­åˆ—è¡¨ */\n        .factor-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .factor-item {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n        }\n        \n        .factor-icon {\n            width: 36px;\n            height: 36px;\n            background: var(--gradient-primary);\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 16px;\n        }\n        \n        .factor-info {\n            flex: 1;\n        }\n        \n        .factor-name {\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 2px;\n        }\n        \n        .factor-category {\n            font-size: 11px;\n            color: var(--text-muted);\n        }\n        \n        .factor-weight {\n            font-size: 16px;\n            font-weight: 700;\n            color: var(--accent-purple);\n        }\n        \n        /* 8æ­¥éª¤å·¥ä½œæµ */\n        .workflow-section {\n            margin-bottom: 24px;\n        }\n        \n        .section-title {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-muted);\n            text-transform: uppercase;\n            letter-spacing: 2px;\n            margin-bottom: 16px;\n            padding-left: 4px;\n        }\n        \n        .section-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        \n        .run-all-btn {\n            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.3s;\n        }\n        .run-all-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .workflow-container {\n            display: flex;\n            gap: 20px;\n        }\n        \n        .workflow-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 12px;\n            flex: 1;\n        }\n        \n        .workflow-step {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px 12px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s;\n            position: relative;\n        }\n        \n        .workflow-step::after {\n            display: none;\n        }\n        \n        .workflow-step:last-child::after {\n            display: none;\n        }\n        \n        .workflow-step:hover {\n            transform: translateY(-4px);\n            border-color: var(--accent-blue);\n            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.15);\n        }\n        \n        .workflow-step.active {\n            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(163, 113, 247, 0.15));\n            border-color: var(--accent-blue);\n        }\n        \n        .step-number {\n            width: 24px;\n            height: 24px;\n            background: var(--bg-card);\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 11px;\n            font-weight: 600;\n            color: var(--text-muted);\n            margin: 0 auto 12px;\n        }\n        \n        .workflow-step:hover .step-number {\n            background: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .step-icon {\n            font-size: 28px;\n            margin-bottom: 10px;\n        }\n        \n        .step-name {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .workflow-step:hover .step-name {\n            color: var(--text-primary);\n        }\n        \n        .step-status {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            font-size: 14px;\n        }\n        \n        .workflow-step.running {\n            border-color: #f59e0b;\n            animation: pulse 1.5s infinite;\n        }\n        \n        .workflow-step.completed {\n            border-color: #10b981;\n        }\n        \n        .workflow-step.failed {\n            border-color: #ef4444;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }\n        }\n        \n        /* ç»“æœé¢æ¿ */\n        .result-panel {\n            flex: 1;\n            min-width: 400px;\n            max-width: 500px;\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px;\n            display: none;\n        }\n        \n        .result-panel.visible {\n            display: block;\n        }\n        \n        .result-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        \n        .result-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .close-btn {\n            background: transparent;\n            border: none;\n            color: var(--text-muted);\n            cursor: pointer;\n            font-size: 16px;\n            padding: 4px 8px;\n            border-radius: 4px;\n        }\n        .close-btn:hover {\n            background: var(--bg-hover);\n            color: var(--text-primary);\n        }\n        \n        .result-summary {\n            background: var(--bg-card);\n            padding: 12px;\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 14px;\n            margin-bottom: 12px;\n        }\n        \n        .result-progress {\n            margin-bottom: 12px;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-card);\n            border-radius: 3px;\n            overflow: hidden;\n            margin-bottom: 8px;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n        \n        .progress-text {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .result-details {\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n            max-height: 300px;\n            overflow-y: auto;\n            font-size: 13px;\n            margin-bottom: 12px;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th, .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-secondary);\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .result-files {\n            max-height: 100px;\n            overflow-y: auto;\n        }\n        \n        .file-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px;\n            background: var(--bg-card);\n            border-radius: 6px;\n            margin-bottom: 4px;\n            cursor: pointer;\n            font-size: 12px;\n        }\n        .file-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        /* å¿«æ·æ“ä½œåŒº */\n        .quick-section {\n            margin-bottom: 24px;\n        }\n        \n        .quick-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n        }\n        \n        .quick-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 24px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .quick-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .quick-card.highlight {\n            background: linear-gradient(135deg, rgba(240, 180, 41, 0.1), rgba(232, 93, 4, 0.1));\n            border-color: var(--accent-gold);\n        }\n        \n        .quick-icon {\n            width: 48px;\n            height: 48px;\n            background: var(--bg-card);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n        }\n        \n        .quick-card.highlight .quick-icon {\n            background: var(--gradient-gold);\n        }\n        \n        .quick-info h4 {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .quick-info p {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        /* åº•éƒ¨åŒæ  */\n        .bottom-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n        }\n        \n        .project-list, .backtest-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .project-item, .backtest-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .project-item:hover, .backtest-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        .item-name {\n            font-size: 14px;\n            font-weight: 500;\n        }\n        \n        .item-date {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .item-return {\n            font-size: 14px;\n            font-weight: 600;\n        }\n        \n        .item-return.positive { color: var(--accent-red); }\n        .item-return.negative { color: var(--accent-green); }\n        \n        /* åŠ è½½çŠ¶æ€ */\n        .loading-overlay {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(10, 14, 20, 0.8);\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n        \n        .loading-overlay.active {\n            display: flex;\n        }\n        \n        .loading-spinner {\n            width: 48px;\n            height: 48px;\n            border: 3px solid var(--border-color);\n            border-top-color: var(--accent-gold);\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n        \n        /* ç©ºçŠ¶æ€ */\n        .empty-state {\n            text-align: center;\n            padding: 32px;\n            color: var(--text-muted);\n        }\n        \n        .empty-state .icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        /* å“åº”å¼ */\n        @media (max-width: 1400px) {\n            .workflow-grid {\n                grid-template-columns: repeat(4, 1fr);\n            }\n            .workflow-step::after {\n                display: none;\n            }\n        }\n        \n        @media (max-width: 1000px) {\n            .content-grid, .bottom-grid {\n                grid-template-columns: 1fr;\n            }\n            .market-grid {\n                grid-template-columns: repeat(3, 1fr);\n            }\n            .quick-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n        }\n    </style>\n</head>\n<body>\n    \x3c!-- é¡¶éƒ¨æ ‡é¢˜æ  --\x3e\n    <div class="header">\n        <div class="header-left">\n            <div class="logo">TR</div>\n            <div class="header-title">\n                <h1>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</h1>\n                <div class="subtitle">TRQuant Professional - Aè‚¡å®Œæ•´æŠ•èµ„æµç¨‹ç³»ç»Ÿ</div>\n            </div>\n        </div>\n        <div class="header-right">\n            <button class="header-btn" onclick="vscode.postMessage({command: \'refreshAll\'})">\n                ğŸ”„ åˆ·æ–°æ•°æ®\n            </button>\n            <button class="header-btn" onclick="vscode.postMessage({command: \'openSettings\'})">\n                âš™ï¸ è®¾ç½®\n            </button>\n            <button class="header-btn primary" onclick="openWorkflowPanel()">\n                ğŸ–¥ï¸ æ‰“å¼€æ¡Œé¢ç³»ç»Ÿ\n            </button>\n        </div>\n    </div>\n    \n    <div class="main-container">\n        \x3c!-- å¿«æ·æ“ä½œï¼ˆç½®é¡¶ï¼‰ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="console.log(\'ç‚¹å‡»æ–°å»ºé¡¹ç›®\'); vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>ä¸€é”®ç”Ÿæˆä¸­å›½é£ç­–ç•¥</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“‚</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç³»ç»Ÿ</h4>\n                        <p>ç­–ç•¥/æŠ¥å‘Š/æ•°æ®ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="openWorkflowPanel()">\n                    <div class="quick-icon">ğŸ–¥ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ¡Œé¢ç³»ç»Ÿ</h4>\n                        <p>æŸ¥çœ‹å®Œæ•´æŠ•èµ„æµç¨‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'runBacktest\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œå›æµ‹</h4>\n                        <p>é…ç½®å¹¶æ‰§è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchAShareManual\'})">\n                    <div class="quick-icon">ğŸ“š</div>\n                    <div class="quick-info">\n                        <h4>å®æ“æ‰‹å†Œ</h4>\n                        <p>Aè‚¡æŠ•èµ„æŒ‡å—</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ¥å‘Š</h4>\n                        <p>AIæŠ•èµ„åˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- å¸‚åœºçŠ¶æ€ --\x3e\n        <div class="market-section">\n            <div class="market-grid" id="marketGrid">\n                <div class="market-card regime">\n                    <div class="label">å¸‚åœºçŠ¶æ€</div>\n                    <div class="value" id="marketRegime">åŠ è½½ä¸­...</div>\n                    <div class="change" id="marketStyle">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">ä¸Šè¯æŒ‡æ•°</div>\n                    <div class="value" id="shIndex">-</div>\n                    <div class="change" id="shChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">æ·±è¯æˆæŒ‡</div>\n                    <div class="value" id="szIndex">-</div>\n                    <div class="change" id="szChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åˆ›ä¸šæ¿æŒ‡</div>\n                    <div class="value" id="cyIndex">-</div>\n                    <div class="change" id="cyChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åŒ—å‘èµ„é‡‘</div>\n                    <div class="value" id="northFlow">-</div>\n                    <div class="change" id="northChange">-</div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æŠ•èµ„ä¸»çº¿ & æ¨èå› å­ --\x3e\n        <div class="content-grid">\n            \x3c!-- æŠ•èµ„ä¸»çº¿ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ”¥ å½“å‰æŠ•èµ„ä¸»çº¿ TOP5</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshMainlines\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 3})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="mainline-list" id="mainlineList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ”¥</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–æŠ•èµ„ä¸»çº¿</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- æ¨èå› å­ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æ™ºèƒ½æ¨èå› å­</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshFactors\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'generateStrategy\'})">ç”Ÿæˆç­–ç•¥</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="factor-list" id="factorList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ“Š</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–å› å­æ¨è</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- 8æ­¥éª¤å·¥ä½œæµ --\x3e\n        <div class="workflow-section">\n            <div class="section-header">\n                <div class="section-title">ğŸ“‹ 8æ­¥éª¤æŠ•èµ„å·¥ä½œæµ</div>\n                <button class="run-all-btn" onclick="vscode.postMessage({command: \'runFullWorkflow\'})">\n                    â–¶ï¸ ä¸€é”®æ‰§è¡Œå…¨éƒ¨\n                </button>\n            </div>\n            <div class="workflow-container">\n                <div class="workflow-grid">\n                    <div class="workflow-step" id="step-1" onclick="runStep(1)">\n                        <div class="step-number">1</div>\n                        <div class="step-icon">ğŸ“¡</div>\n                        <div class="step-name">ä¿¡æ¯è·å–</div>\n                        <div class="step-status" id="status-1">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-2" onclick="runStep(2)">\n                        <div class="step-number">2</div>\n                        <div class="step-icon">ğŸ“ˆ</div>\n                        <div class="step-name">å¸‚åœºè¶‹åŠ¿</div>\n                        <div class="step-status" id="status-2">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-3" onclick="runStep(3)">\n                        <div class="step-number">3</div>\n                        <div class="step-icon">ğŸ”¥</div>\n                        <div class="step-name">æŠ•èµ„ä¸»çº¿</div>\n                        <div class="step-status" id="status-3">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-4" onclick="runStep(4)">\n                        <div class="step-number">4</div>\n                        <div class="step-icon">ğŸ“¦</div>\n                        <div class="step-name">å€™é€‰æ± </div>\n                        <div class="step-status" id="status-4">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-5" onclick="runStep(5)">\n                        <div class="step-number">5</div>\n                        <div class="step-icon">ğŸ“Š</div>\n                        <div class="step-name">å› å­æ„å»º</div>\n                        <div class="step-status" id="status-5">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-6" onclick="runStep(6)">\n                        <div class="step-number">6</div>\n                        <div class="step-icon">ğŸ› ï¸</div>\n                        <div class="step-name">ç­–ç•¥å¼€å‘</div>\n                        <div class="step-status" id="status-6">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-7" onclick="runStep(7)">\n                        <div class="step-number">7</div>\n                        <div class="step-icon">ğŸ”„</div>\n                        <div class="step-name">å›æµ‹éªŒè¯</div>\n                        <div class="step-status" id="status-7">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-8" onclick="runStep(8)">\n                        <div class="step-number">8</div>\n                        <div class="step-icon">ğŸš€</div>\n                        <div class="step-name">å®ç›˜äº¤æ˜“</div>\n                        <div class="step-status" id="status-8">â–¶ï¸</div>\n                    </div>\n                </div>\n                \n                \x3c!-- æ‰§è¡Œç»“æœåŒºåŸŸ --\x3e\n                <div class="result-panel" id="result-panel">\n                    <div class="result-header">\n                        <span class="result-title" id="result-title">ğŸ“‹ æ‰§è¡Œç»“æœ</span>\n                        <button class="close-btn" onclick="hideResultPanel()">âœ•</button>\n                    </div>\n                    <div class="result-summary" id="result-summary">\n                        ç‚¹å‡»å·¦ä¾§æ­¥éª¤å¼€å§‹æ‰§è¡Œ...\n                    </div>\n                    <div class="result-progress" id="result-progress" style="display:none;">\n                        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>\n                        <span class="progress-text" id="progress-text">æ‰§è¡Œä¸­...</span>\n                    </div>\n                    <div class="result-details" id="result-details"></div>\n                    <div class="result-files" id="result-files"></div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- å¿«æ·æ“ä½œ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'openBacktestConfig\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>å›æµ‹é…ç½®</h4>\n                        <p>é…ç½®å¹¶è¿è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>åˆ›å»ºæ–°çš„é‡åŒ–é¡¹ç›®</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateStrategy\'})">\n                    <div class="quick-icon">ğŸ¤–</div>\n                    <div class="quick-info">\n                        <h4>AIç”Ÿæˆç­–ç•¥</h4>\n                        <p>æ™ºèƒ½ç”ŸæˆPTradeä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>æŸ¥çœ‹æ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- ç³»ç»Ÿç®¡ç† --\x3e\n        <div class="quick-section">\n            <div class="section-title">ğŸ”§ ç³»ç»Ÿç®¡ç†ä¸æ–‡ä»¶ä¸­å¿ƒ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h4>\n                        <p>Webä»ªè¡¨ç›˜(ç­–ç•¥/æŠ¥å‘Š/æ•°æ®åº“)</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ•èµ„æŠ¥å‘Š</h4>\n                        <p>AIç»¼åˆåˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'syncFileChanges\'})">\n                    <div class="quick-icon">ğŸ”„</div>\n                    <div class="quick-info">\n                        <h4>æ™ºèƒ½åŒæ­¥</h4>\n                        <p>æ£€æµ‹æ›´æ–°çš„æ–‡ä»¶</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'exportDatabase\'})">\n                    <div class="quick-icon">ğŸ—„ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ•°æ®åº“ç®¡ç†</h4>\n                        <p>å¯¼å‡º/å¤‡ä»½MongoDB</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'openSettings\'})">\n                    <div class="quick-icon">âš™ï¸</div>\n                    <div class="quick-info">\n                        <h4>ç³»ç»Ÿè®¾ç½®</h4>\n                        <p>é…ç½®å‚æ•°ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œæ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æœ€è¿‘é¡¹ç›® & å›æµ‹ --\x3e\n        <div class="bottom-grid">\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“ æœ€è¿‘é¡¹ç›®</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openProject\'})">æ‰“å¼€é¡¹ç›®</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="project-list" id="projectList">\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‰ ç¿æ™ºé‡‘é¾™</div>\n                                <div class="item-date">2024-12-03</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ¦… çµåŠ¨ç¢§é¹¤</div>\n                                <div class="item-date">2024-12-02</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‹ é£˜é€¸ç´«ç«¹</div>\n                                <div class="item-date">2024-12-01</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æœ€è¿‘å›æµ‹</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 7})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="backtest-list" id="backtestList">\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">test1 åŠ¨é‡æˆé•¿ç­–ç•¥</div>\n                                <div class="item-date">2024-12-03 15:30</div>\n                            </div>\n                            <div class="item-return positive">+15.2%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">momentum ç­–ç•¥</div>\n                                <div class="item-date">2024-12-02 10:15</div>\n                            </div>\n                            <div class="item-return positive">+8.5%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">multi_factor å¤šå› å­</div>\n                                <div class="item-date">2024-12-01 14:20</div>\n                            </div>\n                            <div class="item-return negative">-2.1%</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    \x3c!-- åŠ è½½é®ç½© --\x3e\n    <div class="loading-overlay" id="loadingOverlay">\n        <div class="loading-spinner"></div>\n    </div>\n    \n    <script>\n        // Service Worker å·²åœ¨ <head> ä¸­ç¦ç”¨ï¼Œè¿™é‡Œä¸å†é‡å¤\n        // ç¡®ä¿æ–‡æ¡£çŠ¶æ€ç¨³å®šåå†åˆå§‹åŒ–\n        const vscode = acquireVsCodeApi();\n        \n        // æ‰“å¼€æ¡Œé¢ç³»ç»Ÿï¼ˆå®Œæ•´å·¥ä½œæµï¼‰\n        function openWorkflowPanel() {\n            console.log(\'[MainDashboard HTML] ç‚¹å‡»æ‰“å¼€æ¡Œé¢ç³»ç»ŸæŒ‰é’®\');\n            try {\n                vscode.postMessage({command: \'openWorkflowPanel\'});\n                console.log(\'[MainDashboard HTML] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿæ¶ˆæ¯å·²å‘é€\');\n            } catch (error) {\n                console.error(\'[MainDashboard HTML] å‘é€æ¶ˆæ¯å¤±è´¥:\', error);\n            }\n        }\n        \n        // æ›´æ–°å¸‚åœºçŠ¶æ€\n        function updateMarketStatus(data) {\n            if (!data) return;\n            \n            // å¸‚åœºRegime\n            document.getElementById(\'marketRegime\').textContent = data.regime_cn || data.regime || \'ä¸­æ€§\';\n            document.getElementById(\'marketStyle\').textContent = data.style_rotation || \'å‡è¡¡\';\n            \n            // æŒ‡æ•°æ•°æ®\n            if (data.indices && data.indices.length >= 3) {\n                const [sh, sz, cy] = data.indices;\n                \n                document.getElementById(\'shIndex\').textContent = sh.value?.toFixed(2) || \'-\';\n                document.getElementById(\'shChange\').textContent = (sh.change >= 0 ? \'+\' : \'\') + (sh.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'shChange\').className = \'change \' + (sh.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'szIndex\').textContent = sz.value?.toFixed(2) || \'-\';\n                document.getElementById(\'szChange\').textContent = (sz.change >= 0 ? \'+\' : \'\') + (sz.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'szChange\').className = \'change \' + (sz.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'cyIndex\').textContent = cy.value?.toFixed(2) || \'-\';\n                document.getElementById(\'cyChange\').textContent = (cy.change >= 0 ? \'+\' : \'\') + (cy.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'cyChange\').className = \'change \' + (cy.change >= 0 ? \'up\' : \'down\');\n            }\n        }\n        \n        // æ›´æ–°æŠ•èµ„ä¸»çº¿\n        function updateMainlines(data) {\n            const container = document.getElementById(\'mainlineList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ”¥</div><div>æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div></div>\';\n                return;\n            }\n            \n            container.innerHTML = data.map((m, i) => {\n                const rankClass = i === 0 ? \'\' : i === 1 ? \'silver\' : i === 2 ? \'bronze\' : \'\';\n                return `\n                    <div class="mainline-item">\n                        <div class="mainline-rank ${rankClass}">${i + 1}</div>\n                        <div class="mainline-info">\n                            <div class="mainline-name">${m.name}</div>\n                            <div class="mainline-industries">${m.industries?.slice(0, 3).join(\' Â· \') || \'\'}</div>\n                        </div>\n                        <div class="mainline-score">â­${m.score}</div>\n                    </div>\n                `;\n            }).join(\'\');\n        }\n        \n        // æ›´æ–°å› å­\n        function updateFactors(data) {\n            const container = document.getElementById(\'factorList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ“Š</div><div>æš‚æ— å› å­æ¨è</div></div>\';\n                return;\n            }\n            \n            const icons = [\'ğŸ“ˆ\', \'ğŸ’¹\', \'ğŸ’°\', \'âš¡\', \'ğŸ¯\'];\n            container.innerHTML = data.map((f, i) => `\n                <div class="factor-item">\n                    <div class="factor-icon">${icons[i % icons.length]}</div>\n                    <div class="factor-info">\n                        <div class="factor-name">${f.name}</div>\n                        <div class="factor-category">${f.category || \'é‡åŒ–å› å­\'}</div>\n                    </div>\n                    <div class="factor-weight">${(f.weight * 100).toFixed(0)}%</div>\n                </div>\n            `).join(\'\');\n        }\n        \n        // =====================\n        // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n        // =====================\n        \n        function runStep(step) {\n            vscode.postMessage({command: \'openStep\', step: step});\n        }\n        \n        function showResultPanel() {\n            document.getElementById(\'result-panel\').classList.add(\'visible\');\n        }\n        \n        function hideResultPanel() {\n            document.getElementById(\'result-panel\').classList.remove(\'visible\');\n        }\n        \n        function setStepStatus(step, status) {\n            // å…¼å®¹å­—ç¬¦ä¸²å’Œæ•°å­—ï¼šå¦‚æœæ˜¯ \'step1\' æ ¼å¼ï¼Œæå–æ•°å­—ï¼›å¦‚æœæ˜¯ \'data_source\' ç­‰ï¼Œæ˜ å°„åˆ°æ•°å­—\n            let stepNum;\n            if (typeof step === \'string\') {\n                if (step.startsWith(\'step\')) {\n                    stepNum = parseInt(step.replace(\'step\', \'\'), 10);\n                } else {\n                    // æ˜ å°„å­—ç¬¦ä¸² ID åˆ°æ•°å­—\n                    const stepMap = {\n                        \'data_source\': 1,\n                        \'market_trend\': 2,\n                        \'mainline\': 3,\n                        \'candidate_pool\': 4,\n                        \'factor\': 5,\n                        \'strategy\': 6,\n                        \'backtest\': 7,\n                        \'trading\': 8\n                    };\n                    stepNum = stepMap[step] || parseInt(step, 10);\n                }\n            } else {\n                stepNum = step;\n            }\n            \n            if (!stepNum || stepNum < 1 || stepNum > 8) {\n                console.warn(\'[MainDashboard] Invalid step:\', step, \'->\', stepNum);\n                return;\n            }\n            \n            const stepEl = document.getElementById(\'step-\' + stepNum);\n            const statusEl = document.getElementById(\'status-\' + stepNum);\n            \n            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»\n            stepEl.classList.remove(\'running\', \'completed\', \'failed\');\n            \n            switch(status) {\n                case \'running\':\n                    stepEl.classList.add(\'running\');\n                    statusEl.textContent = \'â³\';\n                    break;\n                case \'completed\':\n                    stepEl.classList.add(\'completed\');\n                    statusEl.textContent = \'âœ…\';\n                    break;\n                case \'failed\':\n                    stepEl.classList.add(\'failed\');\n                    statusEl.textContent = \'âŒ\';\n                    break;\n                default:\n                    statusEl.textContent = \'â–¶ï¸\';\n            }\n        }\n        \n        function showProgress(show, value, text) {\n            const el = document.getElementById(\'result-progress\');\n            el.style.display = show ? \'block\' : \'none\';\n            if (show) {\n                document.getElementById(\'progress-fill\').style.width = value + \'%\';\n                document.getElementById(\'progress-text\').textContent = text || \'æ‰§è¡Œä¸­...\';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return \'<div style="color:var(--text-muted);">æ— è¯¦ç»†æ•°æ®</div>\';\n            }\n            \n            let html = \'\';\n            \n            // æŠ•èµ„ä¸»çº¿\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#f59e0b;">ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP\' + mainlines.length + \'</strong></div>\';\n                html += \'<table><tr><th>æ’å</th><th>åç§°</th><th>è¯„åˆ†</th></tr>\';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += \'<tr><td>#\' + (ml.rank || \'-\') + \'</td><td>\' + (ml.name || \'-\') + \'</td><td style="color:#10b981;">\' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || ml.composite_score || ml.score || \'-\') + \'</td></tr>\';\n                });\n                if (mainlines.length > 10) {\n                    html += \'<tr><td colspan="3" style="color:var(--text-muted);">... å…±\' + mainlines.length + \'ä¸ªä¸»çº¿</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å€™é€‰æ± è‚¡ç¥¨\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#8b5cf6;">ğŸ“¦ å€™é€‰æ± è‚¡ç¥¨ (\' + stocks.length + \'åª)</strong></div>\';\n                html += \'<table><tr><th>ä»£ç </th><th>åç§°</th><th>æ¥æº</th><th>è¯„åˆ†</th></tr>\';\n                stocks.slice(0, 15).forEach(s => {\n                    html += \'<tr><td>\' + (s.code || \'-\') + \'</td><td>\' + (s.name || \'-\') + \'</td><td style="color:var(--text-muted);">\' + (s.source || \'-\') + \'</td><td style="color:#10b981;">\' + ((s.score || 0).toFixed?.(1) || \'-\') + \'</td></tr>\';\n                });\n                html += \'</table>\';\n            }\n            \n            // æ¨èå› å­\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ§® æ¨èå› å­</strong></div>\';\n                html += \'<ul style="margin:0;padding-left:20px;">\';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += \'<li style="margin:6px 0;"><strong>\' + (f.name || \'-\') + \'</strong> (æƒé‡\' + weight + \'%) - \' + (f.reason || \'\') + \'</li>\';\n                });\n                html += \'</ul>\';\n            }\n            \n            // æ•°æ®æºæ£€æµ‹\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“¡ æ•°æ®æºçŠ¶æ€</strong></div>\';\n                html += \'<table><tr><th>æ•°æ®æº</th><th>çŠ¶æ€</th></tr>\';\n                if (details.jqdata !== undefined) {\n                    html += \'<tr><td>JQData</td><td style="color:\' + (details.jqdata ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.jqdata ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                if (details.akshare !== undefined) {\n                    html += \'<tr><td>AKShare</td><td style="color:\' + (details.akshare ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.akshare ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å¸‚åœºè¶‹åŠ¿\n            else if (details.regime || details.trend_strength !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“ˆ å¸‚åœºè¶‹åŠ¿åˆ†æ</strong></div>\';\n                html += \'<table><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th></tr>\';\n                if (details.regime) html += \'<tr><td>å¸‚åœºRegime</td><td>\' + details.regime + \'</td></tr>\';\n                if (details.trend_strength !== undefined) html += \'<tr><td>è¶‹åŠ¿å¼ºåº¦</td><td>\' + details.trend_strength + \'</td></tr>\';\n                if (details.volatility !== undefined) html += \'<tr><td>æ³¢åŠ¨ç‡</td><td>\' + details.volatility + \'</td></tr>\';\n                if (details.style_rotation) html += \'<tr><td>é£æ ¼è½®åŠ¨</td><td>\' + details.style_rotation + \'</td></tr>\';\n                html += \'</table>\';\n            }\n            \n            // ç­–ç•¥æ–‡ä»¶\n            else if (details.strategy_file) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ’» ç­–ç•¥ç”Ÿæˆå®Œæˆ</strong></div>\';\n                html += \'<div style="background:var(--bg-card);padding:12px;border-radius:8px;">\';\n                html += \'<div>ğŸ“„ ç­–ç•¥æ–‡ä»¶: <strong>\' + details.strategy_file.split(\'/\').pop() + \'</strong></div>\';\n                if (details.platform) html += \'<div>ğŸ¯ ç›®æ ‡å¹³å°: \' + details.platform + \'</div>\';\n                if (details.style) html += \'<div>ğŸ“Š ç­–ç•¥é£æ ¼: \' + details.style + \'</div>\';\n                html += \'</div>\';\n            }\n            \n            // é»˜è®¤JSONæ˜¾ç¤º\n            else {\n                html += \'<pre style="font-size:11px;overflow-x:auto;">\' + JSON.stringify(details, null, 2) + \'</pre>\';\n            }\n            \n            return html;\n        }\n        \n        // å¤„ç†æ¶ˆæ¯\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'loadingStart\':\n                    document.getElementById(\'loadingOverlay\').classList.add(\'active\');\n                    break;\n                case \'loadingEnd\':\n                    document.getElementById(\'loadingOverlay\').classList.remove(\'active\');\n                    break;\n                case \'marketStatusUpdated\':\n                    updateMarketStatus(message.data);\n                    break;\n                case \'mainlinesUpdated\':\n                    updateMainlines(message.data);\n                    break;\n                case \'factorsUpdated\':\n                    updateFactors(message.data);\n                    break;\n                    \n                // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n                case \'stepStarted\':\n                    setStepStatus(message.step, \'running\');\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - æ‰§è¡Œä¸­\';\n                    document.getElementById(\'result-summary\').textContent = \'æ­£åœ¨æ‰§è¡Œ \' + message.stepName + \'...\';\n                    document.getElementById(\'result-details\').innerHTML = \'\';\n                    showProgress(true, 30, \'æ‰§è¡Œä¸­...\');\n                    break;\n                    \n                case \'stepResult\':\n                    setStepStatus(message.step, message.success ? \'completed\' : \'failed\');\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - \' + (message.success ? \'âœ… å®Œæˆ\' : \'âŒ å¤±è´¥\');\n                    document.getElementById(\'result-summary\').textContent = message.summary || (message.success ? \'æ‰§è¡ŒæˆåŠŸ\' : \'æ‰§è¡Œå¤±è´¥\');\n                    document.getElementById(\'result-details\').innerHTML = formatDetails(message.details);\n                    break;\n                \n                // ä¸€é”®æ‰§è¡Œå…¨éƒ¨å·¥ä½œæµçš„æ¶ˆæ¯å¤„ç†\n                case \'workflowProgress\':\n                    var data = message.data;\n                    if (data.currentStep) {\n                        setStepStatus(data.currentStep, \'running\');\n                    }\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ”„ æ‰§è¡Œå·¥ä½œæµ - \' + data.stepName;\n                    document.getElementById(\'result-summary\').textContent = \'è¿›åº¦: \' + Math.round(data.progress) + \'%\';\n                    showProgress(true, data.progress, data.stepName);\n                    break;\n                    \n                case \'workflowStepResult\':\n                    var stepData = message.data;\n                    if (stepData.stepId) {\n                        setStepStatus(stepData.stepId, stepData.success ? \'completed\' : \'failed\');\n                    }\n                    // ç´¯åŠ æ˜¾ç¤ºç»“æœ\n                    var detailsEl = document.getElementById(\'result-details\');\n                    var stepHtml = \'<div style="margin:8px 0;padding:8px;background:var(--bg-card);border-radius:6px;border-left:3px solid \' + \n                        (stepData.success ? \'#10b981\' : \'#ef4444\') + \';">\';\n                    stepHtml += \'<strong>\' + stepData.stepName + \'</strong>: \' + (stepData.success ? \'âœ…\' : \'âŒ\');\n                    stepHtml += \'</div>\';\n                    detailsEl.innerHTML += stepHtml;\n                    break;\n                    \n                case \'workflowComplete\':\n                    var completeData = message.data;\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = completeData.hasError ? \'âš ï¸ å·¥ä½œæµå®Œæˆï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰\' : \'âœ… å·¥ä½œæµæ‰§è¡Œå®Œæˆ\';\n                    document.getElementById(\'result-summary\').textContent = \'å…±æ‰§è¡Œ \' + completeData.results.length + \' ä¸ªæ­¥éª¤\';\n                    \n                    // æ˜¾ç¤ºæ±‡æ€»\n                    var summaryHtml = \'<div style="margin-top:16px;">\';\n                    summaryHtml += \'<h4 style="color:var(--accent-gold);margin-bottom:8px;">æ‰§è¡Œç»“æœæ±‡æ€»</h4>\';\n                    completeData.results.forEach(function(r) {\n                        summaryHtml += \'<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">\';\n                        summaryHtml += \'<span>\' + (r.success ? \'âœ…\' : \'âŒ\') + \'</span>\';\n                        summaryHtml += \'<span>\' + r.step + \'</span>\';\n                        if (r.error) {\n                            summaryHtml += \'<span style="color:#ef4444;font-size:11px;">(\' + r.error + \')</span>\';\n                        }\n                        summaryHtml += \'</div>\';\n                    });\n                    summaryHtml += \'</div>\';\n                    document.getElementById(\'result-details\').innerHTML += summaryHtml;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>'}dispose(){for(g.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.MainDashboard=g},238:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.generateStrategy=async function(n,e){c.logger.info("æ‰§è¡Œç”Ÿæˆç­–ç•¥å‘½ä»¤",l);try{const e=await async function(){const n=await o.window.showQuickPick(p,{placeHolder:"é€‰æ‹©ç­–ç•¥å¹³å°",title:"Step 1/3: é€‰æ‹©ç›®æ ‡å¹³å°"});return n?.value}();if(!e)return;const t=await async function(){const n=await o.window.showQuickPick(g,{placeHolder:"é€‰æ‹©ç­–ç•¥é£æ ¼",title:"Step 2/3: é€‰æ‹©ç­–ç•¥é£æ ¼"});return n?.value}();if(!t)return;const a=await async function(){const n=await o.window.showQuickPick([{label:"âœ… ä½¿ç”¨é»˜è®¤å‚æ•°",value:"default",description:"æ­¢æŸ8%, æ­¢ç›ˆ20%, å•ç¥¨10%"},{label:"âš™ï¸ è‡ªå®šä¹‰å‚æ•°",value:"custom",description:"æ‰‹åŠ¨é…ç½®é£æ§å‚æ•°"}],{placeHolder:"é£æ§å‚æ•°é…ç½®",title:"Step 3/3: é…ç½®é£æ§å‚æ•°"});if(!n)return;if("default"===n.value)return{max_position:.1,stop_loss:.08,take_profit:.2};const e=await o.window.showInputBox({prompt:"å•ç¥¨æœ€å¤§ä»“ä½ (%)",value:"10",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});if(!e)return;const t=await o.window.showInputBox({prompt:"æ­¢æŸçº¿ (%)",value:"8",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>50?"è¯·è¾“å…¥1-50ä¹‹é—´çš„æ•°å­—":null}});if(!t)return;const a=await o.window.showInputBox({prompt:"æ­¢ç›ˆçº¿ (%)",value:"20",validateInput:n=>{const e=parseFloat(n);return isNaN(e)||e<=0||e>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});return a?{max_position:parseFloat(e)/100,stop_loss:parseFloat(t)/100,take_profit:parseFloat(a)/100}:void 0}();if(!a)return;await async function(n,e,t,a,r){await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(e,i)=>{try{e.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const s=await n.getMarketStatus();if(i.isCancellationRequested)return;e.report({message:"è·å–æ¨èå› å­...",increment:20});const d=await n.recommendFactors({market_regime:s.data?.regime});if(i.isCancellationRequested)return;e.report({message:`ç”Ÿæˆ${t.toUpperCase()}ç­–ç•¥ä»£ç ...`,increment:30});const p=(d.data||[]).slice(0,5).map(n=>n.name),g=await n.generateStrategy({factors:p,style:a,platform:t,risk_params:r});if(e.report({increment:30}),!g.ok||!g.data)return void o.window.showErrorMessage(`ç”Ÿæˆç­–ç•¥å¤±è´¥: ${g.error||"æœªçŸ¥é”™è¯¯"}`);const u=g.data;c.logger.info(`ç­–ç•¥ç”ŸæˆæˆåŠŸ: ${u.name}`,l),e.report({message:"å®Œæˆ",increment:20}),await async function(n,e,t){const a=await o.workspace.openTextDocument({content:e.code,language:"python"});switch(await o.window.showTextDocument(a,o.ViewColumn.One),await o.window.showInformationMessage(`${t.toUpperCase()} ç­–ç•¥ "${e.name}" å·²ç”Ÿæˆ`,"ä¿å­˜æ–‡ä»¶","å¤åˆ¶ä»£ç ","æŸ¥çœ‹è¯´æ˜")){case"ä¿å­˜æ–‡ä»¶":await async function(n,e){const t=`${n.name}.py`,a=await o.window.showSaveDialog({defaultUri:o.Uri.file(t),filters:{Pythonæ–‡ä»¶:["py"]},title:`ä¿å­˜${e.toUpperCase()}ç­–ç•¥`});if(a){await o.workspace.fs.writeFile(a,Buffer.from(n.code,"utf-8"));const e=o.Uri.file(a.fsPath.replace(".py","_meta.json")),t={name:n.name,platform:n.platform,style:n.style,factors:n.factors,risk_params:n.risk_params,created_at:(new Date).toISOString()};await o.workspace.fs.writeFile(e,Buffer.from(JSON.stringify(t,null,2),"utf-8")),o.window.showInformationMessage(`ç­–ç•¥å·²ä¿å­˜: ${a.fsPath}`),c.logger.info(`ç­–ç•¥ä¿å­˜åˆ°: ${a.fsPath}`,l)}}(e,t);break;case"å¤åˆ¶ä»£ç ":await o.env.clipboard.writeText(e.code),o.window.showInformationMessage("ç­–ç•¥ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"æŸ¥çœ‹è¯´æ˜":!function(n){const e=`\n# ç­–ç•¥è¯´æ˜\n\n## åŸºæœ¬ä¿¡æ¯\n- **ç­–ç•¥åç§°**: ${n.name}\n- **ç›®æ ‡å¹³å°**: ${n.platform.toUpperCase()}\n- **ç­–ç•¥é£æ ¼**: ${{multi_factor:"å¤šå› å­é€‰è‚¡",momentum_growth:"åŠ¨é‡æˆé•¿",value:"ä»·å€¼æŠ•èµ„",market_neutral:"å¸‚åœºä¸­æ€§"}[n.style]}\n\n## ä½¿ç”¨å› å­\n${n.factors.map(n=>`- ${n}`).join("\n")}\n\n## é£æ§å‚æ•°\n- **å•ç¥¨æœ€å¤§ä»“ä½**: ${(100*n.risk_params.max_position).toFixed(0)}%\n- **æ­¢æŸçº¿**: ${(100*n.risk_params.stop_loss).toFixed(0)}%\n- **æ­¢ç›ˆçº¿**: ${(100*n.risk_params.take_profit).toFixed(0)}%\n\n## ç­–ç•¥æè¿°\n${n.description}\n\n## ä½¿ç”¨è¯´æ˜\n1. å°†ä»£ç å¤åˆ¶åˆ°${n.platform.toUpperCase()}å®¢æˆ·ç«¯\n2. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è‚¡ç¥¨æ± å’Œå‚æ•°\n3. è¿›è¡Œå›æµ‹éªŒè¯åå†å®ç›˜ä½¿ç”¨\n4. æ³¨æ„é£é™©æ§åˆ¶ï¼Œä¸è¦è¶…è¿‡æ‰¿å—èƒ½åŠ›\n    `;o.workspace.openTextDocument({content:e,language:"markdown"}).then(n=>{o.window.showTextDocument(n,o.ViewColumn.Beside)})}(e)}}(0,u,t)}catch(n){d.ErrorHandler.handle(n,l)}})}(n,0,e,t,a)}catch(n){d.ErrorHandler.handle(n,l)}};const o=s(t(398)),c=t(628),d=t(799),l="GenerateStrategy",p=[{label:"ğŸ“Š PTrade (æ’ç”Ÿ)",value:"ptrade",description:"æ’ç”ŸPTradeå¹³å°ï¼Œæ”¯æŒAè‚¡ã€ETFäº¤æ˜“",detail:"å‡½æ•°: initialize(), handle_data()"},{label:"ğŸ“ˆ QMT (è¿…æŠ•)",value:"qmt",description:"è¿…æŠ•QMTå¹³å°ï¼Œæ”¯æŒè‚¡ç¥¨ã€æœŸè´§äº¤æ˜“",detail:"å‡½æ•°: init(), handlebar()"}],g=[{label:"ğŸ“ˆ å¤šå› å­é€‰è‚¡",value:"multi_factor",description:"ç»¼åˆå¤šä¸ªå› å­è¯„åˆ†é€‰è‚¡",detail:"é€‚åˆ: å„ç§å¸‚åœºç¯å¢ƒ"},{label:"ğŸš€ åŠ¨é‡æˆé•¿",value:"momentum_growth",description:"è¿½é€å¼ºåŠ¿æˆé•¿è‚¡",detail:"é€‚åˆ: ç‰›å¸‚ã€é£é™©åå¥½ä¸Šå‡"},{label:"ğŸ’° ä»·å€¼æŠ•èµ„",value:"value",description:"ä½ä¼°å€¼é«˜åˆ†çº¢æ ‡çš„",detail:"é€‚åˆ: ç†Šå¸‚ã€é£é™©åå¥½ä¸‹é™"},{label:"âš–ï¸ å¸‚åœºä¸­æ€§",value:"market_neutral",description:"å¤šç©ºå¯¹å†²ç­–ç•¥",detail:"é€‚åˆ: éœ‡è¡å¸‚ã€ä¸ç¡®å®šç¯å¢ƒ"}]},265:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.activate=async function(n){f.logger.info("TRQuant Extension æ­£åœ¨æ¿€æ´»...",x);const e=Date.now();try{const a=h.ConfigManager.getInstance();n.subscriptions.push({dispose:()=>a.dispose()}),w=new c.TRQuantClient(n),n.subscriptions.push({dispose:()=>w.dispose()}),y=function(){const n=o.window.createStatusBarItem(o.StatusBarAlignment.Right,100);return n.text="$(graph) TRQuant",n.tooltip="TRQuant é‡åŒ–åŠ©æ‰‹ - ç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿",n.command="trquant.showPanel",n.show(),n}(),n.subscriptions.push(y),function(n){const e=[{id:"trquant.getMarketStatus",handler:()=>(0,l.getMarketStatus)(w,n)},{id:"trquant.getMainlines",handler:()=>(0,p.getMainlines)(w,n)},{id:"trquant.recommendFactors",handler:()=>(0,g.recommendFactors)(w,n)},{id:"trquant.generateStrategy",handler:()=>(0,u.generateStrategy)(w,n)},{id:"trquant.analyzeBacktest",handler:()=>(0,m.analyzeBacktest)(w,n)},{id:"trquant.enableMCP",handler:async()=>{await k(n),o.window.showInformationMessage("TRQuant MCP Server å·²å¯ç”¨")}},{id:"trquant.showPanel",handler:async()=>{v.MarketPanel.createOrShow(n.extensionUri,w)}},{id:"trquant.openWorkbench",handler:async()=>{const{WorkbenchPanel:e}=await Promise.resolve().then(()=>s(t(4)));e.createOrShow(n.extensionUri,w)}},{id:"trquant.showLogs",handler:async()=>{f.logger.show()}},{id:"trquant.refreshStatus",handler:async()=>{await _(),o.window.showInformationMessage("çŠ¶æ€å·²åˆ·æ–°")}}];for(const{id:t,handler:a}of e){const e=o.commands.registerCommand(t,async()=>{f.logger.debug(`æ‰§è¡Œå‘½ä»¤: ${t}`,x),await b.ErrorHandler.wrap(a,t)});n.subscriptions.push(e)}f.logger.info(`å·²æ³¨å†Œ ${e.length} ä¸ªå‘½ä»¤`,x)}(n);try{const{registerMainDashboard:e}=await Promise.resolve().then(()=>s(t(126)));e(n,w)}catch(n){f.logger.debug("ä¸»å·¥ä½œå°æ¨¡å—æœªæ‰¾åˆ°ï¼Œè·³è¿‡æ³¨å†Œ",x)}try{const{registerWorkbenchPanel:e}=await Promise.resolve().then(()=>s(t(4)));e(n,w),f.logger.info("é‡åŒ–å·¥ä½œå°å‘½ä»¤å·²æ³¨å†Œ: trquant.openWorkbench",x)}catch(n){f.logger.error(`æ³¨å†Œé‡åŒ–å·¥ä½œå°å¤±è´¥: ${n}`,x),console.error("[Extension] æ³¨å†Œé‡åŒ–å·¥ä½œå°å¤±è´¥:",n)}h.config.get("mcpEnabled")&&await k(n),_();const r=Date.now()-e;f.logger.info(`TRQuant Extension æ¿€æ´»å®Œæˆ (${r}ms)`,x),function(n){const e="trquant.welcomeShown";n.globalState.get(e)||o.window.showInformationMessage('æ¬¢è¿ä½¿ç”¨ TRQuant é‡åŒ–åŠ©æ‰‹ï¼æŒ‰ Ctrl+Shift+P è¾“å…¥ "TRQuant" æŸ¥çœ‹å¯ç”¨å‘½ä»¤ã€‚',"æŸ¥çœ‹å‘½ä»¤","ä¸å†æ˜¾ç¤º").then(t=>{"æŸ¥çœ‹å‘½ä»¤"===t?o.commands.executeCommand("workbench.action.quickOpen",">TRQuant"):"ä¸å†æ˜¾ç¤º"===t&&n.globalState.update(e,!0)})}(n)}catch(n){throw b.ErrorHandler.handle(n,x),n}},e.deactivate=function(){f.logger.info("TRQuant Extension æ­£åœ¨åœç”¨...",x),w&&w.dispose(),f.logger.dispose()};const o=s(t(398)),c=t(3),d=t(334),l=t(501),p=t(327),g=t(405),u=t(238),m=t(900),v=t(395),f=t(628),h=t(478),b=t(799),x="Extension";let w,y;async function k(n){try{await d.MCPRegistrar.registerServer(n),f.logger.info("MCP Server å·²æ³¨å†Œ",x)}catch(n){f.logger.warn(`MCPæ³¨å†Œå¤±è´¥: ${n instanceof Error?n.message:String(n)}`,x)}}async function _(){try{const n=await w.getMarketStatus();if(n.ok&&n.data){const e=n.data.regime,t={risk_on:"ğŸ“ˆ",risk_off:"ğŸ“‰",neutral:"â¡ï¸"}[e]||"ğŸ“Š";y.text=`$(graph) ${t} TRQuant`,y.tooltip=`TRQuant | å¸‚åœº: ${e.toUpperCase()}\nç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿`}}catch(n){f.logger.debug("æ›´æ–°çŠ¶æ€æ å¤±è´¥",x,{error:n})}}},317:n=>{n.exports=require("child_process")},327:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.getMainlines=async function(n,e){c.logger.info("æ‰§è¡Œè·å–æŠ•èµ„ä¸»çº¿å‘½ä»¤",l);const t=await o.window.showQuickPick([{label:"ğŸ“… çŸ­æœŸ (1-5å¤©)",value:"short",description:"é€‚åˆçŸ­çº¿äº¤æ˜“"},{label:"ğŸ“† ä¸­æœŸ (1-4å‘¨)",value:"medium",description:"é€‚åˆæ³¢æ®µæ“ä½œ"},{label:"ğŸ“† é•¿æœŸ (1æœˆ+)",value:"long",description:"é€‚åˆä»·å€¼æŠ•èµ„"}],{placeHolder:"é€‰æ‹©æŠ•èµ„å‘¨æœŸ"});t&&await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(a,r)=>{try{if(a.report({message:"æ­£åœ¨è·å–æŠ•èµ„ä¸»çº¿...",increment:0}),r.isCancellationRequested)return void c.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",l);const i=await n.getMainlines({top_n:20,time_horizon:t.value});if(a.report({increment:60}),!i.ok||!i.data)return void o.window.showErrorMessage(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${i.error||"æœªçŸ¥é”™è¯¯"}`);const s=i.data;c.logger.info(`è·å–åˆ° ${s.length} æ¡æŠ•èµ„ä¸»çº¿`,l),a.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(n,e,t){const a=o.window.createWebviewPanel("trquantMainlines","ğŸ¯ æŠ•èµ„ä¸»çº¿",o.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(n,e){const t=n.length>0?n.map((n,e)=>function(n,e){const t=e<3?`rank-${e+1}`:"rank-default",a=Math.min(100*n.score,100);return`\n        <div class="mainline-card" onclick="selectMainline('${n.name}')">\n            <div class="mainline-header">\n                <div class="mainline-rank">\n                    <div class="rank-badge ${t}">${e+1}</div>\n                    <span class="mainline-name">${n.name}</span>\n                </div>\n                <div class="mainline-score">\n                    <div class="score-bar">\n                        <div class="score-fill" style="width: ${a}%"></div>\n                    </div>\n                    <span class="score-value">${n.score.toFixed(2)}</span>\n                </div>\n            </div>\n            <div class="mainline-industries">\n                ${n.industries.map(n=>`<span class="industry-tag">${n}</span>`).join("")}\n            </div>\n            <div class="mainline-logic">\n                ğŸ’¡ ${n.logic||"æš‚æ— è¯¦ç»†è¯´æ˜"}\n            </div>\n        </div>\n    `}(n,e)).join(""):'<div class="empty-state">æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div>';return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>æŠ•èµ„ä¸»çº¿</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n            --gold: #fbbf24;\n            --silver: #94a3b8;\n            --bronze: #b45309;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .time-badge {\n            background: var(--primary);\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .stats-row {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .stat-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .stat-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .stat-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .mainlines-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n\n        .mainline-card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .mainline-card:hover {\n            border-color: var(--primary);\n            transform: translateY(-2px);\n        }\n\n        .mainline-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n\n        .mainline-rank {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n\n        .rank-badge {\n            width: 32px;\n            height: 32px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 700;\n            font-size: 14px;\n        }\n\n        .rank-1 { background: var(--gold); color: #1a1a2e; }\n        .rank-2 { background: var(--silver); color: #1a1a2e; }\n        .rank-3 { background: var(--bronze); color: white; }\n        .rank-default { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .mainline-name {\n            font-size: 18px;\n            font-weight: 600;\n        }\n\n        .mainline-score {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .score-bar {\n            width: 100px;\n            height: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .score-fill {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--success));\n            border-radius: 4px;\n        }\n\n        .score-value {\n            font-weight: 600;\n            color: var(--success);\n            min-width: 50px;\n            text-align: right;\n        }\n\n        .mainline-industries {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-bottom: 12px;\n        }\n\n        .industry-tag {\n            background: var(--bg-tertiary);\n            color: var(--text-secondary);\n            padding: 4px 12px;\n            border-radius: 16px;\n            font-size: 12px;\n        }\n\n        .mainline-logic {\n            color: var(--text-secondary);\n            font-size: 14px;\n            line-height: 1.6;\n            padding-left: 16px;\n            border-left: 3px solid var(--primary);\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n            padding-top: 24px;\n            border-top: 1px solid var(--border);\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-muted);\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ¯</span>\n            <div>\n                <div class="header-title">æŠ•èµ„ä¸»çº¿ TOP ${n.length}</div>\n                <div class="header-subtitle">åŸºäºå¸‚åœºçƒ­åº¦ã€èµ„é‡‘æµå‘ã€è¡Œä¸šæ™¯æ°”åº¦ç»¼åˆè¯„ä¼°</div>\n            </div>\n        </div>\n        <span class="time-badge">${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[e]||e}</span>\n    </div>\n\n    <div class="stats-row">\n        <div class="stat-card">\n            <div class="stat-value">${n.length}</div>\n            <div class="stat-label">ä¸»çº¿æ•°é‡</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${n.length>0?n[0].score.toFixed(2):"-"}</div>\n            <div class="stat-label">æœ€é«˜è¯„åˆ†</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${function(n){const e=new Set;return n.forEach(n=>n.industries.forEach(n=>e.add(n))),e.size}(n)}</div>\n            <div class="stat-label">æ¶‰åŠè¡Œä¸š</div>\n        </div>\n    </div>\n\n    <div class="mainlines-list">\n        ${t}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ åŸºäºä¸»çº¿ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function selectMainline(mainline) {\n            vscode.postMessage({ command: 'selectMainline', mainline });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ command: 'generateStrategy' });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(e,t),a.webview.onDidReceiveMessage(async n=>{switch(n.command){case"selectMainline":a=n.mainline,o.window.showInformationMessage(`å·²é€‰æ‹©ä¸»çº¿: ${a}`,"æŸ¥çœ‹è¯¦æƒ…","ç­›é€‰è‚¡ç¥¨").then(n=>{"æŸ¥çœ‹è¯¦æƒ…"===n?c.logger.info(`æŸ¥çœ‹ä¸»çº¿è¯¦æƒ…: ${a}`,l):"ç­›é€‰è‚¡ç¥¨"===n&&c.logger.info(`åŸºäºä¸»çº¿ç­›é€‰è‚¡ç¥¨: ${a}`,l)});break;case"generateStrategy":o.commands.executeCommand("trquant.generateStrategy");break;case"copyPrompt":const r=p(e,t);await o.env.clipboard.writeText(r),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}var a},void 0,n.subscriptions)}(e,s,t.value),a.report({increment:20}),async function(n){if(0!==n.length)switch(await o.window.showInformationMessage(`è·å–åˆ° ${n.length} æ¡æŠ•èµ„ä¸»çº¿`,"ç”Ÿæˆç­–ç•¥","æ¨èå› å­","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":o.commands.executeCommand("trquant.generateStrategy");break;case"æ¨èå› å­":o.commands.executeCommand("trquant.recommendFactors");break;case"å¤åˆ¶Prompt":const e=p(n,"short");await o.env.clipboard.writeText(e),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}}(s)}catch(n){d.ErrorHandler.handle(n,l)}})};const o=s(t(398)),c=t(628),d=t(799),l="GetMainlines";function p(n,e){return`# Aè‚¡æŠ•èµ„ä¸»çº¿åˆ†æ\n\n## åˆ†æå‘¨æœŸ: ${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[e]||e}\n\n## TOP ${n.length} æŠ•èµ„ä¸»çº¿\n\n${n.map((n,e)=>`\n### ${e+1}. ${n.name} (è¯„åˆ†: ${n.score.toFixed(2)})\n- **ç›¸å…³è¡Œä¸š**: ${n.industries.join(", ")}\n- **æŠ•èµ„é€»è¾‘**: ${n.logic||"æš‚æ— "}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸ŠæŠ•èµ„ä¸»çº¿ï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå½“å‰æœ€å€¼å¾—å…³æ³¨çš„ä¸»çº¿åŠå…¶åŸå› \n2. æ¨èé€‚åˆè¿™äº›ä¸»çº¿çš„é‡åŒ–å› å­\n3. ç”Ÿæˆé’ˆå¯¹TOP3ä¸»çº¿çš„PTradeé‡åŒ–ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- ç­–ç•¥åº”è¯¥èšç„¦äºä¸»çº¿ç›¸å…³çš„è‚¡ç¥¨æ± \n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n- æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},334:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MCPRegistrar=void 0;const o=s(t(398)),c=s(t(928)),d=s(t(896));e.MCPRegistrar=class{static async registerServer(n){const e=n.extensionPath,t=c.join(e,"python","mcp_server.py");if(!d.existsSync(t))throw new Error(`MCP Serveræ–‡ä»¶ä¸å­˜åœ¨: ${t}`);const a=o.workspace.getConfiguration("trquant").get("pythonPath")||"python";try{if(o.cursor?.mcp?.registerServer)return await o.cursor.mcp.registerServer({name:"trquant",command:a,args:[t],env:{PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(e)}}),void console.log("TRQuant MCP Server registered via Cursor API")}catch(n){console.log("Cursor MCP API not available, using fallback")}await this.writeConfigFile(n,a,t)}static async writeConfigFile(n,e,t){const a=o.workspace.workspaceFolders;if(!a||0===a.length)throw new Error("æ²¡æœ‰æ‰“å¼€çš„å·¥ä½œåŒº");const r=a[0].uri.fsPath,i=c.join(r,".cursor"),s=c.join(i,"mcp.json");d.existsSync(i)||d.mkdirSync(i,{recursive:!0});let l={mcpServers:{}};if(d.existsSync(s))try{l=JSON.parse(d.readFileSync(s,"utf-8"))}catch(n){}l.mcpServers=l.mcpServers||{},l.mcpServers.trquant={command:e,args:[t],env:{PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(n.extensionPath)}},d.writeFileSync(s,JSON.stringify(l,null,2)),console.log(`MCP config written to ${s}`)}static async unregisterServer(n){try{o.cursor?.mcp?.unregisterServer&&await o.cursor.mcp.unregisterServer("trquant")}catch(n){}}}},395:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.MarketPanel=void 0;const o=s(t(398));class c{static currentPanel;_panel;_extensionUri;_client;_disposables=[];constructor(n,e,t){this._panel=n,this._extensionUri=e,this._client=t,this._update(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(async n=>{switch(n.command){case"refresh":await this._update();break;case"getMarketStatus":await o.commands.executeCommand("trquant.getMarketStatus");break;case"getMainlines":await o.commands.executeCommand("trquant.getMainlines");break;case"generateStrategy":await o.commands.executeCommand("trquant.generateStrategy")}},null,this._disposables)}static createOrShow(n,e){const t=o.ViewColumn.Beside;if(c.currentPanel)return void c.currentPanel._panel.reveal(t);const a=o.window.createWebviewPanel("trquantPanel","TRQuant æ§åˆ¶å°",t,{enableScripts:!0,retainContextWhenHidden:!0});c.currentPanel=new c(a,n,e)}async _update(){this._panel.webview.html=await this._getHtmlContent()}async _getHtmlContent(){let n=null,e=null;try{const t=await this._client.getMarketStatus();t.ok&&(n=t.data);const a=await this._client.getMainlines({top_n:5});a.ok&&(e=a.data)}catch(n){}const t="risk_on"===n?.regime?"#10b981":"risk_off"===n?.regime?"#ef4444":"#f59e0b";return`<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <style>\n        body {\n            font-family: 'Segoe UI', sans-serif;\n            background: #1a1a2e;\n            color: #fff;\n            padding: 20px;\n            margin: 0;\n        }\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid #333;\n        }\n        .logo {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        .logo-icon { font-size: 32px; }\n        .logo-text {\n            font-size: 20px;\n            font-weight: bold;\n        }\n        .refresh-btn {\n            background: #333;\n            border: none;\n            color: #fff;\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n        }\n        .refresh-btn:hover { background: #444; }\n\n        .status-card {\n            background: linear-gradient(135deg, ${t}22, ${t}11);\n            border: 1px solid ${t}44;\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .status-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .status-regime {\n            font-size: 24px;\n            font-weight: bold;\n        }\n        .status-badge {\n            background: ${t};\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n        .status-summary {\n            margin-top: 12px;\n            color: #d1d5db;\n            line-height: 1.6;\n        }\n\n        .section {\n            background: #252540;\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 16px;\n        }\n        .section-title {\n            font-size: 14px;\n            color: #9ca3af;\n            margin-bottom: 12px;\n        }\n\n        .mainline-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px 0;\n            border-bottom: 1px solid #333;\n        }\n        .mainline-item:last-child { border: none; }\n\n        .actions {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n            margin-top: 20px;\n        }\n        .action-btn {\n            background: #667eea;\n            border: none;\n            color: #fff;\n            padding: 14px;\n            border-radius: 10px;\n            cursor: pointer;\n            font-size: 14px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n        .action-btn:hover { background: #5a6fd6; }\n        .action-btn.primary { background: #10b981; }\n        .action-btn.primary:hover { background: #059669; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="logo">\n            <span class="logo-icon">ğŸ“Š</span>\n            <span class="logo-text">TRQuant æ§åˆ¶å°</span>\n        </div>\n        <button class="refresh-btn" onclick="refresh()">ğŸ”„ åˆ·æ–°</button>\n    </div>\n\n    <div class="status-card">\n        <div class="status-header">\n            <span class="status-regime">\n                ${"risk_on"===n?.regime?"ğŸ“ˆ é£é™©åå¥½ä¸Šå‡":"risk_off"===n?.regime?"ğŸ“‰ é£é™©åå¥½ä¸‹é™":"â¡ï¸ éœ‡è¡å¸‚åœº"}\n            </span>\n            <span class="status-badge">${(n?.regime||"UNKNOWN").toUpperCase()}</span>\n        </div>\n        <div class="status-summary">\n            ${n?.summary||"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€..."}\n        </div>\n    </div>\n\n    ${e?`\n    <div class="section">\n        <div class="section-title">ğŸ¯ çƒ­é—¨ä¸»çº¿ TOP 5</div>\n        ${e.slice(0,5).map((n,e)=>`\n            <div class="mainline-item">\n                <span>${e+1}. ${n.name}</span>\n                <span style="color: #667eea">${n.score?.toFixed(2)}</span>\n            </div>\n        `).join("")}\n    </div>\n    `:""}\n\n    <div class="actions">\n        <button class="action-btn" onclick="getMarketStatus()">\n            ğŸ“Š å¸‚åœºçŠ¶æ€\n        </button>\n        <button class="action-btn" onclick="getMainlines()">\n            ğŸ¯ æŠ•èµ„ä¸»çº¿\n        </button>\n        <button class="action-btn" onclick="recommendFactors()">\n            ğŸ“ˆ å› å­æ¨è\n        </button>\n        <button class="action-btn primary" onclick="generateStrategy()">\n            ğŸš€ ç”Ÿæˆç­–ç•¥\n        </button>\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        function refresh() { vscode.postMessage({ command: 'refresh' }); }\n        function getMarketStatus() { vscode.postMessage({ command: 'getMarketStatus' }); }\n        function getMainlines() { vscode.postMessage({ command: 'getMainlines' }); }\n        function recommendFactors() { vscode.postMessage({ command: 'recommendFactors' }); }\n        function generateStrategy() { vscode.postMessage({ command: 'generateStrategy' }); }\n    <\/script>\n</body>\n</html>`}dispose(){for(c.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const n=this._disposables.pop();n&&n.dispose()}}}e.MarketPanel=c},398:n=>{n.exports=require("vscode")},405:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.recommendFactors=async function(n,e){c.logger.info("æ‰§è¡Œæ¨èå› å­å‘½ä»¤",l),await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{t.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const r=await n.getMarketStatus(),i=r.data?.regime||"neutral";if(a.isCancellationRequested)return;t.report({message:"æ¨èå› å­...",increment:30});const s=await n.recommendFactors({market_regime:i,top_n:15});if(t.report({increment:40}),!s.ok||!s.data)return void o.window.showErrorMessage(`è·å–å› å­æ¨èå¤±è´¥: ${s.error||"æœªçŸ¥é”™è¯¯"}`);const d=s.data;c.logger.info(`æ¨è ${d.length} ä¸ªå› å­`,l),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(n,e,t){const a=o.window.createWebviewPanel("trquantFactors","ğŸ“ˆ å› å­æ¨è",o.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(n,e){const t=g(e),a=p(n),r=Object.entries(a).map(([n,e])=>function(n,e){const t=e.map(n=>function(n){const e=n.weight>.7?"weight-high":n.weight>.4?"weight-medium":"weight-low";return`\n        <div class="factor-card" data-factor="${n.name}" onclick="toggleFactor('${n.name}', this)">\n            <div class="factor-header">\n                <span class="factor-name">${n.name}</span>\n                <span class="factor-weight ${e}">${(100*n.weight).toFixed(0)}%</span>\n            </div>\n            <div class="factor-reason">${n.reason||"åŸºäºå†å²è¡¨ç°æ¨è"}</div>\n        </div>\n    `}(n)).join("");return`\n        <div class="category-section">\n            <div class="category-title">${function(n){return{ç›ˆåˆ©èƒ½åŠ›:"ğŸ’°",æˆé•¿æ€§:"ğŸš€",ä¼°å€¼:"ğŸ“Š",åŠ¨é‡:"âš¡",æµåŠ¨æ€§:"ğŸ’§",æ³¢åŠ¨ç‡:"ğŸ“ˆ",è´¨é‡:"âœ¨",å…¶ä»–:"ğŸ“‹"}[n]||"ğŸ“‹"}(n)} ${n}</div>\n            <div class="factors-grid">\n                ${t}\n            </div>\n        </div>\n    `}(n,e)).join("");return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å› å­æ¨è</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${t.color};\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .info-card {\n            background: linear-gradient(135deg, ${t.color}22, ${t.color}11);\n            border-left: 4px solid ${t.color};\n            border-radius: 12px;\n            padding: 16px 20px;\n            margin-bottom: 24px;\n        }\n\n        .info-card p {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .category-section {\n            margin-bottom: 24px;\n        }\n\n        .category-title {\n            font-size: 15px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .category-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .factors-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n            gap: 12px;\n        }\n\n        .factor-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .factor-card:hover {\n            border-color: var(--primary);\n        }\n\n        .factor-card.selected {\n            border-color: var(--success);\n            background: var(--success)11;\n        }\n\n        .factor-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 8px;\n        }\n\n        .factor-name {\n            font-weight: 600;\n            font-size: 15px;\n        }\n\n        .factor-weight {\n            background: var(--bg-tertiary);\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 13px;\n            font-weight: 600;\n        }\n\n        .weight-high { background: var(--success); color: white; }\n        .weight-medium { background: var(--warning); color: #1a1a2e; }\n        .weight-low { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .factor-reason {\n            color: var(--text-secondary);\n            font-size: 13px;\n            line-height: 1.5;\n        }\n\n        .selected-factors {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 24px;\n            border: 1px solid var(--border);\n        }\n\n        .selected-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n\n        .selected-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n        }\n\n        .selected-tag {\n            background: var(--primary);\n            color: white;\n            padding: 6px 12px;\n            border-radius: 16px;\n            font-size: 13px;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .selected-tag .remove {\n            cursor: pointer;\n            opacity: 0.7;\n        }\n\n        .selected-tag .remove:hover { opacity: 1; }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ“ˆ</span>\n            <div>\n                <div class="header-title">å› å­æ¨è</div>\n                <div class="header-subtitle">åŸºäºå½“å‰å¸‚åœºçŠ¶æ€çš„æ™ºèƒ½å› å­æ¨è</div>\n            </div>\n        </div>\n        <span class="regime-badge">å¸‚åœº: ${e.toUpperCase()}</span>\n    </div>\n\n    <div class="info-card">\n        <p>${t.factorAdvice}</p>\n    </div>\n\n    <div class="selected-factors" id="selectedFactors">\n        <div class="selected-title">å·²é€‰å› å­ (ç‚¹å‡»å¡ç‰‡æ·»åŠ /ç§»é™¤)</div>\n        <div class="selected-list" id="selectedList"></div>\n    </div>\n\n    ${r}\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ ä½¿ç”¨é€‰ä¸­å› å­ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        const selectedFactors = new Set();\n        \n        // é»˜è®¤é€‰ä¸­å‰5ä¸ªå› å­\n        const defaultFactors = ${JSON.stringify(n.slice(0,5).map(n=>n.name))};\n        defaultFactors.forEach(f => selectedFactors.add(f));\n        updateSelectedDisplay();\n        \n        function toggleFactor(name, element) {\n            if (selectedFactors.has(name)) {\n                selectedFactors.delete(name);\n                element.classList.remove('selected');\n            } else {\n                selectedFactors.add(name);\n                element.classList.add('selected');\n            }\n            updateSelectedDisplay();\n        }\n        \n        function removeFactor(name) {\n            selectedFactors.delete(name);\n            const card = document.querySelector(\`[data-factor="\${name}"]\`);\n            if (card) card.classList.remove('selected');\n            updateSelectedDisplay();\n        }\n        \n        function updateSelectedDisplay() {\n            const list = document.getElementById('selectedList');\n            list.innerHTML = Array.from(selectedFactors).map(f => \n                \`<span class="selected-tag">\n                    \${f}\n                    <span class="remove" onclick="removeFactor('\${f}')">Ã—</span>\n                </span>\`\n            ).join('');\n            \n            // æ›´æ–°å¡ç‰‡çŠ¶æ€\n            document.querySelectorAll('.factor-card').forEach(card => {\n                const factorName = card.getAttribute('data-factor');\n                if (selectedFactors.has(factorName)) {\n                    card.classList.add('selected');\n                }\n            });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ \n                command: 'generateStrategy',\n                factors: Array.from(selectedFactors)\n            });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(e,t),a.webview.onDidReceiveMessage(async n=>{switch(n.command){case"generateStrategy":!function(n){c.logger.info(`ä½¿ç”¨å› å­ç”Ÿæˆç­–ç•¥: ${n.join(", ")}`,l),o.commands.executeCommand("trquant.generateStrategy")}(n.factors||e.slice(0,5).map(n=>n.name));break;case"copyPrompt":const a=u(e,t);await o.env.clipboard.writeText(a),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}},void 0,n.subscriptions)}(e,d,i),t.report({increment:10}),async function(n){if(0!==n.length)switch(await o.window.showInformationMessage(`æ¨è ${n.length} ä¸ªå› å­`,"ç”Ÿæˆç­–ç•¥","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":o.commands.executeCommand("trquant.generateStrategy");break;case"å¤åˆ¶Prompt":const e=u(n,"neutral");await o.env.clipboard.writeText(e),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}}(d)}catch(n){d.ErrorHandler.handle(n,l)}})};const o=s(t(398)),c=t(628),d=t(799),l="RecommendFactors";function p(n){const e={};for(const t of n){const n=t.category||"å…¶ä»–";e[n]||(e[n]=[]),e[n].push(t)}return e}function g(n){const e={risk_on:{color:"#10b981",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œå»ºè®®ä¾§é‡æˆé•¿æ€§å’ŒåŠ¨é‡å› å­ã€‚é«˜Betaã€é«˜æˆé•¿çš„è‚¡ç¥¨å¯èƒ½è¡¨ç°æ›´å¥½ã€‚"},risk_off:{color:"#ef4444",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®ä¾§é‡ä»·å€¼å’Œè´¨é‡å› å­ã€‚ä½æ³¢åŠ¨ã€é«˜åˆ†çº¢çš„è‚¡ç¥¨å¯èƒ½æ›´ç¨³å¥ã€‚"},neutral:{color:"#f59e0b",factorAdvice:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®å„ç±»å› å­ã€‚å¯ä»¥è€ƒè™‘å¸‚åœºä¸­æ€§ç­–ç•¥é™ä½æ–¹å‘æ€§é£é™©ã€‚"}};return e[n]||e.neutral}function u(n,e){const t=p(n);return`# é‡åŒ–å› å­æ¨è\n\n## å¸‚åœºçŠ¶æ€: ${e.toUpperCase()}\n\n${g(e).factorAdvice}\n\n## æ¨èå› å­åˆ—è¡¨\n\n${Object.entries(t).map(([n,e])=>`\n### ${n}\n${e.map(n=>`- **${n.name}** (æƒé‡: ${(100*n.weight).toFixed(0)}%): ${n.reason||""}`).join("\n")}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸Šå› å­æ¨èï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå„å› å­åœ¨å½“å‰å¸‚åœºç¯å¢ƒä¸‹çš„æœ‰æ•ˆæ€§\n2. è®¾è®¡å› å­åˆæˆæ–¹æ¡ˆï¼ˆæƒé‡åˆ†é…ï¼‰\n3. ç”Ÿæˆä½¿ç”¨è¿™äº›å› å­çš„PTradeå¤šå› å­ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- å› å­éœ€è¦è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼ˆZ-scoreï¼‰\n- è€ƒè™‘å› å­é—´çš„ç›¸å…³æ€§\n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n`}},478:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.config=e.ConfigManager=void 0;const o=s(t(398)),c=s(t(928)),d=s(t(857)),l={pythonPath:"win32"===d.platform()?"python":"python3",serverHost:"127.0.0.1",serverPort:5e3,timeout:6e4,mcpEnabled:!0,mcpPort:5001,autoRefresh:!1,refreshInterval:3e5,defaultPlatform:"ptrade",defaultStyle:"multi_factor",defaultRiskParams:{maxPosition:.1,stopLoss:.08,takeProfit:.2}};class p{static instance;config;disposables=[];constructor(){this.config=this.loadConfig(),this.disposables.push(o.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("trquant")&&(this.config=this.loadConfig())}))}static getInstance(){return p.instance||(p.instance=new p),p.instance}loadConfig(){const n=o.workspace.getConfiguration("trquant");return{pythonPath:n.get("pythonPath")||l.pythonPath,serverHost:n.get("serverHost")||l.serverHost,serverPort:n.get("serverPort")||l.serverPort,timeout:n.get("timeout")||l.timeout,mcpEnabled:n.get("mcpEnabled")??l.mcpEnabled,mcpPort:n.get("mcpPort")||l.mcpPort,autoRefresh:n.get("autoRefresh")??l.autoRefresh,refreshInterval:n.get("refreshInterval")||l.refreshInterval,defaultPlatform:n.get("defaultPlatform")||l.defaultPlatform,defaultStyle:n.get("defaultStyle")||l.defaultStyle,defaultRiskParams:{maxPosition:n.get("defaultMaxPosition")||l.defaultRiskParams.maxPosition,stopLoss:n.get("defaultStopLoss")||l.defaultRiskParams.stopLoss,takeProfit:n.get("defaultTakeProfit")||l.defaultRiskParams.takeProfit}}}getConfig(){return{...this.config}}get(n){return this.config[n]}async set(n,e,t=o.ConfigurationTarget.Global){const a=o.workspace.getConfiguration("trquant");await a.update(n,e,t)}getPythonPath(n){const e=this.config.pythonPath;if(c.isAbsolute(e))return e;const t=c.join(n,"..","venv");return"win32"===d.platform()?c.join(t,"Scripts","python.exe"):c.join(t,"bin","python")}dispose(){this.disposables.forEach(n=>n.dispose())}}e.ConfigManager=p,e.config=p.getInstance()},501:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.getMarketStatus=async function(n,e){c.logger.info("æ‰§è¡Œè·å–å¸‚åœºçŠ¶æ€å‘½ä»¤",l),await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{if(t.report({message:"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€...",increment:0}),a.isCancellationRequested)return void c.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",l);const r=await n.getMarketStatus({universe:"CN_EQ",as_of:(new Date).toISOString().split("T")[0]});if(t.report({increment:50}),!r.ok||!r.data)return void o.window.showErrorMessage(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${r.error||"æœªçŸ¥é”™è¯¯"}`);const i=r.data;c.logger.info(`å¸‚åœºçŠ¶æ€: ${i.regime}`,l),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:30}),function(n,e){const t=o.window.createWebviewPanel("trquantMarketStatus","ğŸ“Š å¸‚åœºçŠ¶æ€",o.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});t.webview.html=function(n){const e=p(n.regime),t=function(n){const e={SH000300:"æ²ªæ·±300",SZ399006:"åˆ›ä¸šæ¿æŒ‡",SH000016:"ä¸Šè¯50",SZ399905:"ä¸­è¯500"};return Object.entries(n).map(([n,t])=>{const a=e[n]||n,r="up"===t.trend?"â†‘":"down"===t.trend?"â†“":"â†’";return`\n                <div class="trend-item">\n                    <span class="trend-name">${a}</span>\n                    <div class="trend-value">\n                        <span class="trend-direction ${t.zscore>0?"positive":t.zscore<0?"negative":"neutral"}">${r}</span>\n                        <span class="zscore">(${t.zscore>=0?"+":""}${t.zscore.toFixed(2)})</span>\n                    </div>\n                </div>\n            `}).join("")}(n.index_trend),a=function(n){const e={growth:"æˆé•¿",value:"ä»·å€¼",momentum:"åŠ¨é‡",quality:"è´¨é‡",size:"å¸‚å€¼"};return n.map(n=>`\n                <div class="style-item">\n                    <span class="style-name">${e[n.style]||n.style}</span>\n                    <span class="style-score ${n.score>0?"positive":n.score<0?"negative":"neutral"}">${n.score>0?"+":""}${n.score.toFixed(2)}</span>\n                </div>\n            `).join("")}(n.style_rotation);return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å¸‚åœºçŠ¶æ€</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-content { flex: 1; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${e.color};\n            color: white;\n            padding: 8px 20px;\n            border-radius: 24px;\n            font-weight: 600;\n            font-size: 14px;\n            text-transform: uppercase;\n        }\n\n        .card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .card-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .card-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .trend-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 12px;\n        }\n\n        .trend-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .trend-name {\n            font-weight: 500;\n            font-size: 14px;\n        }\n\n        .trend-value {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .trend-direction {\n            font-size: 18px;\n        }\n\n        .zscore {\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n        .neutral { color: var(--warning); }\n\n        .style-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 12px;\n        }\n\n        .style-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 12px 20px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            flex: 1;\n            min-width: 150px;\n        }\n\n        .style-name { font-weight: 500; }\n\n        .style-score {\n            margin-left: auto;\n            font-weight: 600;\n            font-size: 18px;\n        }\n\n        .summary-card {\n            background: linear-gradient(135deg, ${e.color}22, ${e.color}11);\n            border-left: 4px solid ${e.color};\n        }\n\n        .summary-text {\n            color: var(--text-primary);\n            font-size: 15px;\n            line-height: 1.8;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover {\n            background: #5a6fd6;\n        }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover {\n            background: #3d3d5c;\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <span class="header-icon">${e.icon}</span>\n        <div class="header-content">\n            <div class="header-title">Aè‚¡å¸‚åœºçŠ¶æ€</div>\n            <div class="header-subtitle">åŸºäºå¤šç»´åº¦æŒ‡æ ‡ç»¼åˆåˆ†æ</div>\n        </div>\n        <span class="regime-badge">${n.regime}</span>\n    </div>\n\n    <div class="card summary-card">\n        <div class="card-title">åˆ†æç»“è®º</div>\n        <div class="summary-text">${n.summary||e.description}</div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">æŒ‡æ•°è¶‹åŠ¿</div>\n        <div class="trend-grid">\n            ${t}\n        </div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">é£æ ¼è½®åŠ¨</div>\n        <div class="style-list">\n            ${a}\n        </div>\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n        <button class="btn btn-secondary" onclick="refresh()">\n            ğŸ”„ åˆ·æ–°æ•°æ®\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n        \n        function refresh() {\n            vscode.postMessage({ command: 'refresh' });\n        }\n    <\/script>\n</body>\n</html>`}(e),t.webview.onDidReceiveMessage(async n=>{switch(n.command){case"copyPrompt":const n=g(e);await o.env.clipboard.writeText(n),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"refresh":o.commands.executeCommand("trquant.getMarketStatus"),t.dispose()}},void 0,n.subscriptions)}(e,i),t.report({increment:20}),async function(n){switch(await o.window.showInformationMessage(`å¸‚åœºçŠ¶æ€: ${n.regime.toUpperCase()}`,"å¤åˆ¶Prompt","ç”Ÿæˆç­–ç•¥","æŸ¥çœ‹ä¸»çº¿")){case"å¤åˆ¶Prompt":const e=g(n);await o.env.clipboard.writeText(e),o.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"ç”Ÿæˆç­–ç•¥":o.commands.executeCommand("trquant.generateStrategy");break;case"æŸ¥çœ‹ä¸»çº¿":o.commands.executeCommand("trquant.getMainlines")}}(i)}catch(n){d.ErrorHandler.handle(n,l)}})};const o=s(t(398)),c=t(628),d=t(799),l="GetMarketStatus";function p(n){const e={risk_on:{icon:"ğŸ“ˆ",color:"#10b981",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œé€‚åˆç§¯æé…ç½®æˆé•¿è‚¡å’Œé«˜Betaèµ„äº§ã€‚å»ºè®®å…³æ³¨ç§‘æŠ€ã€æ–°èƒ½æºç­‰é«˜æˆé•¿æ¿å—ã€‚"},risk_off:{icon:"ğŸ“‰",color:"#ef4444",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®é˜²å¾¡æ€§é…ç½®ã€‚å¯å…³æ³¨é«˜åˆ†çº¢ã€ä½æ³¢åŠ¨çš„ä»·å€¼è‚¡ï¼Œé€‚å½“é™ä½ä»“ä½ã€‚"},neutral:{icon:"â¡ï¸",color:"#f59e0b",description:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®ã€‚å¯é‡‡ç”¨å¸‚åœºä¸­æ€§ç­–ç•¥ï¼Œæ§åˆ¶é£é™©æ•å£ã€‚"}};return e[n]||e.neutral}function g(n){const e=p(n.regime);return`# Aè‚¡å¸‚åœºçŠ¶æ€åˆ†æ\n\n## å¸‚åœºRegime: ${n.regime.toUpperCase()}\n${e.description}\n\n## æŒ‡æ•°è¶‹åŠ¿\n${Object.entries(n.index_trend).map(([n,e])=>`- ${n}: ${e.trend} (åŠ¨é‡: ${e.zscore>=0?"+":""}${e.zscore.toFixed(2)})`).join("\n")}\n\n## é£æ ¼è½®åŠ¨\n${n.style_rotation.map(n=>`- ${n.style}: ${n.score>0?"å ä¼˜":"å¼±åŠ¿"} (${n.score>=0?"+":""}${n.score.toFixed(2)})`).join("\n")}\n\n## åˆ†ææ€»ç»“\n${n.summary||e.description}\n\n---\nè¯·åŸºäºä»¥ä¸Šå¸‚åœºçŠ¶æ€ï¼Œå¸®æˆ‘ç”Ÿæˆé€‚åˆå½“å‰å¸‚åœºç¯å¢ƒçš„PTradeé‡åŒ–ç­–ç•¥ä»£ç ã€‚è¦æ±‚ï¼š\n1. æ ¹æ®å¸‚åœºRegimeé€‰æ‹©åˆé€‚çš„ç­–ç•¥é£æ ¼\n2. åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘ï¼ˆæ­¢æŸ8%ï¼Œæ­¢ç›ˆ20%ï¼‰\n3. å•ç¥¨æœ€å¤§ä»“ä½10%\n4. æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},628:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.logger=e.Logger=e.LogLevel=void 0;const o=s(t(398));var c;!function(n){n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.WARN=2]="WARN",n[n.ERROR=3]="ERROR"}(c||(e.LogLevel=c={}));class d{static instance;outputChannel;minLevel=c.INFO;logs=[];maxLogs=1e3;constructor(){this.outputChannel=o.window.createOutputChannel("TRQuant")}static getInstance(){return d.instance||(d.instance=new d),d.instance}setLevel(n){this.minLevel=n}show(){this.outputChannel.show()}debug(n,e,t){this.log(c.DEBUG,n,e,t)}info(n,e,t){this.log(c.INFO,n,e,t)}warn(n,e,t){this.log(c.WARN,n,e,t)}error(n,e,t){this.log(c.ERROR,n,e,t)}log(n,e,t,a){if(n<this.minLevel)return;const r={level:n,message:e,timestamp:new Date,module:t,data:a};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift();const i=c[n].padEnd(5),s=`${r.timestamp.toISOString().substring(11,23)} ${i} ${t?`[${t}]`:""} ${e}${a?` | ${JSON.stringify(a)}`:""}`;this.outputChannel.appendLine(s),n===c.ERROR&&o.window.showErrorMessage(`TRQuant: ${e}`)}getRecentLogs(n=100){return this.logs.slice(-n)}clear(){this.logs=[],this.outputChannel.clear()}dispose(){this.outputChannel.dispose()}}e.Logger=d,e.logger=d.getInstance()},799:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorHandler=e.ConfigError=e.DataError=e.PythonError=e.TRQuantError=e.ErrorCode=void 0;const o=s(t(398)),c=t(628);var d;!function(n){n[n.UNKNOWN=1e3]="UNKNOWN",n[n.TIMEOUT=1001]="TIMEOUT",n[n.CANCELLED=1002]="CANCELLED",n[n.PYTHON_NOT_FOUND=2e3]="PYTHON_NOT_FOUND",n[n.PYTHON_EXECUTION_ERROR=2001]="PYTHON_EXECUTION_ERROR",n[n.BRIDGE_CONNECTION_ERROR=2002]="BRIDGE_CONNECTION_ERROR",n[n.BRIDGE_RESPONSE_PARSE_ERROR=2003]="BRIDGE_RESPONSE_PARSE_ERROR",n[n.DATA_NOT_AVAILABLE=3e3]="DATA_NOT_AVAILABLE",n[n.DATA_PARSE_ERROR=3001]="DATA_PARSE_ERROR",n[n.DATA_VALIDATION_ERROR=3002]="DATA_VALIDATION_ERROR",n[n.CONFIG_INVALID=4e3]="CONFIG_INVALID",n[n.CONFIG_MISSING=4001]="CONFIG_MISSING",n[n.MCP_CONNECTION_ERROR=5e3]="MCP_CONNECTION_ERROR",n[n.MCP_TOOL_NOT_FOUND=5001]="MCP_TOOL_NOT_FOUND",n[n.MCP_EXECUTION_ERROR=5002]="MCP_EXECUTION_ERROR"}(d||(e.ErrorCode=d={}));class l extends Error{code;details;timestamp;constructor(n,e,t){super(e),this.name="TRQuantError",this.code=n,this.details=t,this.timestamp=new Date,Object.setPrototypeOf(this,l.prototype)}toUserMessage(){return{[d.UNKNOWN]:"å‘ç”ŸæœªçŸ¥é”™è¯¯",[d.TIMEOUT]:"æ“ä½œè¶…æ—¶ï¼Œè¯·é‡è¯•",[d.CANCELLED]:"æ“ä½œå·²å–æ¶ˆ",[d.PYTHON_NOT_FOUND]:"Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥é…ç½®",[d.PYTHON_EXECUTION_ERROR]:"Pythonæ‰§è¡Œé”™è¯¯",[d.BRIDGE_CONNECTION_ERROR]:"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡",[d.BRIDGE_RESPONSE_PARSE_ERROR]:"åç«¯å“åº”è§£æå¤±è´¥",[d.DATA_NOT_AVAILABLE]:"æ•°æ®ä¸å¯ç”¨",[d.DATA_PARSE_ERROR]:"æ•°æ®è§£æå¤±è´¥",[d.DATA_VALIDATION_ERROR]:"æ•°æ®éªŒè¯å¤±è´¥",[d.CONFIG_INVALID]:"é…ç½®æ— æ•ˆ",[d.CONFIG_MISSING]:"ç¼ºå°‘å¿…è¦é…ç½®",[d.MCP_CONNECTION_ERROR]:"MCPæœåŠ¡è¿æ¥å¤±è´¥",[d.MCP_TOOL_NOT_FOUND]:"MCPå·¥å…·æœªæ‰¾åˆ°",[d.MCP_EXECUTION_ERROR]:"MCPå·¥å…·æ‰§è¡Œå¤±è´¥"}[this.code]||this.message}toLogString(){return`[${d[this.code]}] ${this.message}${this.details?` | Details: ${JSON.stringify(this.details)}`:""}`}}e.TRQuantError=l,e.PythonError=class extends l{constructor(n,e){super(d.PYTHON_EXECUTION_ERROR,n,e),this.name="PythonError"}},e.DataError=class extends l{constructor(n,e,t){super(n,e,t),this.name="DataError"}},e.ConfigError=class extends l{constructor(n,e){super(d.CONFIG_INVALID,n,e),this.name="ConfigError"}};class p{static handle(n,e){const t=e||"ErrorHandler";n instanceof l?(c.logger.error(n.toLogString(),t),o.window.showErrorMessage(n.toUserMessage())):n instanceof Error?(c.logger.error(n.message,t,{stack:n.stack}),o.window.showErrorMessage(`TRQuant: ${n.message}`)):(c.logger.error(String(n),t),o.window.showErrorMessage("TRQuant: å‘ç”ŸæœªçŸ¥é”™è¯¯"))}static async wrap(n,e){try{return await n()}catch(n){return void p.handle(n,e)}}static async withRetry(n,e=3,t=1e3,a){let r;for(let i=0;i<e;i++)try{return await n()}catch(n){r=n,c.logger.warn(`æ“ä½œå¤±è´¥ï¼Œç¬¬${i+1}æ¬¡é‡è¯•...`,a,{error:n instanceof Error?n.message:String(n)}),i<e-1&&await new Promise(n=>setTimeout(n,t))}throw r}static validateRequired(n,e){const t=e.filter(e=>void 0===n[e]||null===n[e]);if(t.length>0)throw new l(d.DATA_VALIDATION_ERROR,`ç¼ºå°‘å¿…éœ€å‚æ•°: ${t.join(", ")}`,{missing:t,provided:Object.keys(n)})}}e.ErrorHandler=p},857:n=>{n.exports=require("os")},896:n=>{n.exports=require("fs")},900:function(n,e,t){var a,r=this&&this.__createBinding||(Object.create?function(n,e,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(e,t);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,a,r)}:function(n,e,t,a){void 0===a&&(a=t),n[a]=e[t]}),i=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||(a=function(n){return a=Object.getOwnPropertyNames||function(n){var e=[];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[e.length]=t);return e},a(n)},function(n){if(n&&n.__esModule)return n;var e={};if(null!=n)for(var t=a(n),s=0;s<t.length;s++)"default"!==t[s]&&r(e,n,t[s]);return i(e,n),e});Object.defineProperty(e,"__esModule",{value:!0}),e.analyzeBacktest=async function(n,e){const t=await o.window.showOpenDialog({canSelectMany:!1,filters:{"JSON/HTML":["json","html"],All:["*"]},title:"é€‰æ‹©å›æµ‹ç»“æœæ–‡ä»¶"});if(!t||0===t.length)return;const a=t[0].fsPath;await o.window.withProgress({location:o.ProgressLocation.Notification,title:"TRQuant: åˆ†æå›æµ‹ç»“æœ...",cancellable:!1},async()=>{try{const e=await n.analyzeBacktest({backtest_file:a});if(!e.ok||!e.data)return void o.window.showErrorMessage(`åˆ†æå›æµ‹å¤±è´¥: ${e.error}`);const t=e.data;o.window.createWebviewPanel("trquantBacktest","ğŸ“Š å›æµ‹åˆ†æ",o.ViewColumn.Beside,{enableScripts:!0}).webview.html=function(n){const e=n.metrics||{},t=n.diagnosis||[],a=n.suggestions||[];return`<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <style>\n        body {\n            font-family: 'Segoe UI', sans-serif;\n            background: #1a1a2e;\n            color: #fff;\n            padding: 20px;\n            margin: 0;\n        }\n        h1 { margin-bottom: 24px; }\n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n        .metric-card {\n            background: #252540;\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n        }\n        .metric-value {\n            font-size: 28px;\n            font-weight: bold;\n            margin-bottom: 4px;\n        }\n        .metric-label {\n            color: #9ca3af;\n            font-size: 13px;\n        }\n        .positive { color: #10b981; }\n        .negative { color: #ef4444; }\n        .section {\n            background: #252540;\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 16px;\n        }\n        .section h3 {\n            margin: 0 0 12px 0;\n            color: #9ca3af;\n            font-size: 14px;\n        }\n        .diagnosis-item {\n            padding: 8px 0;\n            border-bottom: 1px solid #333;\n        }\n        .diagnosis-item:last-child { border: none; }\n        .suggestion {\n            background: #667eea22;\n            border-left: 4px solid #667eea;\n            padding: 12px;\n            margin-bottom: 8px;\n            border-radius: 0 8px 8px 0;\n        }\n    </style>\n</head>\n<body>\n    <h1>ğŸ“Š å›æµ‹åˆ†ææŠ¥å‘Š</h1>\n    \n    <div class="metrics-grid">\n        <div class="metric-card">\n            <div class="metric-value ${(e.total_return||0)>0?"positive":"negative"}">\n                ${(e.total_return||0).toFixed(2)}%\n            </div>\n            <div class="metric-label">æ€»æ”¶ç›Šç‡</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${(e.sharpe_ratio||0).toFixed(2)}</div>\n            <div class="metric-label">å¤æ™®æ¯”ç‡</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value negative">${(e.max_drawdown||0).toFixed(2)}%</div>\n            <div class="metric-label">æœ€å¤§å›æ’¤</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${(e.win_rate||0).toFixed(1)}%</div>\n            <div class="metric-label">èƒœç‡</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${e.trade_count||0}</div>\n            <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${(e.profit_loss_ratio||0).toFixed(2)}</div>\n            <div class="metric-label">ç›ˆäºæ¯”</div>\n        </div>\n    </div>\n\n    ${t.length>0?`\n    <div class="section">\n        <h3>ğŸ” é—®é¢˜è¯Šæ–­</h3>\n        ${t.map(n=>`<div class="diagnosis-item">â€¢ ${n}</div>`).join("")}\n    </div>\n    `:""}\n\n    ${a.length>0?`\n    <div class="section">\n        <h3>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h3>\n        ${a.map(n=>`<div class="suggestion">${n}</div>`).join("")}\n    </div>\n    `:""}\n</body>\n</html>`}(t)}catch(n){o.window.showErrorMessage(`é”™è¯¯: ${n.message}`)}})};const o=s(t(398))},928:n=>{n.exports=require("path")}},e={},t=function t(a){var r=e[a];if(void 0!==r)return r.exports;var i=e[a]={exports:{}};return n[a].call(i.exports,i,i.exports,t),i.exports}(265);module.exports=t})();
//# sourceMappingURL=extension.js.map