(()=>{"use strict";var e={3:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.TRQuantClient=void 0;const i=o(t(317)),c=o(t(928)),l=t(628),d=t(478),p=t(799);n.TRQuantClient=class{MODULE="TRQuantClient";extensionPath;configManager;constructor(e){this.extensionPath=e.extensionPath,this.configManager=d.ConfigManager.getInstance(),l.logger.info("TRQuantClientÂàùÂßãÂåñÂÆåÊàê",this.MODULE)}async getMarketStatus(e){return this.callBridge("get_market_status",{universe:e?.universe||"CN_EQ",as_of:e?.as_of||this.getTodayDate(),lookback_days:e?.lookback_days||60})}async getMainlines(e){return this.callBridge("get_mainlines",{top_n:e?.top_n||20,time_horizon:e?.time_horizon||"short"})}async recommendFactors(e){return this.callBridge("recommend_factors",{market_regime:e?.market_regime,mainlines:e?.mainlines,top_n:e?.top_n||10})}async generateStrategy(e){p.ErrorHandler.validateRequired(e,["factors"]);const n={max_position:e.risk_params?.max_position||this.configManager.get("defaultRiskParams").maxPosition,stop_loss:e.risk_params?.stop_loss||this.configManager.get("defaultRiskParams").stopLoss,take_profit:e.risk_params?.take_profit||this.configManager.get("defaultRiskParams").takeProfit};return this.callBridge("generate_strategy",{factors:e.factors,style:e.style||this.configManager.get("defaultStyle"),platform:e.platform||this.configManager.get("defaultPlatform"),risk_params:n})}async analyzeBacktest(e){return this.callBridge("analyze_backtest",e)}async assessRisk(e){return p.ErrorHandler.validateRequired(e,["portfolio"]),this.callBridge("risk_assessment",e)}async healthCheck(){try{return(await this.callBridge("health_check",{})).ok}catch{return!1}}async callBridge(e,n){const t=Date.now();l.logger.debug(`Ë∞ÉÁî®Bridge: ${e}`,this.MODULE,{params:n});try{const a=await this.executeSubprocess(e,n),r=Date.now()-t;return l.logger.info(`BridgeË∞ÉÁî®ÂÆåÊàê: ${e}`,this.MODULE,{duration:`${r}ms`,ok:a.ok}),a}catch(n){const a=Date.now()-t;throw l.logger.error(`BridgeË∞ÉÁî®Â§±Ë¥•: ${e}`,this.MODULE,{duration:`${a}ms`,error:n instanceof Error?n.message:String(n)}),n}}executeSubprocess(e,n){return new Promise((t,a)=>{const r=this.configManager.getPythonPath(this.extensionPath),s=c.join(this.extensionPath,"python","bridge.py"),o=this.configManager.get("timeout"),d={action:e,params:n},g=JSON.stringify(d);l.logger.debug(`ÊâßË°åPython: ${r}`,this.MODULE,{bridgePath:s});const u={...process.env,PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(this.extensionPath),PYTHONPATH:c.join(this.extensionPath,"python")},m=i.spawn(r,[s],{cwd:c.join(this.extensionPath,"python"),env:u,stdio:["pipe","pipe","pipe"]});let h="",f="";m.stdout?.on("data",e=>{h+=e.toString()}),m.stderr?.on("data",e=>{f+=e.toString()});const v=setTimeout(()=>{m.kill("SIGTERM"),a(new p.TRQuantError(p.ErrorCode.TIMEOUT,`Êìç‰ΩúË∂ÖÊó∂ (${o}ms)`,{action:e}))},o);m.on("close",n=>{if(clearTimeout(v),0!==n)return l.logger.error(`PythonËøõÁ®ãÈÄÄÂá∫: ${n}`,this.MODULE,{stderr:f}),void a(new p.PythonError(f||`ËøõÁ®ãÈÄÄÂá∫Á†Å: ${n}`,{action:e,code:n,stderr:f}));try{const e=JSON.parse(h.trim());t(e)}catch(e){l.logger.error("ÂìçÂ∫îËß£ÊûêÂ§±Ë¥•",this.MODULE,{stdout:h}),a(new p.TRQuantError(p.ErrorCode.BRIDGE_RESPONSE_PARSE_ERROR,"Êó†Ê≥ïËß£ÊûêÂêéÁ´ØÂìçÂ∫î",{stdout:h,parseError:e instanceof Error?e.message:String(e)}))}}),m.on("error",e=>{clearTimeout(v),l.logger.error("ËøõÁ®ãÂêØÂä®Â§±Ë¥•",this.MODULE,{error:e.message}),e.message.includes("ENOENT")?a(new p.TRQuantError(p.ErrorCode.PYTHON_NOT_FOUND,`PythonËß£ÈáäÂô®Êú™ÊâæÂà∞: ${r}`,{pythonPath:r})):a(new p.PythonError(e.message,{error:e}))}),m.stdin?.write(g),m.stdin?.end()})}getTodayDate(){return(new Date).toISOString().split("T")[0]}dispose(){l.logger.info("TRQuantClientÂ∑≤ÈáäÊîæ",this.MODULE)}}},46:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.StrategyLearner=void 0,n.createStrategyLearner=function(e){return new p(e)};const i=o(t(896)),c=o(t(928)),l=t(683),d=t(510);class p{store;learningLog=[];constructor(e){this.store=(0,l.getKnowledgeStore)(e)}async learnFromDocuments(e){const n={learned:0,patterns:[],practices:[]};for(const t of e)try{if(!i.existsSync(t))continue;const e=i.readFileSync(t,"utf-8"),a=c.extname(t).toLowerCase();if(".md"===a||".txt"===a){const t=this.extractFromMarkdown(e);n.patterns.push(...t.patterns),n.practices.push(...t.practices)}else if(".py"===a){const a=this.extractFromPython(e,t);n.patterns.push(...a.patterns)}n.learned++}catch(e){this.log(`Â≠¶‰π†ÊñáÊ°£Â§±Ë¥• ${t}: ${e}`)}return this.store.autoSave(),n}extractFromMarkdown(e){const n=[],t=[],a=e.matchAll(/```python\n([\s\S]*?)```/g);for(const e of a){const t=e[1],a=t.match(/def\s+(\w+)\s*\([^)]*\):/);if(a){const e=a[1];e.includes("select")||e.includes("filter")||e.includes("stock")?(this.addLearnedPattern({id:`doc_${e}_${Date.now()}`,name:this.formatFunctionName(e),category:"selection",description:"‰ªéÊñáÊ°£Â≠¶‰π†ÁöÑÈÄâËÇ°ÂáΩÊï∞",codeTemplate:t,effectiveness:70,usageCount:0}),n.push(e)):(e.includes("stop")||e.includes("risk")||e.includes("position"))&&(this.addLearnedPattern({id:`doc_${e}_${Date.now()}`,name:this.formatFunctionName(e),category:"risk",description:"‰ªéÊñáÊ°£Â≠¶‰π†ÁöÑÈ£éÊéßÂáΩÊï∞",codeTemplate:t,effectiveness:75,usageCount:0}),n.push(e))}}const r=e.matchAll(/##\s+(.+?)\n([\s\S]*?)(?=\n##|\n#|$)/g);for(const e of r){const n=e[1].trim(),a=e[2].trim();(n.includes("Âª∫ËÆÆ")||n.includes("ÂÆûË∑µ")||n.includes("Ê≥®ÊÑè")||n.includes("ÊäÄÂ∑ß")||a.includes("Êé®Ëçê")||a.includes("Â∫îËØ•"))&&(this.addLearnedPractice({id:`doc_bp_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,title:n,category:this.categorizeByKeywords(a),description:a.slice(0,200),example:this.extractFirstCodeBlock(a)||"",references:["ÊñáÊ°£Â≠¶‰π†"]}),t.push(n))}return{patterns:n,practices:t}}extractFromPython(e,n){const t=[],a=d.codeAnalyzer.analyze(e,c.basename(n));for(const e of a.components.stockSelection)e.content.length>100&&(this.addLearnedPattern({id:`py_${e.name}_${Date.now()}`,name:this.formatFunctionName(e.name),category:"selection",description:`‰ªé ${c.basename(n)} Â≠¶‰π†ÁöÑÈÄâËÇ°ÈÄªËæë`,codeTemplate:e.content,effectiveness:70,usageCount:0}),t.push(e.name));for(const e of a.components.riskControl)e.content.length>50&&(this.addLearnedPattern({id:`py_${e.name}_${Date.now()}`,name:this.formatFunctionName(e.name),category:"risk",description:`‰ªé ${c.basename(n)} Â≠¶‰π†ÁöÑÈ£éÊéßÈÄªËæë`,codeTemplate:e.content,effectiveness:75,usageCount:0}),t.push(e.name));return{patterns:t}}async learnFromHistory(e){const n={analyzed:0,successPatterns:[],failurePatterns:[]};for(const t of e)try{const e=d.codeAnalyzer.analyze(t.code,t.filename);t.performance&&t.performance.returns>.1&&t.performance.sharpe>1&&t.performance.maxDrawdown>-.2?(this.extractAndUpdatePatterns(e,"success"),n.successPatterns.push(t.filename)):t.performance&&t.performance.returns<-.1&&(this.extractAndUpdatePatterns(e,"failure"),n.failurePatterns.push(t.filename)),n.analyzed++}catch(e){this.log(`ÂàÜÊûêÁ≠ñÁï•Â§±Ë¥• ${t.filename}: ${e}`)}return this.store.autoSave(),n}extractAndUpdatePatterns(e,n){const t="success"===n?5:-3;for(const n of e.dependencies.factors){const e=`factor_${n.type}`,a=this.store.getPatternById(e);a&&this.store.updatePatternEffectiveness(e,Math.max(0,Math.min(100,a.effectiveness+t)))}e.components.riskControl.length>0?"success"===n&&this.store.updatePatternEffectiveness("fixed_stop_loss",Math.min(100,this.store.getPatternById("fixed_stop_loss")?.effectiveness||82)):"failure"===n&&this.log("Â≠¶‰π†: Êó†È£éÊéßÁ≠ñÁï•Êõ¥ÂÆπÊòìÂ§±Ë¥•")}recordFeedback(e){this.store.addFeedback({...e,timestamp:(new Date).toISOString(),resolved:!1}),this.store.autoSave()}async processFeedback(){const e={processed:0,improvements:[]},n=this.store.getFeedback(!1);for(const t of n)try{switch(t.type){case"correction":this.learnFromCorrection(t),e.improvements.push(`‰øÆÊ≠£‰∫Ü ${t.strategyId} ÁöÑËΩ¨Êç¢ËßÑÂàô`);break;case"improvement":this.addLearnedPractice({id:`feedback_${Date.now()}`,title:"Áî®Êà∑Âª∫ËÆÆÁöÑÊúÄ‰Ω≥ÂÆûË∑µ",category:"Áî®Êà∑Ë¥°ÁåÆ",description:t.content,example:"",references:["Áî®Êà∑ÂèçÈ¶à"]}),e.improvements.push("Ê∑ªÂä†‰∫ÜÊñ∞ÁöÑÊúÄ‰Ω≥ÂÆûË∑µ");break;case"bug":this.log(`BugÂèçÈ¶à: ${t.content}`)}this.store.resolveFeedback(t.timestamp),e.processed++}catch(e){this.log(`Â§ÑÁêÜÂèçÈ¶àÂ§±Ë¥•: ${e}`)}return this.store.autoSave(),e}learnFromCorrection(e){const n=e.content.match(/(\w+)\s*(?:->|‚Üí|Â∫îËØ•ÊòØ)\s*(\w+)/);if(n){const[,e,t]=n;this.log(`Â≠¶‰π†Á∫†Ê≠£: ${e} -> ${t}`)}}recommendPatterns(e){const n=[],t=this.store.getPatterns();if(0===e.components.riskControl.length){const e=t.filter(e=>"risk"===e.category).sort((e,n)=>n.effectiveness-e.effectiveness).slice(0,3);n.push(...e)}if(e.components.stockSelection.length<=1){const e=t.filter(e=>"selection"===e.category).sort((e,n)=>n.effectiveness-e.effectiveness).slice(0,2);n.push(...e)}for(const a of e.dependencies.factors){const e=t.filter(e=>e.codeTemplate.toLowerCase().includes(a.type));e.length>0&&n.push(e[0])}const a=new Set;return n.filter(e=>!a.has(e.id)&&(a.add(e.id),!0))}recommendBestPractices(e){const n=[],t=this.store.getBestPractices();if(!e.components.riskControl.some(e=>e.content.toLowerCase().includes("stop_loss")||e.content.includes("Ê≠¢Êçü"))){const e=t.find(e=>"bp_stop_loss"===e.id);e&&n.push(e)}if(!e.components.stockSelection.some(e=>e.content.toLowerCase().includes("is_st")||e.content.includes("ST"))){const e=t.find(e=>"bp_avoid_st"===e.id);e&&n.push(e)}if(!e.dependencies.apis.some(e=>e.name.includes("log"))){const e=t.find(e=>"bp_logging"===e.id);e&&n.push(e)}return n}addLearnedPattern(e){this.store.addPattern(e),this.log(`Â≠¶‰π†Êñ∞Ê®°Âºè: ${e.name}`)}addLearnedPractice(e){this.store.addBestPractice(e),this.log(`Â≠¶‰π†Êñ∞ÂÆûË∑µ: ${e.title}`)}formatFunctionName(e){return e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}categorizeByKeywords(e){const n=e.toLowerCase();return n.includes("È£éÊéß")||n.includes("Ê≠¢Êçü")||n.includes("È£éÈô©")?"È£éÊéß":n.includes("ÈÄâËÇ°")||n.includes("Á≠õÈÄâ")||n.includes("Âõ†Â≠ê")?"ÈÄâËÇ°":n.includes("ÊâßË°å")||n.includes("‰∏ãÂçï")||n.includes("‰∫§Êòì")?"ÊâßË°å":n.includes("Ë∞ÉËØï")||n.includes("Êó•Âøó")||n.includes("ËÆ∞ÂΩï")?"Ë∞ÉËØï":"ÈÄöÁî®"}extractFirstCodeBlock(e){const n=e.match(/```(?:python)?\n([\s\S]*?)```/);return n?n[1]:null}log(e){const n=`[${(new Date).toISOString()}] ${e}`;this.learningLog.push(n),console.log(`[StrategyLearner] ${e}`)}getLearningLog(){return this.learningLog}getStats(){return this.store.getStats()}save(){this.store.save()}}n.StrategyLearner=p},64:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.PLATFORMS=void 0,n.PLATFORMS={joinquant:{name:"joinquant",displayName:"ËÅöÂÆΩ JoinQuant",description:"ÈáèÂåñÁ†îÁ©∂ÂíåÂõûÊµãÂπ≥Âè∞",apiVersion:"2.0",features:["ÂõûÊµã","Ê®°Êãü‰∫§Êòì","Á†îÁ©∂ÁéØÂ¢É"]},ptrade:{name:"ptrade",displayName:"PTrade",description:"ÊÅíÁîüÂÆûÁõò‰∫§ÊòìÁ≥ªÁªü",apiVersion:"1.0",features:["ÂÆûÁõò‰∫§Êòì","Á®ãÂ∫èÂåñ‰∫§Êòì","Â§öË¥¶Êà∑"]},qmt:{name:"qmt",displayName:"QMTËøÖÊäï",description:"ËøÖÊäïÈáèÂåñ‰∫§ÊòìÂπ≥Âè∞",apiVersion:"2.0",features:["ÂÆûÁõò‰∫§Êòì","È´òÈ¢ë‰∫§Êòì","Á≠ñÁï•ÂõûÊµã"]},universal:{name:"universal",displayName:"ÈÄöÁî®Ê†ºÂºè",description:"TRQuantÁªü‰∏ÄÊ†ºÂºè",apiVersion:"1.0",features:["Ë∑®Âπ≥Âè∞","Ê†áÂáÜÂåñ","ÂèØÁßªÊ§ç"]}}},126:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.MainDashboard=void 0,n.registerMainDashboard=function(e,n){e.subscriptions.push(i.commands.registerCommand("trquant.openDashboard",()=>{g.createOrShow(e.extensionUri,n)})),d.logger.info("ÊäïËµÑÂ∑•‰ΩúÊµÅ‰ª™Ë°®ÁõòÂ∑≤Ê≥®ÂÜå",p)},n.showMainDashboard=function(e,n){g.createOrShow(e,n)};const i=o(t(398)),c=o(t(896)),l=o(t(928)),d=t(628),p="MainDashboard";class g{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_marketStatus=null;_mainlines=[];_factors=[];constructor(e,n,t){this._panel=e,this._extensionUri=n,this._client=t,this._panel.webview.onDidReceiveMessage(e=>this.handleMessage(e),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent(),this.refreshAllData()}static createOrShow(e,n){const t=i.ViewColumn.One;if(g.currentPanel)return g.currentPanel._panel.reveal(t),g.currentPanel;const a=i.window.createWebviewPanel("trquantDashboard","üêâ Èü¨ÁùøÈáèÂåñÂ∑•‰ΩúÂè∞",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});return g.currentPanel=new g(a,e,n),g.currentPanel}async handleMessage(e){switch(console.log("[MainDashboard] Êî∂Âà∞Ê∂àÊÅØ:",e.command),e.command){case"openStep":await this.openWorkflowStep(e.step);break;case"refreshAll":await this.refreshAllData();break;case"refreshMarket":await this.refreshMarketStatus();break;case"refreshMainlines":await this.refreshMainlines();break;case"refreshFactors":await this.refreshFactors();break;case"createProject":console.log("[MainDashboard] ÊâßË°å createProject ÂëΩ‰ª§"),await i.commands.executeCommand("trquant.createProject");break;case"openProject":i.commands.executeCommand("trquant.openProject");break;case"openBacktestConfig":i.commands.executeCommand("trquant.openBacktestConfig");break;case"generateStrategy":i.commands.executeCommand("trquant.generateStrategy");break;case"showLogs":i.commands.executeCommand("trquant.showLogs");break;case"openSettings":i.commands.executeCommand("trquant.openSettings");break;case"openFileManager":i.commands.executeCommand("trquant.openFileManager");break;case"launchFileDashboard":await this.launchFileDashboard();break;case"openKnowledgeBase":i.commands.executeCommand("trquant.openKnowledgeBase");break;case"openAShareManual":i.commands.executeCommand("trquant.openAShareManual");break;case"launchAShareManual":await this.launchAShareManual();break;case"runFullWorkflow":await this.runFullWorkflow();break;case"openWorkflowPanel":console.log("[MainDashboard] ÂáÜÂ§áÂêØÂä®Ê°åÈù¢Á≥ªÁªü");try{await i.commands.executeCommand("trquant.openWorkflowPanel"),console.log("[MainDashboard] Ê°åÈù¢Á≥ªÁªüÂêØÂä®ÂëΩ‰ª§Â∑≤ÊâßË°å")}catch(e){console.error("[MainDashboard] ÂêØÂä®Ê°åÈù¢Á≥ªÁªüÂ§±Ë¥•:",e),i.window.showErrorMessage(`ÂêØÂä®Ê°åÈù¢Á≥ªÁªüÂ§±Ë¥•: ${e}`)}break;case"generateInvestmentReport":await this.generateInvestmentReport();break;case"syncFileChanges":await this.syncFileChanges();break;case"exportDatabase":await this.exportDatabase();break;case"openFile":await this.openFile(e.path);break;case"optimizeStrategy":i.commands.executeCommand("trquant.optimizeStrategy")}}async openWorkflowStep(e){const n={1:{id:"data_source",name:"‰ø°ÊÅØËé∑Âèñ"},2:{id:"market_trend",name:"Â∏ÇÂú∫Ë∂ãÂäø"},3:{id:"mainline",name:"ÊäïËµÑ‰∏ªÁ∫ø"},4:{id:"candidate_pool",name:"ÂÄôÈÄâÊ±†ÊûÑÂª∫"},5:{id:"factor",name:"Âõ†Â≠êÊûÑÂª∫"},6:{id:"strategy",name:"Á≠ñÁï•ÁîüÊàê"},7:{id:"backtest",name:"ÂõûÊµãÈ™åËØÅ"},8:{id:"trading",name:"ÂÆûÁõò‰∫§Êòì"}}[e];if(n)if(7!==e)if(8!==e){this._panel.webview.postMessage({command:"stepStarted",step:e,stepId:n.id,stepName:n.name});try{const t=await this._client.callBridge("run_workflow_step",{step_id:n.id}),a=t.summary||(t.ok?"ÊâßË°åÊàêÂäü":"ÊâßË°åÂ§±Ë¥•"),r=t.data||{};this._panel.webview.postMessage({command:"stepResult",step:e,stepId:n.id,stepName:n.name,success:t.ok,summary:a,details:r,error:t.error})}catch(t){d.logger.error(`Ê≠•È™§${e}ÊâßË°åÂ§±Ë¥•: ${t}`,p),this._panel.webview.postMessage({command:"stepResult",step:e,stepId:n.id,stepName:n.name,success:!1,summary:`ÊâßË°åÂ§±Ë¥•: ${t}`,details:{},error:String(t)})}}else i.commands.executeCommand("trquant.openTrading");else i.commands.executeCommand("trquant.openBacktestConfig")}async refreshAllData(){this._panel.webview.postMessage({command:"loadingStart"}),await Promise.all([this.refreshMarketStatus(),this.refreshMainlines(),this.refreshFactors()]),this._panel.webview.postMessage({command:"loadingEnd"})}async refreshMarketStatus(){try{const e=await this._client.getMarketStatus();if(e.ok&&e.data){this._marketStatus=e.data;const n={regime:this._marketStatus.regime,regime_cn:this.getRegimeCN(this._marketStatus.regime),indices:this.formatIndices(this._marketStatus.index_trend),style_rotation:this._marketStatus.style_rotation?.[0]?.style||"ÂùáË°°"};this._panel.webview.postMessage({command:"marketStatusUpdated",data:n})}}catch(e){d.logger.error(`Ëé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅÂ§±Ë¥•: ${e}`,p)}}getRegimeCN(e){return{risk_on:"È£éÈô©ÂÅèÂ•Ω",risk_off:"È£éÈô©ËßÑÈÅø",neutral:"‰∏≠ÊÄß"}[e]||e}formatIndices(e){const n=[],t={sh_index:"‰∏äËØÅÊåáÊï∞",sz_index:"Ê∑±ËØÅÊàêÊåá",cy_index:"Âàõ‰∏öÊùøÊåá"};for(const[a,r]of Object.entries(e||{}))n.push({name:t[a]||a,value:r?.zscore||0,change:r?.change_pct||0});return n}async refreshMainlines(){try{const e=await this._client.getMainlines({time_horizon:"short",top_n:5});e.ok&&e.data&&(this._mainlines=e.data,this._panel.webview.postMessage({command:"mainlinesUpdated",data:this._mainlines}))}catch(e){d.logger.error(`Ëé∑ÂèñÊäïËµÑ‰∏ªÁ∫øÂ§±Ë¥•: ${e}`,p)}}async refreshFactors(){try{const e=this._marketStatus?.regime||"neutral",n=await this._client.recommendFactors({market_regime:e,top_n:5});n.ok&&n.data&&(this._factors=n.data,this._panel.webview.postMessage({command:"factorsUpdated",data:this._factors}))}catch(e){d.logger.error(`Ëé∑ÂèñÊé®ËçêÂõ†Â≠êÂ§±Ë¥•: ${e}`,p)}}async runFullWorkflow(){d.logger.info("=== ‰∏ÄÈîÆÊâßË°åÂÆåÊï¥ÊäïËµÑÂ∑•‰ΩúÊµÅ ===",p);const e=[{id:"step1",name:"üì° ‰ø°ÊÅØËé∑Âèñ",action:"check_data_sources"},{id:"step2",name:"üìà Â∏ÇÂú∫Ë∂ãÂäø",action:"analyze_market_trend"},{id:"step3",name:"üî• ÊäïËµÑ‰∏ªÁ∫ø",action:"identify_mainlines"},{id:"step4",name:"üì¶ ÂÄôÈÄâÊ±†ÊûÑÂª∫",action:"build_candidate_pool"},{id:"step5",name:"üìä Âõ†Â≠êÊé®Ëçê",action:"recommend_factors"},{id:"step6",name:"üõ†Ô∏è Á≠ñÁï•ÁîüÊàê",action:"generate_strategy"},{id:"step7",name:"üîÑ ÂõûÊµãÈ™åËØÅ",action:"run_backtest"},{id:"step8",name:"üöÄ ‰∫§ÊòìÊ£ÄÊü•",action:"check_broker"}];await i.window.withProgress({location:i.ProgressLocation.Notification,title:"üêâ ÊâßË°åÂÆåÊï¥ÊäïËµÑÂ∑•‰ΩúÊµÅ",cancellable:!0},async(n,t)=>{const a=[];let r=!1;for(let s=0;s<e.length;s++){if(t.isCancellationRequested){i.window.showWarningMessage("Â∑•‰ΩúÊµÅÂ∑≤ÂèñÊ∂à");break}const o=e[s];n.report({message:`(${s+1}/${e.length}) ${o.name}`,increment:100/e.length});try{d.logger.info(`ÊâßË°åÊ≠•È™§: ${o.name}`,p),this._panel.webview.postMessage({command:"workflowProgress",data:{currentStep:o.id,stepName:o.name,progress:(s+1)/e.length*100,status:"running"}});const n=await this._client.callBridge("run_workflow_step",{step_id:o.action});n.ok?(a.push({step:o.name,success:!0,data:n.data}),this._panel.webview.postMessage({command:"workflowStepResult",data:{stepId:o.id,stepName:o.name,result:n.data,success:!0}})):(r=!0,a.push({step:o.name,success:!1,error:n.error})),await new Promise(e=>setTimeout(e,500))}catch(e){r=!0;const n=e instanceof Error?e.message:String(e);d.logger.error(`Ê≠•È™§ ${o.name} Â§±Ë¥•: ${n}`,p),a.push({step:o.name,success:!1,error:n})}}this._panel.webview.postMessage({command:"workflowComplete",data:{results:a,hasError:r}}),r?i.window.showWarningMessage("‚ö†Ô∏è Â∑•‰ΩúÊµÅÂÆåÊàêÔºåÈÉ®ÂàÜÊ≠•È™§ÊúâÈîôËØØ"):i.window.showInformationMessage("‚úÖ ÂÆåÊï¥ÊäïËµÑÂ∑•‰ΩúÊµÅÊâßË°åÂÆåÊàêÔºÅ"),await this.refreshAllData()})}async launchAShareManual(){d.logger.info("=== ÂêØÂä®AËÇ°ÂÆûÊìçÊâãÂÜå ===",p);try{const e=i.workspace.workspaceFolders?.[0];if(!e)return void i.window.showErrorMessage("ËØ∑ÂÖàÊâìÂºÄTRQuantÂ∑•‰ΩúÂå∫");const n=l.join(e.uri.fsPath,"extension","AShare-manual");if(d.logger.info(`ÊâãÂÜåË∑ØÂæÑ: ${n}`,p),!c.existsSync(n))return i.window.showErrorMessage(`AËÇ°ÊâãÂÜåÁõÆÂΩï‰∏çÂ≠òÂú®: ${n}`),void d.logger.error(`ÁõÆÂΩï‰∏çÂ≠òÂú®: ${n}`,p);if(!c.existsSync(l.join(n,"package.json")))return void i.window.showErrorMessage("AËÇ°ÊâãÂÜåÈÖçÁΩÆÊñá‰ª∂Áº∫Â§±");if(!c.existsSync(l.join(n,"node_modules"))){if("ÂÆâË£Ö"===await i.window.showWarningMessage("AËÇ°ÊâãÂÜåÈúÄË¶ÅÂÆâË£Ö‰æùËµñÔºåÊòØÂê¶ÂÆâË£ÖÔºü","ÂÆâË£Ö","ÂèñÊ∂à")){const e=i.window.createTerminal({name:"AËÇ°ÊâãÂÜå‰æùËµñÂÆâË£Ö",cwd:n});e.show(),e.sendText('npm install && echo "‰æùËµñÂÆâË£ÖÂÆåÊàêÔºåËØ∑ÈáçÊñ∞ÁÇπÂáªAËÇ°ÂÆûÊìçÊâãÂÜå"')}return}const t=i.window.terminals.find(e=>"AËÇ°ÊâãÂÜåÊúçÂä°"===e.name);if(t)return d.logger.info("ÂèëÁé∞Â∑≤Â≠òÂú®ÁöÑÊâãÂÜåÊúçÂä°ÁªàÁ´Ø",p),t.show(),i.window.showInformationMessage("Ê≠£Âú®ÊâìÂºÄAËÇ°ÊâãÂÜå..."),void setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:4321"))},500);d.logger.info("ÂàõÂª∫Êñ∞ÁªàÁ´ØÂêØÂä®AstroÊúçÂä°",p);const a=i.window.createTerminal({name:"AËÇ°ÊâãÂÜåÊúçÂä°",cwd:n,env:{...process.env}});a.show(),a.sendText("npm run dev"),i.window.showInformationMessage("üìö Ê≠£Âú®ÂêØÂä®AËÇ°ÊâãÂÜåÊúçÂä°Âô®..."),setTimeout(()=>{d.logger.info("Â∞ùËØïÊâìÂºÄÊµèËßàÂô®",p),i.env.openExternal(i.Uri.parse("http://localhost:4321")),i.window.showInformationMessage("‚úÖ AËÇ°È´òÂÄçËÇ°ÂÆûÊìçÊâãÂÜåÂ∑≤ÂêØÂä®")},3e3)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`ÂêØÂä®Â§±Ë¥•: ${n}`,p),i.window.showErrorMessage(`ÂêØÂä®AËÇ°ÊâãÂÜåÂ§±Ë¥•: ${n}`)}}async launchFileDashboard(){d.logger.info("=== ÂêØÂä®Extension Dashboard ===",p);try{const e=i.workspace.workspaceFolders?.[0];if(!e)return void i.window.showErrorMessage("ËØ∑ÂÖàÊâìÂºÄÂ∑•‰ΩúÂå∫");const n=i.window.terminals.find(e=>"TRQuant Dashboard"===e.name);if(n)return d.logger.info("DashboardÊúçÂä°Â∑≤Âú®ËøêË°å",p),n.show(),i.window.showInformationMessage("üìÅ Ê≠£Âú®ÊâìÂºÄÊñá‰ª∂ÁÆ°ÁêÜÁ≥ªÁªü..."),void setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:5000"))},500);const t=l.join(e.uri.fsPath,"extension"),a=l.join(t,"start_dashboard.py");if(!c.existsSync(a))return void i.window.showErrorMessage(`DashboardÂêØÂä®ËÑöÊú¨‰∏çÂ≠òÂú®: ${a}`);d.logger.info(`DashboardËÑöÊú¨: ${a}`,p);const r=i.window.createTerminal({name:"TRQuant Dashboard",cwd:t});r.show();const s="win32"===process.platform,o=s?l.join(t,"venv","Scripts","activate.bat"):l.join(t,"venv","bin","activate"),g=s?l.join(e.uri.fsPath,"venv","Scripts","activate.bat"):l.join(e.uri.fsPath,"venv","bin","activate");let u="";c.existsSync(o)?(u=s?`"${o}" && python start_dashboard.py`:`source "${o}" && python start_dashboard.py`,d.logger.info("‰ΩøÁî®extension venv",p)):c.existsSync(g)?(u=s?`"${g}" && python start_dashboard.py`:`source "${g}" && python start_dashboard.py`,d.logger.info("‰ΩøÁî®Â∑•‰ΩúÂå∫Ê†πÁõÆÂΩïvenv",p)):(u=(s?"python":"python3")+" start_dashboard.py",d.logger.info("‰ΩøÁî®Á≥ªÁªüPython",p)),r.sendText(u),i.window.showInformationMessage("üìÅ Ê≠£Âú®ÂêØÂä®Extension Dashboard..."),setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:5000")),i.window.showInformationMessage("‚úÖ Extension DashboardÂ∑≤ÂêØÂä® - http://localhost:5000")},3e3)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`ÂêØÂä®DashboardÂ§±Ë¥•: ${n}`,p),i.window.showErrorMessage(`ÂêØÂä®Êñá‰ª∂ÁÆ°ÁêÜÁ≥ªÁªüÂ§±Ë¥•: ${n}`)}}async generateInvestmentReport(){d.logger.info("ÁîüÊàêÊäïËµÑÊä•Âëä...",p);try{i.window.showInformationMessage("üìä Ê≠£Âú®ÁîüÊàêÊäïËµÑÊä•Âëä...");const e=await this._client.callBridge("generate_investment_report",{type:"full"});if(e.ok&&e.data){const n=e.data,t=n.path||n.file||"";i.window.showInformationMessage(`‚úÖ Êä•ÂëäÂ∑≤ÁîüÊàê: ${l.basename(t)}`,"ÊâìÂºÄÊä•Âëä").then(e=>{if("ÊâìÂºÄÊä•Âëä"===e){const e=i.workspace.workspaceFolders?.[0];if(e&&t){const n=l.join(e.uri.fsPath,t);i.env.openExternal(i.Uri.file(n))}}})}else i.window.showErrorMessage(`ÁîüÊàêÊä•ÂëäÂ§±Ë¥•: ${e.error||"Êú™Áü•ÈîôËØØ"}`)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`ÁîüÊàêÊä•ÂëäÂ§±Ë¥•: ${n}`,p),i.window.showErrorMessage(`ÁîüÊàêÊä•ÂëäÂ§±Ë¥•: ${n}`)}}async syncFileChanges(){d.logger.info("ÂêåÊ≠•Êñá‰ª∂ÂèòÂåñ...",p);try{const e=await this._client.callBridge("sync_file_changes",{});if(e.ok&&e.data){const n=e.data,t=n.total_count||0,a=n.recent_files||[];if(t>0){const e=a.slice(0,3).map(e=>e.name).join(", ");i.window.showInformationMessage(`üîÑ Ê£ÄÊµãÂà∞ ${t} ‰∏™Êõ¥Êñ∞Êñá‰ª∂: ${e}${t>3?"...":""}`)}else i.window.showInformationMessage("‚úÖ Êñá‰ª∂Â∑≤ÊòØÊúÄÊñ∞Áä∂ÊÄÅ")}}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`ÂêåÊ≠•Â§±Ë¥•: ${n}`,p)}}async exportDatabase(){d.logger.info("ÂØºÂá∫Êï∞ÊçÆÂ∫ì...",p);try{i.window.showInformationMessage("üóÑÔ∏è Ê≠£Âú®ÂØºÂá∫Êï∞ÊçÆÂ∫ì...");const e=await this._client.callBridge("export_database",{});if(e.ok&&e.data){const n=e.data;i.window.showInformationMessage(`‚úÖ Êï∞ÊçÆÂ∫ìÂ∑≤ÂØºÂá∫: ${n.collections||0}‰∏™ÈõÜÂêà, ${n.total_docs||0}Êù°ËÆ∞ÂΩï`,"ÊâìÂºÄÊñá‰ª∂").then(e=>{if("ÊâìÂºÄÊñá‰ª∂"===e){const e=i.workspace.workspaceFolders?.[0];e&&n.file&&i.env.openExternal(i.Uri.file(n.file))}})}else i.window.showErrorMessage(`ÂØºÂá∫Â§±Ë¥•: ${e.error||"ËØ∑Á°Æ‰øùMongoDBÂ∑≤ÂêØÂä®"}`)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`ÂØºÂá∫Êï∞ÊçÆÂ∫ìÂ§±Ë¥•: ${n}`,p),i.window.showErrorMessage(`ÂØºÂá∫Êï∞ÊçÆÂ∫ìÂ§±Ë¥•: ${n}`)}}async openFile(e){if(!e)return;const n=i.workspace.workspaceFolders?.[0];if(!n)return;const t=l.join(n.uri.fsPath,e),a=l.extname(e).toLowerCase();if([".py",".json",".yaml",".yml",".md",".txt"].includes(a)){const e=await i.workspace.openTextDocument(t);await i.window.showTextDocument(e)}else i.env.openExternal(i.Uri.file(t))}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Èü¨ÁùøÈáèÂåñÂ∑•‰ΩúÂè∞</title>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --bg-hover: #262c36;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-purple: #a371f7;\n            --accent-red: #f85149;\n            --accent-orange: #f0883e;\n            --border-color: #30363d;\n            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            --gradient-gold: linear-gradient(135deg, #f0b429 0%, #e85d04 100%);\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: \'SF Pro Display\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n        \n        /* È°∂ÈÉ®Ê†áÈ¢òÊ†è */\n        .header {\n            background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);\n            padding: 24px 32px;\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .logo {\n            width: 48px;\n            height: 48px;\n            background: var(--gradient-gold);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            color: #fff;\n            box-shadow: 0 4px 12px rgba(240, 180, 41, 0.3);\n        }\n        \n        .header-title h1 {\n            font-size: 24px;\n            font-weight: 700;\n            background: linear-gradient(90deg, var(--accent-gold), #fff);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            letter-spacing: 1px;\n        }\n        \n        .header-title .subtitle {\n            font-size: 13px;\n            color: var(--text-muted);\n            margin-top: 4px;\n        }\n        \n        .header-right {\n            display: flex;\n            gap: 12px;\n        }\n        \n        .header-btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 13px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .header-btn:hover {\n            background: var(--bg-hover);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .header-btn.primary {\n            background: var(--gradient-primary);\n            border: none;\n            color: #fff;\n        }\n        \n        .header-btn.primary:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        }\n        \n        /* ‰∏ªÂÆπÂô® */\n        .main-container {\n            padding: 24px 32px;\n            max-width: 1600px;\n            margin: 0 auto;\n        }\n        \n        /* Â∏ÇÂú∫Áä∂ÊÄÅÂç°Áâá */\n        .market-section {\n            margin-bottom: 24px;\n        }\n        \n        .market-grid {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 16px;\n        }\n        \n        .market-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n            transition: all 0.2s;\n        }\n        \n        .market-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .market-card.regime {\n            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));\n            border-color: var(--accent-green);\n        }\n        \n        .market-card .label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        .market-card .value {\n            font-size: 24px;\n            font-weight: 700;\n        }\n        \n        .market-card .change {\n            font-size: 14px;\n            margin-top: 4px;\n        }\n        \n        .market-card .change.up { color: var(--accent-red); }\n        .market-card .change.down { color: var(--accent-green); }\n        \n        .market-card.regime .value {\n            color: var(--accent-green);\n        }\n        \n        /* ÂèåÊ†èÂ∏ÉÂ±Ä */\n        .content-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n            margin-bottom: 24px;\n        }\n        \n        .card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        \n        .card-header {\n            padding: 16px 20px;\n            background: rgba(0, 0, 0, 0.2);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .card-header h3 {\n            font-size: 15px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .card-header .actions {\n            display: flex;\n            gap: 8px;\n        }\n        \n        .card-header .btn-small {\n            padding: 6px 12px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            color: var(--text-secondary);\n            font-size: 12px;\n            cursor: pointer;\n        }\n        \n        .card-header .btn-small:hover {\n            background: var(--accent-blue);\n            border-color: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .card-body {\n            padding: 20px;\n        }\n        \n        /* ÊäïËµÑ‰∏ªÁ∫øÂàóË°® */\n        .mainline-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .mainline-item {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            transition: all 0.2s;\n            cursor: pointer;\n        }\n        \n        .mainline-item:hover {\n            background: var(--bg-hover);\n            transform: translateX(4px);\n        }\n        \n        .mainline-rank {\n            width: 28px;\n            height: 28px;\n            background: var(--gradient-gold);\n            border-radius: 6px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n            font-weight: 700;\n            color: #fff;\n        }\n        \n        .mainline-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }\n        .mainline-rank.bronze { background: linear-gradient(135deg, #d97706, #92400e); }\n        \n        .mainline-info {\n            flex: 1;\n        }\n        \n        .mainline-name {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .mainline-industries {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .mainline-score {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--accent-gold);\n        }\n        \n        /* Âõ†Â≠êÂàóË°® */\n        .factor-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .factor-item {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n        }\n        \n        .factor-icon {\n            width: 36px;\n            height: 36px;\n            background: var(--gradient-primary);\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 16px;\n        }\n        \n        .factor-info {\n            flex: 1;\n        }\n        \n        .factor-name {\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 2px;\n        }\n        \n        .factor-category {\n            font-size: 11px;\n            color: var(--text-muted);\n        }\n        \n        .factor-weight {\n            font-size: 16px;\n            font-weight: 700;\n            color: var(--accent-purple);\n        }\n        \n        /* 8Ê≠•È™§Â∑•‰ΩúÊµÅ */\n        .workflow-section {\n            margin-bottom: 24px;\n        }\n        \n        .section-title {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-muted);\n            text-transform: uppercase;\n            letter-spacing: 2px;\n            margin-bottom: 16px;\n            padding-left: 4px;\n        }\n        \n        .section-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        \n        .run-all-btn {\n            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.3s;\n        }\n        .run-all-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .workflow-container {\n            display: flex;\n            gap: 20px;\n        }\n        \n        .workflow-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 12px;\n            flex: 1;\n        }\n        \n        .workflow-step {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px 12px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s;\n            position: relative;\n        }\n        \n        .workflow-step::after {\n            display: none;\n        }\n        \n        .workflow-step:last-child::after {\n            display: none;\n        }\n        \n        .workflow-step:hover {\n            transform: translateY(-4px);\n            border-color: var(--accent-blue);\n            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.15);\n        }\n        \n        .workflow-step.active {\n            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(163, 113, 247, 0.15));\n            border-color: var(--accent-blue);\n        }\n        \n        .step-number {\n            width: 24px;\n            height: 24px;\n            background: var(--bg-card);\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 11px;\n            font-weight: 600;\n            color: var(--text-muted);\n            margin: 0 auto 12px;\n        }\n        \n        .workflow-step:hover .step-number {\n            background: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .step-icon {\n            font-size: 28px;\n            margin-bottom: 10px;\n        }\n        \n        .step-name {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .workflow-step:hover .step-name {\n            color: var(--text-primary);\n        }\n        \n        .step-status {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            font-size: 14px;\n        }\n        \n        .workflow-step.running {\n            border-color: #f59e0b;\n            animation: pulse 1.5s infinite;\n        }\n        \n        .workflow-step.completed {\n            border-color: #10b981;\n        }\n        \n        .workflow-step.failed {\n            border-color: #ef4444;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }\n        }\n        \n        /* ÁªìÊûúÈù¢Êùø */\n        .result-panel {\n            flex: 1;\n            min-width: 400px;\n            max-width: 500px;\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px;\n            display: none;\n        }\n        \n        .result-panel.visible {\n            display: block;\n        }\n        \n        .result-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        \n        .result-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .close-btn {\n            background: transparent;\n            border: none;\n            color: var(--text-muted);\n            cursor: pointer;\n            font-size: 16px;\n            padding: 4px 8px;\n            border-radius: 4px;\n        }\n        .close-btn:hover {\n            background: var(--bg-hover);\n            color: var(--text-primary);\n        }\n        \n        .result-summary {\n            background: var(--bg-card);\n            padding: 12px;\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 14px;\n            margin-bottom: 12px;\n        }\n        \n        .result-progress {\n            margin-bottom: 12px;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-card);\n            border-radius: 3px;\n            overflow: hidden;\n            margin-bottom: 8px;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n        \n        .progress-text {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .result-details {\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n            max-height: 300px;\n            overflow-y: auto;\n            font-size: 13px;\n            margin-bottom: 12px;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th, .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-secondary);\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .result-files {\n            max-height: 100px;\n            overflow-y: auto;\n        }\n        \n        .file-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px;\n            background: var(--bg-card);\n            border-radius: 6px;\n            margin-bottom: 4px;\n            cursor: pointer;\n            font-size: 12px;\n        }\n        .file-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        /* Âø´Êç∑Êìç‰ΩúÂå∫ */\n        .quick-section {\n            margin-bottom: 24px;\n        }\n        \n        .quick-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n        }\n        \n        .quick-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 24px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .quick-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .quick-card.highlight {\n            background: linear-gradient(135deg, rgba(240, 180, 41, 0.1), rgba(232, 93, 4, 0.1));\n            border-color: var(--accent-gold);\n        }\n        \n        .quick-icon {\n            width: 48px;\n            height: 48px;\n            background: var(--bg-card);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n        }\n        \n        .quick-card.highlight .quick-icon {\n            background: var(--gradient-gold);\n        }\n        \n        .quick-info h4 {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .quick-info p {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        /* Â∫ïÈÉ®ÂèåÊ†è */\n        .bottom-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n        }\n        \n        .project-list, .backtest-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .project-item, .backtest-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .project-item:hover, .backtest-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        .item-name {\n            font-size: 14px;\n            font-weight: 500;\n        }\n        \n        .item-date {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .item-return {\n            font-size: 14px;\n            font-weight: 600;\n        }\n        \n        .item-return.positive { color: var(--accent-red); }\n        .item-return.negative { color: var(--accent-green); }\n        \n        /* Âä†ËΩΩÁä∂ÊÄÅ */\n        .loading-overlay {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(10, 14, 20, 0.8);\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n        \n        .loading-overlay.active {\n            display: flex;\n        }\n        \n        .loading-spinner {\n            width: 48px;\n            height: 48px;\n            border: 3px solid var(--border-color);\n            border-top-color: var(--accent-gold);\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n        \n        /* Á©∫Áä∂ÊÄÅ */\n        .empty-state {\n            text-align: center;\n            padding: 32px;\n            color: var(--text-muted);\n        }\n        \n        .empty-state .icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        /* ÂìçÂ∫îÂºè */\n        @media (max-width: 1400px) {\n            .workflow-grid {\n                grid-template-columns: repeat(4, 1fr);\n            }\n            .workflow-step::after {\n                display: none;\n            }\n        }\n        \n        @media (max-width: 1000px) {\n            .content-grid, .bottom-grid {\n                grid-template-columns: 1fr;\n            }\n            .market-grid {\n                grid-template-columns: repeat(3, 1fr);\n            }\n            .quick-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n        }\n    </style>\n</head>\n<body>\n    \x3c!-- È°∂ÈÉ®Ê†áÈ¢òÊ†è --\x3e\n    <div class="header">\n        <div class="header-left">\n            <div class="logo">TR</div>\n            <div class="header-title">\n                <h1>Èü¨ÁùøÈáèÂåñÂ∑•‰ΩúÂè∞</h1>\n                <div class="subtitle">TRQuant Professional - AËÇ°ÂÆåÊï¥ÊäïËµÑÊµÅÁ®ãÁ≥ªÁªü</div>\n            </div>\n        </div>\n        <div class="header-right">\n            <button class="header-btn" onclick="vscode.postMessage({command: \'refreshAll\'})">\n                üîÑ Âà∑Êñ∞Êï∞ÊçÆ\n            </button>\n            <button class="header-btn" onclick="vscode.postMessage({command: \'openSettings\'})">\n                ‚öôÔ∏è ËÆæÁΩÆ\n            </button>\n            <button class="header-btn primary" onclick="openWorkflowPanel()">\n                üñ•Ô∏è ÊâìÂºÄÊ°åÈù¢Á≥ªÁªü\n            </button>\n        </div>\n    </div>\n    \n    <div class="main-container">\n        \x3c!-- Âø´Êç∑Êìç‰ΩúÔºàÁΩÆÈ°∂Ôºâ --\x3e\n        <div class="quick-section">\n            <div class="section-title">‚ö° Âø´Êç∑Êìç‰Ωú</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="console.log(\'ÁÇπÂáªÊñ∞Âª∫È°πÁõÆ\'); vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">üìÅ</div>\n                    <div class="quick-info">\n                        <h4>Êñ∞Âª∫È°πÁõÆ</h4>\n                        <p>‰∏ÄÈîÆÁîüÊàê‰∏≠ÂõΩÈ£éÁ≠ñÁï•</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">üìÇ</div>\n                    <div class="quick-info">\n                        <h4>Êñá‰ª∂Á≥ªÁªü</h4>\n                        <p>Á≠ñÁï•/Êä•Âëä/Êï∞ÊçÆÁÆ°ÁêÜ</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="openWorkflowPanel()">\n                    <div class="quick-icon">üñ•Ô∏è</div>\n                    <div class="quick-info">\n                        <h4>Ê°åÈù¢Á≥ªÁªü</h4>\n                        <p>Êü•ÁúãÂÆåÊï¥ÊäïËµÑÊµÅÁ®ã</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'runBacktest\'})">\n                    <div class="quick-icon">üß™</div>\n                    <div class="quick-info">\n                        <h4>ËøêË°åÂõûÊµã</h4>\n                        <p>ÈÖçÁΩÆÂπ∂ÊâßË°åÁ≠ñÁï•ÂõûÊµã</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchAShareManual\'})">\n                    <div class="quick-icon">üìö</div>\n                    <div class="quick-info">\n                        <h4>ÂÆûÊìçÊâãÂÜå</h4>\n                        <p>AËÇ°ÊäïËµÑÊåáÂçó</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">üìä</div>\n                    <div class="quick-info">\n                        <h4>ÁîüÊàêÊä•Âëä</h4>\n                        <p>AIÊäïËµÑÂàÜÊûêÊä•Âëä</p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">üîç</div>\n                    <div class="quick-info">\n                        <h4>Á≠ñÁï•‰ºòÂåñ</h4>\n                        <p>ÂàÜÊûêÂπ∂‰ºòÂåñÁ≠ñÁï•‰ª£Á†Å</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- Â∏ÇÂú∫Áä∂ÊÄÅ --\x3e\n        <div class="market-section">\n            <div class="market-grid" id="marketGrid">\n                <div class="market-card regime">\n                    <div class="label">Â∏ÇÂú∫Áä∂ÊÄÅ</div>\n                    <div class="value" id="marketRegime">Âä†ËΩΩ‰∏≠...</div>\n                    <div class="change" id="marketStyle">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">‰∏äËØÅÊåáÊï∞</div>\n                    <div class="value" id="shIndex">-</div>\n                    <div class="change" id="shChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">Ê∑±ËØÅÊàêÊåá</div>\n                    <div class="value" id="szIndex">-</div>\n                    <div class="change" id="szChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">Âàõ‰∏öÊùøÊåá</div>\n                    <div class="value" id="cyIndex">-</div>\n                    <div class="change" id="cyChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">ÂåóÂêëËµÑÈáë</div>\n                    <div class="value" id="northFlow">-</div>\n                    <div class="change" id="northChange">-</div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- ÊäïËµÑ‰∏ªÁ∫ø & Êé®ËçêÂõ†Â≠ê --\x3e\n        <div class="content-grid">\n            \x3c!-- ÊäïËµÑ‰∏ªÁ∫ø --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>üî• ÂΩìÂâçÊäïËµÑ‰∏ªÁ∫ø TOP5</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshMainlines\'})">Âà∑Êñ∞</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 3})">Êü•ÁúãÂÖ®ÈÉ®</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="mainline-list" id="mainlineList">\n                        <div class="empty-state">\n                            <div class="icon">üî•</div>\n                            <div>ÁÇπÂáªÂà∑Êñ∞Ëé∑ÂèñÊäïËµÑ‰∏ªÁ∫ø</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- Êé®ËçêÂõ†Â≠ê --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>üìä Êô∫ËÉΩÊé®ËçêÂõ†Â≠ê</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshFactors\'})">Âà∑Êñ∞</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'generateStrategy\'})">ÁîüÊàêÁ≠ñÁï•</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="factor-list" id="factorList">\n                        <div class="empty-state">\n                            <div class="icon">üìä</div>\n                            <div>ÁÇπÂáªÂà∑Êñ∞Ëé∑ÂèñÂõ†Â≠êÊé®Ëçê</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- 8Ê≠•È™§Â∑•‰ΩúÊµÅ --\x3e\n        <div class="workflow-section">\n            <div class="section-header">\n                <div class="section-title">üìã 8Ê≠•È™§ÊäïËµÑÂ∑•‰ΩúÊµÅ</div>\n                <button class="run-all-btn" onclick="vscode.postMessage({command: \'runFullWorkflow\'})">\n                    ‚ñ∂Ô∏è ‰∏ÄÈîÆÊâßË°åÂÖ®ÈÉ®\n                </button>\n            </div>\n            <div class="workflow-container">\n                <div class="workflow-grid">\n                    <div class="workflow-step" id="step-1" onclick="runStep(1)">\n                        <div class="step-number">1</div>\n                        <div class="step-icon">üì°</div>\n                        <div class="step-name">‰ø°ÊÅØËé∑Âèñ</div>\n                        <div class="step-status" id="status-1">‚ñ∂Ô∏è</div>\n                    </div>\n                    <div class="workflow-step" id="step-2" onclick="runStep(2)">\n                        <div class="step-number">2</div>\n                        <div class="step-icon">üìà</div>\n                        <div class="step-name">Â∏ÇÂú∫Ë∂ãÂäø</div>\n                        <div class="step-status" id="status-2">‚ñ∂Ô∏è</div>\n                    </div>\n                    <div class="workflow-step" id="step-3" onclick="runStep(3)">\n                        <div class="step-number">3</div>\n                        <div class="step-icon">üî•</div>\n                        <div class="step-name">ÊäïËµÑ‰∏ªÁ∫ø</div>\n                        <div class="step-status" id="status-3">‚ñ∂Ô∏è</div>\n                    </div>\n                    <div class="workflow-step" id="step-4" onclick="runStep(4)">\n                        <div class="step-number">4</div>\n                        <div class="step-icon">üì¶</div>\n                        <div class="step-name">ÂÄôÈÄâÊ±†</div>\n                        <div class="step-status" id="status-4">‚ñ∂Ô∏è</div>\n                    </div>\n                    <div class="workflow-step" id="step-5" onclick="runStep(5)">\n                        <div class="step-number">5</div>\n                        <div class="step-icon">üìä</div>\n                        <div class="step-name">Âõ†Â≠êÊûÑÂª∫</div>\n                        <div class="step-status" id="status-5">‚ñ∂Ô∏è</div>\n                    </div>\n                    <div class="workflow-step" id="step-6" onclick="runStep(6)">\n                        <div class="step-number">6</div>\n                        <div class="step-icon">üõ†Ô∏è</div>\n                        <div class="step-name">Á≠ñÁï•ÂºÄÂèë</div>\n                        <div class="step-status" id="status-6">‚ñ∂Ô∏è</div>\n                    </div>\n                    <div class="workflow-step" id="step-7" onclick="runStep(7)">\n                        <div class="step-number">7</div>\n                        <div class="step-icon">üîÑ</div>\n                        <div class="step-name">ÂõûÊµãÈ™åËØÅ</div>\n                        <div class="step-status" id="status-7">‚ñ∂Ô∏è</div>\n                    </div>\n                    <div class="workflow-step" id="step-8" onclick="runStep(8)">\n                        <div class="step-number">8</div>\n                        <div class="step-icon">üöÄ</div>\n                        <div class="step-name">ÂÆûÁõò‰∫§Êòì</div>\n                        <div class="step-status" id="status-8">‚ñ∂Ô∏è</div>\n                    </div>\n                </div>\n                \n                \x3c!-- ÊâßË°åÁªìÊûúÂå∫Âüü --\x3e\n                <div class="result-panel" id="result-panel">\n                    <div class="result-header">\n                        <span class="result-title" id="result-title">üìã ÊâßË°åÁªìÊûú</span>\n                        <button class="close-btn" onclick="hideResultPanel()">‚úï</button>\n                    </div>\n                    <div class="result-summary" id="result-summary">\n                        ÁÇπÂáªÂ∑¶‰æßÊ≠•È™§ÂºÄÂßãÊâßË°å...\n                    </div>\n                    <div class="result-progress" id="result-progress" style="display:none;">\n                        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>\n                        <span class="progress-text" id="progress-text">ÊâßË°å‰∏≠...</span>\n                    </div>\n                    <div class="result-details" id="result-details"></div>\n                    <div class="result-files" id="result-files"></div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- Âø´Êç∑Êìç‰Ωú --\x3e\n        <div class="quick-section">\n            <div class="section-title">‚ö° Âø´Êç∑Êìç‰Ωú</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'openBacktestConfig\'})">\n                    <div class="quick-icon">üß™</div>\n                    <div class="quick-info">\n                        <h4>ÂõûÊµãÈÖçÁΩÆ</h4>\n                        <p>ÈÖçÁΩÆÂπ∂ËøêË°åÁ≠ñÁï•ÂõûÊµã</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">üìÅ</div>\n                    <div class="quick-info">\n                        <h4>Êñ∞Âª∫È°πÁõÆ</h4>\n                        <p>ÂàõÂª∫Êñ∞ÁöÑÈáèÂåñÈ°πÁõÆ</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateStrategy\'})">\n                    <div class="quick-icon">ü§ñ</div>\n                    <div class="quick-info">\n                        <h4>AIÁîüÊàêÁ≠ñÁï•</h4>\n                        <p>Êô∫ËÉΩÁîüÊàêPTrade‰ª£Á†Å</p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">üîç</div>\n                    <div class="quick-info">\n                        <h4>Á≠ñÁï•‰ºòÂåñ</h4>\n                        <p>ÂàÜÊûêÂπ∂‰ºòÂåñÁ≠ñÁï•‰ª£Á†Å</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">üìã</div>\n                    <div class="quick-info">\n                        <h4>Êü•ÁúãÊó•Âøó</h4>\n                        <p>Á≥ªÁªüËøêË°åÊó•Âøó</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- Á≥ªÁªüÁÆ°ÁêÜ --\x3e\n        <div class="quick-section">\n            <div class="section-title">üîß Á≥ªÁªüÁÆ°ÁêÜ‰∏éÊñá‰ª∂‰∏≠ÂøÉ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">üìÅ</div>\n                    <div class="quick-info">\n                        <h4>Êñá‰ª∂ÁÆ°ÁêÜÁ≥ªÁªü</h4>\n                        <p>Web‰ª™Ë°®Áõò(Á≠ñÁï•/Êä•Âëä/Êï∞ÊçÆÂ∫ì)</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">üìä</div>\n                    <div class="quick-info">\n                        <h4>ÁîüÊàêÊäïËµÑÊä•Âëä</h4>\n                        <p>AIÁªºÂêàÂàÜÊûêÊä•Âëä</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'syncFileChanges\'})">\n                    <div class="quick-icon">üîÑ</div>\n                    <div class="quick-info">\n                        <h4>Êô∫ËÉΩÂêåÊ≠•</h4>\n                        <p>Ê£ÄÊµãÊõ¥Êñ∞ÁöÑÊñá‰ª∂</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'exportDatabase\'})">\n                    <div class="quick-icon">üóÑÔ∏è</div>\n                    <div class="quick-info">\n                        <h4>Êï∞ÊçÆÂ∫ìÁÆ°ÁêÜ</h4>\n                        <p>ÂØºÂá∫/Â§á‰ªΩMongoDB</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'openSettings\'})">\n                    <div class="quick-icon">‚öôÔ∏è</div>\n                    <div class="quick-info">\n                        <h4>Á≥ªÁªüËÆæÁΩÆ</h4>\n                        <p>ÈÖçÁΩÆÂèÇÊï∞ÁÆ°ÁêÜ</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">üìã</div>\n                    <div class="quick-info">\n                        <h4>ËøêË°åÊó•Âøó</h4>\n                        <p>Á≥ªÁªüËøêË°åÊó•Âøó</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- ÊúÄËøëÈ°πÁõÆ & ÂõûÊµã --\x3e\n        <div class="bottom-grid">\n            <div class="card">\n                <div class="card-header">\n                    <h3>üìÅ ÊúÄËøëÈ°πÁõÆ</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openProject\'})">ÊâìÂºÄÈ°πÁõÆ</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="project-list" id="projectList">\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">üêâ ÁùøÊô∫ÈáëÈæô</div>\n                                <div class="item-date">2024-12-03</div>\n                            </div>\n                            <span style="color: var(--text-muted)">‚Üí</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ü¶Ö ÁÅµÂä®Á¢ßÈπ§</div>\n                                <div class="item-date">2024-12-02</div>\n                            </div>\n                            <span style="color: var(--text-muted)">‚Üí</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">üéã È£òÈÄ∏Á¥´Á´π</div>\n                                <div class="item-date">2024-12-01</div>\n                            </div>\n                            <span style="color: var(--text-muted)">‚Üí</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>üìä ÊúÄËøëÂõûÊµã</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 7})">Êü•ÁúãÂÖ®ÈÉ®</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="backtest-list" id="backtestList">\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">test1 Âä®ÈáèÊàêÈïøÁ≠ñÁï•</div>\n                                <div class="item-date">2024-12-03 15:30</div>\n                            </div>\n                            <div class="item-return positive">+15.2%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">momentum Á≠ñÁï•</div>\n                                <div class="item-date">2024-12-02 10:15</div>\n                            </div>\n                            <div class="item-return positive">+8.5%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">multi_factor Â§öÂõ†Â≠ê</div>\n                                <div class="item-date">2024-12-01 14:20</div>\n                            </div>\n                            <div class="item-return negative">-2.1%</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    \x3c!-- Âä†ËΩΩÈÅÆÁΩ© --\x3e\n    <div class="loading-overlay" id="loadingOverlay">\n        <div class="loading-spinner"></div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        // ÊâìÂºÄÊ°åÈù¢Á≥ªÁªüÔºàÂÆåÊï¥Â∑•‰ΩúÊµÅÔºâ\n        function openWorkflowPanel() {\n            console.log(\'[MainDashboard HTML] ÁÇπÂáªÊâìÂºÄÊ°åÈù¢Á≥ªÁªüÊåâÈíÆ\');\n            try {\n                vscode.postMessage({command: \'openWorkflowPanel\'});\n                console.log(\'[MainDashboard HTML] ÂêØÂä®Ê°åÈù¢Á≥ªÁªüÊ∂àÊÅØÂ∑≤ÂèëÈÄÅ\');\n            } catch (error) {\n                console.error(\'[MainDashboard HTML] ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:\', error);\n            }\n        }\n        \n        // Êõ¥Êñ∞Â∏ÇÂú∫Áä∂ÊÄÅ\n        function updateMarketStatus(data) {\n            if (!data) return;\n            \n            // Â∏ÇÂú∫Regime\n            document.getElementById(\'marketRegime\').textContent = data.regime_cn || data.regime || \'‰∏≠ÊÄß\';\n            document.getElementById(\'marketStyle\').textContent = data.style_rotation || \'ÂùáË°°\';\n            \n            // ÊåáÊï∞Êï∞ÊçÆ\n            if (data.indices && data.indices.length >= 3) {\n                const [sh, sz, cy] = data.indices;\n                \n                document.getElementById(\'shIndex\').textContent = sh.value?.toFixed(2) || \'-\';\n                document.getElementById(\'shChange\').textContent = (sh.change >= 0 ? \'+\' : \'\') + (sh.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'shChange\').className = \'change \' + (sh.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'szIndex\').textContent = sz.value?.toFixed(2) || \'-\';\n                document.getElementById(\'szChange\').textContent = (sz.change >= 0 ? \'+\' : \'\') + (sz.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'szChange\').className = \'change \' + (sz.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'cyIndex\').textContent = cy.value?.toFixed(2) || \'-\';\n                document.getElementById(\'cyChange\').textContent = (cy.change >= 0 ? \'+\' : \'\') + (cy.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'cyChange\').className = \'change \' + (cy.change >= 0 ? \'up\' : \'down\');\n            }\n        }\n        \n        // Êõ¥Êñ∞ÊäïËµÑ‰∏ªÁ∫ø\n        function updateMainlines(data) {\n            const container = document.getElementById(\'mainlineList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">üî•</div><div>ÊöÇÊó†ÊäïËµÑ‰∏ªÁ∫øÊï∞ÊçÆ</div></div>\';\n                return;\n            }\n            \n            container.innerHTML = data.map((m, i) => {\n                const rankClass = i === 0 ? \'\' : i === 1 ? \'silver\' : i === 2 ? \'bronze\' : \'\';\n                return `\n                    <div class="mainline-item">\n                        <div class="mainline-rank ${rankClass}">${i + 1}</div>\n                        <div class="mainline-info">\n                            <div class="mainline-name">${m.name}</div>\n                            <div class="mainline-industries">${m.industries?.slice(0, 3).join(\' ¬∑ \') || \'\'}</div>\n                        </div>\n                        <div class="mainline-score">‚≠ê${m.score}</div>\n                    </div>\n                `;\n            }).join(\'\');\n        }\n        \n        // Êõ¥Êñ∞Âõ†Â≠ê\n        function updateFactors(data) {\n            const container = document.getElementById(\'factorList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">üìä</div><div>ÊöÇÊó†Âõ†Â≠êÊé®Ëçê</div></div>\';\n                return;\n            }\n            \n            const icons = [\'üìà\', \'üíπ\', \'üí∞\', \'‚ö°\', \'üéØ\'];\n            container.innerHTML = data.map((f, i) => `\n                <div class="factor-item">\n                    <div class="factor-icon">${icons[i % icons.length]}</div>\n                    <div class="factor-info">\n                        <div class="factor-name">${f.name}</div>\n                        <div class="factor-category">${f.category || \'ÈáèÂåñÂõ†Â≠ê\'}</div>\n                    </div>\n                    <div class="factor-weight">${(f.weight * 100).toFixed(0)}%</div>\n                </div>\n            `).join(\'\');\n        }\n        \n        // =====================\n        // Â∑•‰ΩúÊµÅÊ≠•È™§ÊâßË°å\n        // =====================\n        \n        function runStep(step) {\n            vscode.postMessage({command: \'openStep\', step: step});\n        }\n        \n        function showResultPanel() {\n            document.getElementById(\'result-panel\').classList.add(\'visible\');\n        }\n        \n        function hideResultPanel() {\n            document.getElementById(\'result-panel\').classList.remove(\'visible\');\n        }\n        \n        function setStepStatus(step, status) {\n            const stepEl = document.getElementById(\'step-\' + step);\n            const statusEl = document.getElementById(\'status-\' + step);\n            \n            // ÁßªÈô§ÊâÄÊúâÁä∂ÊÄÅÁ±ª\n            stepEl.classList.remove(\'running\', \'completed\', \'failed\');\n            \n            switch(status) {\n                case \'running\':\n                    stepEl.classList.add(\'running\');\n                    statusEl.textContent = \'‚è≥\';\n                    break;\n                case \'completed\':\n                    stepEl.classList.add(\'completed\');\n                    statusEl.textContent = \'‚úÖ\';\n                    break;\n                case \'failed\':\n                    stepEl.classList.add(\'failed\');\n                    statusEl.textContent = \'‚ùå\';\n                    break;\n                default:\n                    statusEl.textContent = \'‚ñ∂Ô∏è\';\n            }\n        }\n        \n        function showProgress(show, value, text) {\n            const el = document.getElementById(\'result-progress\');\n            el.style.display = show ? \'block\' : \'none\';\n            if (show) {\n                document.getElementById(\'progress-fill\').style.width = value + \'%\';\n                document.getElementById(\'progress-text\').textContent = text || \'ÊâßË°å‰∏≠...\';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return \'<div style="color:var(--text-muted);">Êó†ËØ¶ÁªÜÊï∞ÊçÆ</div>\';\n            }\n            \n            let html = \'\';\n            \n            // ÊäïËµÑ‰∏ªÁ∫ø\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#f59e0b;">üî• ÊäïËµÑ‰∏ªÁ∫ø TOP\' + mainlines.length + \'</strong></div>\';\n                html += \'<table><tr><th>ÊéíÂêç</th><th>ÂêçÁß∞</th><th>ËØÑÂàÜ</th></tr>\';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += \'<tr><td>#\' + (ml.rank || \'-\') + \'</td><td>\' + (ml.name || \'-\') + \'</td><td style="color:#10b981;">\' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || ml.composite_score || ml.score || \'-\') + \'</td></tr>\';\n                });\n                if (mainlines.length > 10) {\n                    html += \'<tr><td colspan="3" style="color:var(--text-muted);">... ÂÖ±\' + mainlines.length + \'‰∏™‰∏ªÁ∫ø</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // ÂÄôÈÄâÊ±†ËÇ°Á•®\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#8b5cf6;">üì¶ ÂÄôÈÄâÊ±†ËÇ°Á•® (\' + stocks.length + \'Âè™)</strong></div>\';\n                html += \'<table><tr><th>‰ª£Á†Å</th><th>ÂêçÁß∞</th><th>Êù•Ê∫ê</th><th>ËØÑÂàÜ</th></tr>\';\n                stocks.slice(0, 15).forEach(s => {\n                    html += \'<tr><td>\' + (s.code || \'-\') + \'</td><td>\' + (s.name || \'-\') + \'</td><td style="color:var(--text-muted);">\' + (s.source || \'-\') + \'</td><td style="color:#10b981;">\' + ((s.score || 0).toFixed?.(1) || \'-\') + \'</td></tr>\';\n                });\n                html += \'</table>\';\n            }\n            \n            // Êé®ËçêÂõ†Â≠ê\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">üßÆ Êé®ËçêÂõ†Â≠ê</strong></div>\';\n                html += \'<ul style="margin:0;padding-left:20px;">\';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += \'<li style="margin:6px 0;"><strong>\' + (f.name || \'-\') + \'</strong> (ÊùÉÈáç\' + weight + \'%) - \' + (f.reason || \'\') + \'</li>\';\n                });\n                html += \'</ul>\';\n            }\n            \n            // Êï∞ÊçÆÊ∫êÊ£ÄÊµã\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">üì° Êï∞ÊçÆÊ∫êÁä∂ÊÄÅ</strong></div>\';\n                html += \'<table><tr><th>Êï∞ÊçÆÊ∫ê</th><th>Áä∂ÊÄÅ</th></tr>\';\n                if (details.jqdata !== undefined) {\n                    html += \'<tr><td>JQData</td><td style="color:\' + (details.jqdata ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.jqdata ? \'‚úÖ ÂèØÁî®\' : \'‚ùå ‰∏çÂèØÁî®\') + \'</td></tr>\';\n                }\n                if (details.akshare !== undefined) {\n                    html += \'<tr><td>AKShare</td><td style="color:\' + (details.akshare ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.akshare ? \'‚úÖ ÂèØÁî®\' : \'‚ùå ‰∏çÂèØÁî®\') + \'</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // Â∏ÇÂú∫Ë∂ãÂäø\n            else if (details.regime || details.trend_strength !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">üìà Â∏ÇÂú∫Ë∂ãÂäøÂàÜÊûê</strong></div>\';\n                html += \'<table><tr><th>ÊåáÊ†á</th><th>Êï∞ÂÄº</th></tr>\';\n                if (details.regime) html += \'<tr><td>Â∏ÇÂú∫Regime</td><td>\' + details.regime + \'</td></tr>\';\n                if (details.trend_strength !== undefined) html += \'<tr><td>Ë∂ãÂäøÂº∫Â∫¶</td><td>\' + details.trend_strength + \'</td></tr>\';\n                if (details.volatility !== undefined) html += \'<tr><td>Ê≥¢Âä®Áéá</td><td>\' + details.volatility + \'</td></tr>\';\n                if (details.style_rotation) html += \'<tr><td>È£éÊ†ºËΩÆÂä®</td><td>\' + details.style_rotation + \'</td></tr>\';\n                html += \'</table>\';\n            }\n            \n            // Á≠ñÁï•Êñá‰ª∂\n            else if (details.strategy_file) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">üíª Á≠ñÁï•ÁîüÊàêÂÆåÊàê</strong></div>\';\n                html += \'<div style="background:var(--bg-card);padding:12px;border-radius:8px;">\';\n                html += \'<div>üìÑ Á≠ñÁï•Êñá‰ª∂: <strong>\' + details.strategy_file.split(\'/\').pop() + \'</strong></div>\';\n                if (details.platform) html += \'<div>üéØ ÁõÆÊ†áÂπ≥Âè∞: \' + details.platform + \'</div>\';\n                if (details.style) html += \'<div>üìä Á≠ñÁï•È£éÊ†º: \' + details.style + \'</div>\';\n                html += \'</div>\';\n            }\n            \n            // ÈªòËÆ§JSONÊòæÁ§∫\n            else {\n                html += \'<pre style="font-size:11px;overflow-x:auto;">\' + JSON.stringify(details, null, 2) + \'</pre>\';\n            }\n            \n            return html;\n        }\n        \n        // Â§ÑÁêÜÊ∂àÊÅØ\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'loadingStart\':\n                    document.getElementById(\'loadingOverlay\').classList.add(\'active\');\n                    break;\n                case \'loadingEnd\':\n                    document.getElementById(\'loadingOverlay\').classList.remove(\'active\');\n                    break;\n                case \'marketStatusUpdated\':\n                    updateMarketStatus(message.data);\n                    break;\n                case \'mainlinesUpdated\':\n                    updateMainlines(message.data);\n                    break;\n                case \'factorsUpdated\':\n                    updateFactors(message.data);\n                    break;\n                    \n                // Â∑•‰ΩúÊµÅÊ≠•È™§ÊâßË°å\n                case \'stepStarted\':\n                    setStepStatus(message.step, \'running\');\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'üìã \' + message.stepName + \' - ÊâßË°å‰∏≠\';\n                    document.getElementById(\'result-summary\').textContent = \'Ê≠£Âú®ÊâßË°å \' + message.stepName + \'...\';\n                    document.getElementById(\'result-details\').innerHTML = \'\';\n                    showProgress(true, 30, \'ÊâßË°å‰∏≠...\');\n                    break;\n                    \n                case \'stepResult\':\n                    setStepStatus(message.step, message.success ? \'completed\' : \'failed\');\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = \'üìã \' + message.stepName + \' - \' + (message.success ? \'‚úÖ ÂÆåÊàê\' : \'‚ùå Â§±Ë¥•\');\n                    document.getElementById(\'result-summary\').textContent = message.summary || (message.success ? \'ÊâßË°åÊàêÂäü\' : \'ÊâßË°åÂ§±Ë¥•\');\n                    document.getElementById(\'result-details\').innerHTML = formatDetails(message.details);\n                    break;\n                \n                // ‰∏ÄÈîÆÊâßË°åÂÖ®ÈÉ®Â∑•‰ΩúÊµÅÁöÑÊ∂àÊÅØÂ§ÑÁêÜ\n                case \'workflowProgress\':\n                    var data = message.data;\n                    if (data.currentStep) {\n                        setStepStatus(data.currentStep, \'running\');\n                    }\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'üîÑ ÊâßË°åÂ∑•‰ΩúÊµÅ - \' + data.stepName;\n                    document.getElementById(\'result-summary\').textContent = \'ËøõÂ∫¶: \' + Math.round(data.progress) + \'%\';\n                    showProgress(true, data.progress, data.stepName);\n                    break;\n                    \n                case \'workflowStepResult\':\n                    var stepData = message.data;\n                    if (stepData.stepId) {\n                        setStepStatus(stepData.stepId, stepData.success ? \'completed\' : \'failed\');\n                    }\n                    // Á¥ØÂä†ÊòæÁ§∫ÁªìÊûú\n                    var detailsEl = document.getElementById(\'result-details\');\n                    var stepHtml = \'<div style="margin:8px 0;padding:8px;background:var(--bg-card);border-radius:6px;border-left:3px solid \' + \n                        (stepData.success ? \'#10b981\' : \'#ef4444\') + \';">\';\n                    stepHtml += \'<strong>\' + stepData.stepName + \'</strong>: \' + (stepData.success ? \'‚úÖ\' : \'‚ùå\');\n                    stepHtml += \'</div>\';\n                    detailsEl.innerHTML += stepHtml;\n                    break;\n                    \n                case \'workflowComplete\':\n                    var completeData = message.data;\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = completeData.hasError ? \'‚ö†Ô∏è Â∑•‰ΩúÊµÅÂÆåÊàêÔºàÈÉ®ÂàÜÂ§±Ë¥•Ôºâ\' : \'‚úÖ Â∑•‰ΩúÊµÅÊâßË°åÂÆåÊàê\';\n                    document.getElementById(\'result-summary\').textContent = \'ÂÖ±ÊâßË°å \' + completeData.results.length + \' ‰∏™Ê≠•È™§\';\n                    \n                    // ÊòæÁ§∫Ê±áÊÄª\n                    var summaryHtml = \'<div style="margin-top:16px;">\';\n                    summaryHtml += \'<h4 style="color:var(--accent-gold);margin-bottom:8px;">ÊâßË°åÁªìÊûúÊ±áÊÄª</h4>\';\n                    completeData.results.forEach(function(r) {\n                        summaryHtml += \'<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">\';\n                        summaryHtml += \'<span>\' + (r.success ? \'‚úÖ\' : \'‚ùå\') + \'</span>\';\n                        summaryHtml += \'<span>\' + r.step + \'</span>\';\n                        if (r.error) {\n                            summaryHtml += \'<span style="color:#ef4444;font-size:11px;">(\' + r.error + \')</span>\';\n                        }\n                        summaryHtml += \'</div>\';\n                    });\n                    summaryHtml += \'</div>\';\n                    document.getElementById(\'result-details\').innerHTML += summaryHtml;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>'}dispose(){for(g.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}}n.MainDashboard=g},144:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.createManualLearner=n.ManualLearner=n.createStrategyLearner=n.StrategyLearner=n.getKnowledgeStore=n.KnowledgeStore=void 0;var a=t(683);Object.defineProperty(n,"KnowledgeStore",{enumerable:!0,get:function(){return a.KnowledgeStore}}),Object.defineProperty(n,"getKnowledgeStore",{enumerable:!0,get:function(){return a.getKnowledgeStore}});var r=t(46);Object.defineProperty(n,"StrategyLearner",{enumerable:!0,get:function(){return r.StrategyLearner}}),Object.defineProperty(n,"createStrategyLearner",{enumerable:!0,get:function(){return r.createStrategyLearner}});var s=t(767);Object.defineProperty(n,"ManualLearner",{enumerable:!0,get:function(){return s.ManualLearner}}),Object.defineProperty(n,"createManualLearner",{enumerable:!0,get:function(){return s.createManualLearner}})},150:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.StrategyAnalyzer=void 0,n.createStrategyAnalyzer=function(){return new c};const a=t(628),r="StrategyAnalyzer",s=[{pattern:/momentum|Âä®Èáè|Ê∂®ÂπÖ|Êî∂ÁõäÁéá/gi,name:"Âä®ÈáèÂõ†Â≠ê",type:"momentum"},{pattern:/rsi|Áõ∏ÂØπÂº∫Âº±/gi,name:"RSI",type:"momentum"},{pattern:/macd/gi,name:"MACD",type:"momentum"},{pattern:/pe_ratio|Â∏ÇÁõàÁéá|PE/gi,name:"Â∏ÇÁõàÁéá",type:"value"},{pattern:/pb_ratio|Â∏ÇÂáÄÁéá|PB/gi,name:"Â∏ÇÂáÄÁéá",type:"value"},{pattern:/ps_ratio|Â∏ÇÈîÄÁéá/gi,name:"Â∏ÇÈîÄÁéá",type:"value"},{pattern:/roe|ÂáÄËµÑ‰∫ßÊî∂ÁõäÁéá/gi,name:"ROE",type:"quality"},{pattern:/roa|ËµÑ‰∫ßÊî∂ÁõäÁéá/gi,name:"ROA",type:"quality"},{pattern:/gross_margin|ÊØõÂà©Áéá/gi,name:"ÊØõÂà©Áéá",type:"quality"},{pattern:/revenue_growth|Ëê•Êî∂Â¢ûÈïø/gi,name:"Ëê•Êî∂Â¢ûÈïø",type:"growth"},{pattern:/profit_growth|Âà©Ê∂¶Â¢ûÈïø/gi,name:"Âà©Ê∂¶Â¢ûÈïø",type:"growth"},{pattern:/eps_growth|EPSÂ¢ûÈïø/gi,name:"EPSÂ¢ûÈïø",type:"growth"},{pattern:/ma\d+|ÂùáÁ∫ø|moving_average/gi,name:"ÂùáÁ∫ø",type:"technical"},{pattern:/volatility|Ê≥¢Âä®Áéá/gi,name:"Ê≥¢Âä®Áéá",type:"technical"},{pattern:/volume|Êàê‰∫§Èáè|Êç¢ÊâãÁéá/gi,name:"Êàê‰∫§Èáè",type:"technical"}],o={stopLoss:/stop_loss|Ê≠¢Êçü|Ê≠¢ÊçüÁ∫ø?\s*[=:]\s*([\d.]+)/gi,takeProfit:/take_profit|Ê≠¢Áõà|Ê≠¢ÁõàÁ∫ø?\s*[=:]\s*([\d.]+)/gi,maxPosition:/max_position|ÊúÄÂ§ß‰ªì‰Ωç|ÊÄª‰ªì‰Ωç\s*[=:]\s*([\d.]+)/gi,singleStockMax:/single.*max|ÂçïËÇ°.*‰ªì‰Ωç\s*[=:]\s*([\d.]+)/gi,drawdown:/drawdown|ÂõûÊí§|ÊúÄÂ§ßÂõûÊí§/gi},i={ptrade:/PTrade|ÊÅíÁîü|run_daily|run_weekly/i,qmt:/QMT|ËøÖÊäï|xtquant/i,joinquant:/ËÅöÂÆΩ|jqdata|set_benchmark/i};class c{analyze(e,n){a.logger.info(`ÂºÄÂßãÂàÜÊûêÁ≠ñÁï•: ${n||"Êú™ÂëΩÂêç"}`,r);const t={name:this.extractName(e,n),platform:this.detectPlatform(e),factors:this.extractFactors(e),riskControl:this.extractRiskControl(e),stockSelection:this.extractStockSelection(e),trading:this.extractTradingInfo(e),issues:[]};return t.issues=this.detectIssues(t,e),a.logger.info(`Á≠ñÁï•ÂàÜÊûêÂÆåÊàê: ${t.factors.length}‰∏™Âõ†Â≠ê, ${t.issues.length}‰∏™ÈóÆÈ¢ò`,r),t}extractName(e,n){const t=e.match(/"""[\s\S]*?([^\n]+)[\s\S]*?"""/);return t?t[1].trim():n?n.replace(/\.(py|txt)$/,""):"Êú™ÂëΩÂêçÁ≠ñÁï•"}detectPlatform(e){for(const[n,t]of Object.entries(i))if(t.test(e))return n;return"unknown"}extractFactors(e){const n=[],t=new Set;for(const{pattern:a,name:r,type:o}of s){const s=e.matchAll(a);for(const a of s)if(!t.has(r)){t.add(r);const s=e.lastIndexOf("\n",a.index)+1,i=e.indexOf("\n",a.index),c=e.slice(s,i>0?i:void 0).trim();n.push({name:r,type:o,code:c.slice(0,100)})}}return n}extractRiskControl(e){const n={hasDrawdownControl:o.drawdown.test(e)},t=e.match(/stop_loss\s*[=:]\s*([\d.]+)/i)||e.match(/Ê≠¢Êçü.*?([\d.]+)/);t&&(n.stopLoss=parseFloat(t[1]));const a=e.match(/take_profit\s*[=:]\s*([\d.]+)/i)||e.match(/Ê≠¢Áõà.*?([\d.]+)/);a&&(n.takeProfit=parseFloat(a[1]));const r=e.match(/max_position\s*[=:]\s*([\d.]+)/i)||e.match(/ÊúÄÂ§ß‰ªì‰Ωç.*?([\d.]+)/);r&&(n.maxPosition=parseFloat(r[1]));const s=e.match(/single.*max\s*[=:]\s*([\d.]+)/i);return s&&(n.singleStockMax=parseFloat(s[1])),n}extractStockSelection(e){const n={universe:"Êú™Áü•",filters:[]};/Ê≤™Ê∑±300|000300/i.test(e)?n.universe="Ê≤™Ê∑±300":/‰∏≠ËØÅ500|000905/i.test(e)?n.universe="‰∏≠ËØÅ500":/Âàõ‰∏öÊùø/i.test(e)?n.universe="Âàõ‰∏öÊùø":/ÂÖ®Â∏ÇÂú∫|all_stocks/i.test(e)&&(n.universe="ÂÖ®Â∏ÇÂú∫"),/ST/i.test(e)&&n.filters.push("ÊéíÈô§ST"),/ÂÅúÁâå|is_paused/i.test(e)&&n.filters.push("ÊéíÈô§ÂÅúÁâå"),/Ê∂®Ë∑åÂÅú|limit/i.test(e)&&n.filters.push("ÊéíÈô§Ê∂®Ë∑åÂÅú"),/Â∏ÇÂÄº.*?‰∫ø|market_cap/i.test(e)&&n.filters.push("Â∏ÇÂÄºÁ≠õÈÄâ");const t=e.match(/g\.stock_num\s*=\s*(\d+)/i)||e.match(/top.*?(\d+)/i);return t&&(n.topN=parseInt(t[1])),n}extractTradingInfo(e){const n={frequency:"daily",hasTimingLogic:!1};/run_monthly|ÊúàÂ∫¶/i.test(e)?n.frequency="monthly":/run_weekly|Âë®Â∫¶|ÊØèÂë®/i.test(e)?n.frequency="weekly":/ÂàÜÈíü|intraday|minute/i.test(e)&&(n.frequency="intraday");const t=e.match(/rebalance_day\s*=\s*['"]?(\w+)['"]?/i);return t&&(n.rebalanceDay=t[1]),n.hasTimingLogic=/Êã©Êó∂|timing|Â§ßÁõò.*Âà§Êñ≠|Â∏ÇÂú∫.*Áä∂ÊÄÅ/i.test(e),n}detectIssues(e,n){const t=[];return e.riskControl.stopLoss||t.push({type:"warning",category:"risk",message:"Êú™ËÆæÁΩÆÊ≠¢ÊçüÁ∫ø",suggestion:"Âª∫ËÆÆËÆæÁΩÆ8%-15%ÁöÑÊ≠¢ÊçüÁ∫øÊéßÂà∂È£éÈô©"}),e.riskControl.maxPosition||t.push({type:"suggestion",category:"risk",message:"Êú™ÊòéÁ°ÆËÆæÁΩÆÊúÄÂ§ß‰ªì‰Ωç",suggestion:"Âª∫ËÆÆËÆæÁΩÆÊÄª‰ªì‰Ωç‰∏äÈôêÔºåÂ¶Ç80%"}),e.riskControl.stopLoss&&e.riskControl.stopLoss>.2&&t.push({type:"warning",category:"risk",message:`Ê≠¢ÊçüÁ∫øËøáÂÆΩ (${(100*e.riskControl.stopLoss).toFixed(0)}%)`,suggestion:"Âª∫ËÆÆÊ≠¢ÊçüÁ∫ø‰∏çË∂ÖËøá15%"}),0===e.factors.length&&t.push({type:"warning",category:"factor",message:"Êú™ËØÜÂà´Âà∞ÊòéÁ°ÆÁöÑÈÄâËÇ°Âõ†Â≠ê",suggestion:"Âª∫ËÆÆ‰ΩøÁî®ÈáèÂåñÂõ†Â≠êÔºàÂ¶ÇÂä®Èáè„ÄÅ‰ª∑ÂÄº„ÄÅË¥®ÈáèÔºâËøõË°åÈÄâËÇ°"}),1===e.factors.length&&t.push({type:"suggestion",category:"factor",message:"‰ªÖ‰ΩøÁî®Âçï‰∏ÄÂõ†Â≠ê",suggestion:"Âª∫ËÆÆÁªÑÂêàÂ§ö‰∏™‰ΩéÁõ∏ÂÖ≥Âõ†Â≠êÊèêÈ´òÁ®≥ÂÆöÊÄß"}),e.stockSelection.topN&&e.stockSelection.topN<5&&t.push({type:"warning",category:"risk",message:`ÊåÅËÇ°Êï∞ÈáèËøáÂ∞ë (${e.stockSelection.topN}Âè™)`,suggestion:"Âª∫ËÆÆÊåÅÊúâ5-20Âè™ËÇ°Á•®ÂàÜÊï£È£éÈô©"}),/def\s+initialize/i.test(n)||t.push({type:"error",category:"code",message:"Áº∫Â∞ëinitializeÂáΩÊï∞",suggestion:"ÈúÄË¶ÅÂÆö‰πâinitialize(context)ÂàùÂßãÂåñÂáΩÊï∞"}),t}}n.StrategyAnalyzer=c},238:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.generateStrategy=async function(e,n){c.logger.info("ÊâßË°åÁîüÊàêÁ≠ñÁï•ÂëΩ‰ª§",d);try{const n=await async function(){const e=await i.window.showQuickPick(p,{placeHolder:"ÈÄâÊã©Á≠ñÁï•Âπ≥Âè∞",title:"Step 1/3: ÈÄâÊã©ÁõÆÊ†áÂπ≥Âè∞"});return e?.value}();if(!n)return;const t=await async function(){const e=await i.window.showQuickPick(g,{placeHolder:"ÈÄâÊã©Á≠ñÁï•È£éÊ†º",title:"Step 2/3: ÈÄâÊã©Á≠ñÁï•È£éÊ†º"});return e?.value}();if(!t)return;const a=await async function(){const e=await i.window.showQuickPick([{label:"‚úÖ ‰ΩøÁî®ÈªòËÆ§ÂèÇÊï∞",value:"default",description:"Ê≠¢Êçü8%, Ê≠¢Áõà20%, ÂçïÁ•®10%"},{label:"‚öôÔ∏è Ëá™ÂÆö‰πâÂèÇÊï∞",value:"custom",description:"ÊâãÂä®ÈÖçÁΩÆÈ£éÊéßÂèÇÊï∞"}],{placeHolder:"È£éÊéßÂèÇÊï∞ÈÖçÁΩÆ",title:"Step 3/3: ÈÖçÁΩÆÈ£éÊéßÂèÇÊï∞"});if(!e)return;if("default"===e.value)return{max_position:.1,stop_loss:.08,take_profit:.2};const n=await i.window.showInputBox({prompt:"ÂçïÁ•®ÊúÄÂ§ß‰ªì‰Ωç (%)",value:"10",validateInput:e=>{const n=parseFloat(e);return isNaN(n)||n<=0||n>100?"ËØ∑ËæìÂÖ•1-100‰πãÈó¥ÁöÑÊï∞Â≠ó":null}});if(!n)return;const t=await i.window.showInputBox({prompt:"Ê≠¢ÊçüÁ∫ø (%)",value:"8",validateInput:e=>{const n=parseFloat(e);return isNaN(n)||n<=0||n>50?"ËØ∑ËæìÂÖ•1-50‰πãÈó¥ÁöÑÊï∞Â≠ó":null}});if(!t)return;const a=await i.window.showInputBox({prompt:"Ê≠¢ÁõàÁ∫ø (%)",value:"20",validateInput:e=>{const n=parseFloat(e);return isNaN(n)||n<=0||n>100?"ËØ∑ËæìÂÖ•1-100‰πãÈó¥ÁöÑÊï∞Â≠ó":null}});return a?{max_position:parseFloat(n)/100,stop_loss:parseFloat(t)/100,take_profit:parseFloat(a)/100}:void 0}();if(!a)return;await async function(e,n,t,a,r){await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(n,s)=>{try{n.report({message:"Ëé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅ...",increment:0});const o=await e.getMarketStatus();if(s.isCancellationRequested)return;n.report({message:"Ëé∑ÂèñÊé®ËçêÂõ†Â≠ê...",increment:20});const l=await e.recommendFactors({market_regime:o.data?.regime});if(s.isCancellationRequested)return;n.report({message:`ÁîüÊàê${t.toUpperCase()}Á≠ñÁï•‰ª£Á†Å...`,increment:30});const p=(l.data||[]).slice(0,5).map(e=>e.name),g=await e.generateStrategy({factors:p,style:a,platform:t,risk_params:r});if(n.report({increment:30}),!g.ok||!g.data)return void i.window.showErrorMessage(`ÁîüÊàêÁ≠ñÁï•Â§±Ë¥•: ${g.error||"Êú™Áü•ÈîôËØØ"}`);const u=g.data;c.logger.info(`Á≠ñÁï•ÁîüÊàêÊàêÂäü: ${u.name}`,d),n.report({message:"ÂÆåÊàê",increment:20}),await async function(e,n,t){const a=await i.workspace.openTextDocument({content:n.code,language:"python"});switch(await i.window.showTextDocument(a,i.ViewColumn.One),await i.window.showInformationMessage(`${t.toUpperCase()} Á≠ñÁï• "${n.name}" Â∑≤ÁîüÊàê`,"‰øùÂ≠òÊñá‰ª∂","Â§çÂà∂‰ª£Á†Å","Êü•ÁúãËØ¥Êòé")){case"‰øùÂ≠òÊñá‰ª∂":await async function(e,n){const t=`${e.name}.py`,a=await i.window.showSaveDialog({defaultUri:i.Uri.file(t),filters:{PythonÊñá‰ª∂:["py"]},title:`‰øùÂ≠ò${n.toUpperCase()}Á≠ñÁï•`});if(a){await i.workspace.fs.writeFile(a,Buffer.from(e.code,"utf-8"));const n=i.Uri.file(a.fsPath.replace(".py","_meta.json")),t={name:e.name,platform:e.platform,style:e.style,factors:e.factors,risk_params:e.risk_params,created_at:(new Date).toISOString()};await i.workspace.fs.writeFile(n,Buffer.from(JSON.stringify(t,null,2),"utf-8")),i.window.showInformationMessage(`Á≠ñÁï•Â∑≤‰øùÂ≠ò: ${a.fsPath}`),c.logger.info(`Á≠ñÁï•‰øùÂ≠òÂà∞: ${a.fsPath}`,d)}}(n,t);break;case"Â§çÂà∂‰ª£Á†Å":await i.env.clipboard.writeText(n.code),i.window.showInformationMessage("Á≠ñÁï•‰ª£Á†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø");break;case"Êü•ÁúãËØ¥Êòé":!function(e){const n=`\n# Á≠ñÁï•ËØ¥Êòé\n\n## Âü∫Êú¨‰ø°ÊÅØ\n- **Á≠ñÁï•ÂêçÁß∞**: ${e.name}\n- **ÁõÆÊ†áÂπ≥Âè∞**: ${e.platform.toUpperCase()}\n- **Á≠ñÁï•È£éÊ†º**: ${{multi_factor:"Â§öÂõ†Â≠êÈÄâËÇ°",momentum_growth:"Âä®ÈáèÊàêÈïø",value:"‰ª∑ÂÄºÊäïËµÑ",market_neutral:"Â∏ÇÂú∫‰∏≠ÊÄß"}[e.style]}\n\n## ‰ΩøÁî®Âõ†Â≠ê\n${e.factors.map(e=>`- ${e}`).join("\n")}\n\n## È£éÊéßÂèÇÊï∞\n- **ÂçïÁ•®ÊúÄÂ§ß‰ªì‰Ωç**: ${(100*e.risk_params.max_position).toFixed(0)}%\n- **Ê≠¢ÊçüÁ∫ø**: ${(100*e.risk_params.stop_loss).toFixed(0)}%\n- **Ê≠¢ÁõàÁ∫ø**: ${(100*e.risk_params.take_profit).toFixed(0)}%\n\n## Á≠ñÁï•ÊèèËø∞\n${e.description}\n\n## ‰ΩøÁî®ËØ¥Êòé\n1. Â∞Ü‰ª£Á†ÅÂ§çÂà∂Âà∞${e.platform.toUpperCase()}ÂÆ¢Êà∑Á´Ø\n2. Ê†πÊçÆÂÆûÈôÖÊÉÖÂÜµË∞ÉÊï¥ËÇ°Á•®Ê±†ÂíåÂèÇÊï∞\n3. ËøõË°åÂõûÊµãÈ™åËØÅÂêéÂÜçÂÆûÁõò‰ΩøÁî®\n4. Ê≥®ÊÑèÈ£éÈô©ÊéßÂà∂Ôºå‰∏çË¶ÅË∂ÖËøáÊâøÂèóËÉΩÂäõ\n    `;i.workspace.openTextDocument({content:n,language:"markdown"}).then(e=>{i.window.showTextDocument(e,i.ViewColumn.Beside)})}(n)}}(0,u,t)}catch(e){l.ErrorHandler.handle(e,d)}})}(e,0,n,t,a)}catch(e){l.ErrorHandler.handle(e,d)}};const i=o(t(398)),c=t(628),l=t(799),d="GenerateStrategy",p=[{label:"üìä PTrade (ÊÅíÁîü)",value:"ptrade",description:"ÊÅíÁîüPTradeÂπ≥Âè∞ÔºåÊîØÊåÅAËÇ°„ÄÅETF‰∫§Êòì",detail:"ÂáΩÊï∞: initialize(), handle_data()"},{label:"üìà QMT (ËøÖÊäï)",value:"qmt",description:"ËøÖÊäïQMTÂπ≥Âè∞ÔºåÊîØÊåÅËÇ°Á•®„ÄÅÊúüË¥ß‰∫§Êòì",detail:"ÂáΩÊï∞: init(), handlebar()"}],g=[{label:"üìà Â§öÂõ†Â≠êÈÄâËÇ°",value:"multi_factor",description:"ÁªºÂêàÂ§ö‰∏™Âõ†Â≠êËØÑÂàÜÈÄâËÇ°",detail:"ÈÄÇÂêà: ÂêÑÁßçÂ∏ÇÂú∫ÁéØÂ¢É"},{label:"üöÄ Âä®ÈáèÊàêÈïø",value:"momentum_growth",description:"ËøΩÈÄêÂº∫ÂäøÊàêÈïøËÇ°",detail:"ÈÄÇÂêà: ÁâõÂ∏Ç„ÄÅÈ£éÈô©ÂÅèÂ•Ω‰∏äÂçá"},{label:"üí∞ ‰ª∑ÂÄºÊäïËµÑ",value:"value",description:"‰Ωé‰º∞ÂÄºÈ´òÂàÜÁ∫¢Ê†áÁöÑ",detail:"ÈÄÇÂêà: ÁÜäÂ∏Ç„ÄÅÈ£éÈô©ÂÅèÂ•Ω‰∏ãÈôç"},{label:"‚öñÔ∏è Â∏ÇÂú∫‰∏≠ÊÄß",value:"market_neutral",description:"Â§öÁ©∫ÂØπÂÜ≤Á≠ñÁï•",detail:"ÈÄÇÂêà: ÈúáËç°Â∏Ç„ÄÅ‰∏çÁ°ÆÂÆöÁéØÂ¢É"}]},265:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.activate=async function(e){console.log("[TRQuant] üöÄ Êâ©Â±ïÊøÄÊ¥ªÂºÄÂßã..."),_.logger.info("TRQuant Extension Ê≠£Âú®ÊøÄÊ¥ª...",P);const n=Date.now();try{console.log("[TRQuant] üì¶ Ê≥®ÂÜå createProject ÂëΩ‰ª§...");const a=i.commands.registerCommand("trquant.createProject",async()=>{console.log("[TRQuant] ‚úÖ createProject ÂëΩ‰ª§Ë¢´Ëß¶Âèë!"),i.window.setStatusBarMessage("üêâ Ê≠£Âú®ÂàõÂª∫È°πÁõÆ...",2e3);try{const n=`Á≠ñÁï•_${(new Date).toISOString().slice(0,10).replace(/-/g,"")}_${Math.random().toString(36).substr(2,6)}`;console.log(`[TRQuant] ÁîüÊàêÈ°πÁõÆÂêç: ${n}`);const a=i.workspace.workspaceFolders?.[0];let r;r=a?t(928).join(a.uri.fsPath,"Projects"):t(928).join(e.extensionPath,"data","Projects");const s=t(896);s.existsSync(r)||s.mkdirSync(r,{recursive:!0});const o=await i.window.showInputBox({title:"üêâ ÂàõÂª∫ÈáèÂåñÈ°πÁõÆ",prompt:`È°πÁõÆÂ∞ÜÂàõÂª∫Âú®: ${r}`,value:n,valueSelection:[0,n.length],placeHolder:"ËæìÂÖ•È°πÁõÆÂêçÁß∞ÔºàÂ¶ÇÔºöÁ••ÁëûÁ¢ßÈúÑÂá§Âá∞Ôºâ",ignoreFocusOut:!0,validateInput:e=>e&&0!==e.trim().length?/[<>:"/\\|?*]/.test(e)?"È°πÁõÆÂêçÁß∞‰∏çËÉΩÂåÖÂê´ÁâπÊÆäÂ≠óÁ¨¶":null:"È°πÁõÆÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫"});if(!o)return void console.log("[TRQuant] Áî®Êà∑ÂèñÊ∂à");const c=o.trim(),l=t(928).join(r,c);s.existsSync(l)||s.mkdirSync(l,{recursive:!0});const d=t(928).join(l,"main.py"),p=new Date,g=new Date(p);g.setMonth(g.getMonth()-3);const u=new Date(g);u.setFullYear(u.getFullYear()-1);const m=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;let h="neutral",f=[];try{const e=await(M?.getMarketStatus());e?.ok&&e?.data?.regime&&(h=e.data.regime,console.log(`[TRQuant] Ëé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅ: ${h}`));const n=await(M?.getMainlines({top_n:5}));n?.ok&&n?.data&&(f=n.data.slice(0,5).map(e=>({name:e.name||"",industries:e.industries||[]})),console.log(`[TRQuant] Ëé∑ÂèñÊäïËµÑ‰∏ªÁ∫ø: ${f.map(e=>e.name).join(", ")}`))}catch(e){console.log("[TRQuant] Ëé∑ÂèñÂ∑•‰ΩúÊµÅÊï∞ÊçÆÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº")}const v=t(928).join(e.extensionPath,"templates","strategies","multi_factor_template.py");let y;if(s.existsSync(v)){if(y=s.readFileSync(v,"utf-8"),console.log("[TRQuant] ‰ΩøÁî®ÂÆåÊï¥Â§ñÈÉ®Ê®°Êùø"),y=y.replace(/\{project_name\}/g,c).replace(/\{create_time\}/g,(new Date).toLocaleString("zh-CN")).replace(/\{start_date\}/g,m(u)).replace(/\{end_date\}/g,m(g)),y=y.replace(/MARKET_REGIME = 'neutral'/,`MARKET_REGIME = '${h}'`),f.length>0){const e=f.map(e=>`    ('${e.name}', ${JSON.stringify(e.industries)}),`).join("\n");y=y.replace(/HOT_MAINLINES = \[\n    \('‰∫∫Â∑•Êô∫ËÉΩ'.*?\n    \('ÂçäÂØº‰Ωì'.*?\n\]/s,`HOT_MAINLINES = [\n${e}\n]`)}y=y.replace(/\{\{/g,"{").replace(/\}\}/g,"}")}else console.log("[TRQuant] Ê®°ÊùøÊñá‰ª∂‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®ÁÆÄÂåñÊ®°Êùø"),y=`# -*- coding: utf-8 -*-\n"""\n${c} - Êô∫ËÉΩÂ§öÂõ†Â≠êÈáèÂåñÁ≠ñÁï•\n=====================================\n\nÂàõÂª∫Êó∂Èó¥: ${(new Date).toLocaleString("zh-CN")}\nÂõûÊµãÂå∫Èó¥: ${m(u)} Ëá≥ ${m(g)}\nÂü∫ÂáÜÊåáÊï∞: 000300.XSHG (Ê≤™Ê∑±300)\n\nÂ∏ÇÂú∫Áä∂ÊÄÅ: ${h}\nÊäïËµÑ‰∏ªÁ∫ø: ${f.map(e=>e.name).join(", ")||"Ê≤™Ê∑±300ÊàêÂàÜËÇ°"}\n"""\n\nimport numpy as np\nimport pandas as pd\n\nMARKET_REGIME = '${h}'\nHOT_MAINLINES = ${JSON.stringify(f.map(e=>[e.name,e.industries]))}\n\ndef initialize(context):\n    set_benchmark('000300.XSHG')\n    g.stock_num = 10\n    g.market_regime = MARKET_REGIME\n    log.info('Á≠ñÁï•ÂàùÂßãÂåñ: ${c}')\n    log.info(f'Â∏ÇÂú∫Áä∂ÊÄÅ: {g.market_regime}')\n\ndef handle_data(context, data):\n    pass\n`;s.writeFileSync(d,y,"utf-8");const b=await i.workspace.openTextDocument(d);await i.window.showTextDocument(b),i.commands.executeCommand("workbench.files.action.refreshFilesExplorer"),i.window.showInformationMessage(`‚úÖ È°πÁõÆ "${c}" ÂàõÂª∫ÊàêÂäüÔºÅ`,"ËøêË°åÂõûÊµã").then(e=>{"ËøêË°åÂõûÊµã"===e&&i.commands.executeCommand("trquant.runBacktest")})}catch(e){console.error("[TRQuant] createProject ÈîôËØØ:",e),i.window.showErrorMessage(`ÂàõÂª∫È°πÁõÆÂ§±Ë¥•: ${e}`)}});e.subscriptions.push(a),console.log("[TRQuant] ‚úÖ createProject ÂëΩ‰ª§Ê≥®ÂÜåÊàêÂäü");const r=k.ConfigManager.getInstance();e.subscriptions.push({dispose:()=>r.dispose()}),M=new p.TRQuantClient(e),e.subscriptions.push({dispose:()=>M.dispose()}),$=function(){const e=i.window.createStatusBarItem(i.StatusBarAlignment.Right,100);return e.text="$(graph) TRQuant",e.tooltip="TRQuant ÈáèÂåñÂä©Êâã - ÁÇπÂáªÊâìÂºÄÊéßÂà∂Èù¢Êùø",e.command="trquant.showPanel",e.show(),e}(),e.subscriptions.push($),function(e){const n=[{id:"trquant.getMarketStatus",handler:()=>(0,u.getMarketStatus)(M,e)},{id:"trquant.getMainlines",handler:()=>(0,m.getMainlines)(M,e)},{id:"trquant.recommendFactors",handler:()=>(0,h.recommendFactors)(M,e)},{id:"trquant.generateStrategy",handler:()=>(0,f.generateStrategy)(M,e)},{id:"trquant.analyzeBacktest",handler:()=>(0,v.analyzeBacktest)(M,e)},{id:"trquant.runBacktest",handler:async()=>{try{console.log("[TRQuant] ËøêË°åÂõûÊµãÂëΩ‰ª§Ëß¶Âèë"),i.window.showInformationMessage("ÂõûÊµãÂäüËÉΩÊöÇÊó∂‰∏çÂèØÁî®ÔºàbacktestConfigPanel ‰∏çÂ≠òÂú®Ôºâ"),console.log("[TRQuant] ÂõûÊµãÈÖçÁΩÆÈù¢ÊùøÊöÇÊó∂‰∏çÂèØÁî®")}catch(e){console.error("[TRQuant] ËøêË°åÂõûÊµãÈîôËØØ:",e),i.window.showErrorMessage(`ËøêË°åÂõûÊµãÂ§±Ë¥•: ${e}`)}}},{id:"trquant.openBacktestConfig",handler:async()=>{i.window.showInformationMessage("ÂõûÊµãÈÖçÁΩÆÂäüËÉΩÊöÇÊó∂‰∏çÂèØÁî®ÔºàbacktestConfigPanel ‰∏çÂ≠òÂú®Ôºâ")}},{id:"trquant.enableMCP",handler:async()=>{await C(e),i.window.showInformationMessage("TRQuant MCP Server Â∑≤ÂêØÁî®")}},{id:"trquant.showPanel",handler:async()=>{y.MarketPanel.createOrShow(e.extensionUri,M)}},{id:"trquant.showDashboard",handler:async()=>{b.MainDashboard.createOrShow(e.extensionUri,M)}},{id:"trquant.openDashboard",handler:async()=>{b.MainDashboard.createOrShow(e.extensionUri,M)}},{id:"trquant.showWelcome",handler:async()=>{b.MainDashboard.createOrShow(e.extensionUri,M)}},{id:"trquant.showLogs",handler:async()=>{_.logger.show()}},{id:"trquant.refreshStatus",handler:async()=>{await E(),i.window.showInformationMessage("Áä∂ÊÄÅÂ∑≤Âà∑Êñ∞")}},{id:"trquant.openWorkflowPanel",handler:async()=>{console.log("[TRQuant] ÊâìÂºÄÂ∑•‰ΩúÊµÅÈù¢Êùø -> ÂêØÂä®Ê°åÈù¢Á≥ªÁªü"),_.logger.info("ÊâìÂºÄÂ∑•‰ΩúÊµÅÈù¢ÊùøÔºàÂêØÂä®Ê°åÈù¢Á≥ªÁªüÔºâ",P),await O(e)}},{id:"trquant.launchDesktopSystem",handler:async()=>{console.log("[TRQuant] ÂêØÂä®Ê°åÈù¢Á≥ªÁªü"),_.logger.info("ÂêØÂä®Ê°åÈù¢Á≥ªÁªü",P),await O(e)}},{id:"trquant.openWorkflowPanelWebview",handler:async()=>{console.log("[TRQuant] ÊâìÂºÄWebViewÂ∑•‰ΩúÊµÅÈù¢Êùø"),_.logger.info("ÊâìÂºÄWebViewÂ∑•‰ΩúÊµÅÈù¢Êùø",P);const{WorkflowPanel:n}=await Promise.resolve().then(()=>o(t(360)));n.createOrShow(e.extensionUri,M)}}];for(const{id:t,handler:a}of n){const n=i.commands.registerCommand(t,async()=>{_.logger.debug(`ÊâßË°åÂëΩ‰ª§: ${t}`,P),await S.ErrorHandler.wrap(a,t)});e.subscriptions.push(n)}_.logger.info(`Â∑≤Ê≥®ÂÜå ${n.length} ‰∏™ÂëΩ‰ª§`,P)}(e),console.log("[TRQuant] ‚úÖ ÊâÄÊúâÂëΩ‰ª§Ê≥®ÂÜåÂÆåÊàê"),(0,b.registerMainDashboard)(e,M),e.subscriptions.push(i.commands.registerCommand("trquant.guide.createProject",async()=>{await i.commands.executeCommand("workbench.action.quickOpen",">TRQuant: Êñ∞Âª∫ÈáèÂåñÈ°πÁõÆ")})),(0,x.registerStrategyOptimizer)(e,M),(0,w.registerStrategyOptimizerPanel)(e),e.subscriptions.push(i.commands.registerCommand("trquant.openAShareManual",async()=>{try{_.logger.info("=== ÂºÄÂßãÂêØÂä®AËÇ°ÂÆûÊìçÊâãÂÜå ===",P);let n=l.join(e.extensionPath,"AShare-manual");if(c.existsSync(n))_.logger.info(`‚úì ‰ΩøÁî®Êâ©Â±ïË∑ØÂæÑ: ${n}`,P);else{_.logger.info(`Êâ©Â±ïË∑ØÂæÑ‰∏çÂ≠òÂú®ÔºåÂ∞ùËØïÂ∑•‰ΩúÂå∫Ë∑ØÂæÑ: ${n}`,P);const e=i.workspace.workspaceFolders?.[0];if(e){const t=l.join(e.uri.fsPath,"extension","AShare-manual");_.logger.info(`Ê£ÄÊü•Â∑•‰ΩúÂå∫Ë∑ØÂæÑ: ${t}`,P),c.existsSync(t)?(n=t,_.logger.info(`‚úì ‰ΩøÁî®Â∑•‰ΩúÂå∫Ë∑ØÂæÑ: ${n}`,P)):_.logger.warn(`Â∑•‰ΩúÂå∫Ë∑ØÂæÑ‰πü‰∏çÂ≠òÂú®: ${t}`,P)}}if(!c.existsSync(n)){const e=`ÊâãÂÜåÁõÆÂΩï‰∏çÂ≠òÂú®: ${n}\nËØ∑Á°Æ‰øùAËÇ°ÊâãÂÜåÂ∑≤Ê≠£Á°ÆÂÆâË£Ö„ÄÇ`;return _.logger.error(e,P),void i.window.showErrorMessage(e)}const t=l.join(n,"package.json");if(!c.existsSync(t)){const e=`ÊâãÂÜåÈÖçÁΩÆ‰∏çÂ≠òÂú®: ${t}`;return _.logger.error(e,P),void i.window.showErrorMessage(e)}_.logger.info(`‚úì package.jsonÂ≠òÂú®: ${t}`,P);const a=l.join(n,"node_modules");if(!c.existsSync(a)){if(_.logger.info("Ê£ÄÊµãÂà∞node_modules‰∏çÂ≠òÂú®ÔºåÈúÄË¶ÅÂÆâË£Ö‰æùËµñ",P),"ÂÆâË£Ö"===await i.window.showWarningMessage("AËÇ°ÊâãÂÜåÈúÄË¶ÅÂÆâË£Ö‰æùËµñÔºåÊòØÂê¶Áé∞Âú®ÂÆâË£ÖÔºü","ÂÆâË£Ö","ÂèñÊ∂à")){const e=i.window.createTerminal({name:"AËÇ°ÊâãÂÜå-ÂÆâË£Ö",cwd:n});return e.show(),e.sendText("npm install"),void i.window.showInformationMessage('Ê≠£Âú®ÂÆâË£Ö‰æùËµñÔºåÂÆâË£ÖÂÆåÊàêÂêéËØ∑ÈáçÊñ∞ÁÇπÂáª"üìö AËÇ°ÂÆûÊìçÊâãÂÜå"')}return}_.logger.info("‚úì node_modulesÂ≠òÂú®",P),_.logger.info(`ÂêØÂä®npm run devËøõÁ®ã: ${n}`,P);try{d.spawn("npm",["run","dev"],{cwd:n,stdio:"ignore",detached:!0,shell:!0}).unref(),_.logger.info("‚úì npm run devËøõÁ®ãÂ∑≤ÂêØÂä®",P),i.window.showInformationMessage("Ê≠£Âú®ÂêØÂä®AËÇ°ÊâãÂÜåÊúçÂä°Âô®ÔºåËØ∑Á®çÂÄô..."),setTimeout(async()=>{_.logger.info("Â∞ùËØïÊâìÂºÄÊµèËßàÂô®Âà∞ http://localhost:4321",P);try{await i.env.openExternal(i.Uri.parse("http://localhost:4321")),_.logger.info("‚úÖ AËÇ°ÊâãÂÜåÂ∑≤Âú®ÊµèËßàÂô®‰∏≠ÊâìÂºÄ",P),i.window.showInformationMessage("‚úÖ AËÇ°È´òÂÄçËÇ°ÂÆûÊìçÊâãÂÜåÂ∑≤ÂêØÂä® - ‰∫îÂÜåÂØºËà™È¶ñÈ°µ")}catch(e){_.logger.warn(`ÊâìÂºÄÊµèËßàÂô®Â§±Ë¥•: ${e}`,P);const n=[4322,4323,4324];for(const e of n)try{return await i.env.openExternal(i.Uri.parse(`http://localhost:${e}`)),_.logger.info(`‚úÖ Â∑≤ÊâìÂºÄAËÇ°ÊâãÂÜå (Á´ØÂè£${e})`,P),void i.window.showInformationMessage(`‚úÖ AËÇ°ÊâãÂÜåÂ∑≤ÊâìÂºÄ (Á´ØÂè£${e})`)}catch(e){}i.window.showWarningMessage("Êó†Ê≥ïËá™Âä®ÊâìÂºÄÊµèËßàÂô®ÔºåËØ∑ÊâãÂä®ËÆøÈóÆ http://localhost:4321")}},2e3)}catch(e){_.logger.error(`ÂêØÂä®ËøõÁ®ãÂ§±Ë¥•: ${e}`,P),i.window.showErrorMessage(`ÂêØÂä®Â§±Ë¥•: ${e instanceof Error?e.message:String(e)}`)}}catch(e){const n=e instanceof Error?e.message:String(e);_.logger.error(`ÂêØÂä®AËÇ°ÊâãÂÜåÂ§±Ë¥•: ${n}`,P),i.window.showErrorMessage(`ÂêØÂä®AËÇ°ÊâãÂÜåÂ§±Ë¥•: ${n}`)}})),_.logger.info("‚úì AËÇ°ÂÆûÊìçÊâãÂÜåÂëΩ‰ª§Â∑≤Ê≥®ÂÜå",P),k.config.get("mcpEnabled")&&await C(e),E();const s=Date.now()-n;_.logger.info(`TRQuant Extension ÊøÄÊ¥ªÂÆåÊàê (${s}ms)`,P),_.logger.info("ÂáÜÂ§áÊâìÂºÄ‰∏ªÊéßÂà∂Âè∞...",P);try{b.MainDashboard.createOrShow(e.extensionUri,M),_.logger.info("‚úÖ ‰∏ªÊéßÂà∂Âè∞Â∑≤Ëá™Âä®ÊâìÂºÄ",P)}catch(e){_.logger.error(`‚ùå ÊâìÂºÄ‰∏ªÊéßÂà∂Âè∞Â§±Ë¥•: ${e}`,P),i.window.showErrorMessage(`‰∏ªÊéßÂà∂Âè∞ÊâìÂºÄÂ§±Ë¥•: ${e}`,"ÈáçËØï").then(e=>{"ÈáçËØï"===e&&i.commands.executeCommand("trquant.openDashboard")})}i.window.showInformationMessage("üêâ Èü¨ÁùøÈáèÂåñÂ∑≤ÂêØÂä®ÔºÅ")}catch(e){throw S.ErrorHandler.handle(e,P),e}},n.deactivate=function(){_.logger.info("TRQuant Extension Ê≠£Âú®ÂÅúÁî®...",P),M&&M.dispose(),_.logger.dispose()};const i=o(t(398)),c=o(t(896)),l=o(t(928)),d=o(t(317)),p=t(3),g=t(334),u=t(501),m=t(327),h=t(405),f=t(238),v=t(900),y=t(395),b=t(126),w=t(279),x=t(410),_=t(628),k=t(478),S=t(799),P="Extension";let M,$;async function O(e){const n=k.config.getPythonPath(e.extensionPath),t=l.dirname(e.extensionPath),a=l.join(t,"start_dashboard.py");if(c.existsSync(a)){_.logger.info(`ÂêØÂä®Ê°åÈù¢Á≥ªÁªü: ${a}`,P);try{d.spawn(n,[a],{cwd:t,detached:!0,stdio:"ignore"}).unref(),i.window.showInformationMessage("üñ•Ô∏è Ê°åÈù¢Á≥ªÁªüÂ∑≤ÂêØÂä®ÔºÅ"),_.logger.info("Ê°åÈù¢Á≥ªÁªüÂêØÂä®ÊàêÂäü",P)}catch(e){const n=e instanceof Error?e.message:String(e);_.logger.error(`ÂêØÂä®Ê°åÈù¢Á≥ªÁªüÂ§±Ë¥•: ${n}`,P),i.window.showErrorMessage(`ÂêØÂä®Ê°åÈù¢Á≥ªÁªüÂ§±Ë¥•: ${n}`)}}else i.window.showErrorMessage(`Ê°åÈù¢Á≥ªÁªüÂêØÂä®ËÑöÊú¨‰∏çÂ≠òÂú®: ${a}`)}async function C(e){try{await g.MCPRegistrar.registerServer(e),_.logger.info("MCP Server Â∑≤Ê≥®ÂÜå",P)}catch(e){_.logger.warn(`MCPÊ≥®ÂÜåÂ§±Ë¥•: ${e instanceof Error?e.message:String(e)}`,P)}}async function E(){try{const e=await M.getMarketStatus();if(e.ok&&e.data){const n=e.data.regime,t={risk_on:"üìà",risk_off:"üìâ",neutral:"‚û°Ô∏è"}[n]||"üìä";$.text=`$(graph) ${t} TRQuant`,$.tooltip=`TRQuant | Â∏ÇÂú∫: ${n.toUpperCase()}\nÁÇπÂáªÊâìÂºÄÊéßÂà∂Èù¢Êùø`}}catch(e){_.logger.debug("Êõ¥Êñ∞Áä∂ÊÄÅÊ†èÂ§±Ë¥•",P,{error:e})}}},279:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.StrategyOptimizerPanel=void 0,n.registerStrategyOptimizerPanel=function(e){e.subscriptions.push(i.commands.registerCommand("trquant.optimizeStrategy",async()=>{const n=i.window.activeTextEditor;if(n){const t=n.document.getText(),a=l.basename(n.document.fileName);u.createOrShow(e.extensionUri,t,a)}else u.createOrShow(e.extensionUri)})),d.logger.info("Á≠ñÁï•‰ºòÂåñÂô®Èù¢ÊùøÂ∑≤Ê≥®ÂÜå",g)};const i=o(t(398)),c=o(t(896)),l=o(t(928)),d=t(628);let p=null;const g="StrategyOptimizerPanel";class u{static currentPanel;_panel;_extensionUri;_disposables=[];_report=null;constructor(e,n){this._panel=e,this._extensionUri=n,this._panel.webview.onDidReceiveMessage(e=>this.handleMessage(e),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables)}static createOrShow(e,n,t){const a=i.ViewColumn.One;if(u.currentPanel)return u.currentPanel._panel.reveal(a),n&&u.currentPanel.analyzeStrategy(n,t),u.currentPanel;const r=i.window.createWebviewPanel("strategyOptimizer","üîç Á≠ñÁï•‰ºòÂåñÂô®",a,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});return u.currentPanel=new u(r,e),n?u.currentPanel.analyzeStrategy(n,t):u.currentPanel.updateContent(),u.currentPanel}async handleMessage(e){switch(e.command){case"analyzeFile":await this.analyzeFromFile();break;case"analyzeEditor":await this.analyzeFromEditor();break;case"exportReport":await this.exportReport()}}async analyzeFromFile(){const e=await i.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{PythonÊñá‰ª∂:["py"],ÊâÄÊúâÊñá‰ª∂:["*"]}});if(e&&e[0])try{const n=c.readFileSync(e[0].fsPath,"utf-8"),t=l.basename(e[0].fsPath);this.analyzeStrategy(n,t)}catch(e){i.window.showErrorMessage(`ËØªÂèñÊñá‰ª∂Â§±Ë¥•: ${e}`)}}async analyzeFromEditor(){const e=i.window.activeTextEditor;if(!e)return void i.window.showWarningMessage("ËØ∑ÂÖàÊâìÂºÄ‰∏Ä‰∏™Á≠ñÁï•Êñá‰ª∂");const n=e.document.getText(),t=l.basename(e.document.fileName);this.analyzeStrategy(n,t)}async analyzeStrategy(e,n){try{this._panel.webview.postMessage({command:"analyzing"});const a=(await async function(){if(!p){const e=await Promise.resolve().then(()=>o(t(410)));p=e.strategyOptimizer||e.StrategyOptimizerService?.getInstance()}return p}()).generateOptimizationReport(e,n);this._report=a,this._panel.webview.postMessage({command:"reportReady",report:a}),this.updateContent()}catch(e){d.logger.error(`Á≠ñÁï•ÂàÜÊûêÂ§±Ë¥•: ${e}`,g),i.window.showErrorMessage(`Á≠ñÁï•ÂàÜÊûêÂ§±Ë¥•: ${e}`),this._panel.webview.postMessage({command:"error",message:String(e)})}}async exportReport(){if(!this._report)return void i.window.showWarningMessage("Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÊä•Âëä");const e=i.workspace.workspaceFolders?.[0];if(!e)return void i.window.showErrorMessage("ËØ∑ÂÖàÊâìÂºÄÂ∑•‰ΩúÂå∫");const n=l.join(e.uri.fsPath,"Reports");c.existsSync(n)||c.mkdirSync(n,{recursive:!0});const t=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5),a=l.join(n,`optimization_${t}.md`),r=this.generateMarkdownReport(this._report);c.writeFileSync(a,r,"utf-8"),i.window.showInformationMessage(`Êä•ÂëäÂ∑≤ÂØºÂá∫: ${l.basename(a)}`,"ÊâìÂºÄÊñá‰ª∂").then(e=>{"ÊâìÂºÄÊñá‰ª∂"===e&&i.commands.executeCommand("vscode.open",i.Uri.file(a))})}generateMarkdownReport(e){let n="# Á≠ñÁï•‰ºòÂåñÊä•Âëä\n\n";n+=`**Á≠ñÁï•ÂêçÁß∞**: ${e.strategyName}\n\n`,n+=`**Âπ≥Âè∞**: ${e.platform}\n\n`,n+=`**ÂàÜÊûêÊó∂Èó¥**: ${new Date(e.analysisTime).toLocaleString("zh-CN")}\n\n`,n+="---\n\n",n+="## üìä Á≠ñÁï•ËØÑÂàÜ\n\n",n+="| Áª¥Â∫¶ | ËØÑÂàÜ |\n",n+="|------|------|\n",n+=`| Êï¥‰ΩìËØÑÂàÜ | **${e.overallScore}/100** |\n`,n+=`| È£éÈô©ÊéßÂà∂ | ${e.scoreBreakdown.risk}/100 |\n`,n+=`| Âõ†Â≠êÊûÑÂª∫ | ${e.scoreBreakdown.factor}/100 |\n`,n+=`| ÈÄâËÇ°ÈÄªËæë | ${e.scoreBreakdown.selection}/100 |\n`,n+=`| ‰ª£Á†ÅË¥®Èáè | ${e.scoreBreakdown.code}/100 |\n\n`,n+="## üìù ‰ºòÂåñÊëòË¶Å\n\n",n+=`${e.summary}\n\n`,n+="## üí° ‰ºòÂåñÂª∫ËÆÆ\n\n";for(const t of e.advices)n+=`### ${"high"===t.priority?"üî¥":"medium"===t.priority?"üü°":"üü¢"} ${t.title}\n\n`,n+=`**Á±ªÂà´**: ${t.category}\n\n`,n+=`**ÊèèËø∞**: ${t.description}\n\n`,t.currentState&&(n+=`**ÂΩìÂâçÁä∂ÊÄÅ**: ${t.currentState}\n\n`),t.suggestedState&&(n+=`**Âª∫ËÆÆÁä∂ÊÄÅ**: ${t.suggestedState}\n\n`),t.codeExample&&(n+=`**‰ª£Á†ÅÁ§∫‰æã**:\n\n\`\`\`python\n${t.codeExample}\n\`\`\`\n\n`),t.impact&&(n+=`**È¢ÑÊúüÂΩ±Âìç**: ${t.impact}\n\n`),n+="---\n\n";return n}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){const e=this._report;return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Á≠ñÁï•‰ºòÂåñÂô®</title>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-red: #f85149;\n            --border-color: #30363d;\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            padding: 24px;\n        }\n        \n        .header {\n            margin-bottom: 24px;\n        }\n        \n        .header h1 {\n            font-size: 24px;\n            margin-bottom: 8px;\n        }\n        \n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 16px;\n        }\n        \n        .btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            cursor: pointer;\n            font-size: 14px;\n        }\n        \n        .btn:hover {\n            background: var(--bg-secondary);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .btn-primary {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border: none;\n            color: #fff;\n        }\n        \n        .score-section {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n        \n        .score-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n        }\n        \n        .score-label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n        }\n        \n        .score-value {\n            font-size: 32px;\n            font-weight: 700;\n            color: var(--accent-gold);\n        }\n        \n        .summary {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 24px;\n            white-space: pre-wrap;\n            line-height: 1.6;\n        }\n        \n        .advices {\n            display: flex;\n            flex-direction: column;\n            gap: 16px;\n        }\n        \n        .advice-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n        }\n        \n        .advice-header {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-bottom: 12px;\n        }\n        \n        .priority-badge {\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 12px;\n            font-weight: 600;\n        }\n        \n        .priority-high {\n            background: rgba(248, 81, 73, 0.2);\n            color: var(--accent-red);\n        }\n        \n        .priority-medium {\n            background: rgba(240, 180, 41, 0.2);\n            color: var(--accent-gold);\n        }\n        \n        .priority-low {\n            background: rgba(88, 166, 255, 0.2);\n            color: var(--accent-blue);\n        }\n        \n        .advice-title {\n            font-size: 18px;\n            font-weight: 600;\n        }\n        \n        .advice-body {\n            margin-top: 12px;\n            color: var(--text-secondary);\n            line-height: 1.6;\n        }\n        \n        .code-example {\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n            margin-top: 12px;\n            font-family: 'Courier New', monospace;\n            font-size: 13px;\n            overflow-x: auto;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-muted);\n        }\n        \n        .empty-state .icon {\n            font-size: 64px;\n            margin-bottom: 16px;\n            opacity: 0.5;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>üîç Á≠ñÁï•‰ºòÂåñÂô®</h1>\n        <p style="color: var(--text-muted);">ÂàÜÊûêÁ≠ñÁï•‰ª£Á†ÅÔºåÁîüÊàê‰ºòÂåñÂª∫ËÆÆ</p>\n        <div class="actions">\n            <button class="btn btn-primary" onclick="vscode.postMessage({command: 'analyzeEditor'})">\n                üìù ÂàÜÊûêÂΩìÂâçÁºñËæëÂô®\n            </button>\n            <button class="btn" onclick="vscode.postMessage({command: 'analyzeFile'})">\n                üìÅ ÈÄâÊã©Êñá‰ª∂ÂàÜÊûê\n            </button>\n            ${e?'<button class="btn" onclick="vscode.postMessage({command: \'exportReport\'})">üíæ ÂØºÂá∫Êä•Âëä</button>':""}\n        </div>\n    </div>\n    \n    ${e?`\n        <div class="score-section">\n            <div class="score-card">\n                <div class="score-label">Êï¥‰ΩìËØÑÂàÜ</div>\n                <div class="score-value">${e.overallScore}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">È£éÈô©ÊéßÂà∂</div>\n                <div class="score-value">${e.scoreBreakdown.risk}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">Âõ†Â≠êÊûÑÂª∫</div>\n                <div class="score-value">${e.scoreBreakdown.factor}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">ÈÄâËÇ°ÈÄªËæë</div>\n                <div class="score-value">${e.scoreBreakdown.selection}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">‰ª£Á†ÅË¥®Èáè</div>\n                <div class="score-value">${e.scoreBreakdown.code}</div>\n            </div>\n        </div>\n        \n        <div class="summary">\n            <strong>üìù ‰ºòÂåñÊëòË¶Å</strong><br><br>\n            ${e.summary}\n        </div>\n        \n        <div class="advices">\n            ${e.advices.map(e=>`\n                <div class="advice-card">\n                    <div class="advice-header">\n                        <span class="priority-badge priority-${e.priority}">\n                            ${"high"===e.priority?"üî¥ È´ò‰ºòÂÖàÁ∫ß":"medium"===e.priority?"üü° ‰∏≠‰ºòÂÖàÁ∫ß":"üü¢ ‰Ωé‰ºòÂÖàÁ∫ß"}\n                        </span>\n                        <span class="advice-title">${e.title}</span>\n                    </div>\n                    <div class="advice-body">\n                        <p>${e.description}</p>\n                        ${e.currentState?`<p><strong>ÂΩìÂâçÁä∂ÊÄÅ:</strong> ${e.currentState}</p>`:""}\n                        ${e.suggestedState?`<p><strong>Âª∫ËÆÆÁä∂ÊÄÅ:</strong> ${e.suggestedState}</p>`:""}\n                        ${e.codeExample?`\n                            <div class="code-example">\n                                <pre>${e.codeExample}</pre>\n                            </div>\n                        `:""}\n                        ${e.impact?`<p><strong>È¢ÑÊúüÂΩ±Âìç:</strong> ${e.impact}</p>`:""}\n                    </div>\n                </div>\n            `).join("")}\n        </div>\n    `:'\n        <div class="empty-state">\n            <div class="icon">üîç</div>\n            <h2>ÂºÄÂßãÂàÜÊûêÁ≠ñÁï•</h2>\n            <p>ÁÇπÂáª‰∏äÊñπÊåâÈíÆÂàÜÊûêÁ≠ñÁï•‰ª£Á†Å</p>\n        </div>\n    '}\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case 'analyzing':\n                    document.body.innerHTML = '<div class="empty-state"><div class="icon">‚è≥</div><h2>Ê≠£Âú®ÂàÜÊûêÁ≠ñÁï•...</h2></div>';\n                    break;\n                case 'reportReady':\n                    location.reload();\n                    break;\n                case 'error':\n                    alert('ÂàÜÊûêÂ§±Ë¥•: ' + message.message);\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>`}dispose(){for(u.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}}n.StrategyOptimizerPanel=u},317:e=>{e.exports=require("child_process")},327:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.getMainlines=async function(e,n){c.logger.info("ÊâßË°åËé∑ÂèñÊäïËµÑ‰∏ªÁ∫øÂëΩ‰ª§",d);const t=await i.window.showQuickPick([{label:"üìÖ Áü≠Êúü (1-5Â§©)",value:"short",description:"ÈÄÇÂêàÁü≠Á∫ø‰∫§Êòì"},{label:"üìÜ ‰∏≠Êúü (1-4Âë®)",value:"medium",description:"ÈÄÇÂêàÊ≥¢ÊÆµÊìç‰Ωú"},{label:"üìÜ ÈïøÊúü (1Êúà+)",value:"long",description:"ÈÄÇÂêà‰ª∑ÂÄºÊäïËµÑ"}],{placeHolder:"ÈÄâÊã©ÊäïËµÑÂë®Êúü"});t&&await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(a,r)=>{try{if(a.report({message:"Ê≠£Âú®Ëé∑ÂèñÊäïËµÑ‰∏ªÁ∫ø...",increment:0}),r.isCancellationRequested)return void c.logger.info("Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú",d);const s=await e.getMainlines({top_n:20,time_horizon:t.value});if(a.report({increment:60}),!s.ok||!s.data)return void i.window.showErrorMessage(`Ëé∑ÂèñÊäïËµÑ‰∏ªÁ∫øÂ§±Ë¥•: ${s.error||"Êú™Áü•ÈîôËØØ"}`);const o=s.data;c.logger.info(`Ëé∑ÂèñÂà∞ ${o.length} Êù°ÊäïËµÑ‰∏ªÁ∫ø`,d),a.report({message:"Ê∏≤ÊüìÁªìÊûú...",increment:20}),function(e,n,t){const a=i.window.createWebviewPanel("trquantMainlines","üéØ ÊäïËµÑ‰∏ªÁ∫ø",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(e,n){const t=e.length>0?e.map((e,n)=>function(e,n){const t=n<3?`rank-${n+1}`:"rank-default",a=Math.min(100*e.score,100);return`\n        <div class="mainline-card" onclick="selectMainline('${e.name}')">\n            <div class="mainline-header">\n                <div class="mainline-rank">\n                    <div class="rank-badge ${t}">${n+1}</div>\n                    <span class="mainline-name">${e.name}</span>\n                </div>\n                <div class="mainline-score">\n                    <div class="score-bar">\n                        <div class="score-fill" style="width: ${a}%"></div>\n                    </div>\n                    <span class="score-value">${e.score.toFixed(2)}</span>\n                </div>\n            </div>\n            <div class="mainline-industries">\n                ${e.industries.map(e=>`<span class="industry-tag">${e}</span>`).join("")}\n            </div>\n            <div class="mainline-logic">\n                üí° ${e.logic||"ÊöÇÊó†ËØ¶ÁªÜËØ¥Êòé"}\n            </div>\n        </div>\n    `}(e,n)).join(""):'<div class="empty-state">ÊöÇÊó†ÊäïËµÑ‰∏ªÁ∫øÊï∞ÊçÆ</div>';return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ÊäïËµÑ‰∏ªÁ∫ø</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n            --gold: #fbbf24;\n            --silver: #94a3b8;\n            --bronze: #b45309;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .time-badge {\n            background: var(--primary);\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .stats-row {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .stat-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .stat-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .stat-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .mainlines-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n\n        .mainline-card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .mainline-card:hover {\n            border-color: var(--primary);\n            transform: translateY(-2px);\n        }\n\n        .mainline-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n\n        .mainline-rank {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n\n        .rank-badge {\n            width: 32px;\n            height: 32px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 700;\n            font-size: 14px;\n        }\n\n        .rank-1 { background: var(--gold); color: #1a1a2e; }\n        .rank-2 { background: var(--silver); color: #1a1a2e; }\n        .rank-3 { background: var(--bronze); color: white; }\n        .rank-default { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .mainline-name {\n            font-size: 18px;\n            font-weight: 600;\n        }\n\n        .mainline-score {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .score-bar {\n            width: 100px;\n            height: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .score-fill {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--success));\n            border-radius: 4px;\n        }\n\n        .score-value {\n            font-weight: 600;\n            color: var(--success);\n            min-width: 50px;\n            text-align: right;\n        }\n\n        .mainline-industries {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-bottom: 12px;\n        }\n\n        .industry-tag {\n            background: var(--bg-tertiary);\n            color: var(--text-secondary);\n            padding: 4px 12px;\n            border-radius: 16px;\n            font-size: 12px;\n        }\n\n        .mainline-logic {\n            color: var(--text-secondary);\n            font-size: 14px;\n            line-height: 1.6;\n            padding-left: 16px;\n            border-left: 3px solid var(--primary);\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n            padding-top: 24px;\n            border-top: 1px solid var(--border);\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-muted);\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">üéØ</span>\n            <div>\n                <div class="header-title">ÊäïËµÑ‰∏ªÁ∫ø TOP ${e.length}</div>\n                <div class="header-subtitle">Âü∫‰∫éÂ∏ÇÂú∫ÁÉ≠Â∫¶„ÄÅËµÑÈáëÊµÅÂêë„ÄÅË°å‰∏öÊôØÊ∞îÂ∫¶ÁªºÂêàËØÑ‰º∞</div>\n            </div>\n        </div>\n        <span class="time-badge">${{short:"Áü≠Êúü (1-5Â§©)",medium:"‰∏≠Êúü (1-4Âë®)",long:"ÈïøÊúü (1Êúà+)"}[n]||n}</span>\n    </div>\n\n    <div class="stats-row">\n        <div class="stat-card">\n            <div class="stat-value">${e.length}</div>\n            <div class="stat-label">‰∏ªÁ∫øÊï∞Èáè</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${e.length>0?e[0].score.toFixed(2):"-"}</div>\n            <div class="stat-label">ÊúÄÈ´òËØÑÂàÜ</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${function(e){const n=new Set;return e.forEach(e=>e.industries.forEach(e=>n.add(e))),n.size}(e)}</div>\n            <div class="stat-label">Ê∂âÂèäË°å‰∏ö</div>\n        </div>\n    </div>\n\n    <div class="mainlines-list">\n        ${t}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            üöÄ Âü∫‰∫é‰∏ªÁ∫øÁîüÊàêÁ≠ñÁï•\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            üìã Â§çÂà∂‰∏∫AI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        Êõ¥Êñ∞Êó∂Èó¥: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function selectMainline(mainline) {\n            vscode.postMessage({ command: 'selectMainline', mainline });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ command: 'generateStrategy' });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(n,t),a.webview.onDidReceiveMessage(async e=>{switch(e.command){case"selectMainline":a=e.mainline,i.window.showInformationMessage(`Â∑≤ÈÄâÊã©‰∏ªÁ∫ø: ${a}`,"Êü•ÁúãËØ¶ÊÉÖ","Á≠õÈÄâËÇ°Á•®").then(e=>{"Êü•ÁúãËØ¶ÊÉÖ"===e?c.logger.info(`Êü•Áúã‰∏ªÁ∫øËØ¶ÊÉÖ: ${a}`,d):"Á≠õÈÄâËÇ°Á•®"===e&&c.logger.info(`Âü∫‰∫é‰∏ªÁ∫øÁ≠õÈÄâËÇ°Á•®: ${a}`,d)});break;case"generateStrategy":i.commands.executeCommand("trquant.generateStrategy");break;case"copyPrompt":const r=p(n,t);await i.env.clipboard.writeText(r),i.window.showInformationMessage("PromptÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø")}var a},void 0,e.subscriptions)}(n,o,t.value),a.report({increment:20}),async function(e){if(0!==e.length)switch(await i.window.showInformationMessage(`Ëé∑ÂèñÂà∞ ${e.length} Êù°ÊäïËµÑ‰∏ªÁ∫ø`,"ÁîüÊàêÁ≠ñÁï•","Êé®ËçêÂõ†Â≠ê","Â§çÂà∂Prompt")){case"ÁîüÊàêÁ≠ñÁï•":i.commands.executeCommand("trquant.generateStrategy");break;case"Êé®ËçêÂõ†Â≠ê":i.commands.executeCommand("trquant.recommendFactors");break;case"Â§çÂà∂Prompt":const n=p(e,"short");await i.env.clipboard.writeText(n),i.window.showInformationMessage("PromptÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø")}}(o)}catch(e){l.ErrorHandler.handle(e,d)}})};const i=o(t(398)),c=t(628),l=t(799),d="GetMainlines";function p(e,n){return`# AËÇ°ÊäïËµÑ‰∏ªÁ∫øÂàÜÊûê\n\n## ÂàÜÊûêÂë®Êúü: ${{short:"Áü≠Êúü (1-5Â§©)",medium:"‰∏≠Êúü (1-4Âë®)",long:"ÈïøÊúü (1Êúà+)"}[n]||n}\n\n## TOP ${e.length} ÊäïËµÑ‰∏ªÁ∫ø\n\n${e.map((e,n)=>`\n### ${n+1}. ${e.name} (ËØÑÂàÜ: ${e.score.toFixed(2)})\n- **Áõ∏ÂÖ≥Ë°å‰∏ö**: ${e.industries.join(", ")}\n- **ÊäïËµÑÈÄªËæë**: ${e.logic||"ÊöÇÊó†"}\n`).join("\n")}\n\n---\n\nËØ∑Âü∫‰∫é‰ª•‰∏äÊäïËµÑ‰∏ªÁ∫øÔºåÂ∏ÆÊàëÔºö\n1. ÂàÜÊûêÂΩìÂâçÊúÄÂÄºÂæóÂÖ≥Ê≥®ÁöÑ‰∏ªÁ∫øÂèäÂÖ∂ÂéüÂõ†\n2. Êé®ËçêÈÄÇÂêàËøô‰∫õ‰∏ªÁ∫øÁöÑÈáèÂåñÂõ†Â≠ê\n3. ÁîüÊàêÈíàÂØπTOP3‰∏ªÁ∫øÁöÑPTradeÈáèÂåñÁ≠ñÁï•‰ª£Á†Å\n\nË¶ÅÊ±ÇÔºö\n- Á≠ñÁï•Â∫îËØ•ËÅöÁÑ¶‰∫é‰∏ªÁ∫øÁõ∏ÂÖ≥ÁöÑËÇ°Á•®Ê±†\n- ÂåÖÂê´ÂÆåÊï¥ÁöÑÈ£éÊéßÈÄªËæë\n- Ê∑ªÂä†ËØ¶ÁªÜÁöÑ‰∏≠ÊñáÊ≥®Èáä\n`}},334:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.MCPRegistrar=void 0;const i=o(t(398)),c=o(t(928)),l=o(t(896)),d=o(t(857)),p=t(628),g=t(478),u="MCPRegistrar";n.MCPRegistrar=class{static async registerServer(e){p.logger.info("ÂºÄÂßãÊ≥®ÂÜåMCP Server...",u);try{const n=this.getMCPConfigPath();p.logger.info(`MCPÈÖçÁΩÆË∑ØÂæÑ: ${n}`,u);let t=this.loadMCPConfig(n);const a=g.config.getPythonPath(e.extensionPath),r=c.join(e.extensionPath,"python","mcp_server.py");t.mcpServers.trquant={command:a,args:[r],env:{PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(e.extensionPath)}},this.saveMCPConfig(n,t),p.logger.info("MCP Server Ê≥®ÂÜåÊàêÂäü",u),i.window.showInformationMessage("TRQuant MCP Server Â∑≤Ê≥®ÂÜå„ÄÇÈáçÂêØCursorÂêéÁîüÊïà„ÄÇ","Êü•ÁúãÈÖçÁΩÆ","‰∫ÜËß£Êõ¥Â§ö").then(e=>{"Êü•ÁúãÈÖçÁΩÆ"===e?this.openMCPConfig(n):"‰∫ÜËß£Êõ¥Â§ö"===e&&i.env.openExternal(i.Uri.parse("https://docs.cursor.com/context/model-context-protocol"))})}catch(e){throw p.logger.error(`MCPÊ≥®ÂÜåÂ§±Ë¥•: ${e instanceof Error?e.message:String(e)}`,u),e}}static getMCPConfigPath(){const e=d.homedir(),n=[c.join(e,".cursor","mcp.json"),c.join(e,"Library","Application Support","Cursor","mcp.json"),c.join(e,"AppData","Roaming","Cursor","mcp.json")];for(const e of n)if(l.existsSync(e))return e;switch(d.platform()){case"darwin":return n[1];case"win32":return n[2];default:return n[0]}}static loadMCPConfig(e){try{if(l.existsSync(e)){const n=l.readFileSync(e,"utf-8");return JSON.parse(n)}}catch(e){p.logger.warn(`ËØªÂèñMCPÈÖçÁΩÆÂ§±Ë¥•: ${e}`,u)}return{mcpServers:{}}}static saveMCPConfig(e,n){const t=c.dirname(e);l.existsSync(t)||l.mkdirSync(t,{recursive:!0});const a=JSON.stringify(n,null,2);l.writeFileSync(e,a,"utf-8"),p.logger.info(`MCPÈÖçÁΩÆÂ∑≤‰øùÂ≠ò: ${e}`,u)}static async openMCPConfig(e){const n=await i.workspace.openTextDocument(e);await i.window.showTextDocument(n)}static isRegistered(){try{const e=this.getMCPConfigPath();return"trquant"in this.loadMCPConfig(e).mcpServers}catch{return!1}}static async unregisterServer(){p.logger.info("ÁßªÈô§MCP ServerÊ≥®ÂÜå...",u);try{const e=this.getMCPConfigPath();let n=this.loadMCPConfig(e);"trquant"in n.mcpServers&&(delete n.mcpServers.trquant,this.saveMCPConfig(e,n),p.logger.info("MCP Server Â∑≤ÁßªÈô§",u))}catch(e){p.logger.error(`ÁßªÈô§MCPÊ≥®ÂÜåÂ§±Ë¥•: ${e instanceof Error?e.message:String(e)}`,u)}}}},360:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowPanel=void 0,n.registerWorkflowPanel=function(e,n){if(console.log("[WorkflowPanel] ========== ÂºÄÂßãÊ≥®ÂÜåÂ∑•‰ΩúÊµÅÈù¢ÊùøÂëΩ‰ª§ =========="),c.logger.info("ÂºÄÂßãÊ≥®ÂÜåÂ∑•‰ΩúÊµÅÈù¢Êùø",l),!e)throw console.error("[WorkflowPanel] ‚ùå context ÂèÇÊï∞‰∏∫Á©∫"),new Error("context ÂèÇÊï∞‰∏çËÉΩ‰∏∫Á©∫");if(!n)throw console.error("[WorkflowPanel] ‚ùå client ÂèÇÊï∞‰∏∫Á©∫"),new Error("client ÂèÇÊï∞‰∏çËÉΩ‰∏∫Á©∫");console.log("[WorkflowPanel] ÂèÇÊï∞È™åËØÅÈÄöËøáÔºåÂºÄÂßãÊ≥®ÂÜåÂëΩ‰ª§...");try{const t=i.commands.registerCommand("trquant.openWorkflowPanel",()=>{console.log("[WorkflowPanel] ‚úÖ trquant.openWorkflowPanel ÂëΩ‰ª§Ë¢´Ëß¶Âèë"),c.logger.info("ÊâìÂºÄÂ∑•‰ΩúÊµÅÈù¢ÊùøÂëΩ‰ª§Ë¢´Ëß¶Âèë",l);try{p.createOrShow(e.extensionUri,n),console.log("[WorkflowPanel] ‚úÖ Â∑•‰ΩúÊµÅÈù¢ÊùøÂ∑≤ÂàõÂª∫"),c.logger.info("Â∑•‰ΩúÊµÅÈù¢ÊùøÂ∑≤ÂàõÂª∫",l)}catch(e){const n=e instanceof Error?e.message:String(e);console.error("[WorkflowPanel] ‚ùå ÂàõÂª∫Â∑•‰ΩúÊµÅÈù¢ÊùøÂ§±Ë¥•:",n),c.logger.error(`ÂàõÂª∫Â∑•‰ΩúÊµÅÈù¢ÊùøÂ§±Ë¥•: ${n}`,l),i.window.showErrorMessage(`ÊâìÂºÄÂ∑•‰ΩúÊµÅÈù¢ÊùøÂ§±Ë¥•: ${n}`)}});console.log("[WorkflowPanel] ÂëΩ‰ª§Â∑≤Ê≥®ÂÜåÔºådisposable:",t),e.subscriptions.push(t),console.log("[WorkflowPanel] ÂëΩ‰ª§Â∑≤Ê∑ªÂä†Âà∞context.subscriptionsÔºåÂΩìÂâçËÆ¢ÈòÖÊï∞:",e.subscriptions.length),console.log("[WorkflowPanel] ÂëΩ‰ª§Â∑≤Ê≥®ÂÜåÂà∞context.subscriptions"),setTimeout(()=>{i.commands.getCommands().then(e=>{console.log("[WorkflowPanel] Ê£ÄÊü•ÂëΩ‰ª§ÂàóË°®ÔºåÊÄªÊï∞:",e.length),e.includes("trquant.openWorkflowPanel")?(console.log("[WorkflowPanel] ‚úÖ ÂëΩ‰ª§Ê≥®ÂÜåÈ™åËØÅÊàêÂäü: trquant.openWorkflowPanel"),c.logger.info("Â∑•‰ΩúÊµÅÈù¢ÊùøÂëΩ‰ª§Ê≥®ÂÜåÈ™åËØÅÊàêÂäü",l)):(console.error("[WorkflowPanel] ‚ùå ÂëΩ‰ª§Ê≥®ÂÜåÈ™åËØÅÂ§±Ë¥•: trquant.openWorkflowPanel ‰∏çÂú®ÂëΩ‰ª§ÂàóË°®‰∏≠"),console.error("[WorkflowPanel] ÊêúÁ¥¢trquantÁõ∏ÂÖ≥ÂëΩ‰ª§:",e.filter(e=>e.startsWith("trquant."))),c.logger.error("Â∑•‰ΩúÊµÅÈù¢ÊùøÂëΩ‰ª§Ê≥®ÂÜåÈ™åËØÅÂ§±Ë¥•",l))},e=>{console.error("[WorkflowPanel] È™åËØÅÂëΩ‰ª§Êó∂Âá∫Èîô:",e)})},1e3),c.logger.info("Â∑•‰ΩúÊµÅÈù¢ÊùøÂ∑≤Ê≥®ÂÜåÔºàÂ§çÁî®Ê°åÈù¢Á≥ªÁªü‰ª£Á†ÅÔºâ",l),console.log("[WorkflowPanel] ========== Â∑•‰ΩúÊµÅÈù¢ÊùøÂëΩ‰ª§Ê≥®ÂÜåÂÆåÊàê ==========")}catch(e){const n=e instanceof Error?e.message:String(e);throw console.error("[WorkflowPanel] ‚ùå Ê≥®ÂÜåÂëΩ‰ª§Êó∂ÂèëÁîüÂºÇÂ∏∏:",n),console.error("[WorkflowPanel] ÈîôËØØÂ†ÜÊ†à:",e instanceof Error?e.stack:"Êó†Â†ÜÊ†à‰ø°ÊÅØ"),c.logger.error(`Ê≥®ÂÜåÂ∑•‰ΩúÊµÅÈù¢ÊùøÂëΩ‰ª§Êó∂ÂèëÁîüÂºÇÂ∏∏: ${n}`,l),e}};const i=o(t(398)),c=t(628),l="WorkflowPanel",d=[{id:"data_source",name:"‰ø°ÊÅØËé∑Âèñ",icon:"üì°",color:"#58a6ff"},{id:"market_trend",name:"Â∏ÇÂú∫Ë∂ãÂäø",icon:"üìà",color:"#667eea"},{id:"mainline",name:"ÊäïËµÑ‰∏ªÁ∫ø",icon:"üî•",color:"#F59E0B"},{id:"candidate_pool",name:"ÂÄôÈÄâÊ±†ÊûÑÂª∫",icon:"üì¶",color:"#a371f7"},{id:"factor",name:"Âõ†Â≠êÊûÑÂª∫",icon:"üßÆ",color:"#3fb950"},{id:"strategy",name:"Á≠ñÁï•ÁîüÊàê",icon:"üíª",color:"#d29922"}];class p{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_currentStep=null;_isRunning=!1;constructor(e,n,t){this._panel=e,this._extensionUri=n,this._client=t,this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(e=>this._handleMessage(e),null,this._disposables)}static createOrShow(e,n){console.log("[WorkflowPanel] createOrShow Ë¢´Ë∞ÉÁî®"),c.logger.info("ÂàõÂª∫Â∑•‰ΩúÊµÅÈù¢Êùø",l);const t=i.ViewColumn.One;if(p.currentPanel)return console.log("[WorkflowPanel] Èù¢ÊùøÂ∑≤Â≠òÂú®ÔºåÊòæÁ§∫Áé∞ÊúâÈù¢Êùø"),p.currentPanel._panel.reveal(t),p.currentPanel;console.log("[WorkflowPanel] ÂàõÂª∫Êñ∞ÁöÑÂ∑•‰ΩúÊµÅÈù¢Êùø");const a=i.window.createWebviewPanel("trquantWorkflow","üîÑ ÈõÜÊàêÂ∑•‰ΩúÊµÅÁ®ã",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});return p.currentPanel=new p(a,e,n),console.log("[WorkflowPanel] Â∑•‰ΩúÊµÅÈù¢ÊùøÂàõÂª∫ÊàêÂäü"),c.logger.info("Â∑•‰ΩúÊµÅÈù¢ÊùøÂàõÂª∫ÊàêÂäü",l),p.currentPanel}dispose(){for(p.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}async _handleMessage(e){switch(c.logger.info(`[WorkflowPanel] Êî∂Âà∞Ê∂àÊÅØ: ${e.command}`,l),e.command){case"runStep":await this._runStep(e.stepId);break;case"runAll":await this._runAll();break;case"cancel":this._isRunning=!1,this._postMessage({command:"cancelled"})}}async _runStep(e){if(this._isRunning)i.window.showWarningMessage("Â∑•‰ΩúÊµÅÊ≠£Âú®ÊâßË°å‰∏≠ÔºåËØ∑Á≠âÂæÖÂÆåÊàê");else{this._isRunning=!0,this._currentStep=e,this._postMessage({command:"stepStarted",stepId:e,stepName:d.find(n=>n.id===e)?.name||e});try{const n=await this._client.callBridge("run_workflow_step",{step_id:e}),t=n;n.ok?this._postMessage({command:"stepFinished",stepId:e,success:!0,summary:t.summary||"ÊâßË°åÊàêÂäü",details:t.data||{},stepName:t.step_name||d.find(n=>n.id===e)?.name||e}):this._postMessage({command:"stepFinished",stepId:e,success:!1,summary:t.error||"ÊâßË°åÂ§±Ë¥•",details:{},stepName:d.find(n=>n.id===e)?.name||e})}catch(n){const t=n instanceof Error?n.message:String(n);c.logger.error(`Ê≠•È™§ ${e} ÊâßË°åÂ§±Ë¥•: ${t}`,l),this._postMessage({command:"stepFinished",stepId:e,success:!1,summary:`ÊâßË°åÂ§±Ë¥•: ${t}`,details:{},stepName:d.find(n=>n.id===e)?.name||e})}finally{this._isRunning=!1,this._currentStep=null}}}async _runAll(){this._isRunning?i.window.showWarningMessage("Â∑•‰ΩúÊµÅÊ≠£Âú®ÊâßË°å‰∏≠ÔºåËØ∑Á≠âÂæÖÂÆåÊàê"):(this._isRunning=!0,await i.window.withProgress({location:i.ProgressLocation.Notification,title:"üîÑ ÊâßË°åÂÆåÊï¥Â∑•‰ΩúÊµÅ",cancellable:!0},async(e,n)=>{const t=[];let a=!1;this._postMessage({command:"allStarted"});try{const n=await this._client.callBridge("run_full_workflow",{}),r=n;if(!n.ok||!r.data)throw new Error(n.error||"ÊâßË°åÂ§±Ë¥•");{const n=r.data,s=n.steps||[];for(const n of s){const r=this._getStepIdFromName(n.step_name);this._postMessage({command:"stepFinished",stepId:r,success:n.success,summary:n.summary||"",details:n.details||{},stepName:n.step_name}),t.push({step:n.step_name,success:n.success,error:n.error}),n.success||(a=!0),e.report({message:`${n.step_name}: ${n.success?"‚úÖ":"‚ùå"}`,increment:100/s.length})}this._postMessage({command:"allFinished",success:!a,results:t,strategyFile:n.strategy_file,totalTime:n.total_time}),a?i.window.showWarningMessage("‚ö†Ô∏è Â∑•‰ΩúÊµÅÂÆåÊàêÔºåÈÉ®ÂàÜÊ≠•È™§ÊúâÈîôËØØ"):i.window.showInformationMessage("‚úÖ ÂÆåÊï¥Â∑•‰ΩúÊµÅÊâßË°åÂÆåÊàêÔºÅ")}}catch(e){const n=e instanceof Error?e.message:String(e);c.logger.error(`ÂÆåÊï¥Â∑•‰ΩúÊµÅÊâßË°åÂ§±Ë¥•: ${n}`,l),this._postMessage({command:"allFinished",success:!1,results:[],error:n}),i.window.showErrorMessage(`Â∑•‰ΩúÊµÅÊâßË°åÂ§±Ë¥•: ${n}`)}finally{this._isRunning=!1}}))}_getStepIdFromName(e){return{Êï∞ÊçÆÊ∫ê:"data_source",Êï∞ÊçÆÊ∫êÊ£ÄÊµã:"data_source",Â∏ÇÂú∫Ë∂ãÂäø:"market_trend",ÊäïËµÑ‰∏ªÁ∫ø:"mainline",ÂÄôÈÄâÊ±†:"candidate_pool",ÂÄôÈÄâÊ±†ÊûÑÂª∫:"candidate_pool",Âõ†Â≠êÊé®Ëçê:"factor",Á≠ñÁï•ÁîüÊàê:"strategy"}[e]||e.toLowerCase().replace(/\s+/g,"_")}_postMessage(e){this._panel.webview.postMessage(e)}_getHtmlContent(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ÈõÜÊàêÂ∑•‰ΩúÊµÅÁ®ã</title>\n    <style>\n        :root {\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-tertiary: #21262d;\n            --border-color: #30363d;\n            --text-primary: #c9d1d9;\n            --text-secondary: #8b949e;\n            --accent-blue: #58a6ff;\n            --accent-green: #3fb950;\n            --accent-yellow: #d29922;\n            --accent-red: #f85149;\n            --accent-purple: #a371f7;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            height: 100vh;\n            overflow: hidden;\n        }\n        \n        .container {\n            display: flex;\n            height: 100vh;\n            gap: 0;\n        }\n        \n        /* Â∑¶‰æßÊ≠•È™§Âå∫Âüü */\n        .steps-panel {\n            width: 280px;\n            background: var(--bg-secondary);\n            border-right: 1px solid var(--border-color);\n            padding: 16px;\n            overflow-y: auto;\n        }\n        \n        .header {\n            margin-bottom: 20px;\n        }\n        \n        .header h1 {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 12px;\n        }\n        \n        .run-all-btn {\n            width: 100%;\n            padding: 10px;\n            background: linear-gradient(135deg, #6366f1, #8b5cf6);\n            color: white;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.2s;\n        }\n        \n        .run-all-btn:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .run-all-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        .steps-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .step-card {\n            background: var(--bg-tertiary);\n            border: 2px solid var(--border-color);\n            border-left: 4px solid var(--step-color);\n            border-radius: 10px;\n            padding: 14px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n        \n        .step-card:hover {\n            background: var(--bg-primary);\n            border-color: var(--accent-blue);\n        }\n        \n        .step-card.running {\n            border-color: var(--accent-yellow);\n            animation: pulse 1.5s infinite;\n        }\n        \n        .step-card.completed {\n            border-color: var(--accent-green);\n        }\n        \n        .step-card.failed {\n            border-color: var(--accent-red);\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(217, 153, 34, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(217, 153, 34, 0); }\n        }\n        \n        .step-icon {\n            font-size: 26px;\n            width: 36px;\n            text-align: center;\n        }\n        \n        .step-name {\n            flex: 1;\n            font-size: 15px;\n            font-weight: 600;\n        }\n        \n        .step-status {\n            font-size: 16px;\n        }\n        \n        /* Âè≥‰æßÁªìÊûúÂå∫Âüü */\n        .result-panel {\n            flex: 1;\n            background: var(--bg-primary);\n            padding: 20px;\n            overflow-y: auto;\n        }\n        \n        .result-header {\n            margin-bottom: 20px;\n        }\n        \n        .result-title {\n            font-size: 20px;\n            font-weight: 600;\n            margin-bottom: 8px;\n        }\n        \n        .result-summary {\n            background: var(--bg-secondary);\n            padding: 16px;\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n            margin-bottom: 20px;\n        }\n        \n        .result-details {\n            background: var(--bg-secondary);\n            padding: 16px;\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n            max-height: 400px;\n            overflow-y: auto;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th,\n        .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-tertiary);\n            font-weight: 600;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-secondary);\n        }\n        \n        .empty-icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-tertiary);\n            border-radius: 3px;\n            overflow: hidden;\n            margin: 12px 0;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        \x3c!-- Â∑¶‰æßÊ≠•È™§ --\x3e\n        <div class="steps-panel">\n            <div class="header">\n                <h1>üîÑ ÈõÜÊàêÂ∑•‰ΩúÊµÅÁ®ã</h1>\n                <button class="run-all-btn" id="runAllBtn" onclick="runAll()">\n                    ‚ñ∂Ô∏è ‰∏ÄÈîÆÊâßË°åÂÖ®ÈÉ®\n                </button>\n            </div>\n            <div class="steps-list" id="stepsList">\n                ${d.map(e=>`\n                    <div class="step-card" id="step-${e.id}" \n                         style="--step-color: ${e.color}"\n                         onclick="runStep('${e.id}')">\n                        <div class="step-icon">${e.icon}</div>\n                        <div class="step-name">${e.name}</div>\n                        <div class="step-status" id="status-${e.id}">‚ñ∂Ô∏è</div>\n                    </div>\n                `).join("")}\n            </div>\n        </div>\n        \n        \x3c!-- Âè≥‰æßÁªìÊûú --\x3e\n        <div class="result-panel">\n            <div class="result-header">\n                <div class="result-title" id="resultTitle">üìã ÊâßË°åÁªìÊûú</div>\n            </div>\n            <div class="result-summary" id="resultSummary">\n                ÁÇπÂáªÂ∑¶‰æßÊ≠•È™§ÂºÄÂßãÊâßË°å...\n            </div>\n            <div class="result-details" id="resultDetails"></div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        let isRunning = false;\n        \n        function runStep(stepId) {\n            if (isRunning) {\n                return;\n            }\n            vscode.postMessage({ command: 'runStep', stepId });\n        }\n        \n        function runAll() {\n            if (isRunning) {\n                return;\n            }\n            vscode.postMessage({ command: 'runAll' });\n        }\n        \n        function setStepStatus(stepId, status) {\n            const card = document.getElementById('step-' + stepId);\n            const statusEl = document.getElementById('status-' + stepId);\n            \n            card.classList.remove('running', 'completed', 'failed');\n            \n            switch(status) {\n                case 'running':\n                    card.classList.add('running');\n                    statusEl.textContent = '‚è≥';\n                    break;\n                case 'completed':\n                    card.classList.add('completed');\n                    statusEl.textContent = '‚úÖ';\n                    break;\n                case 'failed':\n                    card.classList.add('failed');\n                    statusEl.textContent = '‚ùå';\n                    break;\n                default:\n                    statusEl.textContent = '‚ñ∂Ô∏è';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return '<div style="color:var(--text-secondary);">Êó†ËØ¶ÁªÜÊï∞ÊçÆ</div>';\n            }\n            \n            let html = '';\n            \n            // ÊäïËµÑ‰∏ªÁ∫ø\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += '<div style="margin-bottom:12px;"><strong>üî• ÊäïËµÑ‰∏ªÁ∫ø TOP' + mainlines.length + '</strong></div>';\n                html += '<table><tr><th>ÊéíÂêç</th><th>ÂêçÁß∞</th><th>ËØÑÂàÜ</th></tr>';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += '<tr><td>#' + (ml.rank || '-') + '</td><td>' + (ml.name || '-') + '</td><td>' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || '-') + '</td></tr>';\n                });\n                html += '</table>';\n            }\n            \n            // ÂÄôÈÄâÊ±†ËÇ°Á•®\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += '<div style="margin-bottom:12px;"><strong>üì¶ ÂÄôÈÄâÊ±†ËÇ°Á•® (' + stocks.length + 'Âè™)</strong></div>';\n                html += '<table><tr><th>‰ª£Á†Å</th><th>ÂêçÁß∞</th><th>Êù•Ê∫ê</th><th>ËØÑÂàÜ</th></tr>';\n                stocks.slice(0, 15).forEach(s => {\n                    html += '<tr><td>' + (s.code || '-') + '</td><td>' + (s.name || '-') + '</td><td>' + (s.source || '-') + '</td><td>' + ((s.score || 0).toFixed?.(1) || '-') + '</td></tr>';\n                });\n                html += '</table>';\n            }\n            \n            // Êé®ËçêÂõ†Â≠ê\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += '<div style="margin-bottom:12px;"><strong>üßÆ Êé®ËçêÂõ†Â≠ê</strong></div>';\n                html += '<ul style="margin:0;padding-left:20px;">';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += '<li style="margin:6px 0;"><strong>' + (f.name || '-') + '</strong> (ÊùÉÈáç' + weight + '%) - ' + (f.reason || '') + '</li>';\n                });\n                html += '</ul>';\n            }\n            \n            // Êï∞ÊçÆÊ∫êÊ£ÄÊµã\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += '<div style="margin-bottom:12px;"><strong>üì° Êï∞ÊçÆÊ∫êÁä∂ÊÄÅ</strong></div>';\n                html += '<table><tr><th>Êï∞ÊçÆÊ∫ê</th><th>Áä∂ÊÄÅ</th></tr>';\n                if (details.jqdata !== undefined) {\n                    html += '<tr><td>JQData</td><td style="color:' + (details.jqdata ? '#3fb950' : '#f85149') + ';">' + (details.jqdata ? '‚úÖ ÂèØÁî®' : '‚ùå ‰∏çÂèØÁî®') + '</td></tr>';\n                }\n                if (details.akshare !== undefined) {\n                    html += '<tr><td>AKShare</td><td style="color:' + (details.akshare ? '#3fb950' : '#f85149') + ';">' + (details.akshare ? '‚úÖ ÂèØÁî®' : '‚ùå ‰∏çÂèØÁî®') + '</td></tr>';\n                }\n                html += '</table>';\n            }\n            \n            // ÈªòËÆ§JSONÊòæÁ§∫\n            else {\n                html += '<pre style="font-size:11px;overflow-x:auto;">' + JSON.stringify(details, null, 2) + '</pre>';\n            }\n            \n            return html;\n        }\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case 'stepStarted':\n                    isRunning = true;\n                    document.getElementById('runAllBtn').disabled = true;\n                    setStepStatus(message.stepId, 'running');\n                    document.getElementById('resultTitle').textContent = 'üìã ' + message.stepName + ' - ÊâßË°å‰∏≠';\n                    document.getElementById('resultSummary').textContent = 'Ê≠£Âú®ÊâßË°å ' + message.stepName + '...';\n                    document.getElementById('resultDetails').innerHTML = '';\n                    break;\n                    \n                case 'stepFinished':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    setStepStatus(message.stepId, message.success ? 'completed' : 'failed');\n                    document.getElementById('resultTitle').textContent = 'üìã ' + message.stepName + ' - ' + (message.success ? '‚úÖ ÂÆåÊàê' : '‚ùå Â§±Ë¥•');\n                    document.getElementById('resultSummary').textContent = message.summary || (message.success ? 'ÊâßË°åÊàêÂäü' : 'ÊâßË°åÂ§±Ë¥•');\n                    document.getElementById('resultDetails').innerHTML = formatDetails(message.details);\n                    break;\n                    \n                case 'allStarted':\n                    isRunning = true;\n                    document.getElementById('runAllBtn').disabled = true;\n                    document.getElementById('resultTitle').textContent = 'üîÑ ÊâßË°åÂÆåÊï¥Â∑•‰ΩúÊµÅ';\n                    document.getElementById('resultSummary').textContent = 'Ê≠£Âú®ÊâßË°åÊâÄÊúâÊ≠•È™§...';\n                    document.getElementById('resultDetails').innerHTML = '';\n                    // ÈáçÁΩÆÊâÄÊúâÊ≠•È™§Áä∂ÊÄÅ\n                    ${d.map(e=>`setStepStatus('${e.id}', 'default');`).join("")}\n                    break;\n                    \n                case 'allFinished':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    document.getElementById('resultTitle').textContent = message.success ? '‚úÖ Â∑•‰ΩúÊµÅÊâßË°åÂÆåÊàê' : '‚ö†Ô∏è Â∑•‰ΩúÊµÅÂÆåÊàêÔºàÈÉ®ÂàÜÂ§±Ë¥•Ôºâ';\n                    document.getElementById('resultSummary').textContent = 'ÂÖ±ÊâßË°å ' + (message.results?.length || 0) + ' ‰∏™Ê≠•È™§';\n                    \n                    // ÊòæÁ§∫Ê±áÊÄª\n                    let summaryHtml = '<div style="margin-top:16px;">';\n                    summaryHtml += '<h4 style="margin-bottom:8px;">ÊâßË°åÁªìÊûúÊ±áÊÄª</h4>';\n                    if (message.results) {\n                        message.results.forEach(r => {\n                            summaryHtml += '<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">';\n                            summaryHtml += '<span>' + (r.success ? '‚úÖ' : '‚ùå') + '</span>';\n                            summaryHtml += '<span>' + r.step + '</span>';\n                            if (r.error) {\n                                summaryHtml += '<span style="color:#f85149;font-size:11px;">(' + r.error + ')</span>';\n                            }\n                            summaryHtml += '</div>';\n                        });\n                    }\n                    summaryHtml += '</div>';\n                    document.getElementById('resultDetails').innerHTML = summaryHtml;\n                    break;\n                    \n                case 'cancelled':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>`}}n.WorkflowPanel=p},381:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.platformAdapter=n.PlatformAdapter=void 0;const t=[{source:{platform:"joinquant",api:"get_price",signature:"get_price(security, start_date, end_date, frequency, fields, skip_paused, fq, count, panel, fill_paused)"},target:{platform:"ptrade",api:"get_history",signature:"get_history(count, frequency, field, security_list, skip_paused, fq, bar_count)"},paramMapping:{security:"security_list",count:"count",frequency:e=>"1d"===e?"daily":e,fields:"field",skip_paused:"skip_paused",fq:"fq"},notes:["PTradeÁöÑget_historyËøîÂõûÊ†ºÂºè‰∏éJoinQuant‰∏çÂêå","ÈúÄË¶ÅÂ§ÑÁêÜËøîÂõûÊï∞ÊçÆÁöÑÊ†ºÂºèËΩ¨Êç¢","PTrade‰∏çÊîØÊåÅstart_date/end_dateÂèÇÊï∞ÔºåÈúÄË¶ÅÁî®countÊõø‰ª£"],examples:{before:"df = get_price('000001.XSHE', count=20, end_date='2024-01-01', frequency='daily', fields=['close', 'volume'])",after:"df = get_history(count=20, frequency='daily', field=['close', 'volume'], security_list=['000001.XSHE'])"}},{source:{platform:"joinquant",api:"get_current_data",signature:"get_current_data(security)"},target:{platform:"ptrade",api:"get_snapshot",signature:"get_snapshot(stock_code)"},paramMapping:{security:"stock_code"},notes:["ËøîÂõûÊï∞ÊçÆÁªìÊûÑ‰∏çÂêåÔºåÈúÄË¶ÅÈÄÇÈÖçÂ≠óÊÆµÂêç"],examples:{before:"current = get_current_data('000001.XSHE')",after:"current = get_snapshot('000001.XSHE')"}},{source:{platform:"joinquant",api:"history",signature:"history(count, unit, field, security_list, df, skip_paused, fq)"},target:{platform:"ptrade",api:"get_history",signature:"get_history(count, frequency, field, security_list, skip_paused, fq, bar_count)"},paramMapping:{count:"count",unit:e=>"1d"===e?"daily":"1m"===e?"minute":e,field:"field",security_list:"security_list",skip_paused:"skip_paused",fq:"fq"},notes:["unitÂèÇÊï∞ÈúÄË¶ÅËΩ¨Êç¢‰∏∫frequency"],examples:{before:"df = history(20, '1d', 'close', ['000001.XSHE'])",after:"df = get_history(count=20, frequency='daily', field='close', security_list=['000001.XSHE'])"}},{source:{platform:"joinquant",api:"get_index_stocks",signature:"get_index_stocks(index_symbol, date)"},target:{platform:"ptrade",api:"get_index_stocks",signature:"get_index_stocks(index_code)"},paramMapping:{index_symbol:e=>e.replace(".XSHG",".SH").replace(".XSHE",".SZ")},notes:["ËÇ°Á•®‰ª£Á†ÅÂêéÁºÄÈúÄË¶ÅËΩ¨Êç¢: .XSHG‚Üí.SH, .XSHE‚Üí.SZ"],examples:{before:"stocks = get_index_stocks('000300.XSHG')",after:"stocks = get_index_stocks('000300.SH')"}},{source:{platform:"joinquant",api:"order_target_value",signature:"order_target_value(security, value)"},target:{platform:"ptrade",api:"order_target_percent",signature:"order_target_percent(stock_code, percent)"},paramMapping:{security:"stock_code",value:(e,n)=>`${e} / context.portfolio.total_value`},notes:["PTrade‰ΩøÁî®ÁôæÂàÜÊØîËÄåÈùûÈáëÈ¢ù","ÈúÄË¶ÅËÆ°ÁÆó: percent = value / portfolio.total_value"],examples:{before:"order_target_value('000001.XSHE', 100000)",after:"order_target_percent('000001.XSHE', 100000 / context.portfolio.total_value)"}},{source:{platform:"joinquant",api:"order",signature:"order(security, amount, style)"},target:{platform:"ptrade",api:"order_lots",signature:"order_lots(stock_code, lots, limit_price)"},paramMapping:{security:"stock_code",amount:e=>`${e} // 100`},notes:["PTrade‰ΩøÁî®ÊâãÊï∞(100ËÇ°=1Êâã)ËÄåÈùûËÇ°Êï∞"],examples:{before:"order('000001.XSHE', 1000)",after:"order_lots('000001.XSHE', 10)"}},{source:{platform:"joinquant",api:"order_target",signature:"order_target(security, amount)"},target:{platform:"ptrade",api:"order_target_volume",signature:"order_target_volume(stock_code, volume)"},paramMapping:{security:"stock_code",amount:"volume"},notes:["ÂèÇÊï∞Âêç‰∏çÂêå‰ΩÜÈÄªËæëÁõ∏Âêå"],examples:{before:"order_target('000001.XSHE', 1000)",after:"order_target_volume('000001.XSHE', 1000)"}},{source:{platform:"joinquant",api:"set_benchmark",signature:"set_benchmark(security)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTrade‰∏çÈúÄË¶ÅËÆæÁΩÆÂü∫ÂáÜÔºåÊ≠§Ë°åÂèØÂà†Èô§ÊàñÊ≥®Èáä"],examples:{before:"set_benchmark('000300.XSHG')",after:"# set_benchmark('000300.XSHG')  # PTrade‰∏çÈúÄË¶ÅÊ≠§ËÆæÁΩÆ"}},{source:{platform:"joinquant",api:"set_option",signature:"set_option(option_name, value)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeÈÖçÁΩÆÊñπÂºè‰∏çÂêåÔºåÂ§ßÈÉ®ÂàÜÈÄâÈ°πÂú®Á≠ñÁï•ÈÖçÁΩÆÊñá‰ª∂‰∏≠ËÆæÁΩÆ"],examples:{before:"set_option('use_real_price', True)",after:"# PTradeÂú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ËÆæÁΩÆuse_real_price"}},{source:{platform:"joinquant",api:"set_slippage",signature:"set_slippage(slippage)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeÊªëÁÇπÂú®‰∫§ÊòìÈÖçÁΩÆ‰∏≠ËÆæÁΩÆ"],examples:{before:"set_slippage(PriceRelatedSlippage(0.002))",after:"# PTradeÂú®‰∫§ÊòìÈÖçÁΩÆ‰∏≠ËÆæÁΩÆÊªëÁÇπ"}},{source:{platform:"joinquant",api:"set_order_cost",signature:"set_order_cost(cost, type)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeË¥πÁî®Âú®Ë¥¶Êà∑ÈÖçÁΩÆ‰∏≠ËÆæÁΩÆ"],examples:{before:"set_order_cost(OrderCost(open_tax=0, close_tax=0.001, open_commission=0.0003, close_commission=0.0003), type='stock')",after:"# PTradeÂú®Ë¥¶Êà∑ÈÖçÁΩÆ‰∏≠ËÆæÁΩÆ‰∫§ÊòìË¥πÁî®"}},{source:{platform:"joinquant",api:"log.info",signature:"log.info(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["PTrade‰ΩøÁî®printËæìÂá∫Êó•Âøó"],examples:{before:"log.info('Á≠ñÁï•ÂºÄÂßãËøêË°å')",after:"print('[INFO] Á≠ñÁï•ÂºÄÂßãËøêË°å')"}},{source:{platform:"joinquant",api:"log.warn",signature:"log.warn(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["Âª∫ËÆÆÊ∑ªÂä†[WARN]ÂâçÁºÄ"],examples:{before:"log.warn('È£éÈô©ÊèêÁ§∫')",after:"print('[WARN] È£éÈô©ÊèêÁ§∫')"}},{source:{platform:"joinquant",api:"log.error",signature:"log.error(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["Âª∫ËÆÆÊ∑ªÂä†[ERROR]ÂâçÁºÄ"],examples:{before:"log.error('ÊâßË°åÂ§±Ë¥•')",after:"print('[ERROR] ÊâßË°åÂ§±Ë¥•')"}},{source:{platform:"joinquant",api:"run_daily",signature:"run_daily(func, time)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTrade‰∏çÊîØÊåÅrun_daily","ÈúÄË¶ÅÂú®on_bar‰∏≠Ê†πÊçÆÊó∂Èó¥Âà§Êñ≠ÊâßË°å","Á§∫‰æã: if context.current_dt.hour == 9 and context.current_dt.minute == 30:"],examples:{before:"run_daily(my_func, '09:30')",after:"# Âú®on_bar‰∏≠Ê∑ªÂä†Êó∂Èó¥Âà§Êñ≠:\n# if context.current_dt.strftime('%H:%M') == '09:30':\n#     my_func(context)"}}];class a{mappings=t;convert(e,n,t){const a=n.compatibility.sourcePlatform;return a===t?{success:!0,targetPlatform:t,originalCode:e,convertedCode:e,changes:[],warnings:["Ê∫êÂπ≥Âè∞‰∏éÁõÆÊ†áÂπ≥Âè∞Áõ∏ÂêåÔºåÊó†ÈúÄËΩ¨Êç¢"],errors:[],stats:{totalChanges:0,apiChanges:0,structureChanges:0,addedLines:0,removedLines:0}}:"joinquant"===a&&"ptrade"===t?this.convertJoinQuantToPTrade(e,n):"ptrade"===a&&"joinquant"===t?this.convertPTradeToJoinQuant(e,n):{success:!1,targetPlatform:t,originalCode:e,convertedCode:e,changes:[],warnings:[],errors:[`ÊöÇ‰∏çÊîØÊåÅ ${a} ‚Üí ${t} ÁöÑËΩ¨Êç¢`],stats:{totalChanges:0,apiChanges:0,structureChanges:0,addedLines:0,removedLines:0}}}convertJoinQuantToPTrade(e,n){const t=[],a=[],r=[];let s=e;const o=e.split("\n");for(const e of n.dependencies.apis){const n=this.findMapping(e.name,"joinquant","ptrade");if(n){if(""===n.target.api){const a=o[e.line-1],r=`# ${a.trim()}  # PTrade‰∏çÈúÄË¶ÅÊ≠§ËÆæÁΩÆ`;s=this.replaceLine(s,e.line,r),t.push({type:"api_replace",line:e.line,original:a.trim(),converted:r,reason:n.notes?.[0]||"PTrade‰∏çÊîØÊåÅÊ≠§API"})}else{const a=new RegExp(`\\b${e.name}\\s*\\(`,"g"),r=`${n.target.api}(`;s=s.replace(a,r),t.push({type:"api_replace",line:e.line,original:e.name,converted:n.target.api,reason:`APIËΩ¨Êç¢: ${e.name} ‚Üí ${n.target.api}`})}n.notes&&a.push(...n.notes)}else r.push(`Á¨¨${e.line}Ë°å: API '${e.name}' Êó†Ê≥ïËá™Âä®ËΩ¨Êç¢`)}s=s.replace(/\.XSHG/g,".SH"),s=s.replace(/\.XSHE/g,".SZ"),t.push({type:"param_change",line:0,original:".XSHG/.XSHE",converted:".SH/.SZ",reason:"ËÇ°Á•®‰ª£Á†ÅÂêéÁºÄËΩ¨Êç¢"}),s=s.replace(/log\.info\s*\(\s*f?(['"])/g,"print('[INFO] ' + $1"),s=s.replace(/log\.info\s*\(/g,"print('[INFO]', "),s=s.replace(/log\.warn\s*\(\s*f?(['"])/g,"print('[WARN] ' + $1"),s=s.replace(/log\.warn\s*\(/g,"print('[WARN]', "),s=s.replace(/log\.error\s*\(\s*f?(['"])/g,"print('[ERROR] ' + $1"),s=s.replace(/log\.error\s*\(/g,"print('[ERROR]', "),s.includes("def on_bar")||(a.push("ÈúÄË¶ÅÊ∑ªÂä† on_bar() ÂÖ•Âè£ÂáΩÊï∞"),s+='\n\n# ============================================================\n# PTradeÂÖ•Âè£ÂáΩÊï∞ (Ëá™Âä®ÁîüÊàê)\n# ============================================================\n\ndef on_bar(context, data):\n    """\n    PTrade‰∏ªÂÖ•Âè£ÂáΩÊï∞\n    ËØ∑Â∞Ühandle_data‰∏≠ÁöÑÈÄªËæëËøÅÁßªÂà∞Ê≠§ÂáΩÊï∞\n    """\n    handle_data(context, data)\n',t.push({type:"structure_change",line:0,original:"",converted:"def on_bar(context, data)",reason:"Ê∑ªÂä†PTradeÂÖ•Âè£ÂáΩÊï∞"}));const i=e.matchAll(/run_daily\s*\(\s*(\w+)\s*,\s*['"](\d{2}:\d{2})['"]\s*\)/g);for(const e of i){const n=e[1],t=e[2];a.push(`run_daily(${n}, '${t}') ÈúÄË¶ÅÂú®on_bar‰∏≠Áî®Êó∂Èó¥Âà§Êñ≠ÂÆûÁé∞`)}const c=(new Date).toLocaleString("zh-CN"),l=`"""\n${n.meta.name} - PTradeÁâàÊú¨\n============================\n\nÂéüÂπ≥Âè∞: JoinQuant\nËΩ¨Êç¢Êó∂Èó¥: ${c}\nËΩ¨Êç¢Â∑•ÂÖ∑: TRQuant Strategy Optimizer\n\nÂéüÂßã‰ø°ÊÅØ:\n---------\n${n.meta.description||"Êó†ÊèèËø∞"}\n\nÊ≥®ÊÑè‰∫ãÈ°π:\n---------\n1. ËØ∑Ê£ÄÊü•ËÇ°Á•®‰ª£Á†ÅÂêéÁºÄÊòØÂê¶Ê≠£Á°Æ\n2. Á°ÆËÆ§‰∫§ÊòìË¥πÁî®ÂíåÊªëÁÇπÈÖçÁΩÆ\n3. ÊµãËØïÊï∞ÊçÆËé∑ÂèñÂáΩÊï∞ËøîÂõûÊ†ºÂºè\n"""`;return s=s.replace(/^[\s\S]*?"""[\s\S]*?"""/,l),{success:0===r.length,targetPlatform:"ptrade",originalCode:e,convertedCode:s,changes:t,warnings:a,errors:r,stats:{totalChanges:t.length,apiChanges:t.filter(e=>"api_replace"===e.type).length,structureChanges:t.filter(e=>"structure_change"===e.type).length,addedLines:t.filter(e=>"add"===e.type).length,removedLines:t.filter(e=>"remove"===e.type).length}}}convertPTradeToJoinQuant(e,n){const t=[],a=[];let r=e;return r=r.replace(/\.SH\b/g,".XSHG"),r=r.replace(/\.SZ\b/g,".XSHE"),r=r.replace(/\bget_history\s*\(/g,"get_price("),r=r.replace(/\bget_snapshot\s*\(/g,"get_current_data("),r=r.replace(/\border_target_percent\s*\(/g,"order_target_value("),r=r.replace(/\border_lots\s*\(/g,"order("),r=r.replace(/print\s*\(\s*\[INFO\]\s*/g,"log.info("),r=r.replace(/print\s*\(\s*\[WARN\]\s*/g,"log.warn("),r=r.replace(/print\s*\(\s*\[ERROR\]\s*/g,"log.error("),a.push("order_target_percentÈúÄË¶ÅÊâãÂä®ËΩ¨Êç¢‰∏∫ÈáëÈ¢ùÂΩ¢Âºè"),a.push("on_barÈÄªËæëÈúÄË¶ÅÊãÜÂàÜÂà∞handle_dataÂíårun_daily"),{success:!0,targetPlatform:"joinquant",originalCode:e,convertedCode:r,changes:t,warnings:a,errors:[],stats:{totalChanges:t.length,apiChanges:t.filter(e=>"api_replace"===e.type).length,structureChanges:0,addedLines:0,removedLines:0}}}findMapping(e,n,t){return this.mappings.find(t=>t.source.platform===n&&t.source.api===e)}replaceLine(e,n,t){const a=e.split("\n");if(n>0&&n<=a.length){const e=a[n-1].match(/^\s*/)?.[0]||"";a[n-1]=e+t}return a.join("\n")}getAllMappings(){return this.mappings}addMapping(e){this.mappings.push(e)}}n.PlatformAdapter=a,n.platformAdapter=new a},395:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.MarketPanel=void 0;const i=o(t(398));class c{static currentPanel;_panel;_extensionUri;_client;_disposables=[];constructor(e,n,t){this._panel=e,this._extensionUri=n,this._client=t,this._update(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(async e=>{switch(e.command){case"refresh":await this._update();break;case"getMarketStatus":await i.commands.executeCommand("trquant.getMarketStatus");break;case"getMainlines":await i.commands.executeCommand("trquant.getMainlines");break;case"generateStrategy":await i.commands.executeCommand("trquant.generateStrategy")}},null,this._disposables)}static createOrShow(e,n){const t=i.ViewColumn.Beside;if(c.currentPanel)return void c.currentPanel._panel.reveal(t);const a=i.window.createWebviewPanel("trquantPanel","TRQuant ÊéßÂà∂Âè∞",t,{enableScripts:!0,retainContextWhenHidden:!0});c.currentPanel=new c(a,e,n)}async _update(){this._panel.webview.html=await this._getHtmlContent()}async _getHtmlContent(){let e=null,n=null;try{const t=await this._client.getMarketStatus();t.ok&&(e=t.data);const a=await this._client.getMainlines({top_n:5});a.ok&&(n=a.data)}catch(e){}const t="risk_on"===e?.regime?"#10b981":"risk_off"===e?.regime?"#ef4444":"#f59e0b";return`<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <style>\n        body {\n            font-family: 'Segoe UI', sans-serif;\n            background: #1a1a2e;\n            color: #fff;\n            padding: 20px;\n            margin: 0;\n        }\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid #333;\n        }\n        .logo {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        .logo-icon { font-size: 32px; }\n        .logo-text {\n            font-size: 20px;\n            font-weight: bold;\n        }\n        .refresh-btn {\n            background: #333;\n            border: none;\n            color: #fff;\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n        }\n        .refresh-btn:hover { background: #444; }\n\n        .status-card {\n            background: linear-gradient(135deg, ${t}22, ${t}11);\n            border: 1px solid ${t}44;\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .status-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .status-regime {\n            font-size: 24px;\n            font-weight: bold;\n        }\n        .status-badge {\n            background: ${t};\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n        .status-summary {\n            margin-top: 12px;\n            color: #d1d5db;\n            line-height: 1.6;\n        }\n\n        .section {\n            background: #252540;\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 16px;\n        }\n        .section-title {\n            font-size: 14px;\n            color: #9ca3af;\n            margin-bottom: 12px;\n        }\n\n        .mainline-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px 0;\n            border-bottom: 1px solid #333;\n        }\n        .mainline-item:last-child { border: none; }\n\n        .actions {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n            margin-top: 20px;\n        }\n        .action-btn {\n            background: #667eea;\n            border: none;\n            color: #fff;\n            padding: 14px;\n            border-radius: 10px;\n            cursor: pointer;\n            font-size: 14px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n        .action-btn:hover { background: #5a6fd6; }\n        .action-btn.primary { background: #10b981; }\n        .action-btn.primary:hover { background: #059669; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="logo">\n            <span class="logo-icon">üìä</span>\n            <span class="logo-text">TRQuant ÊéßÂà∂Âè∞</span>\n        </div>\n        <button class="refresh-btn" onclick="refresh()">üîÑ Âà∑Êñ∞</button>\n    </div>\n\n    <div class="status-card">\n        <div class="status-header">\n            <span class="status-regime">\n                ${"risk_on"===e?.regime?"üìà È£éÈô©ÂÅèÂ•Ω‰∏äÂçá":"risk_off"===e?.regime?"üìâ È£éÈô©ÂÅèÂ•Ω‰∏ãÈôç":"‚û°Ô∏è ÈúáËç°Â∏ÇÂú∫"}\n            </span>\n            <span class="status-badge">${(e?.regime||"UNKNOWN").toUpperCase()}</span>\n        </div>\n        <div class="status-summary">\n            ${e?.summary||"Ê≠£Âú®Ëé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅ..."}\n        </div>\n    </div>\n\n    ${n?`\n    <div class="section">\n        <div class="section-title">üéØ ÁÉ≠Èó®‰∏ªÁ∫ø TOP 5</div>\n        ${n.slice(0,5).map((e,n)=>`\n            <div class="mainline-item">\n                <span>${n+1}. ${e.name}</span>\n                <span style="color: #667eea">${e.score?.toFixed(2)}</span>\n            </div>\n        `).join("")}\n    </div>\n    `:""}\n\n    <div class="actions">\n        <button class="action-btn" onclick="getMarketStatus()">\n            üìä Â∏ÇÂú∫Áä∂ÊÄÅ\n        </button>\n        <button class="action-btn" onclick="getMainlines()">\n            üéØ ÊäïËµÑ‰∏ªÁ∫ø\n        </button>\n        <button class="action-btn" onclick="recommendFactors()">\n            üìà Âõ†Â≠êÊé®Ëçê\n        </button>\n        <button class="action-btn primary" onclick="generateStrategy()">\n            üöÄ ÁîüÊàêÁ≠ñÁï•\n        </button>\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        function refresh() { vscode.postMessage({ command: 'refresh' }); }\n        function getMarketStatus() { vscode.postMessage({ command: 'getMarketStatus' }); }\n        function getMainlines() { vscode.postMessage({ command: 'getMainlines' }); }\n        function recommendFactors() { vscode.postMessage({ command: 'recommendFactors' }); }\n        function generateStrategy() { vscode.postMessage({ command: 'generateStrategy' }); }\n    <\/script>\n</body>\n</html>`}dispose(){for(c.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}}n.MarketPanel=c},398:e=>{e.exports=require("vscode")},405:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.recommendFactors=async function(e,n){c.logger.info("ÊâßË°åÊé®ËçêÂõ†Â≠êÂëΩ‰ª§",d),await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{t.report({message:"Ëé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅ...",increment:0});const r=await e.getMarketStatus(),s=r.data?.regime||"neutral";if(a.isCancellationRequested)return;t.report({message:"Êé®ËçêÂõ†Â≠ê...",increment:30});const o=await e.recommendFactors({market_regime:s,top_n:15});if(t.report({increment:40}),!o.ok||!o.data)return void i.window.showErrorMessage(`Ëé∑ÂèñÂõ†Â≠êÊé®ËçêÂ§±Ë¥•: ${o.error||"Êú™Áü•ÈîôËØØ"}`);const l=o.data;c.logger.info(`Êé®Ëçê ${l.length} ‰∏™Âõ†Â≠ê`,d),t.report({message:"Ê∏≤ÊüìÁªìÊûú...",increment:20}),function(e,n,t){const a=i.window.createWebviewPanel("trquantFactors","üìà Âõ†Â≠êÊé®Ëçê",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(e,n){const t=g(n),a=p(e),r=Object.entries(a).map(([e,n])=>function(e,n){const t=n.map(e=>function(e){const n=e.weight>.7?"weight-high":e.weight>.4?"weight-medium":"weight-low";return`\n        <div class="factor-card" data-factor="${e.name}" onclick="toggleFactor('${e.name}', this)">\n            <div class="factor-header">\n                <span class="factor-name">${e.name}</span>\n                <span class="factor-weight ${n}">${(100*e.weight).toFixed(0)}%</span>\n            </div>\n            <div class="factor-reason">${e.reason||"Âü∫‰∫éÂéÜÂè≤Ë°®Áé∞Êé®Ëçê"}</div>\n        </div>\n    `}(e)).join("");return`\n        <div class="category-section">\n            <div class="category-title">${function(e){return{ÁõàÂà©ËÉΩÂäõ:"üí∞",ÊàêÈïøÊÄß:"üöÄ",‰º∞ÂÄº:"üìä",Âä®Èáè:"‚ö°",ÊµÅÂä®ÊÄß:"üíß",Ê≥¢Âä®Áéá:"üìà",Ë¥®Èáè:"‚ú®",ÂÖ∂‰ªñ:"üìã"}[e]||"üìã"}(e)} ${e}</div>\n            <div class="factors-grid">\n                ${t}\n            </div>\n        </div>\n    `}(e,n)).join("");return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Âõ†Â≠êÊé®Ëçê</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${t.color};\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .info-card {\n            background: linear-gradient(135deg, ${t.color}22, ${t.color}11);\n            border-left: 4px solid ${t.color};\n            border-radius: 12px;\n            padding: 16px 20px;\n            margin-bottom: 24px;\n        }\n\n        .info-card p {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .category-section {\n            margin-bottom: 24px;\n        }\n\n        .category-title {\n            font-size: 15px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .category-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .factors-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n            gap: 12px;\n        }\n\n        .factor-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .factor-card:hover {\n            border-color: var(--primary);\n        }\n\n        .factor-card.selected {\n            border-color: var(--success);\n            background: var(--success)11;\n        }\n\n        .factor-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 8px;\n        }\n\n        .factor-name {\n            font-weight: 600;\n            font-size: 15px;\n        }\n\n        .factor-weight {\n            background: var(--bg-tertiary);\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 13px;\n            font-weight: 600;\n        }\n\n        .weight-high { background: var(--success); color: white; }\n        .weight-medium { background: var(--warning); color: #1a1a2e; }\n        .weight-low { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .factor-reason {\n            color: var(--text-secondary);\n            font-size: 13px;\n            line-height: 1.5;\n        }\n\n        .selected-factors {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 24px;\n            border: 1px solid var(--border);\n        }\n\n        .selected-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n\n        .selected-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n        }\n\n        .selected-tag {\n            background: var(--primary);\n            color: white;\n            padding: 6px 12px;\n            border-radius: 16px;\n            font-size: 13px;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .selected-tag .remove {\n            cursor: pointer;\n            opacity: 0.7;\n        }\n\n        .selected-tag .remove:hover { opacity: 1; }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">üìà</span>\n            <div>\n                <div class="header-title">Âõ†Â≠êÊé®Ëçê</div>\n                <div class="header-subtitle">Âü∫‰∫éÂΩìÂâçÂ∏ÇÂú∫Áä∂ÊÄÅÁöÑÊô∫ËÉΩÂõ†Â≠êÊé®Ëçê</div>\n            </div>\n        </div>\n        <span class="regime-badge">Â∏ÇÂú∫: ${n.toUpperCase()}</span>\n    </div>\n\n    <div class="info-card">\n        <p>${t.factorAdvice}</p>\n    </div>\n\n    <div class="selected-factors" id="selectedFactors">\n        <div class="selected-title">Â∑≤ÈÄâÂõ†Â≠ê (ÁÇπÂáªÂç°ÁâáÊ∑ªÂä†/ÁßªÈô§)</div>\n        <div class="selected-list" id="selectedList"></div>\n    </div>\n\n    ${r}\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            üöÄ ‰ΩøÁî®ÈÄâ‰∏≠Âõ†Â≠êÁîüÊàêÁ≠ñÁï•\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            üìã Â§çÂà∂‰∏∫AI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        Êõ¥Êñ∞Êó∂Èó¥: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        const selectedFactors = new Set();\n        \n        // ÈªòËÆ§ÈÄâ‰∏≠Ââç5‰∏™Âõ†Â≠ê\n        const defaultFactors = ${JSON.stringify(e.slice(0,5).map(e=>e.name))};\n        defaultFactors.forEach(f => selectedFactors.add(f));\n        updateSelectedDisplay();\n        \n        function toggleFactor(name, element) {\n            if (selectedFactors.has(name)) {\n                selectedFactors.delete(name);\n                element.classList.remove('selected');\n            } else {\n                selectedFactors.add(name);\n                element.classList.add('selected');\n            }\n            updateSelectedDisplay();\n        }\n        \n        function removeFactor(name) {\n            selectedFactors.delete(name);\n            const card = document.querySelector(\`[data-factor="\${name}"]\`);\n            if (card) card.classList.remove('selected');\n            updateSelectedDisplay();\n        }\n        \n        function updateSelectedDisplay() {\n            const list = document.getElementById('selectedList');\n            list.innerHTML = Array.from(selectedFactors).map(f => \n                \`<span class="selected-tag">\n                    \${f}\n                    <span class="remove" onclick="removeFactor('\${f}')">√ó</span>\n                </span>\`\n            ).join('');\n            \n            // Êõ¥Êñ∞Âç°ÁâáÁä∂ÊÄÅ\n            document.querySelectorAll('.factor-card').forEach(card => {\n                const factorName = card.getAttribute('data-factor');\n                if (selectedFactors.has(factorName)) {\n                    card.classList.add('selected');\n                }\n            });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ \n                command: 'generateStrategy',\n                factors: Array.from(selectedFactors)\n            });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(n,t),a.webview.onDidReceiveMessage(async e=>{switch(e.command){case"generateStrategy":!function(e){c.logger.info(`‰ΩøÁî®Âõ†Â≠êÁîüÊàêÁ≠ñÁï•: ${e.join(", ")}`,d),i.commands.executeCommand("trquant.generateStrategy")}(e.factors||n.slice(0,5).map(e=>e.name));break;case"copyPrompt":const a=u(n,t);await i.env.clipboard.writeText(a),i.window.showInformationMessage("PromptÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø")}},void 0,e.subscriptions)}(n,l,s),t.report({increment:10}),async function(e){if(0!==e.length)switch(await i.window.showInformationMessage(`Êé®Ëçê ${e.length} ‰∏™Âõ†Â≠ê`,"ÁîüÊàêÁ≠ñÁï•","Â§çÂà∂Prompt")){case"ÁîüÊàêÁ≠ñÁï•":i.commands.executeCommand("trquant.generateStrategy");break;case"Â§çÂà∂Prompt":const n=u(e,"neutral");await i.env.clipboard.writeText(n),i.window.showInformationMessage("PromptÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø")}}(l)}catch(e){l.ErrorHandler.handle(e,d)}})};const i=o(t(398)),c=t(628),l=t(799),d="RecommendFactors";function p(e){const n={};for(const t of e){const e=t.category||"ÂÖ∂‰ªñ";n[e]||(n[e]=[]),n[e].push(t)}return n}function g(e){const n={risk_on:{color:"#10b981",factorAdvice:"ÂΩìÂâçÂ∏ÇÂú∫È£éÈô©ÂÅèÂ•Ω‰∏äÂçáÔºåÂª∫ËÆÆ‰æßÈáçÊàêÈïøÊÄßÂíåÂä®ÈáèÂõ†Â≠ê„ÄÇÈ´òBeta„ÄÅÈ´òÊàêÈïøÁöÑËÇ°Á•®ÂèØËÉΩË°®Áé∞Êõ¥Â•Ω„ÄÇ"},risk_off:{color:"#ef4444",factorAdvice:"ÂΩìÂâçÂ∏ÇÂú∫È£éÈô©ÂÅèÂ•Ω‰∏ãÈôçÔºåÂª∫ËÆÆ‰æßÈáç‰ª∑ÂÄºÂíåË¥®ÈáèÂõ†Â≠ê„ÄÇ‰ΩéÊ≥¢Âä®„ÄÅÈ´òÂàÜÁ∫¢ÁöÑËÇ°Á•®ÂèØËÉΩÊõ¥Á®≥ÂÅ•„ÄÇ"},neutral:{color:"#f59e0b",factorAdvice:"ÂΩìÂâçÂ∏ÇÂú∫Â§Ñ‰∫éÈúáËç°Ê†ºÂ±ÄÔºåÂª∫ËÆÆÂùáË°°ÈÖçÁΩÆÂêÑÁ±ªÂõ†Â≠ê„ÄÇÂèØ‰ª•ËÄÉËôëÂ∏ÇÂú∫‰∏≠ÊÄßÁ≠ñÁï•Èôç‰ΩéÊñπÂêëÊÄßÈ£éÈô©„ÄÇ"}};return n[e]||n.neutral}function u(e,n){const t=p(e);return`# ÈáèÂåñÂõ†Â≠êÊé®Ëçê\n\n## Â∏ÇÂú∫Áä∂ÊÄÅ: ${n.toUpperCase()}\n\n${g(n).factorAdvice}\n\n## Êé®ËçêÂõ†Â≠êÂàóË°®\n\n${Object.entries(t).map(([e,n])=>`\n### ${e}\n${n.map(e=>`- **${e.name}** (ÊùÉÈáç: ${(100*e.weight).toFixed(0)}%): ${e.reason||""}`).join("\n")}\n`).join("\n")}\n\n---\n\nËØ∑Âü∫‰∫é‰ª•‰∏äÂõ†Â≠êÊé®ËçêÔºåÂ∏ÆÊàëÔºö\n1. ÂàÜÊûêÂêÑÂõ†Â≠êÂú®ÂΩìÂâçÂ∏ÇÂú∫ÁéØÂ¢É‰∏ãÁöÑÊúâÊïàÊÄß\n2. ËÆæËÆ°Âõ†Â≠êÂêàÊàêÊñπÊ°àÔºàÊùÉÈáçÂàÜÈÖçÔºâ\n3. ÁîüÊàê‰ΩøÁî®Ëøô‰∫õÂõ†Â≠êÁöÑPTradeÂ§öÂõ†Â≠êÁ≠ñÁï•‰ª£Á†Å\n\nË¶ÅÊ±ÇÔºö\n- Âõ†Â≠êÈúÄË¶ÅËøõË°åÊ†áÂáÜÂåñÂ§ÑÁêÜÔºàZ-scoreÔºâ\n- ËÄÉËôëÂõ†Â≠êÈó¥ÁöÑÁõ∏ÂÖ≥ÊÄß\n- ÂåÖÂê´ÂÆåÊï¥ÁöÑÈ£éÊéßÈÄªËæë\n`}},410:function(e,n,t){var a=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),r=this&&this.__exportStar||function(e,n){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(n,t)||a(n,e,t)};Object.defineProperty(n,"__esModule",{value:!0}),n.OptimizationAdvisor=n.createOptimizationAdvisor=n.StrategyAnalyzer=n.createStrategyAnalyzer=n.ManualLearner=n.createManualLearner=n.StrategyLearner=n.createStrategyLearner=n.reportGenerator=n.platformAdapter=n.codeAnalyzer=n.strategyOptimizer=n.StrategyOptimizerService=void 0,n.registerStrategyOptimizer=function(e,a){const r=t(628).logger,s=t(928),o="StrategyOptimizer",i=e.globalStorageUri.fsPath,c=e.extensionPath?s.join(e.extensionPath,"AShare-manual"):void 0;try{n.strategyOptimizer.initLearner(i,c),r.info("Á≠ñÁï•‰ºòÂåñÂô®Â≠¶‰π†ÂºïÊìéÂ∑≤ÂàùÂßãÂåñ",o)}catch(e){r.warn(`ÂàùÂßãÂåñÂ≠¶‰π†ÂºïÊìéÂ§±Ë¥•: ${e}`,o)}r.info("Á≠ñÁï•‰ºòÂåñÂô®ÊúçÂä°Â∑≤Ê≥®ÂÜå",o)};const s=t(510),o=t(381),i=t(879),c=t(144),l=t(150),d=t(902);r(t(64),n);class p{static instance;learner=null;manualLearner=null;storagePath="";manualPath="";strategyAnalyzer;optimizationAdvisor;constructor(){this.strategyAnalyzer=(0,l.createStrategyAnalyzer)(),this.optimizationAdvisor=(0,d.createOptimizationAdvisor)()}static getInstance(){return p.instance||(p.instance=new p),p.instance}initLearner(e,n){this.storagePath=e,this.learner=(0,c.createStrategyLearner)(e),n&&(this.manualPath=n,this.manualLearner=(0,c.createManualLearner)(e,n))}getLearner(){return this.learner}getManualLearner(){return this.manualLearner}async learnFromManual(){return this.manualLearner?this.manualLearner.learnFromManual():{success:!1,stats:{},log:["ÊâãÂÜåÂ≠¶‰π†Âô®Êú™ÂàùÂßãÂåñ"]}}watchManualUpdates(e){return this.manualLearner?this.manualLearner.watchForUpdates(e):null}analyzeStrategy(e,n){return s.codeAnalyzer.analyze(e,n)}convertToPlatform(e,n,t){const a=t||this.analyzeStrategy(e);return o.platformAdapter.convert(e,a,n)}generateReport(e,n="html"){const t=this.analyzeStrategy(e);switch(n){case"json":return i.reportGenerator.generate(t);case"markdown":return i.reportGenerator.generateMarkdown(t);default:return i.reportGenerator.generateHTML(t)}}async optimizeStrategy(e,n,t){const a=this.analyzeStrategy(e,t),r=o.platformAdapter.convert(e,a,n);return{analysis:a,conversion:r,report:i.reportGenerator.generateHTML(a,r)}}checkCompatibility(e){const n=this.analyzeStrategy(e);return{sourcePlatform:n.compatibility.sourcePlatform,compatibility:{joinquant:{score:n.compatibility.joinquant.score,level:n.compatibility.joinquant.level},ptrade:{score:n.compatibility.ptrade.score,level:n.compatibility.ptrade.level},qmt:{score:n.compatibility.qmt.score,level:n.compatibility.qmt.level},universal:{score:100,level:"full"}}}}getAPIMappings(){return o.platformAdapter.getAllMappings()}getPlatformInfo(e){const{PLATFORMS:n}=t(64);return n[e]}async learnFromDocuments(e){return this.learner?this.learner.learnFromDocuments(e):{learned:0,patterns:[],practices:[]}}async learnFromHistory(e){return this.learner?this.learner.learnFromHistory(e):{analyzed:0,successPatterns:[],failurePatterns:[]}}recordFeedback(e){this.learner&&this.learner.recordFeedback(e)}getRecommendedPatterns(e){if(!this.learner)return[];const n=this.analyzeStrategy(e);return this.learner.recommendPatterns(n)}getRecommendedPractices(e){if(!this.learner)return[];const n=this.analyzeStrategy(e);return this.learner.recommendBestPractices(n)}getLearningStats(){return this.learner?this.learner.getStats():null}saveLearningData(){this.learner&&this.learner.save()}analyzeStrategyDeep(e,n){return this.strategyAnalyzer.analyze(e,n)}generateOptimizationReport(e,n){const t=this.strategyAnalyzer.analyze(e,n);return this.optimizationAdvisor.generateReport(t)}quickOptimizationCheck(e){return this.generateOptimizationReport(e).advices.filter(e=>"high"===e.priority).map(e=>({priority:e.priority,title:e.title,suggestion:e.description}))}getStrategyScore(e){const n=this.generateOptimizationReport(e);return{overall:n.overallScore,...n.scoreBreakdown}}}n.StrategyOptimizerService=p,n.strategyOptimizer=p.getInstance();var g=t(510);Object.defineProperty(n,"codeAnalyzer",{enumerable:!0,get:function(){return g.codeAnalyzer}});var u=t(381);Object.defineProperty(n,"platformAdapter",{enumerable:!0,get:function(){return u.platformAdapter}});var m=t(879);Object.defineProperty(n,"reportGenerator",{enumerable:!0,get:function(){return m.reportGenerator}});var h=t(144);Object.defineProperty(n,"createStrategyLearner",{enumerable:!0,get:function(){return h.createStrategyLearner}}),Object.defineProperty(n,"StrategyLearner",{enumerable:!0,get:function(){return h.StrategyLearner}}),Object.defineProperty(n,"createManualLearner",{enumerable:!0,get:function(){return h.createManualLearner}}),Object.defineProperty(n,"ManualLearner",{enumerable:!0,get:function(){return h.ManualLearner}});var f=t(150);Object.defineProperty(n,"createStrategyAnalyzer",{enumerable:!0,get:function(){return f.createStrategyAnalyzer}}),Object.defineProperty(n,"StrategyAnalyzer",{enumerable:!0,get:function(){return f.StrategyAnalyzer}});var v=t(902);Object.defineProperty(n,"createOptimizationAdvisor",{enumerable:!0,get:function(){return v.createOptimizationAdvisor}}),Object.defineProperty(n,"OptimizationAdvisor",{enumerable:!0,get:function(){return v.OptimizationAdvisor}})},478:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.config=n.ConfigManager=void 0;const i=o(t(398)),c=o(t(928)),l=o(t(857)),d={pythonPath:"win32"===l.platform()?"python":"python3",serverHost:"127.0.0.1",serverPort:5e3,timeout:6e4,mcpEnabled:!0,mcpPort:5001,autoRefresh:!1,refreshInterval:3e5,defaultPlatform:"ptrade",defaultStyle:"multi_factor",defaultRiskParams:{maxPosition:.1,stopLoss:.08,takeProfit:.2}};class p{static instance;config;disposables=[];constructor(){this.config=this.loadConfig(),this.disposables.push(i.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("trquant")&&(this.config=this.loadConfig())}))}static getInstance(){return p.instance||(p.instance=new p),p.instance}loadConfig(){const e=i.workspace.getConfiguration("trquant");return{pythonPath:e.get("pythonPath")||d.pythonPath,serverHost:e.get("serverHost")||d.serverHost,serverPort:e.get("serverPort")||d.serverPort,timeout:e.get("timeout")||d.timeout,mcpEnabled:e.get("mcpEnabled")??d.mcpEnabled,mcpPort:e.get("mcpPort")||d.mcpPort,autoRefresh:e.get("autoRefresh")??d.autoRefresh,refreshInterval:e.get("refreshInterval")||d.refreshInterval,defaultPlatform:e.get("defaultPlatform")||d.defaultPlatform,defaultStyle:e.get("defaultStyle")||d.defaultStyle,defaultRiskParams:{maxPosition:e.get("defaultMaxPosition")||d.defaultRiskParams.maxPosition,stopLoss:e.get("defaultStopLoss")||d.defaultRiskParams.stopLoss,takeProfit:e.get("defaultTakeProfit")||d.defaultRiskParams.takeProfit}}}getConfig(){return{...this.config}}get(e){return this.config[e]}async set(e,n,t=i.ConfigurationTarget.Global){const a=i.workspace.getConfiguration("trquant");await a.update(e,n,t)}getPythonPath(e){const n=this.config.pythonPath;if(c.isAbsolute(n))return n;const t=c.join(e,"..","venv");return"win32"===l.platform()?c.join(t,"Scripts","python.exe"):c.join(t,"bin","python")}dispose(){this.disposables.forEach(e=>e.dispose())}}n.ConfigManager=p,n.config=p.getInstance()},501:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.getMarketStatus=async function(e,n){c.logger.info("ÊâßË°åËé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅÂëΩ‰ª§",d),await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{if(t.report({message:"Ê≠£Âú®Ëé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅ...",increment:0}),a.isCancellationRequested)return void c.logger.info("Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú",d);const r=await e.getMarketStatus({universe:"CN_EQ",as_of:(new Date).toISOString().split("T")[0]});if(t.report({increment:50}),!r.ok||!r.data)return void i.window.showErrorMessage(`Ëé∑ÂèñÂ∏ÇÂú∫Áä∂ÊÄÅÂ§±Ë¥•: ${r.error||"Êú™Áü•ÈîôËØØ"}`);const s=r.data;c.logger.info(`Â∏ÇÂú∫Áä∂ÊÄÅ: ${s.regime}`,d),t.report({message:"Ê∏≤ÊüìÁªìÊûú...",increment:30}),function(e,n){const t=i.window.createWebviewPanel("trquantMarketStatus","üìä Â∏ÇÂú∫Áä∂ÊÄÅ",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});t.webview.html=function(e){const n=p(e.regime),t=function(e){const n={SH000300:"Ê≤™Ê∑±300",SZ399006:"Âàõ‰∏öÊùøÊåá",SH000016:"‰∏äËØÅ50",SZ399905:"‰∏≠ËØÅ500"};return Object.entries(e).map(([e,t])=>{const a=n[e]||e,r="up"===t.trend?"‚Üë":"down"===t.trend?"‚Üì":"‚Üí";return`\n                <div class="trend-item">\n                    <span class="trend-name">${a}</span>\n                    <div class="trend-value">\n                        <span class="trend-direction ${t.zscore>0?"positive":t.zscore<0?"negative":"neutral"}">${r}</span>\n                        <span class="zscore">(${t.zscore>=0?"+":""}${t.zscore.toFixed(2)})</span>\n                    </div>\n                </div>\n            `}).join("")}(e.index_trend),a=function(e){const n={growth:"ÊàêÈïø",value:"‰ª∑ÂÄº",momentum:"Âä®Èáè",quality:"Ë¥®Èáè",size:"Â∏ÇÂÄº"};return e.map(e=>`\n                <div class="style-item">\n                    <span class="style-name">${n[e.style]||e.style}</span>\n                    <span class="style-score ${e.score>0?"positive":e.score<0?"negative":"neutral"}">${e.score>0?"+":""}${e.score.toFixed(2)}</span>\n                </div>\n            `).join("")}(e.style_rotation);return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Â∏ÇÂú∫Áä∂ÊÄÅ</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-content { flex: 1; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${n.color};\n            color: white;\n            padding: 8px 20px;\n            border-radius: 24px;\n            font-weight: 600;\n            font-size: 14px;\n            text-transform: uppercase;\n        }\n\n        .card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .card-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .card-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .trend-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 12px;\n        }\n\n        .trend-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .trend-name {\n            font-weight: 500;\n            font-size: 14px;\n        }\n\n        .trend-value {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .trend-direction {\n            font-size: 18px;\n        }\n\n        .zscore {\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n        .neutral { color: var(--warning); }\n\n        .style-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 12px;\n        }\n\n        .style-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 12px 20px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            flex: 1;\n            min-width: 150px;\n        }\n\n        .style-name { font-weight: 500; }\n\n        .style-score {\n            margin-left: auto;\n            font-weight: 600;\n            font-size: 18px;\n        }\n\n        .summary-card {\n            background: linear-gradient(135deg, ${n.color}22, ${n.color}11);\n            border-left: 4px solid ${n.color};\n        }\n\n        .summary-text {\n            color: var(--text-primary);\n            font-size: 15px;\n            line-height: 1.8;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover {\n            background: #5a6fd6;\n        }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover {\n            background: #3d3d5c;\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <span class="header-icon">${n.icon}</span>\n        <div class="header-content">\n            <div class="header-title">AËÇ°Â∏ÇÂú∫Áä∂ÊÄÅ</div>\n            <div class="header-subtitle">Âü∫‰∫éÂ§öÁª¥Â∫¶ÊåáÊ†áÁªºÂêàÂàÜÊûê</div>\n        </div>\n        <span class="regime-badge">${e.regime}</span>\n    </div>\n\n    <div class="card summary-card">\n        <div class="card-title">ÂàÜÊûêÁªìËÆ∫</div>\n        <div class="summary-text">${e.summary||n.description}</div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">ÊåáÊï∞Ë∂ãÂäø</div>\n        <div class="trend-grid">\n            ${t}\n        </div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">È£éÊ†ºËΩÆÂä®</div>\n        <div class="style-list">\n            ${a}\n        </div>\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="copyPrompt()">\n            üìã Â§çÂà∂‰∏∫AI Prompt\n        </button>\n        <button class="btn btn-secondary" onclick="refresh()">\n            üîÑ Âà∑Êñ∞Êï∞ÊçÆ\n        </button>\n    </div>\n\n    <div class="timestamp">\n        Êõ¥Êñ∞Êó∂Èó¥: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n        \n        function refresh() {\n            vscode.postMessage({ command: 'refresh' });\n        }\n    <\/script>\n</body>\n</html>`}(n),t.webview.onDidReceiveMessage(async e=>{switch(e.command){case"copyPrompt":const e=g(n);await i.env.clipboard.writeText(e),i.window.showInformationMessage("PromptÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø");break;case"refresh":i.commands.executeCommand("trquant.getMarketStatus"),t.dispose()}},void 0,e.subscriptions)}(n,s),t.report({increment:20}),async function(e){switch(await i.window.showInformationMessage(`Â∏ÇÂú∫Áä∂ÊÄÅ: ${e.regime.toUpperCase()}`,"Â§çÂà∂Prompt","ÁîüÊàêÁ≠ñÁï•","Êü•Áúã‰∏ªÁ∫ø")){case"Â§çÂà∂Prompt":const n=g(e);await i.env.clipboard.writeText(n),i.window.showInformationMessage("PromptÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø");break;case"ÁîüÊàêÁ≠ñÁï•":i.commands.executeCommand("trquant.generateStrategy");break;case"Êü•Áúã‰∏ªÁ∫ø":i.commands.executeCommand("trquant.getMainlines")}}(s)}catch(e){l.ErrorHandler.handle(e,d)}})};const i=o(t(398)),c=t(628),l=t(799),d="GetMarketStatus";function p(e){const n={risk_on:{icon:"üìà",color:"#10b981",description:"ÂΩìÂâçÂ∏ÇÂú∫È£éÈô©ÂÅèÂ•Ω‰∏äÂçáÔºåÈÄÇÂêàÁßØÊûÅÈÖçÁΩÆÊàêÈïøËÇ°ÂíåÈ´òBetaËµÑ‰∫ß„ÄÇÂª∫ËÆÆÂÖ≥Ê≥®ÁßëÊäÄ„ÄÅÊñ∞ËÉΩÊ∫êÁ≠âÈ´òÊàêÈïøÊùøÂùó„ÄÇ"},risk_off:{icon:"üìâ",color:"#ef4444",description:"ÂΩìÂâçÂ∏ÇÂú∫È£éÈô©ÂÅèÂ•Ω‰∏ãÈôçÔºåÂª∫ËÆÆÈò≤Âæ°ÊÄßÈÖçÁΩÆ„ÄÇÂèØÂÖ≥Ê≥®È´òÂàÜÁ∫¢„ÄÅ‰ΩéÊ≥¢Âä®ÁöÑ‰ª∑ÂÄºËÇ°ÔºåÈÄÇÂΩìÈôç‰Ωé‰ªì‰Ωç„ÄÇ"},neutral:{icon:"‚û°Ô∏è",color:"#f59e0b",description:"ÂΩìÂâçÂ∏ÇÂú∫Â§Ñ‰∫éÈúáËç°Ê†ºÂ±ÄÔºåÂª∫ËÆÆÂùáË°°ÈÖçÁΩÆ„ÄÇÂèØÈááÁî®Â∏ÇÂú∫‰∏≠ÊÄßÁ≠ñÁï•ÔºåÊéßÂà∂È£éÈô©ÊïûÂè£„ÄÇ"}};return n[e]||n.neutral}function g(e){const n=p(e.regime);return`# AËÇ°Â∏ÇÂú∫Áä∂ÊÄÅÂàÜÊûê\n\n## Â∏ÇÂú∫Regime: ${e.regime.toUpperCase()}\n${n.description}\n\n## ÊåáÊï∞Ë∂ãÂäø\n${Object.entries(e.index_trend).map(([e,n])=>`- ${e}: ${n.trend} (Âä®Èáè: ${n.zscore>=0?"+":""}${n.zscore.toFixed(2)})`).join("\n")}\n\n## È£éÊ†ºËΩÆÂä®\n${e.style_rotation.map(e=>`- ${e.style}: ${e.score>0?"Âç†‰ºò":"Âº±Âäø"} (${e.score>=0?"+":""}${e.score.toFixed(2)})`).join("\n")}\n\n## ÂàÜÊûêÊÄªÁªì\n${e.summary||n.description}\n\n---\nËØ∑Âü∫‰∫é‰ª•‰∏äÂ∏ÇÂú∫Áä∂ÊÄÅÔºåÂ∏ÆÊàëÁîüÊàêÈÄÇÂêàÂΩìÂâçÂ∏ÇÂú∫ÁéØÂ¢ÉÁöÑPTradeÈáèÂåñÁ≠ñÁï•‰ª£Á†Å„ÄÇË¶ÅÊ±ÇÔºö\n1. Ê†πÊçÆÂ∏ÇÂú∫RegimeÈÄâÊã©ÂêàÈÄÇÁöÑÁ≠ñÁï•È£éÊ†º\n2. ÂåÖÂê´ÂÆåÊï¥ÁöÑÈ£éÊéßÈÄªËæëÔºàÊ≠¢Êçü8%ÔºåÊ≠¢Áõà20%Ôºâ\n3. ÂçïÁ•®ÊúÄÂ§ß‰ªì‰Ωç10%\n4. Ê∑ªÂä†ËØ¶ÁªÜÁöÑ‰∏≠ÊñáÊ≥®Èáä\n`}},510:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.codeAnalyzer=n.CodeAnalyzer=void 0;const t=[{pattern:/get_price\s*\(/g,name:"get_price",category:"data"},{pattern:/get_fundamentals\s*\(/g,name:"get_fundamentals",category:"data"},{pattern:/get_current_data\s*\(/g,name:"get_current_data",category:"data"},{pattern:/get_extras\s*\(/g,name:"get_extras",category:"data"},{pattern:/get_index_stocks\s*\(/g,name:"get_index_stocks",category:"data"},{pattern:/get_industry_stocks\s*\(/g,name:"get_industry_stocks",category:"data"},{pattern:/get_concept_stocks\s*\(/g,name:"get_concept_stocks",category:"data"},{pattern:/get_all_securities\s*\(/g,name:"get_all_securities",category:"data"},{pattern:/history\s*\(/g,name:"history",category:"data"},{pattern:/attribute_history\s*\(/g,name:"attribute_history",category:"data"},{pattern:/order\s*\(/g,name:"order",category:"trade"},{pattern:/order_target\s*\(/g,name:"order_target",category:"trade"},{pattern:/order_target_value\s*\(/g,name:"order_target_value",category:"trade"},{pattern:/order_value\s*\(/g,name:"order_value",category:"trade"},{pattern:/cancel_order\s*\(/g,name:"cancel_order",category:"trade"},{pattern:/get_open_orders\s*\(/g,name:"get_open_orders",category:"trade"},{pattern:/set_benchmark\s*\(/g,name:"set_benchmark",category:"setting"},{pattern:/set_option\s*\(/g,name:"set_option",category:"setting"},{pattern:/set_slippage\s*\(/g,name:"set_slippage",category:"setting"},{pattern:/set_order_cost\s*\(/g,name:"set_order_cost",category:"setting"},{pattern:/set_universe\s*\(/g,name:"set_universe",category:"setting"},{pattern:/log\.info\s*\(/g,name:"log.info",category:"log"},{pattern:/log\.warn\s*\(/g,name:"log.warn",category:"log"},{pattern:/log\.error\s*\(/g,name:"log.error",category:"log"},{pattern:/run_daily\s*\(/g,name:"run_daily",category:"schedule"},{pattern:/run_weekly\s*\(/g,name:"run_weekly",category:"schedule"},{pattern:/run_monthly\s*\(/g,name:"run_monthly",category:"schedule"}],a=[{pattern:/get_history\s*\(/g,name:"get_history",category:"data"},{pattern:/get_snapshot\s*\(/g,name:"get_snapshot",category:"data"},{pattern:/get_Ede\s*\(/g,name:"get_Ede",category:"data"},{pattern:/order_target_percent\s*\(/g,name:"order_target_percent",category:"trade"},{pattern:/order_lots\s*\(/g,name:"order_lots",category:"trade"},{pattern:/on_bar\s*\(/g,name:"on_bar",category:"entry"}],r=[{pattern:/\bpe\b|\bPE\b|pe_ratio|Â∏ÇÁõàÁéá/gi,type:"value",name:"PE"},{pattern:/\bpb\b|\bPB\b|pb_ratio|Â∏ÇÂáÄÁéá/gi,type:"value",name:"PB"},{pattern:/\bps\b|\bPS\b|ps_ratio|Â∏ÇÈîÄÁéá/gi,type:"value",name:"PS"},{pattern:/\bpcf\b|\bPCF\b|Â∏ÇÁé∞Áéá/gi,type:"value",name:"PCF"},{pattern:/dividend|ËÇ°ÊÅØ|ÂàÜÁ∫¢/gi,type:"value",name:"Dividend"},{pattern:/revenue_growth|Ëê•Êî∂Â¢ûÈïø/gi,type:"growth",name:"RevenueGrowth"},{pattern:/profit_growth|Âà©Ê∂¶Â¢ûÈïø|ÂáÄÂà©Ê∂¶Â¢ûÈïø/gi,type:"growth",name:"ProfitGrowth"},{pattern:/eps_growth|ÊØèËÇ°Êî∂ÁõäÂ¢ûÈïø/gi,type:"growth",name:"EPSGrowth"},{pattern:/roe_growth|ROEÂ¢ûÈïø/gi,type:"growth",name:"ROEGrowth"},{pattern:/\broe\b|\bROE\b|ÂáÄËµÑ‰∫ßÊî∂ÁõäÁéá/gi,type:"quality",name:"ROE"},{pattern:/\broa\b|\bROA\b|ÊÄªËµÑ‰∫ßÊî∂ÁõäÁéá/gi,type:"quality",name:"ROA"},{pattern:/gross_margin|ÊØõÂà©Áéá/gi,type:"quality",name:"GrossMargin"},{pattern:/net_margin|ÂáÄÂà©Áéá/gi,type:"quality",name:"NetMargin"},{pattern:/asset_turnover|ËµÑ‰∫ßÂë®ËΩ¨/gi,type:"quality",name:"AssetTurnover"},{pattern:/momentum|Âä®Èáè/gi,type:"momentum",name:"Momentum"},{pattern:/return_\d+d|Êî∂ÁõäÁéá/gi,type:"momentum",name:"Return"},{pattern:/relative_strength|Áõ∏ÂØπÂº∫Â∫¶/gi,type:"momentum",name:"RelativeStrength"},{pattern:/volatility|Ê≥¢Âä®Áéá/gi,type:"volatility",name:"Volatility"},{pattern:/\bbeta\b|Ë¥ùÂ°î/gi,type:"volatility",name:"Beta"},{pattern:/std_dev|Ê†áÂáÜÂ∑Æ/gi,type:"volatility",name:"StdDev"}],s=[{pattern:/\bMA\b|ÁßªÂä®Âπ≥Âùá|ma\(/gi,type:"ma",name:"MA"},{pattern:/\bEMA\b|ÊåáÊï∞Âπ≥Âùá|ema\(/gi,type:"ma",name:"EMA"},{pattern:/\bMACD\b|macd/gi,type:"macd",name:"MACD"},{pattern:/\bRSI\b|rsi|Áõ∏ÂØπÂº∫Âº±/gi,type:"rsi",name:"RSI"},{pattern:/\bKDJ\b|kdj/gi,type:"kdj",name:"KDJ"},{pattern:/\bBOLL\b|Â∏ÉÊûó|boll/gi,type:"boll",name:"BOLL"},{pattern:/\bATR\b|atr|Âπ≥ÂùáÁúüÂÆûÊ≥¢ÂπÖ/gi,type:"atr",name:"ATR"}];class o{analyze(e,n){const t=e.split("\n"),a=this.extractMeta(e,n),r=this.extractCodeBlocks(e),s=this.categorizeComponents(r),o=this.analyzeDependencies(e,t);return{meta:a,components:s,dependencies:o,compatibility:this.calculateCompatibility(o.apis),stats:this.calculateStats(e,r)}}extractMeta(e,n){const t={name:n?.replace(".py","")||"Êú™ÂëΩÂêçÁ≠ñÁï•",description:""},a=e.match(/^[\s\S]*?"""([\s\S]*?)"""/);if(a){const e=a[1],n=e.match(/^(.+?)\s*[-=]/m);n&&(t.name=n[1].trim());const r=e.match(/ÂàõÂª∫Êó∂Èó¥[Ôºö:]\s*(.+)/);r&&(t.createTime=r[1].trim());const s=e.match(/ÂõûÊµãÂå∫Èó¥[Ôºö:]\s*(\d{4}-\d{2}-\d{2})\s*Ëá≥\s*(\d{4}-\d{2}-\d{2})/);s&&(t.backtestPeriod={start:s[1],end:s[2]});const o=e.match(/Âü∫ÂáÜ[ÊåáÊï∞]*[Ôºö:]\s*(\S+)/);o&&(t.benchmark=o[1]);const i=e.match(/Á≠ñÁï•[ËØ¥ÊòéÁâπËâ≤]*[Ôºö:]*\n?([\s\S]*?)(?=\n\n|ËøÅÁßª|Âπ≥Âè∞|$)/);i&&(t.description=i[1].trim().replace(/^[-\d.\s]+/gm,"").trim())}return t}extractCodeBlocks(e){const n=[],t=e.split("\n");let a=null,r=0,s=!1,o="";for(let e=0;e<t.length;e++){const i=t[e],c=i.trim(),l=i.length-i.trimStart().length;if(c.startsWith('"""')||c.startsWith("'''")){s?c.endsWith(o)&&(s=!1):(s=!0,o=c.substring(0,3),c.endsWith(o)&&c.length>3&&(s=!1));continue}if(s)continue;const d=c.match(/^def\s+(\w+)\s*\(/);if(d){a&&void 0!==a.startLine&&(a.endLine=e-1,a.content=t.slice(a.startLine,e).join("\n"),n.push(a)),a={type:"function",name:d[1],startLine:e,endLine:e,content:""},r=l;continue}const p=c.match(/^class\s+(\w+)/);if(p){a&&void 0!==a.startLine&&(a.endLine=e-1,a.content=t.slice(a.startLine,e).join("\n"),n.push(a)),a={type:"class",name:p[1],startLine:e,endLine:e,content:""},r=l;continue}const g=c.match(/^([A-Z_][A-Z0-9_]*)\s*=/);if(g&&0===l&&!a){let a=e;for(let n=e+1;n<t.length;n++){const e=t[n],r=e.trim(),s=e.length-e.trimStart().length;if(""===r||0===s&&!r.startsWith("#"))break;a=n}n.push({type:"variable",name:g[1],startLine:e,endLine:a,content:t.slice(e,a+1).join("\n")});continue}a&&l<=r&&""!==c&&!c.startsWith("#")&&(a.endLine=e-1,a.content=t.slice(a.startLine,e).join("\n"),n.push(a),a=null)}return a&&void 0!==a.startLine&&(a.endLine=t.length-1,a.content=t.slice(a.startLine).join("\n"),n.push(a)),n}categorizeComponents(e){const n={stockSelection:[],timing:[],riskControl:[],execution:[],utilities:[]};for(const t of e){const e=t.name.toLowerCase(),a=t.content.toLowerCase();e.includes("select")||e.includes("filter")||e.includes("stock")||a.includes("ÈÄâËÇ°")||a.includes("stock_pool")||a.includes("get_index_stocks")?(t.category="selection",n.stockSelection.push(t)):e.includes("timing")||e.includes("signal")||e.includes("market")||a.includes("Êã©Êó∂")||a.includes("‰ø°Âè∑")||a.includes("Ë∂ãÂäø")?(t.category="timing",n.timing.push(t)):e.includes("risk")||e.includes("stop")||e.includes("control")||a.includes("Ê≠¢Êçü")||a.includes("Ê≠¢Áõà")||a.includes("È£éÊéß")?(t.category="risk",n.riskControl.push(t)):e.includes("execute")||e.includes("trade")||e.includes("order")||e.includes("handle_data")||e.includes("rebalance")||a.includes("order")||a.includes("‰∫§Êòì")?(t.category="execution",n.execution.push(t)):(t.category="util",n.utilities.push(t))}return n}analyzeDependencies(e,n){const o=[],i=[],c=[],l=[],d=e.matchAll(/^(?:from\s+(\S+)\s+)?import\s+(.+)$/gm);for(const e of d)e[1]?l.push(`${e[1]}.${e[2]}`):l.push(e[2]);for(const a of t){let t;for(;null!==(t=a.pattern.exec(e));){const r=e.substring(0,t.index).split("\n").length,s=n[r-1]||"";o.push({name:a.name,platform:"joinquant",line:r,params:{},context:s.trim(),canConvert:!0})}a.pattern.lastIndex=0}for(const t of a){let a;for(;null!==(a=t.pattern.exec(e));){const r=e.substring(0,a.index).split("\n").length,s=n[r-1]||"";o.push({name:t.name,platform:"ptrade",line:r,params:{},context:s.trim(),canConvert:!0})}t.pattern.lastIndex=0}const p=new Set;for(const n of r)n.pattern.test(e)&&(p.has(n.name)||(p.add(n.name),i.push({name:n.name,type:n.type}))),n.pattern.lastIndex=0;const g=new Set;for(const n of s)n.pattern.test(e)&&(g.has(n.name)||(g.add(n.name),c.push({name:n.name,type:n.type}))),n.pattern.lastIndex=0;return{apis:o,factors:i,indicators:c,imports:l}}calculateCompatibility(e){const n=e.filter(e=>"joinquant"===e.platform),t=e.filter(e=>"ptrade"===e.platform);let a="joinquant";t.length>n.length&&(a="ptrade");const r=e=>{if(e===a)return{score:100,level:"full",issues:[],suggestions:[]};const r=[],s="joinquant"===a?n:t;for(const n of s)this.hasAPIMapping(n.name,a,e)?r.push({severity:"info",line:n.line,message:`API '${n.name}' ÂèØËá™Âä®ËΩ¨Êç¢`,api:n.name,suggestion:"Â∞ÜËá™Âä®ËΩ¨Êç¢‰∏∫ÂØπÂ∫îAPI"}):r.push({severity:"error",line:n.line,message:`API '${n.name}' Âú® ${e} ‰∏≠Ê≤°ÊúâÁõ¥Êé•ÂØπÂ∫î`,api:n.name,suggestion:"ÈúÄË¶ÅÊâãÂä®ÂÆûÁé∞ÊàñÂØªÊâæÊõø‰ª£ÊñπÊ°à"});const o=r.filter(e=>"error"===e.severity).length,i=s.length||1,c=Math.max(0,100-o/i*100);let l;return l=c>=95?"full":c>=80?"high":c>=60?"medium":c>=30?"low":"none",{score:Math.round(c),level:l,issues:r,suggestions:this.generateSuggestions(r,e)}};return{sourcePlatform:a,joinquant:r("joinquant"),ptrade:r("ptrade"),qmt:r("qmt")}}hasAPIMapping(e,n,t){const a={get_price:{joinquant:"get_price",ptrade:"get_history",qmt:"ContextInfo.get_market_data"},get_current_data:{joinquant:"get_current_data",ptrade:"get_snapshot",qmt:"ContextInfo.get_full_tick"},order_target_value:{joinquant:"order_target_value",ptrade:"order_target_percent",qmt:"order_target_volume"},order:{joinquant:"order",ptrade:"order_lots",qmt:"order_volume"},set_benchmark:{joinquant:"set_benchmark",ptrade:null,qmt:null},"log.info":{joinquant:"log.info",ptrade:"print",qmt:"print"},run_daily:{joinquant:"run_daily",ptrade:null,qmt:null},get_index_stocks:{joinquant:"get_index_stocks",ptrade:null,qmt:"ContextInfo.get_stock_list_in_sector"}}[e];return!!a&&null!==a[t]}generateSuggestions(e,n){const t=[],a=e.filter(e=>"error"===e.severity).map(e=>e.api);return 0===a.length?t.push("‰ª£Á†ÅÂèØÁõ¥Êé•ËΩ¨Êç¢ÔºåÊó†ÈúÄÊâãÂä®‰øÆÊîπ"):(t.push(`ÈúÄË¶ÅÂ§ÑÁêÜ ${a.length} ‰∏™‰∏çÂÖºÂÆπÁöÑAPIË∞ÉÁî®`),a.includes("run_daily")&&t.push("PTrade‰∏çÊîØÊåÅrun_dailyÔºåÈúÄË¶ÅÂú®on_bar‰∏≠ÂÆûÁé∞Êó•È¢ëÈÄªËæë"),a.includes("set_benchmark")&&t.push("PTradeÊó†ÈúÄËÆæÁΩÆÂü∫ÂáÜÔºåÂèØÂà†Èô§Ê≠§Ë°å"),"ptrade"===n&&(t.push("ÈúÄË¶ÅÊ∑ªÂä† on_bar() ‰Ωú‰∏∫ÂÖ•Âè£ÂáΩÊï∞"),t.push("Âª∫ËÆÆÊ∑ªÂä† initialize() Âíå before_trading_start() ÂáΩÊï∞"))),t}calculateStats(e,n){const t=e.split("\n"),a=t.length;let r=0,s=0,o=!1;for(const e of t){const n=e.trim();n.startsWith('"""')||n.startsWith("'''")?(o?o=!1:(o=!0,n.length>3&&(n.endsWith('"""')||n.endsWith("'''"))&&(o=!1)),r++):o||n.startsWith("#")||""===n?r++:s++}const i=n.filter(e=>"function"===e.type).length;let c;return c=i<=5&&a<=200?"low":i<=15&&a<=500?"medium":"high",{totalLines:a,codeLines:s,commentLines:r,functionCount:i,classCount:n.filter(e=>"class"===e.type).length,complexity:c}}}n.CodeAnalyzer=o,n.codeAnalyzer=new o},628:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.logger=n.Logger=n.LogLevel=void 0;const i=o(t(398));var c;!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(c||(n.LogLevel=c={}));class l{static instance;outputChannel;minLevel=c.INFO;logs=[];maxLogs=1e3;constructor(){this.outputChannel=i.window.createOutputChannel("TRQuant")}static getInstance(){return l.instance||(l.instance=new l),l.instance}setLevel(e){this.minLevel=e}show(){this.outputChannel.show()}debug(e,n,t){this.log(c.DEBUG,e,n,t)}info(e,n,t){this.log(c.INFO,e,n,t)}warn(e,n,t){this.log(c.WARN,e,n,t)}error(e,n,t){this.log(c.ERROR,e,n,t)}log(e,n,t,a){if(e<this.minLevel)return;const r={level:e,message:n,timestamp:new Date,module:t,data:a};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift();const s=c[e].padEnd(5),o=`${r.timestamp.toISOString().substring(11,23)} ${s} ${t?`[${t}]`:""} ${n}${a?` | ${JSON.stringify(a)}`:""}`;this.outputChannel.appendLine(o),e===c.ERROR&&i.window.showErrorMessage(`TRQuant: ${n}`)}getRecentLogs(e=100){return this.logs.slice(-e)}clear(){this.logs=[],this.outputChannel.clear()}dispose(){this.outputChannel.dispose()}}n.Logger=l,n.logger=l.getInstance()},683:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.KnowledgeStore=void 0,n.getKnowledgeStore=function(e){return d||(d=new l(e)),d};const i=o(t(896)),c=o(t(928));class l{dataPath;data;isDirty=!1;constructor(e){this.dataPath=c.join(e,"knowledge.json"),this.data=this.load()}load(){try{if(i.existsSync(this.dataPath)){const e=i.readFileSync(this.dataPath,"utf-8");return JSON.parse(e)}}catch(e){console.error("[KnowledgeStore] Âä†ËΩΩÂ§±Ë¥•:",e)}return this.getDefaultData()}getDefaultData(){return{patterns:this.getBuiltinPatterns(),apiMappings:[],bestPractices:this.getBuiltinBestPractices(),userFeedback:[]}}getBuiltinPatterns(){return[{id:"multi_factor_selection",name:"Â§öÂõ†Â≠êÈÄâËÇ°",category:"selection",description:"Âü∫‰∫éÂ§ö‰∏™ÈáèÂåñÂõ†Â≠êÂØπËÇ°Á•®ËøõË°åÁªºÂêàËØÑÂàÜÁ≠õÈÄâ",codeTemplate:'\ndef select_stocks_by_factors(stocks, factor_weights):\n    """Â§öÂõ†Â≠êÈÄâËÇ°"""\n    scores = {}\n    for stock in stocks:\n        score = 0\n        for factor, weight in factor_weights.items():\n            factor_value = get_factor_value(stock, factor)\n            score += factor_value * weight\n        scores[stock] = score\n    # ËøîÂõûÂæóÂàÜÊúÄÈ´òÁöÑËÇ°Á•®\n    return sorted(scores, key=scores.get, reverse=True)\n',effectiveness:85,usageCount:100},{id:"momentum_timing",name:"Âä®ÈáèÊã©Êó∂",category:"timing",description:"Âü∫‰∫é‰ª∑Ê†ºÂä®ÈáèÂà§Êñ≠Â∏ÇÂú∫Ë∂ãÂäø",codeTemplate:"\ndef check_momentum_signal(index_code, lookback=20):\n    \"\"\"Âä®ÈáèÊã©Êó∂‰ø°Âè∑\"\"\"\n    prices = get_price(index_code, count=lookback, fields=['close'])\n    returns = prices['close'].pct_change(lookback-1).iloc[-1]\n    \n    if returns > 0.05:\n        return 'bullish'\n    elif returns < -0.05:\n        return 'bearish'\n    return 'neutral'\n",effectiveness:70,usageCount:80},{id:"fixed_stop_loss",name:"Âõ∫ÂÆöÊ≠¢Êçü",category:"risk",description:"ÂΩì‰∫èÊçüËææÂà∞ÈòàÂÄºÊó∂Ëá™Âä®Ê≠¢Êçü",codeTemplate:'\ndef check_stop_loss(context, stock, stop_loss_pct=-0.08):\n    """Âõ∫ÂÆöÊ≠¢ÊçüÊ£ÄÊü•"""\n    if stock not in context.portfolio.positions:\n        return False\n    \n    position = context.portfolio.positions[stock]\n    cost = position.avg_cost\n    current_price = position.price\n    \n    profit_pct = (current_price - cost) / cost\n    return profit_pct <= stop_loss_pct\n',effectiveness:90,usageCount:150},{id:"trailing_stop",name:"ÁßªÂä®Ê≠¢Êçü",category:"risk",description:"Ê†πÊçÆÊúÄÈ´ò‰ª∑Âä®ÊÄÅË∞ÉÊï¥Ê≠¢ÊçüÁ∫ø",codeTemplate:'\ndef check_trailing_stop(context, stock, trail_pct=0.10):\n    """ÁßªÂä®Ê≠¢ÊçüÊ£ÄÊü•"""\n    if stock not in g.highest_prices:\n        return False\n    \n    highest = g.highest_prices[stock]\n    current = get_current_data()[stock].last_price\n    \n    # Êõ¥Êñ∞ÊúÄÈ´ò‰ª∑\n    if current > highest:\n        g.highest_prices[stock] = current\n        return False\n    \n    # Ê£ÄÊü•ÂõûÊí§\n    drawdown = (highest - current) / highest\n    return drawdown >= trail_pct\n',effectiveness:85,usageCount:90},{id:"equal_weight_execution",name:"Á≠âÊùÉÈáçÊâßË°å",category:"execution",description:"ÂØπÁõÆÊ†áËÇ°Á•®ËøõË°åÁ≠âÊùÉÈáçÈÖçÁΩÆ",codeTemplate:'\ndef execute_equal_weight(context, target_stocks, max_position=0.10):\n    """Á≠âÊùÉÈáçÊâßË°å"""\n    if not target_stocks:\n        return\n    \n    total_value = context.portfolio.total_value\n    weight = min(1.0 / len(target_stocks), max_position)\n    \n    for stock in target_stocks:\n        target_value = total_value * weight\n        order_target_value(stock, target_value)\n',effectiveness:80,usageCount:120},{id:"market_regime_position",name:"Â∏ÇÂú∫Áä∂ÊÄÅ‰ªì‰ΩçÁÆ°ÁêÜ",category:"risk",description:"Ê†πÊçÆÂ∏ÇÂú∫Áä∂ÊÄÅÂä®ÊÄÅË∞ÉÊï¥ÊÄª‰ªì‰Ωç",codeTemplate:"\nPOSITION_BY_REGIME = {\n    'risk_on': 0.90,   # ÁâõÂ∏ÇÈ´ò‰ªì‰Ωç\n    'risk_off': 0.50,  # ÁÜäÂ∏Ç‰Ωé‰ªì‰Ωç\n    'neutral': 0.70,   # ÈúáËç°‰∏≠‰ªì‰Ωç\n}\n\ndef get_target_position(regime):\n    \"\"\"Ëé∑ÂèñÁõÆÊ†á‰ªì‰Ωç\"\"\"\n    return POSITION_BY_REGIME.get(regime, 0.70)\n",effectiveness:88,usageCount:85}]}getBuiltinBestPractices(){return[{id:"bp_stop_loss",title:"ÂøÖÈ°ªËÆæÁΩÆÊ≠¢Êçü",category:"È£éÊéß",description:"‰ªª‰ΩïÁ≠ñÁï•ÈÉΩÂ∫îËØ•ÊúâÊ≠¢ÊçüÊú∫Âà∂ÔºåÂª∫ËÆÆÂçïÁ•®Ê≠¢ÊçüÁ∫øËÆæÁΩÆÂú®-8%Â∑¶Âè≥",example:"\n# Êé®ËçêÁöÑÊ≠¢ÊçüËÆæÁΩÆ\nSTOP_LOSS = -0.08  # 8%Ê≠¢Êçü\nTAKE_PROFIT = 0.20  # 20%Ê≠¢Áõà\n\ndef check_risk(context, stock):\n    profit = get_profit_pct(context, stock)\n    if profit <= STOP_LOSS:\n        order_target_value(stock, 0)\n        log.warn(f'Ê≠¢Êçü: {stock}')\n",references:["ÈáèÂåñÊäïËµÑÁ≠ñÁï•‰∏éÊäÄÊúØ","AËÇ°ÈáèÂåñÂÆûÊàò"]},{id:"bp_position_limit",title:"ÊéßÂà∂ÂçïÁ•®‰ªì‰Ωç",category:"È£éÊéß",description:"ÂçïÁ•®‰ªì‰Ωç‰∏çÂÆúË∂ÖËøáÊÄªËµÑÈáëÁöÑ10%ÔºåÈÅøÂÖç‰∏™ËÇ°È£éÈô©ÈõÜ‰∏≠",example:"\n# Êé®ËçêÁöÑ‰ªì‰ΩçÊéßÂà∂\nMAX_SINGLE_POSITION = 0.10  # ÂçïÁ•®ÊúÄÂ§ß10%\nMAX_TOTAL_POSITION = 0.80   # ÊÄª‰ªì‰ΩçÊúÄÂ§ß80%\n\ndef calculate_position(context, stock, score):\n    max_value = context.portfolio.total_value * MAX_SINGLE_POSITION\n    target_value = min(calculated_value, max_value)\n    return target_value\n",references:["ÁªÑÂêàÁÆ°ÁêÜ","È£éÈô©Âπ≥‰ª∑"]},{id:"bp_avoid_st",title:"ËøáÊª§STËÇ°Á•®",category:"ÈÄâËÇ°",description:"Âú®ÈÄâËÇ°Ê±†‰∏≠ÊéíÈô§ST„ÄÅ*STËÇ°Á•®ÔºåÈÅøÂÖçÈÄÄÂ∏ÇÈ£éÈô©",example:'\ndef filter_st_stocks(stocks):\n    """ËøáÊª§STËÇ°Á•®"""\n    current_data = get_current_data()\n    return [s for s in stocks \n            if not current_data[s].is_st \n            and not current_data[s].name.startswith(\'ST\')\n            and not current_data[s].name.startswith(\'*ST\')]\n',references:["AËÇ°‰∫§ÊòìËßÑÂàô"]},{id:"bp_avoid_suspension",title:"ËøáÊª§ÂÅúÁâåËÇ°Á•®",category:"ÈÄâËÇ°",description:"‰∫§ÊòìÂâçÊ£ÄÊü•ËÇ°Á•®ÊòØÂê¶ÂÅúÁâåÔºåÈÅøÂÖçÊó†Êïà‰∏ãÂçï",example:'\ndef filter_paused_stocks(stocks):\n    """ËøáÊª§ÂÅúÁâåËÇ°Á•®"""\n    current_data = get_current_data()\n    return [s for s in stocks \n            if not current_data[s].paused]\n',references:["‰∫§ÊòìÁ≥ªÁªüËÆæËÆ°"]},{id:"bp_limit_check",title:"Ê∂®Ë∑åÂÅúÊ£ÄÊü•",category:"ÊâßË°å",description:"‰∏ãÂçïÂâçÊ£ÄÊü•ÊòØÂê¶Ê∂®Ë∑åÂÅúÔºåÈÅøÂÖçÊó†ÊïàÂßîÊâò",example:'\ndef can_trade(stock):\n    """Ê£ÄÊü•ÊòØÂê¶ÂèØ‰∫§Êòì"""\n    current_data = get_current_data()\n    data = current_data[stock]\n    \n    # Ê∂®ÂÅú‰∏çËÉΩ‰π∞ÂÖ•\n    if data.last_price >= data.high_limit * 0.995:\n        return False, \'buy\'\n    \n    # Ë∑åÂÅú‰∏çËÉΩÂçñÂá∫\n    if data.last_price <= data.low_limit * 1.005:\n        return False, \'sell\'\n    \n    return True, None\n',references:["AËÇ°‰∫§ÊòìËßÑÂàô","Á®ãÂ∫èÂåñ‰∫§Êòì"]},{id:"bp_rebalance_frequency",title:"ÂêàÁêÜÁöÑË∞É‰ªìÈ¢ëÁéá",category:"ÊâßË°å",description:"Ë∞É‰ªìÈ¢ëÁéá‰∏çÂÆúËøáÈ´òÔºåÂª∫ËÆÆÂë®È¢ëÊàñÊúàÈ¢ëÔºåÂáèÂ∞ë‰∫§ÊòìÊàêÊú¨",example:'\n# Êé®ËçêÁöÑË∞É‰ªìËÆæÁΩÆ\nREBALANCE_DAYS = 20  # ÊúàÂ∫¶Ë∞É‰ªì\n\ndef should_rebalance(context):\n    """Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅË∞É‰ªì"""\n    if not hasattr(g, \'last_rebalance_date\'):\n        g.last_rebalance_date = context.current_dt.date()\n        return True\n    \n    days_since = (context.current_dt.date() - g.last_rebalance_date).days\n    if days_since >= REBALANCE_DAYS:\n        g.last_rebalance_date = context.current_dt.date()\n        return True\n    \n    return False\n',references:["‰∫§ÊòìÊàêÊú¨ÂàÜÊûê"]},{id:"bp_logging",title:"ÂÆåÂñÑÁöÑÊó•ÂøóËÆ∞ÂΩï",category:"Ë∞ÉËØï",description:"ËÆ∞ÂΩïÂÖ≥ÈîÆÊìç‰ΩúÊó•ÂøóÔºå‰æø‰∫éÂõûÊµãÂàÜÊûêÂíåÈóÆÈ¢òÊéíÊü•",example:'\ndef log_trade(context, stock, action, amount, price):\n    """ËÆ∞ÂΩï‰∫§ÊòìÊó•Âøó"""\n    log.info(f\'[{context.current_dt}] {action}: {stock}, \'\n             f\'Êï∞Èáè: {amount}, ‰ª∑Ê†º: {price:.2f}\')\n\ndef log_daily_summary(context):\n    """ËÆ∞ÂΩïÊØèÊó•ÊÄªÁªì"""\n    pv = context.portfolio.total_value\n    cash = context.portfolio.cash\n    positions = len(context.portfolio.positions)\n    log.info(f\'Êó•Áªà: ÊÄªÂÄº={pv:.0f}, Áé∞Èáë={cash:.0f}, ÊåÅ‰ªì={positions}Âè™\')\n',references:["ÈáèÂåñÁ≥ªÁªüËÆæËÆ°"]}]}save(){try{const e=c.dirname(this.dataPath);i.existsSync(e)||i.mkdirSync(e,{recursive:!0}),i.writeFileSync(this.dataPath,JSON.stringify(this.data,null,2),"utf-8"),this.isDirty=!1}catch(e){console.error("[KnowledgeStore] ‰øùÂ≠òÂ§±Ë¥•:",e)}}autoSave(){this.isDirty&&this.save()}getPatterns(e){return e?this.data.patterns.filter(n=>n.category===e):this.data.patterns}getPatternById(e){return this.data.patterns.find(n=>n.id===e)}addPattern(e){const n=this.data.patterns.findIndex(n=>n.id===e.id);n>=0?this.data.patterns[n]=e:this.data.patterns.push(e),this.isDirty=!0}updatePatternEffectiveness(e,n){const t=this.data.patterns.find(n=>n.id===e);t&&(t.effectiveness=n,t.usageCount++,this.isDirty=!0)}getAPIMappings(){return this.data.apiMappings}addAPIMapping(e){const n=this.data.apiMappings.findIndex(n=>n.source.api===e.source.api&&n.source.platform===e.source.platform&&n.target.platform===e.target.platform);n>=0?this.data.apiMappings[n]=e:this.data.apiMappings.push(e),this.isDirty=!0}getBestPractices(e){return e?this.data.bestPractices.filter(n=>n.category===e):this.data.bestPractices}addBestPractice(e){const n=this.data.bestPractices.findIndex(n=>n.id===e.id);n>=0?this.data.bestPractices[n]=e:this.data.bestPractices.push(e),this.isDirty=!0}getFeedback(e){return void 0!==e?this.data.userFeedback.filter(n=>n.resolved===e):this.data.userFeedback}addFeedback(e){this.data.userFeedback.push(e),this.isDirty=!0}resolveFeedback(e){const n=this.data.userFeedback.find(n=>n.timestamp===e);n&&(n.resolved=!0,this.isDirty=!0)}getStats(){return{patterns:this.data.patterns.length,apiMappings:this.data.apiMappings.length,bestPractices:this.data.bestPractices.length,feedback:{total:this.data.userFeedback.length,resolved:this.data.userFeedback.filter(e=>e.resolved).length,pending:this.data.userFeedback.filter(e=>!e.resolved).length}}}}n.KnowledgeStore=l;let d=null},767:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.ManualLearner=void 0,n.createManualLearner=function(e,n){return new m(e,n)};const i=o(t(896)),c=o(t(928)),l=t(683),d={"ashare-book1":{name:"AËÇ°ÊäïËµÑÂü∫Á°Ä",chapters:{"001":{name:"AËÇ°Â∏ÇÂú∫",category:"Âü∫Á°ÄÁü•ËØÜ"},"002":{name:"ÊäïËµÑÂøÉÁêÜ",category:"‰∫§ÊòìÂøÉÁêÜ"},"003":{name:"È´òÂÄçËÇ°",category:"ÈÄâËÇ°Á≠ñÁï•"},"004":{name:"Ë°å‰∏öÂàÜÊûê",category:"Ë°å‰∏öÁ†îÁ©∂"},"005":{name:"Âü∫Êú¨Èù¢",category:"Âü∫Êú¨Èù¢ÂàÜÊûê"},"006":{name:"ÈÄâËÇ°Á≠õÈÄâ",category:"ÈÄâËÇ°Á≠ñÁï•"},"007":{name:"‰∫§ÊòìÊâßË°å",category:"‰∫§ÊòìÊâßË°å"},"008":{name:"Â∑•ÂÖ∑‰ΩøÁî®",category:"Â∑•ÂÖ∑"},"009":{name:"Ê°à‰æãÂàÜÊûê",category:"ÂÆûÊàòÊ°à‰æã"},"010":{name:"‰∫§ÊòìÁ≥ªÁªü",category:"Á≥ªÁªüÊûÑÂª∫"}}},"ashare-book2":{name:"ÂÆèËßÇÁªèÊµé",chapters:{"001":{name:"ÁªèÊµéÂë®Êúü",category:"ÂÆèËßÇÊã©Êó∂"},"002":{name:"Ë¥ßÂ∏ÅÊîøÁ≠ñ",category:"ÊîøÁ≠ñÂàÜÊûê"},"003":{name:"Ë¥¢ÊîøÊîøÁ≠ñ",category:"ÊîøÁ≠ñÂàÜÊûê"},"004":{name:"Ë°å‰∏öËΩÆÂä®",category:"Ë°å‰∏öËΩÆÂä®"},"005":{name:"Â∏ÇÂú∫ÊÉÖÁª™",category:"ÊÉÖÁª™ÂàÜÊûê"},"006":{name:"ÂÆèËßÇÊï∞ÊçÆ",category:"Êï∞ÊçÆÂàÜÊûê"},"007":{name:"ÂÖ®ÁêÉÂΩ±Âìç",category:"ÂÖ®ÁêÉËßÜÈáé"},"008":{name:"È£éÈô©ÁõëÊéß",category:"È£éÊéß"},"009":{name:"ÂÆèËßÇÊã©Êó∂",category:"ÂÆèËßÇÊã©Êó∂"},"010":{name:"ÂÆèËßÇÂ∑•ÂÖ∑",category:"Â∑•ÂÖ∑"}}},"ashare-book3":{name:"‰∏™ËÇ°Á†îÁ©∂",chapters:{"001":{name:"Á†îÁ©∂Ê°ÜÊû∂",category:"Á†îÁ©∂ÊñπÊ≥ï"},"002":{name:"Ë¥¢Âä°ÂàÜÊûê",category:"Âü∫Êú¨Èù¢ÂàÜÊûê"},"003":{name:"‰º∞ÂÄºÊñπÊ≥ï",category:"‰º∞ÂÄº"},"004":{name:"Ë°å‰∏öÈæôÂ§¥",category:"ÈÄâËÇ°Á≠ñÁï•"},"005":{name:"Ê∂àË¥πÊ°à‰æã",category:"Ë°å‰∏öÁ†îÁ©∂"},"006":{name:"ÁßëÊäÄÊ°à‰æã",category:"Ë°å‰∏öÁ†îÁ©∂"},"007":{name:"Âë®ÊúüÊ°à‰æã",category:"Ë°å‰∏öÁ†îÁ©∂"},"008":{name:"ÈáëËûçÊ°à‰æã",category:"Ë°å‰∏öÁ†îÁ©∂"},"009":{name:"ÂåªËçØÊ°à‰æã",category:"Ë°å‰∏öÁ†îÁ©∂"},"010":{name:"Êä•ÂëäÊí∞ÂÜô",category:"Á†îÁ©∂ÊñπÊ≥ï"}}},"ashare-book4":{name:"ÊäÄÊúØÂàÜÊûê",chapters:{"001":{name:"ÊäÄÊúØÂàÜÊûêÂü∫Á°Ä",category:"ÊäÄÊúØÂàÜÊûê"},"002":{name:"KÁ∫øÂΩ¢ÊÄÅ",category:"ÊäÄÊúØÂàÜÊûê"},"003":{name:"Ë∂ãÂäøÂàÜÊûê",category:"ÊäÄÊúØÂàÜÊûê"},"004":{name:"Èáè‰ª∑ÂÖ≥Á≥ª",category:"ÊäÄÊúØÂàÜÊûê"},"005":{name:"ÊäÄÊúØÊåáÊ†á",category:"ÊäÄÊúØÊåáÊ†á"}}},"ashare-book5":{name:"ÈáèÂåñ‰∏ìÈ¢ò",chapters:{"001":{name:"ÂõûÊµãÂü∫Á°Ä",category:"ÂõûÊµã"},"002":{name:"JQDataÈõÜÊàê",category:"Êï∞ÊçÆÊ∫ê"},"003":{name:"Èü¨ÁùøÂõûÊµã",category:"ÂõûÊµã"},"004":{name:"Êä•ÂëäÂàÜÊûê",category:"ÂõûÊµãÂàÜÊûê"},"005":{name:"È£éÈô©ÊéßÂà∂",category:"È£éÊéß"},"006":{name:"PTradeÂÆûÁõò",category:"ÂÆûÁõò‰∫§Êòì"},"007":{name:"QMTÂÆûÁõò",category:"ÂÆûÁõò‰∫§Êòì"},"008":{name:"Á≠ñÁï•Ëø≠‰ª£",category:"Á≠ñÁï•‰ºòÂåñ"},"009":{name:"Êñá‰ª∂ÁÆ°ÁêÜ",category:"Â∑•ÂÖ∑"},"010":{name:"ÂÆåÊï¥Â∑•‰ΩúÊµÅ",category:"Á≥ªÁªüÊûÑÂª∫"}}},ashare:{name:"AËÇ°ÈáèÂåñÊ†∏ÂøÉ",chapters:{"001":{name:"AËÇ°Â∏ÇÂú∫",category:"Âü∫Á°ÄÁü•ËØÜ"},"002":{name:"Âõ†Â≠êÊ°ÜÊû∂",category:"Âõ†Â≠êÊäïËµÑ"},"003":{name:"È´òÂÄçËÇ°",category:"ÈÄâËÇ°Á≠ñÁï•"},"004":{name:"Ë°å‰∏öËΩÆÂä®",category:"Ë°å‰∏öËΩÆÂä®"},"005":{name:"Â§öÂõ†Â≠ê",category:"Â§öÂõ†Â≠êÁ≠ñÁï•"},"006":{name:"‰∫§ÊòìÊâßË°å",category:"‰∫§ÊòìÊâßË°å"},"007":{name:"È£éÈô©ÊéßÂà∂",category:"È£éÊéß"},"008":{name:"ÂõûÊµãÁ≥ªÁªü",category:"ÂõûÊµã"}}}},p=/```python\n([\s\S]*?)```/g,g=/(?:Âª∫ËÆÆ|Ê≥®ÊÑè|ÊèêÁ§∫|ÊúÄ‰Ω≥ÂÆûË∑µ|Êé®Ëçê)[Ôºö:]\s*(.+?)(?:\n|$)/g,u=/(?:Ê≠¢Êçü|Ê≠¢Áõà|‰ªì‰Ωç|È£éÊéß)[Ôºö:]?\s*(.+?)(?:\n|$)/gi;class m{store;manualPath;learningLog=[];stats={filesScanned:0,patternsExtracted:0,practicesExtracted:0,codeBlocksFound:0};constructor(e,n){this.store=(0,l.getKnowledgeStore)(e),this.manualPath=n}async learnFromManual(){this.log("ÂºÄÂßãÊâ´ÊèèAËÇ°ÂÆûÊìçÊâãÂÜå...");const e=c.join(this.manualPath,"src","pages");if(!i.existsSync(e))return this.log(`ÊâãÂÜåË∑ØÂæÑ‰∏çÂ≠òÂú®: ${e}`),{success:!1,stats:this.stats,log:this.learningLog};for(const[n,t]of Object.entries(d)){const a=c.join(e,n);i.existsSync(a)&&await this.scanBookDirectory(a,n,t)}const n=c.join(this.manualPath,"docs");return i.existsSync(n)&&await this.scanDocsDirectory(n),this.store.save(),this.log(`Â≠¶‰π†ÂÆåÊàêÔºÅÊâ´Êèè${this.stats.filesScanned}‰∏™Êñá‰ª∂ÔºåÊèêÂèñ${this.stats.patternsExtracted}‰∏™Ê®°ÂºèÔºå${this.stats.practicesExtracted}‰∏™ÊúÄ‰Ω≥ÂÆûË∑µ`),{success:!0,stats:this.stats,log:this.learningLog}}async scanBookDirectory(e,n,t){this.log(`Êâ´Êèè: ${t.name} (${n})`);const a=this.getAllMarkdownFiles(e);for(const e of a)try{const n=i.readFileSync(e,"utf-8"),a=c.basename(e),r=a.match(/(\d{3})_Chapter(\d+)/),s=r?r[1]:"000",o=t.chapters[s]||{name:"Êú™Áü•",category:"ÈÄöÁî®"};this.extractKnowledge(n,{source:`${t.name} - ${o.name}`,category:o.category,file:a}),this.stats.filesScanned++}catch(n){this.log(`Â§ÑÁêÜÊñá‰ª∂Â§±Ë¥• ${e}: ${n}`)}}async scanDocsDirectory(e){this.log("Êâ´ÊèèdocsÁõÆÂΩï...");const n=i.readdirSync(e).filter(e=>e.endsWith(".md")).map(n=>c.join(e,n));for(const e of n)try{const n=i.readFileSync(e,"utf-8"),t=c.basename(e);this.extractKnowledge(n,{source:`ÊñáÊ°£: ${t}`,category:"ÂèÇËÄÉÊñáÊ°£",file:t}),this.stats.filesScanned++}catch(e){}}getAllMarkdownFiles(e){const n=[],t=i.readdirSync(e,{withFileTypes:!0});for(const a of t){const t=c.join(e,a.name);a.isDirectory()?n.push(...this.getAllMarkdownFiles(t)):a.name.endsWith(".md")&&n.push(t)}return n}extractKnowledge(e,n){const t=e.matchAll(p);for(const e of t){const t=e[1];this.stats.codeBlocksFound++;const a=t.match(/def\s+(\w+)\s*\([^)]*\):/);if(a){const e=a[1];this.addPatternFromCode(e,t,n)}}const a=e.matchAll(g);for(const e of a){const t=e[1].trim();t.length>10&&t.length<200&&this.addPractice(t,n)}const r=e.matchAll(u);for(const e of r){const t=e[1].trim();t.length>5&&t.length<150&&this.addPractice(t,{...n,category:"È£éÊéß"})}}addPatternFromCode(e,n,t){let a="execution";e.includes("select")||e.includes("filter")||e.includes("stock")?a="selection":e.includes("stop")||e.includes("risk")||e.includes("position")?a="risk":(e.includes("timing")||e.includes("signal")||e.includes("trend"))&&(a="timing");const r={id:`manual_${e}_${Date.now()}`,name:this.formatFunctionName(e),category:a,description:`‰ªé${t.source}Â≠¶‰π†ÁöÑ${"selection"===a?"ÈÄâËÇ°":"risk"===a?"È£éÊéß":"timing"===a?"Êã©Êó∂":"ÊâßË°å"}ÂáΩÊï∞`,codeTemplate:n.trim(),effectiveness:75,usageCount:0};this.store.addPattern(r),this.stats.patternsExtracted++}addPractice(e,n){const t={id:`manual_bp_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,title:e.slice(0,50)+(e.length>50?"...":""),category:n.category,description:e,example:"",references:[n.source]};this.store.addBestPractice(t),this.stats.practicesExtracted++}watchForUpdates(e){const n=c.join(this.manualPath,"src","pages");return i.existsSync(n)?(this.log("ÂºÄÂßãÁõëÂê¨ÊâãÂÜåÊõ¥Êñ∞..."),i.watch(n,{recursive:!0},(t,a)=>{if(a&&a.endsWith(".md")){this.log(`Ê£ÄÊµãÂà∞Êõ¥Êñ∞: ${a}`);const t=c.join(n,a);if(i.existsSync(t))try{const n=i.readFileSync(t,"utf-8");this.extractKnowledge(n,{source:"ÊâãÂÜåÊõ¥Êñ∞",category:"Êõ¥Êñ∞ÂÜÖÂÆπ",file:a}),this.store.save(),e&&e(a)}catch(e){this.log(`Â§ÑÁêÜÊõ¥Êñ∞Â§±Ë¥•: ${e}`)}}})):null}getChapterKnowledge(e,n){const t=d[e];if(!t)return{patterns:[],practices:[]};const a=t.chapters[n];if(!a)return{patterns:[],practices:[]};const r=`${t.name} - ${a.name}`;return{patterns:this.store.getPatterns().filter(e=>e.description.includes(r)),practices:this.store.getBestPractices().filter(e=>e.references.some(e=>e.includes(r)))}}getStats(){return{...this.stats,knowledgeStore:this.store.getStats()}}formatFunctionName(e){return e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}log(e){const n=`[${(new Date).toISOString()}] ${e}`;this.learningLog.push(n),console.log(`[ManualLearner] ${e}`)}getLearningLog(){return this.learningLog}}n.ManualLearner=m},799:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorHandler=n.ConfigError=n.DataError=n.PythonError=n.TRQuantError=n.ErrorCode=void 0;const i=o(t(398)),c=t(628);var l;!function(e){e[e.UNKNOWN=1e3]="UNKNOWN",e[e.TIMEOUT=1001]="TIMEOUT",e[e.CANCELLED=1002]="CANCELLED",e[e.PYTHON_NOT_FOUND=2e3]="PYTHON_NOT_FOUND",e[e.PYTHON_EXECUTION_ERROR=2001]="PYTHON_EXECUTION_ERROR",e[e.BRIDGE_CONNECTION_ERROR=2002]="BRIDGE_CONNECTION_ERROR",e[e.BRIDGE_RESPONSE_PARSE_ERROR=2003]="BRIDGE_RESPONSE_PARSE_ERROR",e[e.DATA_NOT_AVAILABLE=3e3]="DATA_NOT_AVAILABLE",e[e.DATA_PARSE_ERROR=3001]="DATA_PARSE_ERROR",e[e.DATA_VALIDATION_ERROR=3002]="DATA_VALIDATION_ERROR",e[e.CONFIG_INVALID=4e3]="CONFIG_INVALID",e[e.CONFIG_MISSING=4001]="CONFIG_MISSING",e[e.MCP_CONNECTION_ERROR=5e3]="MCP_CONNECTION_ERROR",e[e.MCP_TOOL_NOT_FOUND=5001]="MCP_TOOL_NOT_FOUND",e[e.MCP_EXECUTION_ERROR=5002]="MCP_EXECUTION_ERROR"}(l||(n.ErrorCode=l={}));class d extends Error{code;details;timestamp;constructor(e,n,t){super(n),this.name="TRQuantError",this.code=e,this.details=t,this.timestamp=new Date,Object.setPrototypeOf(this,d.prototype)}toUserMessage(){return{[l.UNKNOWN]:"ÂèëÁîüÊú™Áü•ÈîôËØØ",[l.TIMEOUT]:"Êìç‰ΩúË∂ÖÊó∂ÔºåËØ∑ÈáçËØï",[l.CANCELLED]:"Êìç‰ΩúÂ∑≤ÂèñÊ∂à",[l.PYTHON_NOT_FOUND]:"PythonËß£ÈáäÂô®Êú™ÊâæÂà∞ÔºåËØ∑Ê£ÄÊü•ÈÖçÁΩÆ",[l.PYTHON_EXECUTION_ERROR]:"PythonÊâßË°åÈîôËØØ",[l.BRIDGE_CONNECTION_ERROR]:"Êó†Ê≥ïËøûÊé•Âà∞ÂêéÁ´ØÊúçÂä°",[l.BRIDGE_RESPONSE_PARSE_ERROR]:"ÂêéÁ´ØÂìçÂ∫îËß£ÊûêÂ§±Ë¥•",[l.DATA_NOT_AVAILABLE]:"Êï∞ÊçÆ‰∏çÂèØÁî®",[l.DATA_PARSE_ERROR]:"Êï∞ÊçÆËß£ÊûêÂ§±Ë¥•",[l.DATA_VALIDATION_ERROR]:"Êï∞ÊçÆÈ™åËØÅÂ§±Ë¥•",[l.CONFIG_INVALID]:"ÈÖçÁΩÆÊó†Êïà",[l.CONFIG_MISSING]:"Áº∫Â∞ëÂøÖË¶ÅÈÖçÁΩÆ",[l.MCP_CONNECTION_ERROR]:"MCPÊúçÂä°ËøûÊé•Â§±Ë¥•",[l.MCP_TOOL_NOT_FOUND]:"MCPÂ∑•ÂÖ∑Êú™ÊâæÂà∞",[l.MCP_EXECUTION_ERROR]:"MCPÂ∑•ÂÖ∑ÊâßË°åÂ§±Ë¥•"}[this.code]||this.message}toLogString(){return`[${l[this.code]}] ${this.message}${this.details?` | Details: ${JSON.stringify(this.details)}`:""}`}}n.TRQuantError=d,n.PythonError=class extends d{constructor(e,n){super(l.PYTHON_EXECUTION_ERROR,e,n),this.name="PythonError"}},n.DataError=class extends d{constructor(e,n,t){super(e,n,t),this.name="DataError"}},n.ConfigError=class extends d{constructor(e,n){super(l.CONFIG_INVALID,e,n),this.name="ConfigError"}};class p{static handle(e,n){const t=n||"ErrorHandler";e instanceof d?(c.logger.error(e.toLogString(),t),i.window.showErrorMessage(e.toUserMessage())):e instanceof Error?(c.logger.error(e.message,t,{stack:e.stack}),i.window.showErrorMessage(`TRQuant: ${e.message}`)):(c.logger.error(String(e),t),i.window.showErrorMessage("TRQuant: ÂèëÁîüÊú™Áü•ÈîôËØØ"))}static async wrap(e,n){try{return await e()}catch(e){return void p.handle(e,n)}}static async withRetry(e,n=3,t=1e3,a){let r;for(let s=0;s<n;s++)try{return await e()}catch(e){r=e,c.logger.warn(`Êìç‰ΩúÂ§±Ë¥•ÔºåÁ¨¨${s+1}Ê¨°ÈáçËØï...`,a,{error:e instanceof Error?e.message:String(e)}),s<n-1&&await new Promise(e=>setTimeout(e,t))}throw r}static validateRequired(e,n){const t=n.filter(n=>void 0===e[n]||null===e[n]);if(t.length>0)throw new d(l.DATA_VALIDATION_ERROR,`Áº∫Â∞ëÂøÖÈúÄÂèÇÊï∞: ${t.join(", ")}`,{missing:t,provided:Object.keys(e)})}}n.ErrorHandler=p},857:e=>{e.exports=require("os")},879:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.reportGenerator=n.ReportGenerator=void 0;class t{generate(e,n){return{title:`${e.meta.name} - Á≠ñÁï•ÂàÜÊûêÊä•Âëä`,generatedAt:(new Date).toLocaleString("zh-CN"),version:"1.0.0",investmentPhilosophy:this.generatePhilosophy(e),codeArchitecture:this.generateArchitecture(e),platformCompatibility:this.generateCompatibility(e,n),optimizations:this.generateOptimizations(e),codeQuality:this.generateQuality(e)}}generateMarkdown(e,n){const t=this.generate(e,n);return`# ${t.title}\n\n> ÁîüÊàêÊó∂Èó¥: ${t.generatedAt}\n> ÁâàÊú¨: ${t.version}\n\n---\n\n## üìä ÊäïËµÑÁêÜÂøµ\n\n### Ê†∏ÂøÉÈÄªËæë\n${t.investmentPhilosophy.coreLogic}\n\n### Â∏ÇÂú∫ÈÄÇÂ∫î\n${t.investmentPhilosophy.marketAdaptation}\n\n### È£éÈô©ÁÆ°ÁêÜ\n${t.investmentPhilosophy.riskManagement}\n\n### ÁâπËâ≤‰∫ÆÁÇπ\n${t.investmentPhilosophy.uniqueFeatures.map(e=>`- ${e}`).join("\n")}\n\n---\n\n## üèóÔ∏è ‰ª£Á†ÅÊû∂ÊûÑ\n\n### Ê¶ÇËø∞\n${t.codeArchitecture.overview}\n\n### Ê®°ÂùóËØ¥Êòé\n\n${t.codeArchitecture.modules.map(e=>`\n#### ${e.name}\n- **Áî®ÈÄî**: ${e.purpose}\n- **Â§çÊùÇÂ∫¶**: ${e.complexity}\n- **ÂáΩÊï∞**: ${e.functions.join(", ")}\n- **‰æùËµñ**: ${e.dependencies.join(", ")||"Êó†"}\n`).join("\n")}\n\n### ÊµÅÁ®ãÂõæ\n\n\`\`\`mermaid\n${t.codeArchitecture.flowChart}\n\`\`\`\n\n### Êï∞ÊçÆÊµÅ\n\n\`\`\`mermaid\n${t.codeArchitecture.dataFlow}\n\`\`\`\n\n---\n\n## üîÑ Âπ≥Âè∞ÂÖºÂÆπÊÄß\n\n${t.platformCompatibility.summary}\n\n| Âπ≥Âè∞ | ÂÖºÂÆπÂ∫¶ | Á≠âÁ∫ß | ÈúÄ‰øÆÊîπ | Â§áÊ≥® |\n|------|--------|------|--------|------|\n${Object.entries(t.platformCompatibility.details).map(([e,n])=>`| ${e} | ${n.score}% | ${n.level} | ${n.changes}Â§Ñ | ${n.notes.join("; ")} |`).join("\n")}\n\n---\n\n## üí° ‰ºòÂåñÂª∫ËÆÆ\n\n### ÊÄßËÉΩ‰ºòÂåñ\n${t.optimizations.performance.map(e=>this.formatOptimization(e)).join("\n")}\n\n### È£éÊéß‰ºòÂåñ\n${t.optimizations.risk.map(e=>this.formatOptimization(e)).join("\n")}\n\n### ‰ª£Á†ÅÂèØËØªÊÄß\n${t.optimizations.readability.map(e=>this.formatOptimization(e)).join("\n")}\n\n### Âπ≥Âè∞ÈÄÇÈÖç\n${t.optimizations.platform.map(e=>this.formatOptimization(e)).join("\n")}\n\n---\n\n## üìà ‰ª£Á†ÅË¥®Èáè\n\n**ÊÄªÂàÜ: ${t.codeQuality.score}/100**\n\n| ÊåáÊ†á | ÂæóÂàÜ |\n|------|------|\n| ÂèØÁª¥Êä§ÊÄß | ${t.codeQuality.metrics.maintainability}/100 |\n| ÂèØÊµãËØïÊÄß | ${t.codeQuality.metrics.testability}/100 |\n| ÊñáÊ°£ÂÆåÊï¥ÊÄß | ${t.codeQuality.metrics.documentation}/100 |\n| Â§çÊùÇÂ∫¶ÊéßÂà∂ | ${t.codeQuality.metrics.complexity}/100 |\n\n### ÊîπËøõÂª∫ËÆÆ\n${t.codeQuality.suggestions.map(e=>`- ${e}`).join("\n")}\n\n---\n\n*Êä•ÂëäÁî± TRQuant Strategy Optimizer Ëá™Âä®ÁîüÊàê*\n`}generateHTML(e,n){const t=this.generate(e,n);return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${t.title}</title>\n    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"><\/script>\n    <style>\n        :root {\n            --primary: #6366f1;\n            --secondary: #8b5cf6;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --bg: #0f172a;\n            --card-bg: #1e293b;\n            --text: #e2e8f0;\n            --text-muted: #94a3b8;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n            background: var(--bg);\n            color: var(--text);\n            line-height: 1.6;\n            padding: 2rem;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n        \n        h1 {\n            font-size: 2.5rem;\n            background: linear-gradient(135deg, var(--primary), var(--secondary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            margin-bottom: 0.5rem;\n        }\n        \n        .meta {\n            color: var(--text-muted);\n            margin-bottom: 2rem;\n        }\n        \n        h2 {\n            font-size: 1.5rem;\n            color: var(--primary);\n            margin: 2rem 0 1rem;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n        \n        h3 {\n            font-size: 1.2rem;\n            margin: 1.5rem 0 0.5rem;\n        }\n        \n        .card {\n            background: var(--card-bg);\n            border-radius: 12px;\n            padding: 1.5rem;\n            margin-bottom: 1.5rem;\n            border: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        .grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n            gap: 1rem;\n        }\n        \n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 1rem 0;\n        }\n        \n        th, td {\n            padding: 0.75rem;\n            text-align: left;\n            border-bottom: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        th {\n            background: rgba(99,102,241,0.2);\n            font-weight: 600;\n        }\n        \n        .badge {\n            display: inline-block;\n            padding: 0.25rem 0.75rem;\n            border-radius: 9999px;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n        \n        .badge-success { background: rgba(16,185,129,0.2); color: var(--success); }\n        .badge-warning { background: rgba(245,158,11,0.2); color: var(--warning); }\n        .badge-danger { background: rgba(239,68,68,0.2); color: var(--danger); }\n        .badge-info { background: rgba(99,102,241,0.2); color: var(--primary); }\n        \n        .score {\n            font-size: 3rem;\n            font-weight: 700;\n            background: linear-gradient(135deg, var(--primary), var(--secondary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n        }\n        \n        .progress {\n            height: 8px;\n            background: rgba(255,255,255,0.1);\n            border-radius: 4px;\n            overflow: hidden;\n            margin-top: 0.5rem;\n        }\n        \n        .progress-bar {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--secondary));\n            border-radius: 4px;\n        }\n        \n        ul {\n            list-style-position: inside;\n            margin: 0.5rem 0;\n        }\n        \n        li {\n            margin: 0.25rem 0;\n        }\n        \n        .mermaid {\n            background: rgba(255,255,255,0.05);\n            padding: 1rem;\n            border-radius: 8px;\n            margin: 1rem 0;\n        }\n        \n        .optimization {\n            border-left: 3px solid var(--primary);\n            padding-left: 1rem;\n            margin: 1rem 0;\n        }\n        \n        .optimization.high { border-color: var(--danger); }\n        .optimization.medium { border-color: var(--warning); }\n        .optimization.low { border-color: var(--success); }\n        \n        code {\n            background: rgba(99,102,241,0.2);\n            padding: 0.2rem 0.5rem;\n            border-radius: 4px;\n            font-family: 'Fira Code', monospace;\n            font-size: 0.9em;\n        }\n        \n        pre {\n            background: rgba(0,0,0,0.3);\n            padding: 1rem;\n            border-radius: 8px;\n            overflow-x: auto;\n        }\n        \n        pre code {\n            background: none;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <h1>${t.title}</h1>\n        <p class="meta">üìÖ ${t.generatedAt} | üîñ ÁâàÊú¨ ${t.version}</p>\n        \n        \x3c!-- ÊäïËµÑÁêÜÂøµ --\x3e\n        <h2>üìä ÊäïËµÑÁêÜÂøµ</h2>\n        <div class="grid">\n            <div class="card">\n                <h3>üéØ Ê†∏ÂøÉÈÄªËæë</h3>\n                <p>${t.investmentPhilosophy.coreLogic}</p>\n            </div>\n            <div class="card">\n                <h3>üìà Â∏ÇÂú∫ÈÄÇÂ∫î</h3>\n                <p>${t.investmentPhilosophy.marketAdaptation}</p>\n            </div>\n            <div class="card">\n                <h3>üõ°Ô∏è È£éÈô©ÁÆ°ÁêÜ</h3>\n                <p>${t.investmentPhilosophy.riskManagement}</p>\n            </div>\n        </div>\n        <div class="card">\n            <h3>‚ú® ÁâπËâ≤‰∫ÆÁÇπ</h3>\n            <ul>\n                ${t.investmentPhilosophy.uniqueFeatures.map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n        </div>\n        \n        \x3c!-- ‰ª£Á†ÅÊû∂ÊûÑ --\x3e\n        <h2>üèóÔ∏è ‰ª£Á†ÅÊû∂ÊûÑ</h2>\n        <div class="card">\n            <p>${t.codeArchitecture.overview}</p>\n        </div>\n        \n        <div class="grid">\n            ${t.codeArchitecture.modules.map(e=>`\n            <div class="card">\n                <h3>${e.name}</h3>\n                <p>${e.purpose}</p>\n                <p><span class="badge badge-info">${e.complexity}Â§çÊùÇÂ∫¶</span></p>\n                <p><strong>ÂáΩÊï∞:</strong> ${e.functions.join(", ")}</p>\n            </div>\n            `).join("")}\n        </div>\n        \n        <div class="card">\n            <h3>ÊµÅÁ®ãÂõæ</h3>\n            <div class="mermaid">\n${t.codeArchitecture.flowChart}\n            </div>\n        </div>\n        \n        \x3c!-- Âπ≥Âè∞ÂÖºÂÆπÊÄß --\x3e\n        <h2>üîÑ Âπ≥Âè∞ÂÖºÂÆπÊÄß</h2>\n        <div class="card">\n            <p>${t.platformCompatibility.summary}</p>\n            <table>\n                <tr>\n                    <th>Âπ≥Âè∞</th>\n                    <th>ÂÖºÂÆπÂ∫¶</th>\n                    <th>Á≠âÁ∫ß</th>\n                    <th>ÈúÄ‰øÆÊîπ</th>\n                    <th>Â§áÊ≥®</th>\n                </tr>\n                ${Object.entries(t.platformCompatibility.details).map(([e,n])=>`\n                <tr>\n                    <td><strong>${e}</strong></td>\n                    <td>\n                        <div>${n.score}%</div>\n                        <div class="progress"><div class="progress-bar" style="width: ${n.score}%"></div></div>\n                    </td>\n                    <td><span class="badge ${n.score>=80?"badge-success":n.score>=50?"badge-warning":"badge-danger"}">${n.level}</span></td>\n                    <td>${n.changes}Â§Ñ</td>\n                    <td>${n.notes.join("; ")}</td>\n                </tr>\n                `).join("")}\n            </table>\n        </div>\n        \n        \x3c!-- ‰ºòÂåñÂª∫ËÆÆ --\x3e\n        <h2>üí° ‰ºòÂåñÂª∫ËÆÆ</h2>\n        ${this.renderOptimizationsHTML(t.optimizations)}\n        \n        \x3c!-- ‰ª£Á†ÅË¥®Èáè --\x3e\n        <h2>üìà ‰ª£Á†ÅË¥®Èáè</h2>\n        <div class="card">\n            <div style="text-align: center; margin-bottom: 1rem;">\n                <div class="score">${t.codeQuality.score}</div>\n                <div class="meta">ÊÄªÂàÜ / 100</div>\n            </div>\n            <div class="grid">\n                ${Object.entries(t.codeQuality.metrics).map(([e,n])=>`\n                <div>\n                    <div style="display: flex; justify-content: space-between;">\n                        <span>${this.translateMetric(e)}</span>\n                        <span>${n}/100</span>\n                    </div>\n                    <div class="progress"><div class="progress-bar" style="width: ${n}%"></div></div>\n                </div>\n                `).join("")}\n            </div>\n            <h3 style="margin-top: 1.5rem;">ÊîπËøõÂª∫ËÆÆ</h3>\n            <ul>\n                ${t.codeQuality.suggestions.map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n        </div>\n        \n        <p class="meta" style="text-align: center; margin-top: 3rem;">\n            Êä•ÂëäÁî± TRQuant Strategy Optimizer Ëá™Âä®ÁîüÊàê\n        </p>\n    </div>\n    \n    <script>\n        mermaid.initialize({ \n            startOnLoad: true,\n            theme: 'dark',\n            themeVariables: {\n                primaryColor: '#6366f1',\n                primaryTextColor: '#e2e8f0',\n                primaryBorderColor: '#4f46e5',\n                lineColor: '#94a3b8',\n                secondaryColor: '#1e293b',\n                tertiaryColor: '#0f172a'\n            }\n        });\n    <\/script>\n</body>\n</html>`}generatePhilosophy(e){const n=e.dependencies.factors,t=e.components.riskControl.length>0,a=e.components.timing.length>0;let r="Âü∫‰∫é";const s=[...new Set(n.map(e=>e.type))];if(s.length>0){const e={value:"‰ª∑ÂÄº",growth:"ÊàêÈïø",quality:"Ë¥®Èáè",momentum:"Âä®Èáè",volatility:"Ê≥¢Âä®"};r+=s.map(n=>e[n]||n).join("+")+"Â§öÂõ†Â≠êÊ®°Âûã"}else r+="ÈáèÂåñÈÄâËÇ°Ê®°Âûã";r+="ÔºåÁ≠õÈÄâÂÖ∑ÊúâÊäïËµÑ‰ª∑ÂÄºÁöÑÊ†áÁöÑ";let o="";o=a?"ÂÖ∑Â§áÂ∏ÇÂú∫Êã©Êó∂ËÉΩÂäõÔºåÊ†πÊçÆÂ∏ÇÂú∫Ë∂ãÂäøÂä®ÊÄÅË∞ÉÊï¥‰ªì‰Ωç":"ÈááÁî®Âõ∫ÂÆöÁ≠ñÁï•ÔºåÈÄÇÂêàÈïøÊúüÊåÅÊúâ";let i="";i=t?e.components.riskControl.map(e=>e.name).some(e=>e.includes("stop"))?"ËÆæÊúâÊ≠¢ÊçüÊ≠¢ÁõàÊú∫Âà∂ÔºåÊéßÂà∂ÂçïÁ•®È£éÈô©":"ÂåÖÂê´È£éÈô©ÊéßÂà∂Ê®°ÂùóÔºåÁÆ°ÁêÜÁªÑÂêàÈ£éÈô©":"Âª∫ËÆÆÊ∑ªÂä†È£éÊéßÊ®°Âùó‰ª•ÊéßÂà∂‰∏ãË°åÈ£éÈô©";const c=[];return"low"===e.stats.complexity&&c.push("‰ª£Á†ÅÁÆÄÊ¥ÅÔºåÊòì‰∫éÁêÜËß£ÂíåÁª¥Êä§"),n.length>=3&&c.push(`Â§öÁª¥Â∫¶Âõ†Â≠êËØÑ‰º∞Ôºà${n.length}‰∏™Âõ†Â≠êÔºâ`),a&&c.push("Âä®ÊÄÅÂ∏ÇÂú∫ÈÄÇÂ∫îËÉΩÂäõ"),t&&c.push("ÂÆåÂñÑÁöÑÈ£éÈô©ÊéßÂà∂‰ΩìÁ≥ª"),e.dependencies.indicators.length>0&&c.push(`ÊäÄÊúØÊåáÊ†áËæÖÂä©Ôºà${e.dependencies.indicators.map(e=>e.name).join("„ÄÅ")}Ôºâ`),{coreLogic:r,marketAdaptation:o,riskManagement:i,uniqueFeatures:c}}generateArchitecture(e){const n=[];e.components.stockSelection.length>0&&n.push({name:"ÈÄâËÇ°Ê®°Âùó",purpose:"Ê†πÊçÆÂõ†Â≠êÁ≠õÈÄâÊäïËµÑÊ†áÁöÑ",functions:e.components.stockSelection.map(e=>e.name),dependencies:["Êï∞ÊçÆËé∑Âèñ","Âõ†Â≠êËÆ°ÁÆó"],complexity:e.components.stockSelection.length>3?"high":"medium"}),e.components.timing.length>0&&n.push({name:"Êã©Êó∂Ê®°Âùó",purpose:"Âà§Êñ≠Â∏ÇÂú∫Ë∂ãÂäøÔºåÁîüÊàê‰∫§Êòì‰ø°Âè∑",functions:e.components.timing.map(e=>e.name),dependencies:["Â∏ÇÂú∫Êï∞ÊçÆ","ÊäÄÊúØÊåáÊ†á"],complexity:"medium"}),e.components.riskControl.length>0&&n.push({name:"È£éÊéßÊ®°Âùó",purpose:"ÊéßÂà∂È£éÈô©Ôºå‰øùÊä§ËµÑÈáëÂÆâÂÖ®",functions:e.components.riskControl.map(e=>e.name),dependencies:["ÊåÅ‰ªìÊï∞ÊçÆ","‰ª∑Ê†ºÊï∞ÊçÆ"],complexity:"medium"}),e.components.execution.length>0&&n.push({name:"ÊâßË°åÊ®°Âùó",purpose:"ÊâßË°å‰∫§ÊòìÊåá‰ª§ÔºåÁÆ°ÁêÜÊåÅ‰ªì",functions:e.components.execution.map(e=>e.name),dependencies:["ÈÄâËÇ°ÁªìÊûú","È£éÊéßÊ£ÄÊü•"],complexity:"medium"});const t=this.generateFlowChart(e),a=this.generateDataFlow(e);return{overview:`Á≠ñÁï•ÂåÖÂê´ ${n.length} ‰∏™Ê†∏ÂøÉÊ®°ÂùóÔºå${e.stats.functionCount} ‰∏™ÂáΩÊï∞Ôºå‰ª£Á†ÅÂ§çÊùÇÂ∫¶‰∏∫${"low"===e.stats.complexity?"‰Ωé":"medium"===e.stats.complexity?"‰∏≠":"È´ò"}„ÄÇ`,modules:n,flowChart:t,dataFlow:a}}generateFlowChart(e){return"graph TD\n    A[Á≠ñÁï•ÂêØÂä®] --\x3e B[ÂàùÂßãÂåñÈÖçÁΩÆ]\n    B --\x3e C{ÊØèÊó•ÊâßË°å}\n    C --\x3e D[Êï∞ÊçÆËé∑Âèñ]\n    D --\x3e E[ÈÄâËÇ°Á≠õÈÄâ]\n    E --\x3e F[Âõ†Â≠êÊâìÂàÜ]\n    F --\x3e G{È£éÊéßÊ£ÄÊü•}\n    G --\x3e|ÈÄöËøá| H[ÊâßË°å‰∫§Êòì]\n    G --\x3e|‰∏çÈÄöËøá| I[Ë∞ÉÊï¥ÊåÅ‰ªì]\n    H --\x3e J[ËÆ∞ÂΩïÊó•Âøó]\n    I --\x3e J\n    J --\x3e C\n    \n    style A fill:#6366f1,stroke:#4f46e5,color:#fff\n    style H fill:#10b981,stroke:#059669,color:#fff\n    style G fill:#f59e0b,stroke:#d97706,color:#fff"}generateDataFlow(e){return"graph LR\n    subgraph Êï∞ÊçÆÂ±Ç\n        A1[Ë°åÊÉÖÊï∞ÊçÆ]\n        A2[Ë¥¢Âä°Êï∞ÊçÆ]\n        A3[ÊåÅ‰ªìÊï∞ÊçÆ]\n    end\n    \n    subgraph ËÆ°ÁÆóÂ±Ç\n        B1[Âõ†Â≠êËÆ°ÁÆó]\n        B2[ÊåáÊ†áËÆ°ÁÆó]\n        B3[È£éÈô©ËØÑ‰º∞]\n    end\n    \n    subgraph ÂÜ≥Á≠ñÂ±Ç\n        C1[ÈÄâËÇ°ÂÜ≥Á≠ñ]\n        C2[‰ªì‰ΩçÂÜ≥Á≠ñ]\n        C3[‰∫§ÊòìÊâßË°å]\n    end\n    \n    A1 --\x3e B1\n    A2 --\x3e B1\n    A1 --\x3e B2\n    A3 --\x3e B3\n    B1 --\x3e C1\n    B2 --\x3e C2\n    B3 --\x3e C2\n    C1 --\x3e C3\n    C2 --\x3e C3\n    \n    style A1 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style A2 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style A3 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style C3 fill:#10b981,stroke:#059669,color:#fff"}generateCompatibility(e,n){const t={};for(const n of["joinquant","ptrade","qmt"]){const a=e.compatibility[n];t[n]={score:a.score,level:this.translateLevel(a.level),changes:a.issues.filter(e=>"error"===e.severity).length,notes:a.suggestions.slice(0,2)}}const a=e.compatibility.sourcePlatform;return{summary:`ÂΩìÂâç‰ª£Á†ÅÂü∫‰∫é ${a.toUpperCase()} Âπ≥Âè∞ÂºÄÂèë„ÄÇÂèØÁõ¥Êé•Âú® ${a} ËøêË°åÔºåËΩ¨Êç¢Âà∞ÂÖ∂‰ªñÂπ≥Âè∞ÈúÄË¶ÅËøõË°åAPIÈÄÇÈÖç„ÄÇ`,details:t}}generateOptimizations(e){const n={performance:[],risk:[],readability:[],platform:[]};e.stats.totalLines>500&&n.performance.push({category:"ÊÄßËÉΩ",priority:"medium",title:"‰ª£Á†ÅÈáèËæÉÂ§ß",description:"Á≠ñÁï•‰ª£Á†ÅË∂ÖËøá500Ë°åÔºåÂª∫ËÆÆÊãÜÂàÜÊ®°Âùó",impact:"ÊèêÈ´ò‰ª£Á†ÅÂèØÁª¥Êä§ÊÄßÂíåÊâßË°åÊïàÁéá"}),0===e.components.riskControl.length&&n.risk.push({category:"È£éÊéß",priority:"high",title:"Áº∫Â∞ëÈ£éÊéßÊ®°Âùó",description:"Âª∫ËÆÆÊ∑ªÂä†Ê≠¢Êçü„ÄÅÊ≠¢Áõà„ÄÅ‰ªì‰ΩçÁÆ°ÁêÜÁ≠âÈ£éÊéßÊú∫Âà∂",impact:"ÊéßÂà∂‰∏ãË°åÈ£éÈô©Ôºå‰øùÊä§ËµÑÈáëÂÆâÂÖ®",implementation:"Ê∑ªÂä† check_risk() ÂáΩÊï∞ÔºåËÆæÁΩÆÊ≠¢ÊçüÁ∫ø-8%ÔºåÊ≠¢ÁõàÁ∫ø20%"}),e.stats.commentLines<.2*e.stats.codeLines&&n.readability.push({category:"ÊñáÊ°£",priority:"low",title:"Ê≥®Èáä‰∏çË∂≥",description:"‰ª£Á†ÅÊ≥®ÈáäÊØî‰æã‰Ωé‰∫é20%ÔºåÂª∫ËÆÆÂ¢ûÂä†Ê≥®Èáä",impact:"ÊèêÈ´ò‰ª£Á†ÅÂèØËØªÊÄßÂíåÂèØÁª¥Êä§ÊÄß"});for(const t of["ptrade","qmt"]){const a=e.compatibility[t];a.score<100&&n.platform.push({category:"Âπ≥Âè∞ÈÄÇÈÖç",priority:a.score<50?"high":"medium",title:`${t.toUpperCase()} ÈÄÇÈÖç`,description:`ÈúÄË¶Å‰øÆÊîπ ${a.issues.filter(e=>"error"===e.severity).length} Â§ÑAPIË∞ÉÁî®`,impact:`ÊîØÊåÅÂú® ${t.toUpperCase()} Âπ≥Âè∞ËøêË°å`,implementation:a.suggestions.join("\n")})}return n}generateQuality(e){const n={maintainability:0,testability:0,documentation:0,complexity:0};n.maintainability=Math.min(100,Math.max(0,100-e.stats.totalLines/10+5*e.stats.functionCount-("high"===e.stats.complexity?20:"medium"===e.stats.complexity?10:0))),n.testability=Math.min(100,10*e.stats.functionCount+5*e.components.utilities.length);const t=e.stats.commentLines/e.stats.totalLines;n.documentation=Math.min(100,200*t),n.complexity="low"===e.stats.complexity?90:"medium"===e.stats.complexity?70:50;const a=Math.round((n.maintainability+n.testability+n.documentation+n.complexity)/4),r=[];return n.maintainability<70&&r.push("Âª∫ËÆÆÊãÜÂàÜÂ§ßÂáΩÊï∞Ôºå‰øùÊåÅÂçï‰∏™ÂáΩÊï∞‰∏çË∂ÖËøá50Ë°å"),n.testability<70&&r.push("Âª∫ËÆÆÂ¢ûÂä†Â∑•ÂÖ∑ÂáΩÊï∞ÔºåÊèêÈ´ò‰ª£Á†ÅÂ§çÁî®ÊÄß"),n.documentation<70&&r.push("Âª∫ËÆÆ‰∏∫ÊØè‰∏™ÂáΩÊï∞Ê∑ªÂä†docstringËØ¥Êòé"),n.complexity<70&&r.push("Âª∫ËÆÆÁÆÄÂåñÂ§çÊùÇÈÄªËæëÔºå‰ΩøÁî®ËÆæËÆ°Ê®°ÂºèÈáçÊûÑ"),{score:a,metrics:{maintainability:Math.round(n.maintainability),testability:Math.round(n.testability),documentation:Math.round(n.documentation),complexity:Math.round(n.complexity)},suggestions:r}}formatOptimization(e){return`\n#### ${"high"===e.priority?"üî¥":"medium"===e.priority?"üü°":"üü¢"} ${e.title}\n\n- **‰ºòÂÖàÁ∫ß**: ${"high"===e.priority?"È´ò":"medium"===e.priority?"‰∏≠":"‰Ωé"}\n- **ÊèèËø∞**: ${e.description}\n- **ÂΩ±Âìç**: ${e.impact}\n${e.implementation?`- **ÂÆûÁé∞**: ${e.implementation}`:""}\n`}renderOptimizationsHTML(e){return[{key:"performance",title:"üöÄ ÊÄßËÉΩ‰ºòÂåñ",items:e.performance},{key:"risk",title:"üõ°Ô∏è È£éÊéß‰ºòÂåñ",items:e.risk},{key:"readability",title:"üìñ ‰ª£Á†ÅÂèØËØªÊÄß",items:e.readability},{key:"platform",title:"üîÑ Âπ≥Âè∞ÈÄÇÈÖç",items:e.platform}].map(e=>`\n            <div class="card">\n                <h3>${e.title}</h3>\n                ${0===e.items.length?'<p class="meta">ÊöÇÊó†‰ºòÂåñÂª∫ËÆÆ</p>':e.items.map(e=>`\n                    <div class="optimization ${e.priority}">\n                        <h4>${e.title}</h4>\n                        <p>${e.description}</p>\n                        <p class="meta">ÂΩ±Âìç: ${e.impact}</p>\n                        ${e.implementation?`<p><strong>Âª∫ËÆÆ:</strong> ${e.implementation}</p>`:""}\n                    </div>\n                  `).join("")}\n            </div>\n        `).join("")}translateLevel(e){return{full:"ÂÆåÂÖ®ÂÖºÂÆπ",high:"È´òÂ∫¶ÂÖºÂÆπ",medium:"ÈÉ®ÂàÜÂÖºÂÆπ",low:"‰ΩéÂÖºÂÆπ",none:"‰∏çÂÖºÂÆπ"}[e]||e}translateMetric(e){return{maintainability:"ÂèØÁª¥Êä§ÊÄß",testability:"ÂèØÊµãËØïÊÄß",documentation:"ÊñáÊ°£ÂÆåÊï¥ÊÄß",complexity:"Â§çÊùÇÂ∫¶ÊéßÂà∂"}[e]||e}}n.ReportGenerator=t,n.reportGenerator=new t},896:e=>{e.exports=require("fs")},900:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),o=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),o=0;o<t.length;o++)"default"!==t[o]&&r(n,e,t[o]);return s(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.analyzeBacktest=async function(e,n){c.logger.info("ÊâßË°åÂõûÊµãÂàÜÊûêÂëΩ‰ª§",d);try{const t=await i.window.showQuickPick([{label:"üìÇ ‰ªéÊñá‰ª∂ÂØºÂÖ•",value:"file",description:"ÈÄâÊã©ÂõûÊµãÁªìÊûúÊñá‰ª∂"},{label:"üìù ÊâãÂä®ËæìÂÖ•",value:"manual",description:"ËæìÂÖ•ÂÖ≥ÈîÆÊåáÊ†á"},{label:"üìã ‰ªéÂâ™Ë¥¥Êùø",value:"clipboard",description:"‰ªéÂâ™Ë¥¥ÊùøËØªÂèñÊåáÊ†á"}],{placeHolder:"ÈÄâÊã©ÂõûÊµãÊï∞ÊçÆÊù•Ê∫ê"});if(!t)return;let a;switch(t.value){case"file":a=await async function(){const e=await i.window.showOpenDialog({canSelectMany:!1,filters:{JSONÊñá‰ª∂:["json"],CSVÊñá‰ª∂:["csv"],ÊâÄÊúâÊñá‰ª∂:["*"]},title:"ÈÄâÊã©ÂõûÊµãÁªìÊûúÊñá‰ª∂"});if(!e||0===e.length)return;const n=e[0].fsPath,t=await i.workspace.fs.readFile(e[0]),a=Buffer.from(t).toString("utf-8");try{if(n.endsWith(".json"))return p(JSON.parse(a));if(n.endsWith(".csv"))return g(a)}catch(e){c.logger.error(`Ëß£ÊûêÊñá‰ª∂Â§±Ë¥•: ${e}`,d),i.window.showErrorMessage("Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Ê†ºÂºè")}}();break;case"manual":a=await async function(){const e=await i.window.showInputBox({prompt:"ÊÄªÊî∂ÁõäÁéá (%)",value:"0",validateInput:e=>isNaN(parseFloat(e))?"ËØ∑ËæìÂÖ•Êï∞Â≠ó":null});if(!e)return;const n=await i.window.showInputBox({prompt:"Â§èÊôÆÊØîÁéá",value:"0",validateInput:e=>isNaN(parseFloat(e))?"ËØ∑ËæìÂÖ•Êï∞Â≠ó":null});if(!n)return;const t=await i.window.showInputBox({prompt:"ÊúÄÂ§ßÂõûÊí§ (%)",value:"0",validateInput:e=>isNaN(parseFloat(e))?"ËØ∑ËæìÂÖ•Êï∞Â≠ó":null});if(!t)return;const a=await i.window.showInputBox({prompt:"ËÉúÁéá (%)",value:"50",validateInput:e=>isNaN(parseFloat(e))?"ËØ∑ËæìÂÖ•Êï∞Â≠ó":null});if(!a)return;const r=await i.window.showInputBox({prompt:"‰∫§ÊòìÊ¨°Êï∞",value:"0",validateInput:e=>isNaN(parseInt(e))?"ËØ∑ËæìÂÖ•Êï¥Êï∞":null});return r?{total_return:parseFloat(e)/100,annual_return:parseFloat(e)/100,sharpe_ratio:parseFloat(n),max_drawdown:parseFloat(t)/100,win_rate:parseFloat(a)/100,trade_count:parseInt(r),profit_loss_ratio:1}:void 0}();break;case"clipboard":a=await async function(){const e=await i.env.clipboard.readText();if(e.trim())try{return p(JSON.parse(e))}catch{try{return g(e)}catch{return void i.window.showErrorMessage("Êó†Ê≥ïËß£ÊûêÂâ™Ë¥¥ÊùøÂÜÖÂÆπ")}}else i.window.showWarningMessage("Ââ™Ë¥¥Êùø‰∏∫Á©∫")}()}if(!a)return void i.window.showWarningMessage("Êú™ËÉΩËé∑ÂèñÂõûÊµãÊï∞ÊçÆ");await async function(e,n,t){await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!1},async a=>{a.report({message:"ÂàÜÊûêÂõûÊµãÁªìÊûú...",increment:0});const r=await e.analyzeBacktest({backtest_data:{metrics:t}});if(a.report({increment:60}),r.ok&&r.data)m(n,t,r.data);else{const e=function(e){const n=[],t=[];e.total_return<0?(n.push("‚ö†Ô∏è Á≠ñÁï•‰∫èÊçüÔºåÈúÄË¶ÅÂÖ®Èù¢Ê£ÄËßÜ"),t.push("Ê£ÄÊü•ÂÖ•Âú∫‰ø°Âè∑ÊòØÂê¶Ëøá‰∫éÊøÄËøõ"),t.push("ËÄÉËôëÂ¢ûÂä†Êõ¥Â§öËøáÊª§Êù°‰ª∂")):e.total_return<.1?(n.push("üí° Êî∂ÁõäËæÉ‰ΩéÔºåÂ≠òÂú®‰ºòÂåñÁ©∫Èó¥"),t.push("Â∞ùËØïË∞ÉÊï¥Âõ†Â≠êÊùÉÈáç")):e.total_return>.5&&n.push("‚úÖ Êî∂ÁõäË°®Áé∞‰ºòÁßÄ"),e.sharpe_ratio<.5?(n.push("‚ö†Ô∏è Â§èÊôÆÊØîÁéáÂÅè‰ΩéÔºåÈ£éÈô©Ë∞ÉÊï¥Êî∂Áõä‰∏ç‰Ω≥"),t.push("Â¢ûÂä†Ê≠¢ÊçüÊù°‰ª∂ÊàñÈôç‰Ωé‰ªì‰Ωç")):e.sharpe_ratio>2?n.push("‚úÖ Â§èÊôÆÊØîÁéá‰ºòÁßÄÔºåÁ≠ñÁï•Ë¥®ÈáèÈ´ò"):n.push("üí° Â§èÊôÆÊØîÁéá‰∏ÄËà¨ÔºåÂèØ‰ª•‰ºòÂåñ"),e.max_drawdown>.3?(n.push("‚ö†Ô∏è ÊúÄÂ§ßÂõûÊí§ËøáÂ§ßÔºåÈ£éÊéßÈúÄË¶ÅÂä†Âº∫"),t.push("Èôç‰ΩéÂçïÁ•®‰ªì‰ΩçËá≥5%‰ª•‰∏ã"),t.push("Â¢ûÂä†ÁªÑÂêàÂàÜÊï£Â∫¶")):e.max_drawdown>.2?(n.push("üí° ÊúÄÂ§ßÂõûÊí§‰∏≠Á≠âÔºåÂª∫ËÆÆ‰ºòÂåñ"),t.push("ËÄÉËôëÂ¢ûÂä†Âä®ÊÄÅÊ≠¢Êçü")):n.push("‚úÖ ÊúÄÂ§ßÂõûÊí§ÊéßÂà∂ËâØÂ•Ω"),e.win_rate<.4?(n.push("‚ö†Ô∏è ËÉúÁéáÂÅè‰Ωé"),t.push("‰ºòÂåñÈÄâËÇ°Êù°‰ª∂"),t.push("Â¢ûÂä†Á°ÆËÆ§‰ø°Âè∑")):e.win_rate>.6&&n.push("‚úÖ ËÉúÁéáËæÉÈ´ò"),e.trade_count<10?(n.push("üí° ‰∫§ÊòìÊ¨°Êï∞ËæÉÂ∞ëÔºåÁªüËÆ°ÊÑè‰πâÊúâÈôê"),t.push("Âª∂ÈïøÂõûÊµãÂë®Êúü")):e.trade_count>500&&(n.push("üí° ‰∫§ÊòìÈ¢ëÁπÅÔºåÊ≥®ÊÑè‰∫§ÊòìÊàêÊú¨"),t.push("ËÄÉËôëÈôç‰ΩéÊç¢‰ªìÈ¢ëÁéá"));const a=u(e);return a>=80?n.unshift("üèÜ Á≠ñÁï•ÁªºÂêàËØÑÂàÜ: ‰ºòÁßÄ ("+a+"/100)"):a>=60?n.unshift("üìä Á≠ñÁï•ÁªºÂêàËØÑÂàÜ: ËâØÂ•Ω ("+a+"/100)"):a>=40?n.unshift("üìã Á≠ñÁï•ÁªºÂêàËØÑÂàÜ: ‰∏ÄËà¨ ("+a+"/100)"):n.unshift("‚ö†Ô∏è Á≠ñÁï•ÁªºÂêàËØÑÂàÜ: ËæÉÂ∑Æ ("+a+"/100)"),{metrics:e,trades:[],diagnosis:n,suggestions:t.length>0?t:["Á≠ñÁï•Ë°®Áé∞ËâØÂ•ΩÔºå‰øùÊåÅËßÇÂØü"]}}(t);m(n,t,e)}a.report({increment:40})})}(e,n,a)}catch(e){l.ErrorHandler.handle(e,d)}};const i=o(t(398)),c=t(628),l=t(799),d="AnalyzeBacktest";function p(e){return{total_return:e.total_return??e.totalReturn??e.return??0,annual_return:e.annual_return??e.annualReturn??e.cagr??0,sharpe_ratio:e.sharpe_ratio??e.sharpeRatio??e.sharpe??0,max_drawdown:e.max_drawdown??e.maxDrawdown??e.mdd??0,win_rate:e.win_rate??e.winRate??0,trade_count:e.trade_count??e.tradeCount??e.trades??0,profit_loss_ratio:e.profit_loss_ratio??e.plRatio??1}}function g(e){const n=e.trim().split("\n"),t={};for(const e of n){const[n,a]=e.split(/[,\t:=]/);n&&a&&(t[n.trim().toLowerCase().replace(/\s+/g,"_")]=parseFloat(a.trim()))}return p(t)}function u(e){let n=50;return e.total_return>.5?n+=30:e.total_return>.2?n+=20:e.total_return>0?n+=10:n-=20,e.sharpe_ratio>2?n+=25:e.sharpe_ratio>1?n+=15:e.sharpe_ratio>.5?n+=5:n-=10,e.max_drawdown<.1?n+=25:e.max_drawdown<.2?n+=15:e.max_drawdown<.3?n+=5:n-=15,e.win_rate>.6?n+=20:e.win_rate>.5?n+=10:e.win_rate>.4?n+=0:n-=10,Math.max(0,Math.min(100,n))}function m(e,n,t){const a=i.window.createWebviewPanel("trquantBacktestAnalysis","üìä ÂõûÊµãÂàÜÊûêÊä•Âëä",i.ViewColumn.Beside,{enableScripts:!0});a.webview.html=function(e,n){const t=u(e),a=t>=80?"#10b981":t>=60?"#f59e0b":"#ef4444";return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ÂõûÊµãÂàÜÊûêÊä•Âëä</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .score-badge {\n            width: 80px;\n            height: 80px;\n            border-radius: 50%;\n            background: ${a}22;\n            border: 3px solid ${a};\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .score-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: ${a};\n        }\n\n        .score-label {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n\n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .metric-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .metric-value {\n            font-size: 24px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .metric-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n\n        .section {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .section-title {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .diagnosis-item, .suggestion-item {\n            padding: 12px 16px;\n            margin-bottom: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 8px;\n            font-size: 14px;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div>\n            <div class="header-title">üìä ÂõûÊµãÂàÜÊûêÊä•Âëä</div>\n        </div>\n        <div class="score-badge">\n            <div class="score-value">${t}</div>\n            <div class="score-label">ÁªºÂêàËØÑÂàÜ</div>\n        </div>\n    </div>\n\n    <div class="metrics-grid">\n        <div class="metric-card">\n            <div class="metric-value ${e.total_return>=0?"positive":"negative"}">\n                ${(100*e.total_return).toFixed(2)}%\n            </div>\n            <div class="metric-label">ÊÄªÊî∂Áõä</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${e.sharpe_ratio.toFixed(2)}</div>\n            <div class="metric-label">Â§èÊôÆÊØîÁéá</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value negative">${(100*e.max_drawdown).toFixed(2)}%</div>\n            <div class="metric-label">ÊúÄÂ§ßÂõûÊí§</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${(100*e.win_rate).toFixed(1)}%</div>\n            <div class="metric-label">ËÉúÁéá</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${e.trade_count}</div>\n            <div class="metric-label">‰∫§ÊòìÊ¨°Êï∞</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${e.profit_loss_ratio.toFixed(2)}</div>\n            <div class="metric-label">Áõà‰∫èÊØî</div>\n        </div>\n    </div>\n\n    <div class="section">\n        <div class="section-title">üîç ËØäÊñ≠ÁªìÊûú</div>\n        ${n.diagnosis.map(e=>`<div class="diagnosis-item">${e}</div>`).join("")}\n    </div>\n\n    <div class="section">\n        <div class="section-title">üí° ‰ºòÂåñÂª∫ËÆÆ</div>\n        ${n.suggestions.map(e=>`<div class="suggestion-item">${e}</div>`).join("")}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="optimizeStrategy()">\n            üöÄ ÁîüÊàê‰ºòÂåñÁ≠ñÁï•\n        </button>\n        <button class="btn btn-secondary" onclick="copyReport()">\n            üìã Â§çÂà∂Êä•Âëä\n        </button>\n    </div>\n\n    <div class="timestamp">\n        ÁîüÊàêÊó∂Èó¥: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyReport() {\n            vscode.postMessage({ command: 'copyReport' });\n        }\n        \n        function optimizeStrategy() {\n            vscode.postMessage({ command: 'optimizeStrategy' });\n        }\n    <\/script>\n</body>\n</html>`}(n,t),a.webview.onDidReceiveMessage(async e=>{switch(e.command){case"copyReport":const e=function(e,n){return`# ÂõûÊµãÂàÜÊûêÊä•Âëä\n\n## ÁªºÂêàËØÑÂàÜ: ${u(e)}/100\n\n## ÂÖ≥ÈîÆÊåáÊ†á\n- ÊÄªÊî∂Áõä: ${(100*e.total_return).toFixed(2)}%\n- Â§èÊôÆÊØîÁéá: ${e.sharpe_ratio.toFixed(2)}\n- ÊúÄÂ§ßÂõûÊí§: ${(100*e.max_drawdown).toFixed(2)}%\n- ËÉúÁéá: ${(100*e.win_rate).toFixed(1)}%\n- ‰∫§ÊòìÊ¨°Êï∞: ${e.trade_count}\n- Áõà‰∫èÊØî: ${e.profit_loss_ratio.toFixed(2)}\n\n## ËØäÊñ≠ÁªìÊûú\n${n.diagnosis.map(e=>`- ${e}`).join("\n")}\n\n## ‰ºòÂåñÂª∫ËÆÆ\n${n.suggestions.map(e=>`- ${e}`).join("\n")}\n\n---\nÁîüÊàêÊó∂Èó¥: ${(new Date).toLocaleString("zh-CN")}\n`}(n,t);await i.env.clipboard.writeText(e),i.window.showInformationMessage("Êä•ÂëäÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø");break;case"optimizeStrategy":i.commands.executeCommand("trquant.generateStrategy")}},void 0,e.subscriptions)}},902:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.OptimizationAdvisor=void 0,n.createOptimizationAdvisor=function(e){return new r(e)};const a=t(628);class r{knowledgeStore=null;constructor(e){this.knowledgeStore=e||null}setKnowledgeStore(e){this.knowledgeStore=e}generateReport(e){a.logger.info(`ÁîüÊàê‰ºòÂåñÊä•Âëä: ${e.name}`,"OptimizationAdvisor");const n=[];n.push(...this.generateRiskAdvices(e)),n.push(...this.generateFactorAdvices(e)),n.push(...this.generateSelectionAdvices(e)),n.push(...this.generateCodeAdvices(e)),this.knowledgeStore&&n.push(...this.getKnowledgeBasedAdvices(e));const t=this.calculateScores(e,n),r=this.generateSummary(e,t,n);return{strategyName:e.name,platform:e.platform,analysisTime:(new Date).toISOString(),overallScore:t.overall,scoreBreakdown:{risk:t.risk,factor:t.factor,selection:t.selection,code:t.code},advices:n.sort((e,n)=>{const t={high:0,medium:1,low:2};return t[e.priority]-t[n.priority]}),summary:r}}generateRiskAdvices(e){const n=[],t=e.riskControl;return t.stopLoss?t.stopLoss>.15&&n.push({id:"risk_stop_loss_tight",category:"risk",priority:"medium",title:"Êî∂Á¥ßÊ≠¢ÊçüÁ∫ø",description:`ÂΩìÂâçÊ≠¢ÊçüÁ∫ø ${(100*t.stopLoss).toFixed(0)}% Ëøá‰∫éÂÆΩÊùæ`,currentState:`${(100*t.stopLoss).toFixed(0)}%`,suggestedState:"8-12%",impact:"ÂáèÂ∞ëÂçïÊ¨°‰∫§ÊòìÊçüÂ§±"}):n.push({id:"risk_stop_loss",category:"risk",priority:"high",title:"Ê∑ªÂä†Ê≠¢ÊçüÊú∫Âà∂",description:"Á≠ñÁï•Áº∫Â∞ëÊ≠¢ÊçüËÆæÁΩÆÔºåÂú®Â∏ÇÂú∫Â§ßÂπÖ‰∏ãË∑åÊó∂ÂèØËÉΩÈÄ†ÊàêÈáçÂ§ßÊçüÂ§±",suggestedState:"Ê≠¢ÊçüÁ∫ø 8%",codeExample:"# Ê≠¢ÊçüËÆæÁΩÆ\nSTOP_LOSS = 0.08  # 8%Ê≠¢Êçü\n\ndef check_stop_loss(context, stock):\n    cost = context.portfolio.positions[stock].avg_cost\n    price = context.portfolio.positions[stock].price\n    if (cost - price) / cost >= STOP_LOSS:\n        order_target(stock, 0)\n        log.info(f'{stock} Ëß¶ÂèëÊ≠¢Êçü')",impact:"ÊòæËëóÈôç‰ΩéÊúÄÂ§ßÂõûÊí§",source:"AËÇ°ÂÆûÊìçÊâãÂÜå-È£éÊéßÁØá"}),t.takeProfit||n.push({id:"risk_take_profit",category:"risk",priority:"medium",title:"Ê∑ªÂä†Ê≠¢ÁõàÊú∫Âà∂",description:"Âª∫ËÆÆËÆæÁΩÆÂä®ÊÄÅÊ≠¢ÁõàÔºåÈîÅÂÆöÂà©Ê∂¶",suggestedState:"Ê≠¢ÁõàÁ∫ø 20-30%",codeExample:"# Ê≠¢ÁõàËÆæÁΩÆ\nTAKE_PROFIT = 0.20  # 20%Ê≠¢Áõà\n\ndef check_take_profit(context, stock):\n    cost = context.portfolio.positions[stock].avg_cost\n    price = context.portfolio.positions[stock].price\n    if (price - cost) / cost >= TAKE_PROFIT:\n        order_target(stock, 0)\n        log.info(f'{stock} Ëß¶ÂèëÊ≠¢Áõà')",impact:"ÈîÅÂÆöÊî∂ÁõäÔºåÈÅøÂÖçÂà©Ê∂¶ÂõûÂêê"}),t.maxPosition||n.push({id:"risk_position",category:"risk",priority:"medium",title:"ËÆæÁΩÆ‰ªì‰Ωç‰∏äÈôê",description:"Âª∫ËÆÆËÆæÁΩÆÊúÄÂ§ß‰ªì‰ΩçÊéßÂà∂Ôºå‰øùÁïôÁé∞ÈáëÂ∫îÂØπÈ£éÈô©",suggestedState:"ÊúÄÂ§ß‰ªì‰Ωç 80%",codeExample:"MAX_POSITION = 0.8  # ÊúÄÂ§ß‰ªì‰Ωç80%",impact:"‰øùÁïôÊµÅÂä®ÊÄßÔºå‰æø‰∫éÊäÑÂ∫ï"}),t.hasDrawdownControl||n.push({id:"risk_drawdown",category:"risk",priority:"low",title:"Ê∑ªÂä†ÂõûÊí§ÊéßÂà∂",description:"Âª∫ËÆÆÁõëÊéßÁªÑÂêàÂõûÊí§ÔºåËß¶ÂèëÈòàÂÄºÊó∂Èôç‰Ωé‰ªì‰Ωç",suggestedState:"ÂõûÊí§Ë∂Ö15%Âáè‰ªì50%",impact:"ÊéßÂà∂ÁªÑÂêàÁ∫ßÂà´È£éÈô©"}),n}generateFactorAdvices(e){const n=[],t=e.factors;0===t.length?n.push({id:"factor_missing",category:"factor",priority:"high",title:"Ê∑ªÂä†ÈáèÂåñÂõ†Â≠ê",description:"Á≠ñÁï•Áº∫Â∞ëÊòéÁ°ÆÁöÑÈáèÂåñÂõ†Â≠êÔºåÂª∫ËÆÆ‰ΩøÁî®Âõ†Â≠êÈÄâËÇ°",suggestedState:"Â§öÂõ†Â≠êÁªÑÂêà",codeExample:"# Êé®ËçêÂõ†Â≠êÁªÑÂêà\nfactors = {\n    'momentum': 0.3,    # Âä®ÈáèÂõ†Â≠ê\n    'value': 0.3,       # ‰ª∑ÂÄºÂõ†Â≠ê\n    'quality': 0.2,     # Ë¥®ÈáèÂõ†Â≠ê\n    'volatility': 0.2,  # ‰ΩéÊ≥¢Âõ†Â≠ê\n}",impact:"ÊèêÈ´òÈÄâËÇ°ÁöÑÁßëÂ≠¶ÊÄßÂíåÁ®≥ÂÆöÊÄß",source:"AËÇ°ÂÆûÊìçÊâãÂÜå-Âõ†Â≠êÁØá"}):1===t.length&&n.push({id:"factor_single",category:"factor",priority:"medium",title:"Â¢ûÂä†Âõ†Â≠êÂ§öÊ†∑ÊÄß",description:`ÂΩìÂâç‰ªÖ‰ΩøÁî® ${t[0].name}ÔºåÂª∫ËÆÆÁªÑÂêàÂ§öÂõ†Â≠ê`,currentState:t[0].name,suggestedState:"3-5‰∏™‰ΩéÁõ∏ÂÖ≥Âõ†Â≠ê",impact:"Èôç‰ΩéÂçïÂõ†Â≠êÂ§±ÊïàÈ£éÈô©ÔºåÊèêÈ´òÁ®≥ÂÆöÊÄß"});const a={};for(const e of t)a[e.type]=(a[e.type]||0)+1;return t.length>=2&&1===Object.keys(a).length&&n.push({id:"factor_diversity",category:"factor",priority:"medium",title:"Â¢ûÂä†Âõ†Â≠êÁ±ªÂûãÂ§öÊ†∑ÊÄß",description:"ÂΩìÂâçÂõ†Â≠êÁ±ªÂûãÂçï‰∏ÄÔºåÂª∫ËÆÆÊ∑∑Âêà‰∏çÂêåÁ±ªÂûãÂõ†Â≠ê",currentState:`ÂÖ®ÈÉ®‰∏∫${t[0].type}Á±ªÂûã`,suggestedState:"Âä®Èáè+‰ª∑ÂÄº+Ë¥®ÈáèÁªÑÂêà",impact:"Âõ†Â≠ê‰∫íË°•ÔºåÈÄÇÂ∫î‰∏çÂêåÂ∏ÇÂú∫ÁéØÂ¢É"}),n}generateSelectionAdvices(e){const n=[],t=e.stockSelection;return"Êú™Áü•"!==t.universe&&"ÂÖ®Â∏ÇÂú∫"!==t.universe||n.push({id:"selection_universe",category:"selection",priority:"medium",title:"Áº©Â∞èËÇ°Á•®Ê±†ËåÉÂõ¥",description:"ÂÖ®Â∏ÇÂú∫ÈÄâËÇ°ÂèØËÉΩÂåÖÂê´ÊµÅÂä®ÊÄßÂ∑ÆÁöÑËÇ°Á•®",suggestedState:"Ê≤™Ê∑±300/‰∏≠ËØÅ500ÊàêÂàÜËÇ°",impact:"ÊèêÈ´òÊµÅÂä®ÊÄßÔºåÈôç‰ΩéÂÜ≤ÂáªÊàêÊú¨"}),t.topN&&t.topN>30?n.push({id:"selection_topn_reduce",category:"selection",priority:"low",title:"ÂáèÂ∞ëÊåÅËÇ°Êï∞Èáè",description:`ÂΩìÂâçÊåÅËÇ°${t.topN}Âè™ÔºåÂèØËÉΩËøá‰∫éÂàÜÊï£`,currentState:`${t.topN}Âè™`,suggestedState:"10-20Âè™",impact:"ÊèêÈ´òÈÄâËÇ°ÈõÜ‰∏≠Â∫¶ÂíåÊî∂ÁõäÂºπÊÄß"}):t.topN&&t.topN<5&&n.push({id:"selection_topn_increase",category:"selection",priority:"high",title:"Â¢ûÂä†ÊåÅËÇ°Êï∞Èáè",description:`ÂΩìÂâçÊåÅËÇ°${t.topN}Âè™ÔºåÈ£éÈô©Ëøá‰∫éÈõÜ‰∏≠`,currentState:`${t.topN}Âè™`,suggestedState:"5-10Âè™",impact:"ÂàÜÊï£È£éÈô©ÔºåÈôç‰ΩéÊ≥¢Âä®"}),t.filters.includes("ÊéíÈô§ST")||n.push({id:"selection_filter_st",category:"selection",priority:"medium",title:"ÊéíÈô§STËÇ°Á•®",description:"Âª∫ËÆÆËøáÊª§ST/*STËÇ°Á•®ÔºåÈÅøÂÖçÈÄÄÂ∏ÇÈ£éÈô©",codeExample:"# ÊéíÈô§STËÇ°Á•®\nstocks = [s for s in stocks if not get_extras('is_st', s)]",impact:"Èôç‰ΩéË∏©Èõ∑È£éÈô©"}),n}generateCodeAdvices(e){const n=[];for(const t of e.issues)"code"===t.category&&n.push({id:`code_${t.message.replace(/\s+/g,"_").toLowerCase()}`,category:"code",priority:"error"===t.type?"high":"low",title:t.message,description:t.suggestion||"",impact:"‰ª£Á†ÅËßÑËåÉÊÄß"});return n}getKnowledgeBasedAdvices(e){if(!this.knowledgeStore)return[];const n=[],t=this.knowledgeStore.getBestPractices();for(const a of t.slice(0,5))this.checkPracticeApplied(a,e)||n.push({id:`kb_${a.id}`,category:this.mapPracticeCategory(a.category),priority:"medium",title:a.title,description:a.description,codeExample:a.example,source:a.references?.[0]||"Áü•ËØÜÂ∫ì",impact:"Êù•Ëá™ÂÆûÊìçÁªèÈ™åÁöÑ‰ºòÂåñÂª∫ËÆÆ"});return n}checkPracticeApplied(e,n){const t=e.description.toLowerCase();return!(!t.includes("Ê≠¢Êçü")||!n.riskControl.stopLoss)||!(!t.includes("Ê≠¢Áõà")||!n.riskControl.takeProfit)||!!(t.includes("Â§öÂõ†Â≠ê")&&n.factors.length>=3)}mapPracticeCategory(e){return{risk:"risk",selection:"selection",trading:"performance",position:"risk"}[e]||"performance"}calculateScores(e,n){let t=70,a=70,r=70,s=80;e.riskControl.stopLoss&&(t+=10),e.riskControl.takeProfit&&(t+=5),e.riskControl.maxPosition&&(t+=5),e.riskControl.hasDrawdownControl&&(t+=10),a+=Math.min(10*e.factors.length,30),e.stockSelection.topN&&e.stockSelection.topN>=5&&e.stockSelection.topN<=20&&(r+=10),r+=5*e.stockSelection.filters.length;const o=e.issues.filter(e=>"code"===e.category);s-=20*o.filter(e=>"error"===e.type).length,s-=5*o.filter(e=>"warning"===e.type).length;const i=5*n.filter(e=>"high"===e.priority).length;return{risk:Math.max(0,Math.min(100,t-i)),factor:Math.max(0,Math.min(100,a-i)),selection:Math.max(0,Math.min(100,r-i)),code:Math.max(0,Math.min(100,s)),overall:Math.round((t+a+r+s)/4-i)}}generateSummary(e,n,t){const a=t.filter(e=>"high"===e.priority),r=t.filter(e=>"medium"===e.priority);let s=`Á≠ñÁï• "${e.name}" Êï¥‰ΩìËØÑÂàÜ ${n.overall}/100„ÄÇ`;if(a.length>0){s+=`\n\nüî¥ ÂèëÁé∞ ${a.length} ‰∏™È´ò‰ºòÂÖàÁ∫ßÈóÆÈ¢òÈúÄË¶Å‰ºòÂÖàÂ§ÑÁêÜÔºö`;for(const e of a.slice(0,3))s+=`\n  ‚Ä¢ ${e.title}`}r.length>0&&(s+=`\n\nüü° ÂèëÁé∞ ${r.length} ‰∏™‰∏≠Á≠â‰ºòÂÖàÁ∫ß‰ºòÂåñÂª∫ËÆÆ„ÄÇ`);const o=[];return e.riskControl.stopLoss&&e.riskControl.takeProfit&&o.push("È£éÊéßÂÆåÂñÑ"),e.factors.length>=3&&o.push("Â§öÂõ†Â≠êÈÄâËÇ°"),e.trading.hasTimingLogic&&o.push("ÂåÖÂê´Êã©Êó∂ÈÄªËæë"),o.length>0&&(s+=`\n\n‚úÖ Á≠ñÁï•‰∫ÆÁÇπÔºö${o.join("„ÄÅ")}`),s}}n.OptimizationAdvisor=r},928:e=>{e.exports=require("path")}},n={},t=function t(a){var r=n[a];if(void 0!==r)return r.exports;var s=n[a]={exports:{}};return e[a].call(s.exports,s,s.exports,t),s.exports}(265);module.exports=t})();
//# sourceMappingURL=extension.js.map