(()=>{"use strict";var e={3:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.TRQuantClient=void 0;const i=s(t(317)),c=s(t(928)),l=t(628),d=t(478),p=t(799);n.TRQuantClient=class{MODULE="TRQuantClient";extensionPath;configManager;constructor(e){this.extensionPath=e.extensionPath,this.configManager=d.ConfigManager.getInstance(),l.logger.info("TRQuantClientåˆå§‹åŒ–å®Œæˆ",this.MODULE)}async getMarketStatus(e){return this.callBridge("get_market_status",{universe:e?.universe||"CN_EQ",as_of:e?.as_of||this.getTodayDate(),lookback_days:e?.lookback_days||60})}async getMainlines(e){return this.callBridge("get_mainlines",{top_n:e?.top_n||20,time_horizon:e?.time_horizon||"short"})}async recommendFactors(e){return this.callBridge("recommend_factors",{market_regime:e?.market_regime,mainlines:e?.mainlines,top_n:e?.top_n||10})}async generateStrategy(e){p.ErrorHandler.validateRequired(e,["factors"]);const n={max_position:e.risk_params?.max_position||this.configManager.get("defaultRiskParams").maxPosition,stop_loss:e.risk_params?.stop_loss||this.configManager.get("defaultRiskParams").stopLoss,take_profit:e.risk_params?.take_profit||this.configManager.get("defaultRiskParams").takeProfit};return this.callBridge("generate_strategy",{factors:e.factors,style:e.style||this.configManager.get("defaultStyle"),platform:e.platform||this.configManager.get("defaultPlatform"),risk_params:n})}async analyzeBacktest(e){return this.callBridge("analyze_backtest",e)}async runBacktest(e){return p.ErrorHandler.validateRequired(e,["strategy_code","config"]),this.callBridge("run_backtest",{strategy_code:e.strategy_code,config:e.config,data_source:e.data_source||"akshare"})}async assessRisk(e){return p.ErrorHandler.validateRequired(e,["portfolio"]),this.callBridge("risk_assessment",e)}async healthCheck(){try{return(await this.callBridge("health_check",{})).ok}catch{return!1}}async callBridge(e,n){const t=Date.now();l.logger.debug(`è°ƒç”¨Bridge: ${e}`,this.MODULE,{params:n});try{const a=await this.executeSubprocess(e,n),r=Date.now()-t;return l.logger.info(`Bridgeè°ƒç”¨å®Œæˆ: ${e}`,this.MODULE,{duration:`${r}ms`,ok:a.ok}),a}catch(n){const a=Date.now()-t;throw l.logger.error(`Bridgeè°ƒç”¨å¤±è´¥: ${e}`,this.MODULE,{duration:`${a}ms`,error:n instanceof Error?n.message:String(n)}),n}}executeSubprocess(e,n){return new Promise((t,a)=>{const r=this.configManager.getPythonPath(this.extensionPath),o=c.join(this.extensionPath,"python","bridge.py"),s=this.configManager.get("timeout"),d={action:e,params:n},g=JSON.stringify(d);l.logger.debug(`æ‰§è¡ŒPython: ${r}`,this.MODULE,{bridgePath:o});const u={...process.env,PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(this.extensionPath),PYTHONPATH:c.join(this.extensionPath,"python")},m=i.spawn(r,[o],{cwd:c.join(this.extensionPath,"python"),env:u,stdio:["pipe","pipe","pipe"]});let f="",h="";m.stdout?.on("data",e=>{f+=e.toString()}),m.stderr?.on("data",e=>{h+=e.toString()});const v=setTimeout(()=>{m.kill("SIGTERM"),a(new p.TRQuantError(p.ErrorCode.TIMEOUT,`æ“ä½œè¶…æ—¶ (${s}ms)`,{action:e}))},s);m.on("close",n=>{if(clearTimeout(v),0!==n)return l.logger.error(`Pythonè¿›ç¨‹é€€å‡º: ${n}`,this.MODULE,{stderr:h}),void a(new p.PythonError(h||`è¿›ç¨‹é€€å‡ºç : ${n}`,{action:e,code:n,stderr:h}));try{const e=JSON.parse(f.trim());t(e)}catch(e){l.logger.error("å“åº”è§£æå¤±è´¥",this.MODULE,{stdout:f}),a(new p.TRQuantError(p.ErrorCode.BRIDGE_RESPONSE_PARSE_ERROR,"æ— æ³•è§£æåç«¯å“åº”",{stdout:f,parseError:e instanceof Error?e.message:String(e)}))}}),m.on("error",e=>{clearTimeout(v),l.logger.error("è¿›ç¨‹å¯åŠ¨å¤±è´¥",this.MODULE,{error:e.message}),e.message.includes("ENOENT")?a(new p.TRQuantError(p.ErrorCode.PYTHON_NOT_FOUND,`Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°: ${r}`,{pythonPath:r})):a(new p.PythonError(e.message,{error:e}))}),m.stdin?.write(g),m.stdin?.end()})}getTodayDate(){return(new Date).toISOString().split("T")[0]}dispose(){l.logger.info("TRQuantClientå·²é‡Šæ”¾",this.MODULE)}}},46:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.StrategyLearner=void 0,n.createStrategyLearner=function(e){return new p(e)};const i=s(t(896)),c=s(t(928)),l=t(683),d=t(510);class p{store;learningLog=[];constructor(e){this.store=(0,l.getKnowledgeStore)(e)}async learnFromDocuments(e){const n={learned:0,patterns:[],practices:[]};for(const t of e)try{if(!i.existsSync(t))continue;const e=i.readFileSync(t,"utf-8"),a=c.extname(t).toLowerCase();if(".md"===a||".txt"===a){const t=this.extractFromMarkdown(e);n.patterns.push(...t.patterns),n.practices.push(...t.practices)}else if(".py"===a){const a=this.extractFromPython(e,t);n.patterns.push(...a.patterns)}n.learned++}catch(e){this.log(`å­¦ä¹ æ–‡æ¡£å¤±è´¥ ${t}: ${e}`)}return this.store.autoSave(),n}extractFromMarkdown(e){const n=[],t=[],a=e.matchAll(/```python\n([\s\S]*?)```/g);for(const e of a){const t=e[1],a=t.match(/def\s+(\w+)\s*\([^)]*\):/);if(a){const e=a[1];e.includes("select")||e.includes("filter")||e.includes("stock")?(this.addLearnedPattern({id:`doc_${e}_${Date.now()}`,name:this.formatFunctionName(e),category:"selection",description:"ä»æ–‡æ¡£å­¦ä¹ çš„é€‰è‚¡å‡½æ•°",codeTemplate:t,effectiveness:70,usageCount:0}),n.push(e)):(e.includes("stop")||e.includes("risk")||e.includes("position"))&&(this.addLearnedPattern({id:`doc_${e}_${Date.now()}`,name:this.formatFunctionName(e),category:"risk",description:"ä»æ–‡æ¡£å­¦ä¹ çš„é£æ§å‡½æ•°",codeTemplate:t,effectiveness:75,usageCount:0}),n.push(e))}}const r=e.matchAll(/##\s+(.+?)\n([\s\S]*?)(?=\n##|\n#|$)/g);for(const e of r){const n=e[1].trim(),a=e[2].trim();(n.includes("å»ºè®®")||n.includes("å®è·µ")||n.includes("æ³¨æ„")||n.includes("æŠ€å·§")||a.includes("æ¨è")||a.includes("åº”è¯¥"))&&(this.addLearnedPractice({id:`doc_bp_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,title:n,category:this.categorizeByKeywords(a),description:a.slice(0,200),example:this.extractFirstCodeBlock(a)||"",references:["æ–‡æ¡£å­¦ä¹ "]}),t.push(n))}return{patterns:n,practices:t}}extractFromPython(e,n){const t=[],a=d.codeAnalyzer.analyze(e,c.basename(n));for(const e of a.components.stockSelection)e.content.length>100&&(this.addLearnedPattern({id:`py_${e.name}_${Date.now()}`,name:this.formatFunctionName(e.name),category:"selection",description:`ä» ${c.basename(n)} å­¦ä¹ çš„é€‰è‚¡é€»è¾‘`,codeTemplate:e.content,effectiveness:70,usageCount:0}),t.push(e.name));for(const e of a.components.riskControl)e.content.length>50&&(this.addLearnedPattern({id:`py_${e.name}_${Date.now()}`,name:this.formatFunctionName(e.name),category:"risk",description:`ä» ${c.basename(n)} å­¦ä¹ çš„é£æ§é€»è¾‘`,codeTemplate:e.content,effectiveness:75,usageCount:0}),t.push(e.name));return{patterns:t}}async learnFromHistory(e){const n={analyzed:0,successPatterns:[],failurePatterns:[]};for(const t of e)try{const e=d.codeAnalyzer.analyze(t.code,t.filename);t.performance&&t.performance.returns>.1&&t.performance.sharpe>1&&t.performance.maxDrawdown>-.2?(this.extractAndUpdatePatterns(e,"success"),n.successPatterns.push(t.filename)):t.performance&&t.performance.returns<-.1&&(this.extractAndUpdatePatterns(e,"failure"),n.failurePatterns.push(t.filename)),n.analyzed++}catch(e){this.log(`åˆ†æç­–ç•¥å¤±è´¥ ${t.filename}: ${e}`)}return this.store.autoSave(),n}extractAndUpdatePatterns(e,n){const t="success"===n?5:-3;for(const n of e.dependencies.factors){const e=`factor_${n.type}`,a=this.store.getPatternById(e);a&&this.store.updatePatternEffectiveness(e,Math.max(0,Math.min(100,a.effectiveness+t)))}e.components.riskControl.length>0?"success"===n&&this.store.updatePatternEffectiveness("fixed_stop_loss",Math.min(100,this.store.getPatternById("fixed_stop_loss")?.effectiveness||82)):"failure"===n&&this.log("å­¦ä¹ : æ— é£æ§ç­–ç•¥æ›´å®¹æ˜“å¤±è´¥")}recordFeedback(e){this.store.addFeedback({...e,timestamp:(new Date).toISOString(),resolved:!1}),this.store.autoSave()}async processFeedback(){const e={processed:0,improvements:[]},n=this.store.getFeedback(!1);for(const t of n)try{switch(t.type){case"correction":this.learnFromCorrection(t),e.improvements.push(`ä¿®æ­£äº† ${t.strategyId} çš„è½¬æ¢è§„åˆ™`);break;case"improvement":this.addLearnedPractice({id:`feedback_${Date.now()}`,title:"ç”¨æˆ·å»ºè®®çš„æœ€ä½³å®è·µ",category:"ç”¨æˆ·è´¡çŒ®",description:t.content,example:"",references:["ç”¨æˆ·åé¦ˆ"]}),e.improvements.push("æ·»åŠ äº†æ–°çš„æœ€ä½³å®è·µ");break;case"bug":this.log(`Bugåé¦ˆ: ${t.content}`)}this.store.resolveFeedback(t.timestamp),e.processed++}catch(e){this.log(`å¤„ç†åé¦ˆå¤±è´¥: ${e}`)}return this.store.autoSave(),e}learnFromCorrection(e){const n=e.content.match(/(\w+)\s*(?:->|â†’|åº”è¯¥æ˜¯)\s*(\w+)/);if(n){const[,e,t]=n;this.log(`å­¦ä¹ çº æ­£: ${e} -> ${t}`)}}recommendPatterns(e){const n=[],t=this.store.getPatterns();if(0===e.components.riskControl.length){const e=t.filter(e=>"risk"===e.category).sort((e,n)=>n.effectiveness-e.effectiveness).slice(0,3);n.push(...e)}if(e.components.stockSelection.length<=1){const e=t.filter(e=>"selection"===e.category).sort((e,n)=>n.effectiveness-e.effectiveness).slice(0,2);n.push(...e)}for(const a of e.dependencies.factors){const e=t.filter(e=>e.codeTemplate.toLowerCase().includes(a.type));e.length>0&&n.push(e[0])}const a=new Set;return n.filter(e=>!a.has(e.id)&&(a.add(e.id),!0))}recommendBestPractices(e){const n=[],t=this.store.getBestPractices();if(!e.components.riskControl.some(e=>e.content.toLowerCase().includes("stop_loss")||e.content.includes("æ­¢æŸ"))){const e=t.find(e=>"bp_stop_loss"===e.id);e&&n.push(e)}if(!e.components.stockSelection.some(e=>e.content.toLowerCase().includes("is_st")||e.content.includes("ST"))){const e=t.find(e=>"bp_avoid_st"===e.id);e&&n.push(e)}if(!e.dependencies.apis.some(e=>e.name.includes("log"))){const e=t.find(e=>"bp_logging"===e.id);e&&n.push(e)}return n}addLearnedPattern(e){this.store.addPattern(e),this.log(`å­¦ä¹ æ–°æ¨¡å¼: ${e.name}`)}addLearnedPractice(e){this.store.addBestPractice(e),this.log(`å­¦ä¹ æ–°å®è·µ: ${e.title}`)}formatFunctionName(e){return e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}categorizeByKeywords(e){const n=e.toLowerCase();return n.includes("é£æ§")||n.includes("æ­¢æŸ")||n.includes("é£é™©")?"é£æ§":n.includes("é€‰è‚¡")||n.includes("ç­›é€‰")||n.includes("å› å­")?"é€‰è‚¡":n.includes("æ‰§è¡Œ")||n.includes("ä¸‹å•")||n.includes("äº¤æ˜“")?"æ‰§è¡Œ":n.includes("è°ƒè¯•")||n.includes("æ—¥å¿—")||n.includes("è®°å½•")?"è°ƒè¯•":"é€šç”¨"}extractFirstCodeBlock(e){const n=e.match(/```(?:python)?\n([\s\S]*?)```/);return n?n[1]:null}log(e){const n=`[${(new Date).toISOString()}] ${e}`;this.learningLog.push(n),console.log(`[StrategyLearner] ${e}`)}getLearningLog(){return this.learningLog}getStats(){return this.store.getStats()}save(){this.store.save()}}n.StrategyLearner=p},56:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.BacktestConfigPanel=void 0,n.showBacktestConfigPanel=function(e,n,t){g.createOrShow(e,n)};const i=s(t(398)),c=s(t(896)),l=s(t(928)),d=t(628),p="BacktestConfigPanel";class g{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_isRunning=!1;constructor(e,n,t){this._panel=e,this._extensionUri=n,this._client=t,this._panel.webview.onDidReceiveMessage(e=>this.handleMessage(e),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent()}static createOrShow(e,n){const t=i.ViewColumn.One;if(g.currentPanel)return g.currentPanel._panel.reveal(t),g.currentPanel;const a=i.window.createWebviewPanel("backtestConfig","ğŸ§ª å›æµ‹é…ç½®",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});return g.currentPanel=new g(a,e,n),g.currentPanel}async handleMessage(e){switch(e.command){case"loadStrategyFile":await this.loadStrategyFile();break;case"runBacktest":await this.runBacktest(e.config,e.strategyCode);break;case"saveConfig":await this.saveConfig(e.config);break;case"loadConfig":await this.loadConfig()}}async loadStrategyFile(){const e=await i.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Pythonæ–‡ä»¶:["py"],æ‰€æœ‰æ–‡ä»¶:["*"]}});if(e&&e[0])try{const n=c.readFileSync(e[0].fsPath,"utf-8");this._panel.webview.postMessage({command:"strategyLoaded",code:n,fileName:l.basename(e[0].fsPath)})}catch(e){i.window.showErrorMessage(`è¯»å–ç­–ç•¥æ–‡ä»¶å¤±è´¥: ${e}`)}}async runBacktest(e,n){if(this._isRunning)i.window.showWarningMessage("å›æµ‹æ­£åœ¨è¿è¡Œä¸­ï¼Œè¯·ç¨å€™...");else if(n&&0!==n.trim().length){this._isRunning=!0,this._panel.webview.postMessage({command:"backtestRunning",running:!0});try{d.logger.info("å¼€å§‹è¿è¡Œå›æµ‹",p,{config:e});const t=await this._client.runBacktest({strategy_code:n,config:e,data_source:e.data_source||"akshare"});if(this._isRunning=!1,this._panel.webview.postMessage({command:"backtestRunning",running:!1}),t.ok&&t.data)this._panel.webview.postMessage({command:"backtestResult",result:t.data}),i.window.showInformationMessage("âœ… å›æµ‹å®Œæˆï¼");else{const e=t.error||"å›æµ‹æ‰§è¡Œå¤±è´¥";this._panel.webview.postMessage({command:"backtestError",error:e}),i.window.showErrorMessage(`å›æµ‹å¤±è´¥: ${e}`)}}catch(e){this._isRunning=!1,this._panel.webview.postMessage({command:"backtestRunning",running:!1});const n=e instanceof Error?e.message:String(e);this._panel.webview.postMessage({command:"backtestError",error:n}),d.logger.error(`å›æµ‹æ‰§è¡Œå¤±è´¥: ${n}`,p),i.window.showErrorMessage(`å›æµ‹å¤±è´¥: ${n}`)}}else i.window.showErrorMessage("è¯·å…ˆåŠ è½½æˆ–è¾“å…¥ç­–ç•¥ä»£ç ")}async saveConfig(e){const n=i.workspace.workspaceFolders;if(!n||0===n.length)return void i.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const t=l.join(n[0].uri.fsPath,"backtest_config.json");try{c.writeFileSync(t,JSON.stringify(e,null,2),"utf-8"),i.window.showInformationMessage(`é…ç½®å·²ä¿å­˜åˆ°: ${t}`)}catch(e){i.window.showErrorMessage(`ä¿å­˜é…ç½®å¤±è´¥: ${e}`)}}async loadConfig(){const e=i.workspace.workspaceFolders;if(!e||0===e.length)return void i.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const n=l.join(e[0].uri.fsPath,"backtest_config.json");if(c.existsSync(n))try{const e=JSON.parse(c.readFileSync(n,"utf-8"));this._panel.webview.postMessage({command:"configLoaded",config:e})}catch(e){i.window.showErrorMessage(`åŠ è½½é…ç½®å¤±è´¥: ${e}`)}else i.window.showWarningMessage("æœªæ‰¾åˆ°é…ç½®æ–‡ä»¶")}updateContent(){this._panel.webview.html=this.getHtmlContent()}getHtmlContent(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å›æµ‹é…ç½®</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: \'Segoe UI\', \'Microsoft YaHei\', sans-serif;\n            background: var(--vscode-editor-background);\n            color: var(--vscode-editor-foreground);\n            padding: 20px;\n            line-height: 1.6;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n        \n        h1 {\n            color: var(--vscode-textLink-foreground);\n            margin-bottom: 20px;\n            font-size: 24px;\n        }\n        \n        .section {\n            background: var(--vscode-editor-background);\n            border: 1px solid var(--vscode-panel-border);\n            border-radius: 6px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        \n        .section-title {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 15px;\n            color: var(--vscode-textLink-foreground);\n        }\n        \n        .form-group {\n            margin-bottom: 15px;\n        }\n        \n        label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: 500;\n            color: var(--vscode-descriptionForeground);\n        }\n        \n        input, select, textarea {\n            width: 100%;\n            padding: 8px 12px;\n            background: var(--vscode-input-background);\n            color: var(--vscode-input-foreground);\n            border: 1px solid var(--vscode-input-border);\n            border-radius: 4px;\n            font-size: 14px;\n            font-family: inherit;\n        }\n        \n        input:focus, select:focus, textarea:focus {\n            outline: none;\n            border-color: var(--vscode-focusBorder);\n        }\n        \n        textarea {\n            min-height: 200px;\n            font-family: \'Consolas\', \'Monaco\', monospace;\n            resize: vertical;\n        }\n        \n        .form-row {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 15px;\n        }\n        \n        .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            transition: all 0.2s;\n        }\n        \n        .btn-primary {\n            background: var(--vscode-button-background);\n            color: var(--vscode-button-foreground);\n        }\n        \n        .btn-primary:hover {\n            background: var(--vscode-button-hoverBackground);\n        }\n        \n        .btn-secondary {\n            background: var(--vscode-button-secondaryBackground);\n            color: var(--vscode-button-secondaryForeground);\n        }\n        \n        .btn-secondary:hover {\n            background: var(--vscode-button-secondaryHoverBackground);\n        }\n        \n        .btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        .button-group {\n            display: flex;\n            gap: 10px;\n            margin-top: 20px;\n        }\n        \n        .status {\n            padding: 10px;\n            border-radius: 4px;\n            margin-bottom: 15px;\n            display: none;\n        }\n        \n        .status.success {\n            background: var(--vscode-testing-iconPassed);\n            color: white;\n        }\n        \n        .status.error {\n            background: var(--vscode-testing-iconFailed);\n            color: white;\n        }\n        \n        .status.info {\n            background: var(--vscode-notificationsInfoIcon-foreground);\n            color: white;\n        }\n        \n        .result-section {\n            margin-top: 20px;\n        }\n        \n        .result-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 15px;\n        }\n        \n        .result-table th,\n        .result-table td {\n            padding: 10px;\n            text-align: left;\n            border-bottom: 1px solid var(--vscode-panel-border);\n        }\n        \n        .result-table th {\n            background: var(--vscode-editor-lineHighlightBackground);\n            font-weight: 600;\n        }\n        \n        .loading {\n            display: inline-block;\n            width: 16px;\n            height: 16px;\n            border: 2px solid var(--vscode-progressBar-background);\n            border-top-color: transparent;\n            border-radius: 50%;\n            animation: spin 0.8s linear infinite;\n            margin-right: 8px;\n            vertical-align: middle;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <h1>ğŸ§ª å›æµ‹é…ç½®</h1>\n        \n        <div id="status" class="status"></div>\n        \n        \x3c!-- å›æµ‹å‚æ•°é…ç½® --\x3e\n        <div class="section">\n            <div class="section-title">ğŸ“Š å›æµ‹å‚æ•°</div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>å¼€å§‹æ—¥æœŸ</label>\n                    <input type="date" id="startDate" value="2023-01-01">\n                </div>\n                <div class="form-group">\n                    <label>ç»“æŸæ—¥æœŸ</label>\n                    <input type="date" id="endDate" value="2024-01-01">\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>åˆå§‹èµ„é‡‘ï¼ˆå…ƒï¼‰</label>\n                    <input type="number" id="initialCapital" value="1000000" min="10000" step="10000">\n                </div>\n                <div class="form-group">\n                    <label>åŸºå‡†æŒ‡æ•°</label>\n                    <select id="benchmark">\n                        <option value="000300.XSHG">æ²ªæ·±300 (000300.XSHG)</option>\n                        <option value="000905.XSHG">ä¸­è¯500 (000905.XSHG)</option>\n                        <option value="000001.XSHG">ä¸Šè¯æŒ‡æ•° (000001.XSHG)</option>\n                    </select>\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>æ‰‹ç»­è´¹ç‡</label>\n                    <input type="number" id="commission" value="0.0003" min="0" max="0.01" step="0.0001">\n                </div>\n                <div class="form-group">\n                    <label>æ»‘ç‚¹</label>\n                    <input type="number" id="slippage" value="0.002" min="0" max="0.01" step="0.0001">\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>æœ€å¤§ä»“ä½æ¯”ä¾‹</label>\n                    <input type="number" id="maxPosition" value="0.8" min="0" max="1" step="0.1">\n                </div>\n                <div class="form-group">\n                    <label>å•è‚¡æœ€å¤§ä»“ä½</label>\n                    <input type="number" id="singleStockMax" value="0.1" min="0" max="1" step="0.05">\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-group">\n                    <label>æ­¢æŸçº¿</label>\n                    <input type="number" id="stopLoss" value="0.08" min="0" max="0.5" step="0.01">\n                </div>\n                <div class="form-group">\n                    <label>æ­¢ç›ˆçº¿</label>\n                    <input type="number" id="takeProfit" value="0.2" min="0" max="1" step="0.05">\n                </div>\n            </div>\n            <div class="form-group">\n                <label>æ•°æ®æº</label>\n                <select id="dataSource">\n                    <option value="akshare">AKShare (å…è´¹)</option>\n                    <option value="jqdata">JQData (éœ€è®¤è¯)</option>\n                </select>\n            </div>\n            <div class="form-group">\n                <label>è‚¡ç¥¨æ± ï¼ˆä»£ç ï¼Œç”¨é€—å·åˆ†éš”ï¼‰</label>\n                <input type="text" id="symbols" placeholder="ä¾‹å¦‚: 000001.XSHE,000002.XSHE" value="000001.XSHE">\n            </div>\n        </div>\n        \n        \x3c!-- ç­–ç•¥ä»£ç  --\x3e\n        <div class="section">\n            <div class="section-title">ğŸ“ ç­–ç•¥ä»£ç </div>\n            <div class="button-group">\n                <button class="btn btn-secondary" onclick="loadStrategyFile()">ğŸ“‚ åŠ è½½ç­–ç•¥æ–‡ä»¶</button>\n                <button class="btn btn-secondary" onclick="loadConfig()">ğŸ“¥ åŠ è½½é…ç½®</button>\n                <button class="btn btn-secondary" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>\n            </div>\n            <div class="form-group" style="margin-top: 15px;">\n                <label>ç­–ç•¥ä»£ç ï¼ˆå¿…é¡»å®šä¹‰ on_bar(engine, bars) å‡½æ•°ï¼‰</label>\n                <textarea id="strategyCode" placeholder="def on_bar(engine, bars):\n    # ç­–ç•¥é€»è¾‘\n    for symbol, bar in bars.items():\n        # ç¤ºä¾‹ï¼šç®€å•ä¹°å…¥æŒæœ‰\n        if engine.portfolio.get_position(symbol) == 0:\n            engine.buy(symbol, 100)"></textarea>\n            </div>\n        </div>\n        \n        \x3c!-- æ“ä½œæŒ‰é’® --\x3e\n        <div class="button-group">\n            <button class="btn btn-primary" id="runBtn" onclick="runBacktest()">\n                â–¶ï¸ è¿è¡Œå›æµ‹\n            </button>\n        </div>\n        \n        \x3c!-- å›æµ‹ç»“æœ --\x3e\n        <div class="section result-section" id="resultSection" style="display: none;">\n            <div class="section-title">ğŸ“ˆ å›æµ‹ç»“æœ</div>\n            <div id="resultContent"></div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function showStatus(message, type = \'info\') {\n            const statusEl = document.getElementById(\'status\');\n            statusEl.textContent = message;\n            statusEl.className = \'status \' + type;\n            statusEl.style.display = \'block\';\n            if (type !== \'error\') {\n                setTimeout(() => {\n                    statusEl.style.display = \'none\';\n                }, 3000);\n            }\n        }\n        \n        function getConfig() {\n            return {\n                start_date: document.getElementById(\'startDate\').value,\n                end_date: document.getElementById(\'endDate\').value,\n                initial_capital: parseFloat(document.getElementById(\'initialCapital\').value),\n                benchmark: document.getElementById(\'benchmark\').value,\n                commission: parseFloat(document.getElementById(\'commission\').value),\n                slippage: parseFloat(document.getElementById(\'slippage\').value),\n                max_position: parseFloat(document.getElementById(\'maxPosition\').value),\n                single_stock_max: parseFloat(document.getElementById(\'singleStockMax\').value),\n                stop_loss: parseFloat(document.getElementById(\'stopLoss\').value),\n                take_profit: parseFloat(document.getElementById(\'takeProfit\').value),\n                data_source: document.getElementById(\'dataSource\').value,\n                symbols: document.getElementById(\'symbols\').value.split(\',\').map(s => s.trim()).filter(s => s)\n            };\n        }\n        \n        function getStrategyCode() {\n            return document.getElementById(\'strategyCode\').value;\n        }\n        \n        function loadStrategyFile() {\n            vscode.postMessage({ command: \'loadStrategyFile\' });\n        }\n        \n        function loadConfig() {\n            vscode.postMessage({ command: \'loadConfig\' });\n        }\n        \n        function saveConfig() {\n            const config = getConfig();\n            vscode.postMessage({ command: \'saveConfig\', config: config });\n        }\n        \n        function runBacktest() {\n            const config = getConfig();\n            const strategyCode = getStrategyCode();\n            \n            if (!strategyCode || strategyCode.trim().length === 0) {\n                showStatus(\'è¯·å…ˆè¾“å…¥ç­–ç•¥ä»£ç \', \'error\');\n                return;\n            }\n            \n            vscode.postMessage({\n                command: \'runBacktest\',\n                config: config,\n                strategyCode: strategyCode\n            });\n        }\n        \n        // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'strategyLoaded\':\n                    document.getElementById(\'strategyCode\').value = message.code;\n                    showStatus(\'ç­–ç•¥æ–‡ä»¶åŠ è½½æˆåŠŸ: \' + message.fileName, \'success\');\n                    break;\n                    \n                case \'configLoaded\':\n                    const config = message.config;\n                    if (config.start_date) document.getElementById(\'startDate\').value = config.start_date;\n                    if (config.end_date) document.getElementById(\'endDate\').value = config.end_date;\n                    if (config.initial_capital) document.getElementById(\'initialCapital\').value = config.initial_capital;\n                    if (config.benchmark) document.getElementById(\'benchmark\').value = config.benchmark;\n                    if (config.commission) document.getElementById(\'commission\').value = config.commission;\n                    if (config.slippage) document.getElementById(\'slippage\').value = config.slippage;\n                    if (config.max_position) document.getElementById(\'maxPosition\').value = config.max_position;\n                    if (config.single_stock_max) document.getElementById(\'singleStockMax\').value = config.single_stock_max;\n                    if (config.stop_loss) document.getElementById(\'stopLoss\').value = config.stop_loss;\n                    if (config.take_profit) document.getElementById(\'takeProfit\').value = config.take_profit;\n                    if (config.data_source) document.getElementById(\'dataSource\').value = config.data_source;\n                    if (config.symbols) document.getElementById(\'symbols\').value = config.symbols.join(\',\');\n                    showStatus(\'é…ç½®åŠ è½½æˆåŠŸ\', \'success\');\n                    break;\n                    \n                case \'backtestRunning\':\n                    const runBtn = document.getElementById(\'runBtn\');\n                    if (message.running) {\n                        runBtn.disabled = true;\n                        runBtn.innerHTML = \'<span class="loading"></span> å›æµ‹è¿è¡Œä¸­...\';\n                    } else {\n                        runBtn.disabled = false;\n                        runBtn.innerHTML = \'â–¶ï¸ è¿è¡Œå›æµ‹\';\n                    }\n                    break;\n                    \n                case \'backtestResult\':\n                    displayResult(message.result);\n                    showStatus(\'å›æµ‹å®Œæˆï¼\', \'success\');\n                    break;\n                    \n                case \'backtestError\':\n                    showStatus(\'å›æµ‹å¤±è´¥: \' + message.error, \'error\');\n                    document.getElementById(\'resultSection\').style.display = \'none\';\n                    break;\n            }\n        });\n        \n        function displayResult(result) {\n            const resultSection = document.getElementById(\'resultSection\');\n            const resultContent = document.getElementById(\'resultContent\');\n            \n            if (!result || !result.success) {\n                resultContent.innerHTML = \'<p style="color: var(--vscode-errorForeground);">å›æµ‹æ‰§è¡Œå¤±è´¥</p>\';\n                resultSection.style.display = \'block\';\n                return;\n            }\n            \n            const data = result.result || result;\n            let html = \'<table class="result-table">\';\n            \n            // åŸºæœ¬æŒ‡æ ‡\n            if (data.total_return !== undefined) {\n                html += \'<tr><th>æ€»æ”¶ç›Šç‡</th><td>\' + (data.total_return * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.annual_return !== undefined) {\n                html += \'<tr><th>å¹´åŒ–æ”¶ç›Šç‡</th><td>\' + (data.annual_return * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.sharpe_ratio !== undefined) {\n                html += \'<tr><th>å¤æ™®æ¯”ç‡</th><td>\' + data.sharpe_ratio.toFixed(3) + \'</td></tr>\';\n            }\n            if (data.max_drawdown !== undefined) {\n                html += \'<tr><th>æœ€å¤§å›æ’¤</th><td>\' + (data.max_drawdown * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.win_rate !== undefined) {\n                html += \'<tr><th>èƒœç‡</th><td>\' + (data.win_rate * 100).toFixed(2) + \'%</td></tr>\';\n            }\n            if (data.total_trades !== undefined) {\n                html += \'<tr><th>æ€»äº¤æ˜“æ¬¡æ•°</th><td>\' + data.total_trades + \'</td></tr>\';\n            }\n            if (data.final_value !== undefined) {\n                html += \'<tr><th>æœ€ç»ˆèµ„äº§</th><td>\' + data.final_value.toFixed(2) + \' å…ƒ</td></tr>\';\n            }\n            \n            html += \'</table>\';\n            resultContent.innerHTML = html;\n            resultSection.style.display = \'block\';\n        }\n    <\/script>\n</body>\n</html>'}dispose(){g.currentPanel=void 0,this._disposables.forEach(e=>e.dispose())}}n.BacktestConfigPanel=g},64:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.PLATFORMS=void 0,n.PLATFORMS={joinquant:{name:"joinquant",displayName:"èšå®½ JoinQuant",description:"é‡åŒ–ç ”ç©¶å’Œå›æµ‹å¹³å°",apiVersion:"2.0",features:["å›æµ‹","æ¨¡æ‹Ÿäº¤æ˜“","ç ”ç©¶ç¯å¢ƒ"]},ptrade:{name:"ptrade",displayName:"PTrade",description:"æ’ç”Ÿå®ç›˜äº¤æ˜“ç³»ç»Ÿ",apiVersion:"1.0",features:["å®ç›˜äº¤æ˜“","ç¨‹åºåŒ–äº¤æ˜“","å¤šè´¦æˆ·"]},qmt:{name:"qmt",displayName:"QMTè¿…æŠ•",description:"è¿…æŠ•é‡åŒ–äº¤æ˜“å¹³å°",apiVersion:"2.0",features:["å®ç›˜äº¤æ˜“","é«˜é¢‘äº¤æ˜“","ç­–ç•¥å›æµ‹"]},universal:{name:"universal",displayName:"é€šç”¨æ ¼å¼",description:"TRQuantç»Ÿä¸€æ ¼å¼",apiVersion:"1.0",features:["è·¨å¹³å°","æ ‡å‡†åŒ–","å¯ç§»æ¤"]}}},126:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.MainDashboard=void 0,n.registerMainDashboard=function(e,n){d.logger.info("æŠ•èµ„å·¥ä½œæµä»ªè¡¨ç›˜å·²æ³¨å†Œ",p)},n.showMainDashboard=function(e,n){g.createOrShow(e,n)};const i=s(t(398)),c=s(t(896)),l=s(t(928)),d=t(628),p="MainDashboard";class g{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_marketStatus=null;_mainlines=[];_factors=[];constructor(e,n,t){this._panel=e,this._extensionUri=n,this._client=t,this._panel.webview.onDidReceiveMessage(e=>this.handleMessage(e),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this.updateContent(),this.refreshAllData()}static createOrShow(e,n){const t=i.ViewColumn.One;if(g.currentPanel)return g.currentPanel._panel.reveal(t),g.currentPanel;const a=i.window.createWebviewPanel("trquantDashboard","ğŸ‰ éŸ¬ç¿é‡åŒ–å·¥ä½œå°",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});return g.currentPanel=new g(a,e,n),g.currentPanel}async handleMessage(e){switch(console.log("[MainDashboard] æ”¶åˆ°æ¶ˆæ¯:",e.command),e.command){case"openStep":await this.openWorkflowStep(e.step);break;case"refreshAll":await this.refreshAllData();break;case"refreshMarket":await this.refreshMarketStatus();break;case"refreshMainlines":await this.refreshMainlines();break;case"refreshFactors":await this.refreshFactors();break;case"createProject":console.log("[MainDashboard] æ‰§è¡Œ createProject å‘½ä»¤"),await i.commands.executeCommand("trquant.createProject");break;case"openProject":i.commands.executeCommand("trquant.openProject");break;case"openBacktestConfig":i.commands.executeCommand("trquant.openBacktestConfig");break;case"generateStrategy":i.commands.executeCommand("trquant.generateStrategy");break;case"showLogs":i.commands.executeCommand("trquant.showLogs");break;case"openSettings":i.commands.executeCommand("trquant.openSettings");break;case"openFileManager":i.commands.executeCommand("trquant.openFileManager");break;case"launchFileDashboard":await this.launchFileDashboard();break;case"openKnowledgeBase":i.commands.executeCommand("trquant.openKnowledgeBase");break;case"openAShareManual":i.commands.executeCommand("trquant.openAShareManual");break;case"launchAShareManual":await this.launchAShareManual();break;case"runFullWorkflow":await this.runFullWorkflow();break;case"openWorkflowPanel":console.log("[MainDashboard] å‡†å¤‡å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ");try{await i.commands.executeCommand("trquant.launchDesktopSystem"),console.log("[MainDashboard] æ¡Œé¢ç³»ç»Ÿå¯åŠ¨å‘½ä»¤å·²æ‰§è¡Œ"),i.window.showInformationMessage("ğŸ–¥ï¸ æ¡Œé¢ç³»ç»Ÿæ­£åœ¨å¯åŠ¨...")}catch(e){console.error("[MainDashboard] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥:",e);const n=e instanceof Error?e.message:String(e);i.window.showErrorMessage(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${n}`)}break;case"generateInvestmentReport":await this.generateInvestmentReport();break;case"syncFileChanges":await this.syncFileChanges();break;case"exportDatabase":await this.exportDatabase();break;case"openFile":await this.openFile(e.path);break;case"optimizeStrategy":i.commands.executeCommand("trquant.optimizeStrategy")}}async openWorkflowStep(e){const n={1:{id:"data_source",name:"ä¿¡æ¯è·å–"},2:{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿"},3:{id:"mainline",name:"æŠ•èµ„ä¸»çº¿"},4:{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º"},5:{id:"factor",name:"å› å­æ„å»º"},6:{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ"},7:{id:"backtest",name:"å›æµ‹éªŒè¯"},8:{id:"trading",name:"å®ç›˜äº¤æ˜“"}}[e];if(n)if(7!==e)if(8!==e){this._panel.webview.postMessage({command:"stepStarted",step:e,stepId:n.id,stepName:n.name});try{const t=await this._client.callBridge("run_workflow_step",{step_id:n.id}),a=t.summary||(t.ok?"æ‰§è¡ŒæˆåŠŸ":"æ‰§è¡Œå¤±è´¥"),r=t.data||{};this._panel.webview.postMessage({command:"stepResult",step:e,stepId:n.id,stepName:n.name,success:t.ok,summary:a,details:r,error:t.error})}catch(t){d.logger.error(`æ­¥éª¤${e}æ‰§è¡Œå¤±è´¥: ${t}`,p),this._panel.webview.postMessage({command:"stepResult",step:e,stepId:n.id,stepName:n.name,success:!1,summary:`æ‰§è¡Œå¤±è´¥: ${t}`,details:{},error:String(t)})}}else i.commands.executeCommand("trquant.openTrading");else i.commands.executeCommand("trquant.openBacktestConfig")}async refreshAllData(){this._panel.webview.postMessage({command:"loadingStart"}),await Promise.all([this.refreshMarketStatus(),this.refreshMainlines(),this.refreshFactors()]),this._panel.webview.postMessage({command:"loadingEnd"})}async refreshMarketStatus(){try{const e=await this._client.getMarketStatus();if(e.ok&&e.data){this._marketStatus=e.data;const n={regime:this._marketStatus.regime,regime_cn:this.getRegimeCN(this._marketStatus.regime),indices:this.formatIndices(this._marketStatus.index_trend),style_rotation:this._marketStatus.style_rotation?.[0]?.style||"å‡è¡¡"};this._panel.webview.postMessage({command:"marketStatusUpdated",data:n})}}catch(e){d.logger.error(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${e}`,p)}}getRegimeCN(e){return{risk_on:"é£é™©åå¥½",risk_off:"é£é™©è§„é¿",neutral:"ä¸­æ€§"}[e]||e}formatIndices(e){const n=[],t={sh_index:"ä¸Šè¯æŒ‡æ•°",sz_index:"æ·±è¯æˆæŒ‡",cy_index:"åˆ›ä¸šæ¿æŒ‡"};for(const[a,r]of Object.entries(e||{}))n.push({name:t[a]||a,value:r?.zscore||0,change:r?.change_pct||0});return n}async refreshMainlines(){try{const e=await this._client.getMainlines({time_horizon:"short",top_n:5});e.ok&&e.data&&(this._mainlines=e.data,this._panel.webview.postMessage({command:"mainlinesUpdated",data:this._mainlines}))}catch(e){d.logger.error(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${e}`,p)}}async refreshFactors(){try{const e=this._marketStatus?.regime||"neutral",n=await this._client.recommendFactors({market_regime:e,top_n:5});n.ok&&n.data&&(this._factors=n.data,this._panel.webview.postMessage({command:"factorsUpdated",data:this._factors}))}catch(e){d.logger.error(`è·å–æ¨èå› å­å¤±è´¥: ${e}`,p)}}async runFullWorkflow(){d.logger.info("=== ä¸€é”®æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ ===",p);const e=[{id:"step1",name:"ğŸ“¡ ä¿¡æ¯è·å–",action:"check_data_sources"},{id:"step2",name:"ğŸ“ˆ å¸‚åœºè¶‹åŠ¿",action:"analyze_market_trend"},{id:"step3",name:"ğŸ”¥ æŠ•èµ„ä¸»çº¿",action:"identify_mainlines"},{id:"step4",name:"ğŸ“¦ å€™é€‰æ± æ„å»º",action:"build_candidate_pool"},{id:"step5",name:"ğŸ“Š å› å­æ¨è",action:"recommend_factors"},{id:"step6",name:"ğŸ› ï¸ ç­–ç•¥ç”Ÿæˆ",action:"generate_strategy"},{id:"step7",name:"ğŸ”„ å›æµ‹éªŒè¯",action:"run_backtest"},{id:"step8",name:"ğŸš€ äº¤æ˜“æ£€æŸ¥",action:"check_broker"}];await i.window.withProgress({location:i.ProgressLocation.Notification,title:"ğŸ‰ æ‰§è¡Œå®Œæ•´æŠ•èµ„å·¥ä½œæµ",cancellable:!0},async(n,t)=>{const a=[];let r=!1;for(let o=0;o<e.length;o++){if(t.isCancellationRequested){i.window.showWarningMessage("å·¥ä½œæµå·²å–æ¶ˆ");break}const s=e[o];n.report({message:`(${o+1}/${e.length}) ${s.name}`,increment:100/e.length});try{d.logger.info(`æ‰§è¡Œæ­¥éª¤: ${s.name}`,p),this._panel.webview.postMessage({command:"workflowProgress",data:{currentStep:s.id,stepName:s.name,progress:(o+1)/e.length*100,status:"running"}});const n=await this._client.callBridge("run_workflow_step",{step_id:s.action});n.ok?(a.push({step:s.name,success:!0,data:n.data}),this._panel.webview.postMessage({command:"workflowStepResult",data:{stepId:s.id,stepName:s.name,result:n.data,success:!0}})):(r=!0,a.push({step:s.name,success:!1,error:n.error})),await new Promise(e=>setTimeout(e,500))}catch(e){r=!0;const n=e instanceof Error?e.message:String(e);d.logger.error(`æ­¥éª¤ ${s.name} å¤±è´¥: ${n}`,p),a.push({step:s.name,success:!1,error:n})}}this._panel.webview.postMessage({command:"workflowComplete",data:{results:a,hasError:r}}),r?i.window.showWarningMessage("âš ï¸ å·¥ä½œæµå®Œæˆï¼Œéƒ¨åˆ†æ­¥éª¤æœ‰é”™è¯¯"):i.window.showInformationMessage("âœ… å®Œæ•´æŠ•èµ„å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼"),await this.refreshAllData()})}async launchAShareManual(){d.logger.info("=== å¯åŠ¨Aè‚¡å®æ“æ‰‹å†Œ ===",p);try{const e=i.workspace.workspaceFolders?.[0];if(!e)return void i.window.showErrorMessage("è¯·å…ˆæ‰“å¼€TRQuantå·¥ä½œåŒº");const n=l.join(e.uri.fsPath,"extension","AShare-manual");if(d.logger.info(`æ‰‹å†Œè·¯å¾„: ${n}`,p),!c.existsSync(n))return i.window.showErrorMessage(`Aè‚¡æ‰‹å†Œç›®å½•ä¸å­˜åœ¨: ${n}`),void d.logger.error(`ç›®å½•ä¸å­˜åœ¨: ${n}`,p);if(!c.existsSync(l.join(n,"package.json")))return void i.window.showErrorMessage("Aè‚¡æ‰‹å†Œé…ç½®æ–‡ä»¶ç¼ºå¤±");if(!c.existsSync(l.join(n,"node_modules"))){if("å®‰è£…"===await i.window.showWarningMessage("Aè‚¡æ‰‹å†Œéœ€è¦å®‰è£…ä¾èµ–ï¼Œæ˜¯å¦å®‰è£…ï¼Ÿ","å®‰è£…","å–æ¶ˆ")){const e=i.window.createTerminal({name:"Aè‚¡æ‰‹å†Œä¾èµ–å®‰è£…",cwd:n});e.show(),e.sendText('npm install && echo "ä¾èµ–å®‰è£…å®Œæˆï¼Œè¯·é‡æ–°ç‚¹å‡»Aè‚¡å®æ“æ‰‹å†Œ"')}return}const t=i.window.terminals.find(e=>"Aè‚¡æ‰‹å†ŒæœåŠ¡"===e.name);if(t)return d.logger.info("å‘ç°å·²å­˜åœ¨çš„æ‰‹å†ŒæœåŠ¡ç»ˆç«¯",p),t.show(),i.window.showInformationMessage("æ­£åœ¨æ‰“å¼€Aè‚¡æ‰‹å†Œ..."),void setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:4321"))},500);d.logger.info("åˆ›å»ºæ–°ç»ˆç«¯å¯åŠ¨AstroæœåŠ¡",p);const a=i.window.createTerminal({name:"Aè‚¡æ‰‹å†ŒæœåŠ¡",cwd:n,env:{...process.env}});a.show(),a.sendText("npm run dev"),i.window.showInformationMessage("ğŸ“š æ­£åœ¨å¯åŠ¨Aè‚¡æ‰‹å†ŒæœåŠ¡å™¨..."),setTimeout(()=>{d.logger.info("å°è¯•æ‰“å¼€æµè§ˆå™¨",p),i.env.openExternal(i.Uri.parse("http://localhost:4321")),i.window.showInformationMessage("âœ… Aè‚¡é«˜å€è‚¡å®æ“æ‰‹å†Œå·²å¯åŠ¨")},3e3)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`å¯åŠ¨å¤±è´¥: ${n}`,p),i.window.showErrorMessage(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${n}`)}}async launchFileDashboard(){d.logger.info("=== å¯åŠ¨Extension Dashboard ===",p);try{const e=i.workspace.workspaceFolders?.[0];if(!e)return void i.window.showErrorMessage("è¯·å…ˆæ‰“å¼€å·¥ä½œåŒº");const n=i.window.terminals.find(e=>"TRQuant Dashboard"===e.name);if(n)return d.logger.info("DashboardæœåŠ¡å·²åœ¨è¿è¡Œ",p),n.show(),i.window.showInformationMessage("ğŸ“ æ­£åœ¨æ‰“å¼€æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ..."),void setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:5000"))},500);const t=l.join(e.uri.fsPath,"extension"),a=l.join(t,"start_dashboard.py");if(!c.existsSync(a))return void i.window.showErrorMessage(`Dashboardå¯åŠ¨è„šæœ¬ä¸å­˜åœ¨: ${a}`);d.logger.info(`Dashboardè„šæœ¬: ${a}`,p);const r=i.window.createTerminal({name:"TRQuant Dashboard",cwd:t});r.show();const o="win32"===process.platform,s=o?l.join(t,"venv","Scripts","activate.bat"):l.join(t,"venv","bin","activate"),g=o?l.join(e.uri.fsPath,"venv","Scripts","activate.bat"):l.join(e.uri.fsPath,"venv","bin","activate");let u="";c.existsSync(s)?(u=o?`"${s}" && python start_dashboard.py`:`source "${s}" && python start_dashboard.py`,d.logger.info("ä½¿ç”¨extension venv",p)):c.existsSync(g)?(u=o?`"${g}" && python start_dashboard.py`:`source "${g}" && python start_dashboard.py`,d.logger.info("ä½¿ç”¨å·¥ä½œåŒºæ ¹ç›®å½•venv",p)):(u=(o?"python":"python3")+" start_dashboard.py",d.logger.info("ä½¿ç”¨ç³»ç»ŸPython",p)),r.sendText(u),i.window.showInformationMessage("ğŸ“ æ­£åœ¨å¯åŠ¨Extension Dashboard..."),setTimeout(()=>{i.env.openExternal(i.Uri.parse("http://localhost:5000")),i.window.showInformationMessage("âœ… Extension Dashboardå·²å¯åŠ¨ - http://localhost:5000")},3e3)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`å¯åŠ¨Dashboardå¤±è´¥: ${n}`,p),i.window.showErrorMessage(`å¯åŠ¨æ–‡ä»¶ç®¡ç†ç³»ç»Ÿå¤±è´¥: ${n}`)}}async generateInvestmentReport(){d.logger.info("ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...",p);try{i.window.showInformationMessage("ğŸ“Š æ­£åœ¨ç”ŸæˆæŠ•èµ„æŠ¥å‘Š...");const e=await this._client.callBridge("generate_investment_report",{type:"full"});if(e.ok&&e.data){const n=e.data,t=n.path||n.file||"";i.window.showInformationMessage(`âœ… æŠ¥å‘Šå·²ç”Ÿæˆ: ${l.basename(t)}`,"æ‰“å¼€æŠ¥å‘Š").then(e=>{if("æ‰“å¼€æŠ¥å‘Š"===e){const e=i.workspace.workspaceFolders?.[0];if(e&&t){const n=l.join(e.uri.fsPath,t);i.env.openExternal(i.Uri.file(n))}}})}else i.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${e.error||"æœªçŸ¥é”™è¯¯"}`)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${n}`,p),i.window.showErrorMessage(`ç”ŸæˆæŠ¥å‘Šå¤±è´¥: ${n}`)}}async syncFileChanges(){d.logger.info("åŒæ­¥æ–‡ä»¶å˜åŒ–...",p);try{const e=await this._client.callBridge("sync_file_changes",{});if(e.ok&&e.data){const n=e.data,t=n.total_count||0,a=n.recent_files||[];if(t>0){const e=a.slice(0,3).map(e=>e.name).join(", ");i.window.showInformationMessage(`ğŸ”„ æ£€æµ‹åˆ° ${t} ä¸ªæ›´æ–°æ–‡ä»¶: ${e}${t>3?"...":""}`)}else i.window.showInformationMessage("âœ… æ–‡ä»¶å·²æ˜¯æœ€æ–°çŠ¶æ€")}}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`åŒæ­¥å¤±è´¥: ${n}`,p)}}async exportDatabase(){d.logger.info("å¯¼å‡ºæ•°æ®åº“...",p);try{i.window.showInformationMessage("ğŸ—„ï¸ æ­£åœ¨å¯¼å‡ºæ•°æ®åº“...");const e=await this._client.callBridge("export_database",{});if(e.ok&&e.data){const n=e.data;i.window.showInformationMessage(`âœ… æ•°æ®åº“å·²å¯¼å‡º: ${n.collections||0}ä¸ªé›†åˆ, ${n.total_docs||0}æ¡è®°å½•`,"æ‰“å¼€æ–‡ä»¶").then(e=>{if("æ‰“å¼€æ–‡ä»¶"===e){const e=i.workspace.workspaceFolders?.[0];e&&n.file&&i.env.openExternal(i.Uri.file(n.file))}})}else i.window.showErrorMessage(`å¯¼å‡ºå¤±è´¥: ${e.error||"è¯·ç¡®ä¿MongoDBå·²å¯åŠ¨"}`)}catch(e){const n=e instanceof Error?e.message:String(e);d.logger.error(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${n}`,p),i.window.showErrorMessage(`å¯¼å‡ºæ•°æ®åº“å¤±è´¥: ${n}`)}}async openFile(e){if(!e)return;const n=i.workspace.workspaceFolders?.[0];if(!n)return;const t=l.join(n.uri.fsPath,e),a=l.extname(e).toLowerCase();if([".py",".json",".yaml",".yml",".md",".txt"].includes(a)){const e=await i.workspace.openTextDocument(t);await i.window.showTextDocument(e)}else i.env.openExternal(i.Uri.file(t))}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){return'<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</title>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --bg-hover: #262c36;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-purple: #a371f7;\n            --accent-red: #f85149;\n            --accent-orange: #f0883e;\n            --border-color: #30363d;\n            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            --gradient-gold: linear-gradient(135deg, #f0b429 0%, #e85d04 100%);\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: \'SF Pro Display\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            min-height: 100vh;\n            overflow-x: hidden;\n        }\n        \n        /* é¡¶éƒ¨æ ‡é¢˜æ  */\n        .header {\n            background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);\n            padding: 24px 32px;\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .logo {\n            width: 48px;\n            height: 48px;\n            background: var(--gradient-gold);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            font-weight: bold;\n            color: #fff;\n            box-shadow: 0 4px 12px rgba(240, 180, 41, 0.3);\n        }\n        \n        .header-title h1 {\n            font-size: 24px;\n            font-weight: 700;\n            background: linear-gradient(90deg, var(--accent-gold), #fff);\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            letter-spacing: 1px;\n        }\n        \n        .header-title .subtitle {\n            font-size: 13px;\n            color: var(--text-muted);\n            margin-top: 4px;\n        }\n        \n        .header-right {\n            display: flex;\n            gap: 12px;\n        }\n        \n        .header-btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 13px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .header-btn:hover {\n            background: var(--bg-hover);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .header-btn.primary {\n            background: var(--gradient-primary);\n            border: none;\n            color: #fff;\n        }\n        \n        .header-btn.primary:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        }\n        \n        /* ä¸»å®¹å™¨ */\n        .main-container {\n            padding: 24px 32px;\n            max-width: 1600px;\n            margin: 0 auto;\n        }\n        \n        /* å¸‚åœºçŠ¶æ€å¡ç‰‡ */\n        .market-section {\n            margin-bottom: 24px;\n        }\n        \n        .market-grid {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 16px;\n        }\n        \n        .market-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n            transition: all 0.2s;\n        }\n        \n        .market-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .market-card.regime {\n            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));\n            border-color: var(--accent-green);\n        }\n        \n        .market-card .label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n        }\n        \n        .market-card .value {\n            font-size: 24px;\n            font-weight: 700;\n        }\n        \n        .market-card .change {\n            font-size: 14px;\n            margin-top: 4px;\n        }\n        \n        .market-card .change.up { color: var(--accent-red); }\n        .market-card .change.down { color: var(--accent-green); }\n        \n        .market-card.regime .value {\n            color: var(--accent-green);\n        }\n        \n        /* åŒæ å¸ƒå±€ */\n        .content-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n            margin-bottom: 24px;\n        }\n        \n        .card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            overflow: hidden;\n        }\n        \n        .card-header {\n            padding: 16px 20px;\n            background: rgba(0, 0, 0, 0.2);\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .card-header h3 {\n            font-size: 15px;\n            font-weight: 600;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n        \n        .card-header .actions {\n            display: flex;\n            gap: 8px;\n        }\n        \n        .card-header .btn-small {\n            padding: 6px 12px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            color: var(--text-secondary);\n            font-size: 12px;\n            cursor: pointer;\n        }\n        \n        .card-header .btn-small:hover {\n            background: var(--accent-blue);\n            border-color: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .card-body {\n            padding: 20px;\n        }\n        \n        /* æŠ•èµ„ä¸»çº¿åˆ—è¡¨ */\n        .mainline-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .mainline-item {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            transition: all 0.2s;\n            cursor: pointer;\n        }\n        \n        .mainline-item:hover {\n            background: var(--bg-hover);\n            transform: translateX(4px);\n        }\n        \n        .mainline-rank {\n            width: 28px;\n            height: 28px;\n            background: var(--gradient-gold);\n            border-radius: 6px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n            font-weight: 700;\n            color: #fff;\n        }\n        \n        .mainline-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }\n        .mainline-rank.bronze { background: linear-gradient(135deg, #d97706, #92400e); }\n        \n        .mainline-info {\n            flex: 1;\n        }\n        \n        .mainline-name {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .mainline-industries {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .mainline-score {\n            font-size: 20px;\n            font-weight: 700;\n            color: var(--accent-gold);\n        }\n        \n        /* å› å­åˆ—è¡¨ */\n        .factor-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .factor-item {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            padding: 14px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n        }\n        \n        .factor-icon {\n            width: 36px;\n            height: 36px;\n            background: var(--gradient-primary);\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 16px;\n        }\n        \n        .factor-info {\n            flex: 1;\n        }\n        \n        .factor-name {\n            font-size: 14px;\n            font-weight: 600;\n            margin-bottom: 2px;\n        }\n        \n        .factor-category {\n            font-size: 11px;\n            color: var(--text-muted);\n        }\n        \n        .factor-weight {\n            font-size: 16px;\n            font-weight: 700;\n            color: var(--accent-purple);\n        }\n        \n        /* 8æ­¥éª¤å·¥ä½œæµ */\n        .workflow-section {\n            margin-bottom: 24px;\n        }\n        \n        .section-title {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-muted);\n            text-transform: uppercase;\n            letter-spacing: 2px;\n            margin-bottom: 16px;\n            padding-left: 4px;\n        }\n        \n        .section-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 16px;\n        }\n        \n        .run-all-btn {\n            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.3s;\n        }\n        .run-all-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .workflow-container {\n            display: flex;\n            gap: 20px;\n        }\n        \n        .workflow-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 12px;\n            flex: 1;\n        }\n        \n        .workflow-step {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px 12px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s;\n            position: relative;\n        }\n        \n        .workflow-step::after {\n            display: none;\n        }\n        \n        .workflow-step:last-child::after {\n            display: none;\n        }\n        \n        .workflow-step:hover {\n            transform: translateY(-4px);\n            border-color: var(--accent-blue);\n            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.15);\n        }\n        \n        .workflow-step.active {\n            background: linear-gradient(135deg, rgba(88, 166, 255, 0.15), rgba(163, 113, 247, 0.15));\n            border-color: var(--accent-blue);\n        }\n        \n        .step-number {\n            width: 24px;\n            height: 24px;\n            background: var(--bg-card);\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 11px;\n            font-weight: 600;\n            color: var(--text-muted);\n            margin: 0 auto 12px;\n        }\n        \n        .workflow-step:hover .step-number {\n            background: var(--accent-blue);\n            color: #fff;\n        }\n        \n        .step-icon {\n            font-size: 28px;\n            margin-bottom: 10px;\n        }\n        \n        .step-name {\n            font-size: 13px;\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .workflow-step:hover .step-name {\n            color: var(--text-primary);\n        }\n        \n        .step-status {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            font-size: 14px;\n        }\n        \n        .workflow-step.running {\n            border-color: #f59e0b;\n            animation: pulse 1.5s infinite;\n        }\n        \n        .workflow-step.completed {\n            border-color: #10b981;\n        }\n        \n        .workflow-step.failed {\n            border-color: #ef4444;\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }\n        }\n        \n        /* ç»“æœé¢æ¿ */\n        .result-panel {\n            flex: 1;\n            min-width: 400px;\n            max-width: 500px;\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 16px;\n            display: none;\n        }\n        \n        .result-panel.visible {\n            display: block;\n        }\n        \n        .result-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n        \n        .result-title {\n            font-size: 16px;\n            font-weight: 600;\n            color: var(--text-primary);\n        }\n        \n        .close-btn {\n            background: transparent;\n            border: none;\n            color: var(--text-muted);\n            cursor: pointer;\n            font-size: 16px;\n            padding: 4px 8px;\n            border-radius: 4px;\n        }\n        .close-btn:hover {\n            background: var(--bg-hover);\n            color: var(--text-primary);\n        }\n        \n        .result-summary {\n            background: var(--bg-card);\n            padding: 12px;\n            border-radius: 8px;\n            color: var(--text-secondary);\n            font-size: 14px;\n            margin-bottom: 12px;\n        }\n        \n        .result-progress {\n            margin-bottom: 12px;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-card);\n            border-radius: 3px;\n            overflow: hidden;\n            margin-bottom: 8px;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n        \n        .progress-text {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .result-details {\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n            max-height: 300px;\n            overflow-y: auto;\n            font-size: 13px;\n            margin-bottom: 12px;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th, .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-secondary);\n            font-weight: 600;\n            color: var(--text-secondary);\n        }\n        \n        .result-files {\n            max-height: 100px;\n            overflow-y: auto;\n        }\n        \n        .file-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px;\n            background: var(--bg-card);\n            border-radius: 6px;\n            margin-bottom: 4px;\n            cursor: pointer;\n            font-size: 12px;\n        }\n        .file-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        /* å¿«æ·æ“ä½œåŒº */\n        .quick-section {\n            margin-bottom: 24px;\n        }\n        \n        .quick-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 16px;\n        }\n        \n        .quick-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 24px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n        \n        .quick-card:hover {\n            transform: translateY(-2px);\n            border-color: var(--accent-blue);\n        }\n        \n        .quick-card.highlight {\n            background: linear-gradient(135deg, rgba(240, 180, 41, 0.1), rgba(232, 93, 4, 0.1));\n            border-color: var(--accent-gold);\n        }\n        \n        .quick-icon {\n            width: 48px;\n            height: 48px;\n            background: var(--bg-card);\n            border-radius: 12px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n        }\n        \n        .quick-card.highlight .quick-icon {\n            background: var(--gradient-gold);\n        }\n        \n        .quick-info h4 {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n        \n        .quick-info p {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        /* åº•éƒ¨åŒæ  */\n        .bottom-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 24px;\n        }\n        \n        .project-list, .backtest-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .project-item, .backtest-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            background: var(--bg-card);\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n        \n        .project-item:hover, .backtest-item:hover {\n            background: var(--bg-hover);\n        }\n        \n        .item-name {\n            font-size: 14px;\n            font-weight: 500;\n        }\n        \n        .item-date {\n            font-size: 12px;\n            color: var(--text-muted);\n        }\n        \n        .item-return {\n            font-size: 14px;\n            font-weight: 600;\n        }\n        \n        .item-return.positive { color: var(--accent-red); }\n        .item-return.negative { color: var(--accent-green); }\n        \n        /* åŠ è½½çŠ¶æ€ */\n        .loading-overlay {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(10, 14, 20, 0.8);\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n        \n        .loading-overlay.active {\n            display: flex;\n        }\n        \n        .loading-spinner {\n            width: 48px;\n            height: 48px;\n            border: 3px solid var(--border-color);\n            border-top-color: var(--accent-gold);\n            border-radius: 50%;\n            animation: spin 1s linear infinite;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n        \n        /* ç©ºçŠ¶æ€ */\n        .empty-state {\n            text-align: center;\n            padding: 32px;\n            color: var(--text-muted);\n        }\n        \n        .empty-state .icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        /* å“åº”å¼ */\n        @media (max-width: 1400px) {\n            .workflow-grid {\n                grid-template-columns: repeat(4, 1fr);\n            }\n            .workflow-step::after {\n                display: none;\n            }\n        }\n        \n        @media (max-width: 1000px) {\n            .content-grid, .bottom-grid {\n                grid-template-columns: 1fr;\n            }\n            .market-grid {\n                grid-template-columns: repeat(3, 1fr);\n            }\n            .quick-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n        }\n    </style>\n</head>\n<body>\n    \x3c!-- é¡¶éƒ¨æ ‡é¢˜æ  --\x3e\n    <div class="header">\n        <div class="header-left">\n            <div class="logo">TR</div>\n            <div class="header-title">\n                <h1>éŸ¬ç¿é‡åŒ–å·¥ä½œå°</h1>\n                <div class="subtitle">TRQuant Professional - Aè‚¡å®Œæ•´æŠ•èµ„æµç¨‹ç³»ç»Ÿ</div>\n            </div>\n        </div>\n        <div class="header-right">\n            <button class="header-btn" onclick="vscode.postMessage({command: \'refreshAll\'})">\n                ğŸ”„ åˆ·æ–°æ•°æ®\n            </button>\n            <button class="header-btn" onclick="vscode.postMessage({command: \'openSettings\'})">\n                âš™ï¸ è®¾ç½®\n            </button>\n            <button class="header-btn primary" onclick="openWorkflowPanel()">\n                ğŸ–¥ï¸ æ‰“å¼€æ¡Œé¢ç³»ç»Ÿ\n            </button>\n        </div>\n    </div>\n    \n    <div class="main-container">\n        \x3c!-- å¿«æ·æ“ä½œï¼ˆç½®é¡¶ï¼‰ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="console.log(\'ç‚¹å‡»æ–°å»ºé¡¹ç›®\'); vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>ä¸€é”®ç”Ÿæˆä¸­å›½é£ç­–ç•¥</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“‚</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç³»ç»Ÿ</h4>\n                        <p>ç­–ç•¥/æŠ¥å‘Š/æ•°æ®ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="openWorkflowPanel()">\n                    <div class="quick-icon">ğŸ–¥ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ¡Œé¢ç³»ç»Ÿ</h4>\n                        <p>æŸ¥çœ‹å®Œæ•´æŠ•èµ„æµç¨‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'runBacktest\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œå›æµ‹</h4>\n                        <p>é…ç½®å¹¶æ‰§è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'launchAShareManual\'})">\n                    <div class="quick-icon">ğŸ“š</div>\n                    <div class="quick-info">\n                        <h4>å®æ“æ‰‹å†Œ</h4>\n                        <p>Aè‚¡æŠ•èµ„æŒ‡å—</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ¥å‘Š</h4>\n                        <p>AIæŠ•èµ„åˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        \x3c!-- å¸‚åœºçŠ¶æ€ --\x3e\n        <div class="market-section">\n            <div class="market-grid" id="marketGrid">\n                <div class="market-card regime">\n                    <div class="label">å¸‚åœºçŠ¶æ€</div>\n                    <div class="value" id="marketRegime">åŠ è½½ä¸­...</div>\n                    <div class="change" id="marketStyle">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">ä¸Šè¯æŒ‡æ•°</div>\n                    <div class="value" id="shIndex">-</div>\n                    <div class="change" id="shChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">æ·±è¯æˆæŒ‡</div>\n                    <div class="value" id="szIndex">-</div>\n                    <div class="change" id="szChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åˆ›ä¸šæ¿æŒ‡</div>\n                    <div class="value" id="cyIndex">-</div>\n                    <div class="change" id="cyChange">-</div>\n                </div>\n                <div class="market-card">\n                    <div class="label">åŒ—å‘èµ„é‡‘</div>\n                    <div class="value" id="northFlow">-</div>\n                    <div class="change" id="northChange">-</div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æŠ•èµ„ä¸»çº¿ & æ¨èå› å­ --\x3e\n        <div class="content-grid">\n            \x3c!-- æŠ•èµ„ä¸»çº¿ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ”¥ å½“å‰æŠ•èµ„ä¸»çº¿ TOP5</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshMainlines\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 3})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="mainline-list" id="mainlineList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ”¥</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–æŠ•èµ„ä¸»çº¿</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- æ¨èå› å­ --\x3e\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æ™ºèƒ½æ¨èå› å­</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'refreshFactors\'})">åˆ·æ–°</button>\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'generateStrategy\'})">ç”Ÿæˆç­–ç•¥</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="factor-list" id="factorList">\n                        <div class="empty-state">\n                            <div class="icon">ğŸ“Š</div>\n                            <div>ç‚¹å‡»åˆ·æ–°è·å–å› å­æ¨è</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- 8æ­¥éª¤å·¥ä½œæµ --\x3e\n        <div class="workflow-section">\n            <div class="section-header">\n                <div class="section-title">ğŸ“‹ 8æ­¥éª¤æŠ•èµ„å·¥ä½œæµ</div>\n                <button class="run-all-btn" onclick="vscode.postMessage({command: \'runFullWorkflow\'})">\n                    â–¶ï¸ ä¸€é”®æ‰§è¡Œå…¨éƒ¨\n                </button>\n            </div>\n            <div class="workflow-container">\n                <div class="workflow-grid">\n                    <div class="workflow-step" id="step-1" onclick="runStep(1)">\n                        <div class="step-number">1</div>\n                        <div class="step-icon">ğŸ“¡</div>\n                        <div class="step-name">ä¿¡æ¯è·å–</div>\n                        <div class="step-status" id="status-1">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-2" onclick="runStep(2)">\n                        <div class="step-number">2</div>\n                        <div class="step-icon">ğŸ“ˆ</div>\n                        <div class="step-name">å¸‚åœºè¶‹åŠ¿</div>\n                        <div class="step-status" id="status-2">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-3" onclick="runStep(3)">\n                        <div class="step-number">3</div>\n                        <div class="step-icon">ğŸ”¥</div>\n                        <div class="step-name">æŠ•èµ„ä¸»çº¿</div>\n                        <div class="step-status" id="status-3">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-4" onclick="runStep(4)">\n                        <div class="step-number">4</div>\n                        <div class="step-icon">ğŸ“¦</div>\n                        <div class="step-name">å€™é€‰æ± </div>\n                        <div class="step-status" id="status-4">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-5" onclick="runStep(5)">\n                        <div class="step-number">5</div>\n                        <div class="step-icon">ğŸ“Š</div>\n                        <div class="step-name">å› å­æ„å»º</div>\n                        <div class="step-status" id="status-5">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-6" onclick="runStep(6)">\n                        <div class="step-number">6</div>\n                        <div class="step-icon">ğŸ› ï¸</div>\n                        <div class="step-name">ç­–ç•¥å¼€å‘</div>\n                        <div class="step-status" id="status-6">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-7" onclick="runStep(7)">\n                        <div class="step-number">7</div>\n                        <div class="step-icon">ğŸ”„</div>\n                        <div class="step-name">å›æµ‹éªŒè¯</div>\n                        <div class="step-status" id="status-7">â–¶ï¸</div>\n                    </div>\n                    <div class="workflow-step" id="step-8" onclick="runStep(8)">\n                        <div class="step-number">8</div>\n                        <div class="step-icon">ğŸš€</div>\n                        <div class="step-name">å®ç›˜äº¤æ˜“</div>\n                        <div class="step-status" id="status-8">â–¶ï¸</div>\n                    </div>\n                </div>\n                \n                \x3c!-- æ‰§è¡Œç»“æœåŒºåŸŸ --\x3e\n                <div class="result-panel" id="result-panel">\n                    <div class="result-header">\n                        <span class="result-title" id="result-title">ğŸ“‹ æ‰§è¡Œç»“æœ</span>\n                        <button class="close-btn" onclick="hideResultPanel()">âœ•</button>\n                    </div>\n                    <div class="result-summary" id="result-summary">\n                        ç‚¹å‡»å·¦ä¾§æ­¥éª¤å¼€å§‹æ‰§è¡Œ...\n                    </div>\n                    <div class="result-progress" id="result-progress" style="display:none;">\n                        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>\n                        <span class="progress-text" id="progress-text">æ‰§è¡Œä¸­...</span>\n                    </div>\n                    <div class="result-details" id="result-details"></div>\n                    <div class="result-files" id="result-files"></div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- å¿«æ·æ“ä½œ --\x3e\n        <div class="quick-section">\n            <div class="section-title">âš¡ å¿«æ·æ“ä½œ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'openBacktestConfig\'})">\n                    <div class="quick-icon">ğŸ§ª</div>\n                    <div class="quick-info">\n                        <h4>å›æµ‹é…ç½®</h4>\n                        <p>é…ç½®å¹¶è¿è¡Œç­–ç•¥å›æµ‹</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'createProject\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–°å»ºé¡¹ç›®</h4>\n                        <p>åˆ›å»ºæ–°çš„é‡åŒ–é¡¹ç›®</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateStrategy\'})">\n                    <div class="quick-icon">ğŸ¤–</div>\n                    <div class="quick-info">\n                        <h4>AIç”Ÿæˆç­–ç•¥</h4>\n                        <p>æ™ºèƒ½ç”ŸæˆPTradeä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'optimizeStrategy\'})">\n                    <div class="quick-icon">ğŸ”</div>\n                    <div class="quick-info">\n                        <h4>ç­–ç•¥ä¼˜åŒ–</h4>\n                        <p>åˆ†æå¹¶ä¼˜åŒ–ç­–ç•¥ä»£ç </p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>æŸ¥çœ‹æ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- ç³»ç»Ÿç®¡ç† --\x3e\n        <div class="quick-section">\n            <div class="section-title">ğŸ”§ ç³»ç»Ÿç®¡ç†ä¸æ–‡ä»¶ä¸­å¿ƒ</div>\n            <div class="quick-grid">\n                <div class="quick-card highlight" onclick="vscode.postMessage({command: \'launchFileDashboard\'})">\n                    <div class="quick-icon">ğŸ“</div>\n                    <div class="quick-info">\n                        <h4>æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ</h4>\n                        <p>Webä»ªè¡¨ç›˜(ç­–ç•¥/æŠ¥å‘Š/æ•°æ®åº“)</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'generateInvestmentReport\'})">\n                    <div class="quick-icon">ğŸ“Š</div>\n                    <div class="quick-info">\n                        <h4>ç”ŸæˆæŠ•èµ„æŠ¥å‘Š</h4>\n                        <p>AIç»¼åˆåˆ†ææŠ¥å‘Š</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'syncFileChanges\'})">\n                    <div class="quick-icon">ğŸ”„</div>\n                    <div class="quick-info">\n                        <h4>æ™ºèƒ½åŒæ­¥</h4>\n                        <p>æ£€æµ‹æ›´æ–°çš„æ–‡ä»¶</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'exportDatabase\'})">\n                    <div class="quick-icon">ğŸ—„ï¸</div>\n                    <div class="quick-info">\n                        <h4>æ•°æ®åº“ç®¡ç†</h4>\n                        <p>å¯¼å‡º/å¤‡ä»½MongoDB</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'openSettings\'})">\n                    <div class="quick-icon">âš™ï¸</div>\n                    <div class="quick-info">\n                        <h4>ç³»ç»Ÿè®¾ç½®</h4>\n                        <p>é…ç½®å‚æ•°ç®¡ç†</p>\n                    </div>\n                </div>\n                <div class="quick-card" onclick="vscode.postMessage({command: \'showLogs\'})">\n                    <div class="quick-icon">ğŸ“‹</div>\n                    <div class="quick-info">\n                        <h4>è¿è¡Œæ—¥å¿—</h4>\n                        <p>ç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- æœ€è¿‘é¡¹ç›® & å›æµ‹ --\x3e\n        <div class="bottom-grid">\n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“ æœ€è¿‘é¡¹ç›®</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openProject\'})">æ‰“å¼€é¡¹ç›®</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="project-list" id="projectList">\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‰ ç¿æ™ºé‡‘é¾™</div>\n                                <div class="item-date">2024-12-03</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ¦… çµåŠ¨ç¢§é¹¤</div>\n                                <div class="item-date">2024-12-02</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                        <div class="project-item">\n                            <div>\n                                <div class="item-name">ğŸ‹ é£˜é€¸ç´«ç«¹</div>\n                                <div class="item-date">2024-12-01</div>\n                            </div>\n                            <span style="color: var(--text-muted)">â†’</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class="card">\n                <div class="card-header">\n                    <h3>ğŸ“Š æœ€è¿‘å›æµ‹</h3>\n                    <div class="actions">\n                        <button class="btn-small" onclick="vscode.postMessage({command: \'openStep\', step: 7})">æŸ¥çœ‹å…¨éƒ¨</button>\n                    </div>\n                </div>\n                <div class="card-body">\n                    <div class="backtest-list" id="backtestList">\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">test1 åŠ¨é‡æˆé•¿ç­–ç•¥</div>\n                                <div class="item-date">2024-12-03 15:30</div>\n                            </div>\n                            <div class="item-return positive">+15.2%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">momentum ç­–ç•¥</div>\n                                <div class="item-date">2024-12-02 10:15</div>\n                            </div>\n                            <div class="item-return positive">+8.5%</div>\n                        </div>\n                        <div class="backtest-item">\n                            <div>\n                                <div class="item-name">multi_factor å¤šå› å­</div>\n                                <div class="item-date">2024-12-01 14:20</div>\n                            </div>\n                            <div class="item-return negative">-2.1%</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    \x3c!-- åŠ è½½é®ç½© --\x3e\n    <div class="loading-overlay" id="loadingOverlay">\n        <div class="loading-spinner"></div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        // æ‰“å¼€æ¡Œé¢ç³»ç»Ÿï¼ˆå®Œæ•´å·¥ä½œæµï¼‰\n        function openWorkflowPanel() {\n            console.log(\'[MainDashboard HTML] ç‚¹å‡»æ‰“å¼€æ¡Œé¢ç³»ç»ŸæŒ‰é’®\');\n            try {\n                vscode.postMessage({command: \'openWorkflowPanel\'});\n                console.log(\'[MainDashboard HTML] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿæ¶ˆæ¯å·²å‘é€\');\n            } catch (error) {\n                console.error(\'[MainDashboard HTML] å‘é€æ¶ˆæ¯å¤±è´¥:\', error);\n            }\n        }\n        \n        // æ›´æ–°å¸‚åœºçŠ¶æ€\n        function updateMarketStatus(data) {\n            if (!data) return;\n            \n            // å¸‚åœºRegime\n            document.getElementById(\'marketRegime\').textContent = data.regime_cn || data.regime || \'ä¸­æ€§\';\n            document.getElementById(\'marketStyle\').textContent = data.style_rotation || \'å‡è¡¡\';\n            \n            // æŒ‡æ•°æ•°æ®\n            if (data.indices && data.indices.length >= 3) {\n                const [sh, sz, cy] = data.indices;\n                \n                document.getElementById(\'shIndex\').textContent = sh.value?.toFixed(2) || \'-\';\n                document.getElementById(\'shChange\').textContent = (sh.change >= 0 ? \'+\' : \'\') + (sh.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'shChange\').className = \'change \' + (sh.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'szIndex\').textContent = sz.value?.toFixed(2) || \'-\';\n                document.getElementById(\'szChange\').textContent = (sz.change >= 0 ? \'+\' : \'\') + (sz.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'szChange\').className = \'change \' + (sz.change >= 0 ? \'up\' : \'down\');\n                \n                document.getElementById(\'cyIndex\').textContent = cy.value?.toFixed(2) || \'-\';\n                document.getElementById(\'cyChange\').textContent = (cy.change >= 0 ? \'+\' : \'\') + (cy.change * 100)?.toFixed(2) + \'%\';\n                document.getElementById(\'cyChange\').className = \'change \' + (cy.change >= 0 ? \'up\' : \'down\');\n            }\n        }\n        \n        // æ›´æ–°æŠ•èµ„ä¸»çº¿\n        function updateMainlines(data) {\n            const container = document.getElementById(\'mainlineList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ”¥</div><div>æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div></div>\';\n                return;\n            }\n            \n            container.innerHTML = data.map((m, i) => {\n                const rankClass = i === 0 ? \'\' : i === 1 ? \'silver\' : i === 2 ? \'bronze\' : \'\';\n                return `\n                    <div class="mainline-item">\n                        <div class="mainline-rank ${rankClass}">${i + 1}</div>\n                        <div class="mainline-info">\n                            <div class="mainline-name">${m.name}</div>\n                            <div class="mainline-industries">${m.industries?.slice(0, 3).join(\' Â· \') || \'\'}</div>\n                        </div>\n                        <div class="mainline-score">â­${m.score}</div>\n                    </div>\n                `;\n            }).join(\'\');\n        }\n        \n        // æ›´æ–°å› å­\n        function updateFactors(data) {\n            const container = document.getElementById(\'factorList\');\n            if (!data || data.length === 0) {\n                container.innerHTML = \'<div class="empty-state"><div class="icon">ğŸ“Š</div><div>æš‚æ— å› å­æ¨è</div></div>\';\n                return;\n            }\n            \n            const icons = [\'ğŸ“ˆ\', \'ğŸ’¹\', \'ğŸ’°\', \'âš¡\', \'ğŸ¯\'];\n            container.innerHTML = data.map((f, i) => `\n                <div class="factor-item">\n                    <div class="factor-icon">${icons[i % icons.length]}</div>\n                    <div class="factor-info">\n                        <div class="factor-name">${f.name}</div>\n                        <div class="factor-category">${f.category || \'é‡åŒ–å› å­\'}</div>\n                    </div>\n                    <div class="factor-weight">${(f.weight * 100).toFixed(0)}%</div>\n                </div>\n            `).join(\'\');\n        }\n        \n        // =====================\n        // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n        // =====================\n        \n        function runStep(step) {\n            vscode.postMessage({command: \'openStep\', step: step});\n        }\n        \n        function showResultPanel() {\n            document.getElementById(\'result-panel\').classList.add(\'visible\');\n        }\n        \n        function hideResultPanel() {\n            document.getElementById(\'result-panel\').classList.remove(\'visible\');\n        }\n        \n        function setStepStatus(step, status) {\n            const stepEl = document.getElementById(\'step-\' + step);\n            const statusEl = document.getElementById(\'status-\' + step);\n            \n            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»\n            stepEl.classList.remove(\'running\', \'completed\', \'failed\');\n            \n            switch(status) {\n                case \'running\':\n                    stepEl.classList.add(\'running\');\n                    statusEl.textContent = \'â³\';\n                    break;\n                case \'completed\':\n                    stepEl.classList.add(\'completed\');\n                    statusEl.textContent = \'âœ…\';\n                    break;\n                case \'failed\':\n                    stepEl.classList.add(\'failed\');\n                    statusEl.textContent = \'âŒ\';\n                    break;\n                default:\n                    statusEl.textContent = \'â–¶ï¸\';\n            }\n        }\n        \n        function showProgress(show, value, text) {\n            const el = document.getElementById(\'result-progress\');\n            el.style.display = show ? \'block\' : \'none\';\n            if (show) {\n                document.getElementById(\'progress-fill\').style.width = value + \'%\';\n                document.getElementById(\'progress-text\').textContent = text || \'æ‰§è¡Œä¸­...\';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return \'<div style="color:var(--text-muted);">æ— è¯¦ç»†æ•°æ®</div>\';\n            }\n            \n            let html = \'\';\n            \n            // æŠ•èµ„ä¸»çº¿\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#f59e0b;">ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP\' + mainlines.length + \'</strong></div>\';\n                html += \'<table><tr><th>æ’å</th><th>åç§°</th><th>è¯„åˆ†</th></tr>\';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += \'<tr><td>#\' + (ml.rank || \'-\') + \'</td><td>\' + (ml.name || \'-\') + \'</td><td style="color:#10b981;">\' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || ml.composite_score || ml.score || \'-\') + \'</td></tr>\';\n                });\n                if (mainlines.length > 10) {\n                    html += \'<tr><td colspan="3" style="color:var(--text-muted);">... å…±\' + mainlines.length + \'ä¸ªä¸»çº¿</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å€™é€‰æ± è‚¡ç¥¨\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#8b5cf6;">ğŸ“¦ å€™é€‰æ± è‚¡ç¥¨ (\' + stocks.length + \'åª)</strong></div>\';\n                html += \'<table><tr><th>ä»£ç </th><th>åç§°</th><th>æ¥æº</th><th>è¯„åˆ†</th></tr>\';\n                stocks.slice(0, 15).forEach(s => {\n                    html += \'<tr><td>\' + (s.code || \'-\') + \'</td><td>\' + (s.name || \'-\') + \'</td><td style="color:var(--text-muted);">\' + (s.source || \'-\') + \'</td><td style="color:#10b981;">\' + ((s.score || 0).toFixed?.(1) || \'-\') + \'</td></tr>\';\n                });\n                html += \'</table>\';\n            }\n            \n            // æ¨èå› å­\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ§® æ¨èå› å­</strong></div>\';\n                html += \'<ul style="margin:0;padding-left:20px;">\';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += \'<li style="margin:6px 0;"><strong>\' + (f.name || \'-\') + \'</strong> (æƒé‡\' + weight + \'%) - \' + (f.reason || \'\') + \'</li>\';\n                });\n                html += \'</ul>\';\n            }\n            \n            // æ•°æ®æºæ£€æµ‹\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“¡ æ•°æ®æºçŠ¶æ€</strong></div>\';\n                html += \'<table><tr><th>æ•°æ®æº</th><th>çŠ¶æ€</th></tr>\';\n                if (details.jqdata !== undefined) {\n                    html += \'<tr><td>JQData</td><td style="color:\' + (details.jqdata ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.jqdata ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                if (details.akshare !== undefined) {\n                    html += \'<tr><td>AKShare</td><td style="color:\' + (details.akshare ? \'#10b981\' : \'#ef4444\') + \';">\' + (details.akshare ? \'âœ… å¯ç”¨\' : \'âŒ ä¸å¯ç”¨\') + \'</td></tr>\';\n                }\n                html += \'</table>\';\n            }\n            \n            // å¸‚åœºè¶‹åŠ¿\n            else if (details.regime || details.trend_strength !== undefined) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#6366f1;">ğŸ“ˆ å¸‚åœºè¶‹åŠ¿åˆ†æ</strong></div>\';\n                html += \'<table><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th></tr>\';\n                if (details.regime) html += \'<tr><td>å¸‚åœºRegime</td><td>\' + details.regime + \'</td></tr>\';\n                if (details.trend_strength !== undefined) html += \'<tr><td>è¶‹åŠ¿å¼ºåº¦</td><td>\' + details.trend_strength + \'</td></tr>\';\n                if (details.volatility !== undefined) html += \'<tr><td>æ³¢åŠ¨ç‡</td><td>\' + details.volatility + \'</td></tr>\';\n                if (details.style_rotation) html += \'<tr><td>é£æ ¼è½®åŠ¨</td><td>\' + details.style_rotation + \'</td></tr>\';\n                html += \'</table>\';\n            }\n            \n            // ç­–ç•¥æ–‡ä»¶\n            else if (details.strategy_file) {\n                html += \'<div style="margin-bottom:12px;"><strong style="color:#10b981;">ğŸ’» ç­–ç•¥ç”Ÿæˆå®Œæˆ</strong></div>\';\n                html += \'<div style="background:var(--bg-card);padding:12px;border-radius:8px;">\';\n                html += \'<div>ğŸ“„ ç­–ç•¥æ–‡ä»¶: <strong>\' + details.strategy_file.split(\'/\').pop() + \'</strong></div>\';\n                if (details.platform) html += \'<div>ğŸ¯ ç›®æ ‡å¹³å°: \' + details.platform + \'</div>\';\n                if (details.style) html += \'<div>ğŸ“Š ç­–ç•¥é£æ ¼: \' + details.style + \'</div>\';\n                html += \'</div>\';\n            }\n            \n            // é»˜è®¤JSONæ˜¾ç¤º\n            else {\n                html += \'<pre style="font-size:11px;overflow-x:auto;">\' + JSON.stringify(details, null, 2) + \'</pre>\';\n            }\n            \n            return html;\n        }\n        \n        // å¤„ç†æ¶ˆæ¯\n        window.addEventListener(\'message\', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case \'loadingStart\':\n                    document.getElementById(\'loadingOverlay\').classList.add(\'active\');\n                    break;\n                case \'loadingEnd\':\n                    document.getElementById(\'loadingOverlay\').classList.remove(\'active\');\n                    break;\n                case \'marketStatusUpdated\':\n                    updateMarketStatus(message.data);\n                    break;\n                case \'mainlinesUpdated\':\n                    updateMainlines(message.data);\n                    break;\n                case \'factorsUpdated\':\n                    updateFactors(message.data);\n                    break;\n                    \n                // å·¥ä½œæµæ­¥éª¤æ‰§è¡Œ\n                case \'stepStarted\':\n                    setStepStatus(message.step, \'running\');\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - æ‰§è¡Œä¸­\';\n                    document.getElementById(\'result-summary\').textContent = \'æ­£åœ¨æ‰§è¡Œ \' + message.stepName + \'...\';\n                    document.getElementById(\'result-details\').innerHTML = \'\';\n                    showProgress(true, 30, \'æ‰§è¡Œä¸­...\');\n                    break;\n                    \n                case \'stepResult\':\n                    setStepStatus(message.step, message.success ? \'completed\' : \'failed\');\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = \'ğŸ“‹ \' + message.stepName + \' - \' + (message.success ? \'âœ… å®Œæˆ\' : \'âŒ å¤±è´¥\');\n                    document.getElementById(\'result-summary\').textContent = message.summary || (message.success ? \'æ‰§è¡ŒæˆåŠŸ\' : \'æ‰§è¡Œå¤±è´¥\');\n                    document.getElementById(\'result-details\').innerHTML = formatDetails(message.details);\n                    break;\n                \n                // ä¸€é”®æ‰§è¡Œå…¨éƒ¨å·¥ä½œæµçš„æ¶ˆæ¯å¤„ç†\n                case \'workflowProgress\':\n                    var data = message.data;\n                    if (data.currentStep) {\n                        setStepStatus(data.currentStep, \'running\');\n                    }\n                    showResultPanel();\n                    document.getElementById(\'result-title\').textContent = \'ğŸ”„ æ‰§è¡Œå·¥ä½œæµ - \' + data.stepName;\n                    document.getElementById(\'result-summary\').textContent = \'è¿›åº¦: \' + Math.round(data.progress) + \'%\';\n                    showProgress(true, data.progress, data.stepName);\n                    break;\n                    \n                case \'workflowStepResult\':\n                    var stepData = message.data;\n                    if (stepData.stepId) {\n                        setStepStatus(stepData.stepId, stepData.success ? \'completed\' : \'failed\');\n                    }\n                    // ç´¯åŠ æ˜¾ç¤ºç»“æœ\n                    var detailsEl = document.getElementById(\'result-details\');\n                    var stepHtml = \'<div style="margin:8px 0;padding:8px;background:var(--bg-card);border-radius:6px;border-left:3px solid \' + \n                        (stepData.success ? \'#10b981\' : \'#ef4444\') + \';">\';\n                    stepHtml += \'<strong>\' + stepData.stepName + \'</strong>: \' + (stepData.success ? \'âœ…\' : \'âŒ\');\n                    stepHtml += \'</div>\';\n                    detailsEl.innerHTML += stepHtml;\n                    break;\n                    \n                case \'workflowComplete\':\n                    var completeData = message.data;\n                    showProgress(false);\n                    document.getElementById(\'result-title\').textContent = completeData.hasError ? \'âš ï¸ å·¥ä½œæµå®Œæˆï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰\' : \'âœ… å·¥ä½œæµæ‰§è¡Œå®Œæˆ\';\n                    document.getElementById(\'result-summary\').textContent = \'å…±æ‰§è¡Œ \' + completeData.results.length + \' ä¸ªæ­¥éª¤\';\n                    \n                    // æ˜¾ç¤ºæ±‡æ€»\n                    var summaryHtml = \'<div style="margin-top:16px;">\';\n                    summaryHtml += \'<h4 style="color:var(--accent-gold);margin-bottom:8px;">æ‰§è¡Œç»“æœæ±‡æ€»</h4>\';\n                    completeData.results.forEach(function(r) {\n                        summaryHtml += \'<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">\';\n                        summaryHtml += \'<span>\' + (r.success ? \'âœ…\' : \'âŒ\') + \'</span>\';\n                        summaryHtml += \'<span>\' + r.step + \'</span>\';\n                        if (r.error) {\n                            summaryHtml += \'<span style="color:#ef4444;font-size:11px;">(\' + r.error + \')</span>\';\n                        }\n                        summaryHtml += \'</div>\';\n                    });\n                    summaryHtml += \'</div>\';\n                    document.getElementById(\'result-details\').innerHTML += summaryHtml;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>'}dispose(){for(g.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}}n.MainDashboard=g},144:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.createManualLearner=n.ManualLearner=n.createStrategyLearner=n.StrategyLearner=n.getKnowledgeStore=n.KnowledgeStore=void 0;var a=t(683);Object.defineProperty(n,"KnowledgeStore",{enumerable:!0,get:function(){return a.KnowledgeStore}}),Object.defineProperty(n,"getKnowledgeStore",{enumerable:!0,get:function(){return a.getKnowledgeStore}});var r=t(46);Object.defineProperty(n,"StrategyLearner",{enumerable:!0,get:function(){return r.StrategyLearner}}),Object.defineProperty(n,"createStrategyLearner",{enumerable:!0,get:function(){return r.createStrategyLearner}});var o=t(767);Object.defineProperty(n,"ManualLearner",{enumerable:!0,get:function(){return o.ManualLearner}}),Object.defineProperty(n,"createManualLearner",{enumerable:!0,get:function(){return o.createManualLearner}})},150:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.StrategyAnalyzer=void 0,n.createStrategyAnalyzer=function(){return new c};const a=t(628),r="StrategyAnalyzer",o=[{pattern:/momentum|åŠ¨é‡|æ¶¨å¹…|æ”¶ç›Šç‡/gi,name:"åŠ¨é‡å› å­",type:"momentum"},{pattern:/rsi|ç›¸å¯¹å¼ºå¼±/gi,name:"RSI",type:"momentum"},{pattern:/macd/gi,name:"MACD",type:"momentum"},{pattern:/pe_ratio|å¸‚ç›ˆç‡|PE/gi,name:"å¸‚ç›ˆç‡",type:"value"},{pattern:/pb_ratio|å¸‚å‡€ç‡|PB/gi,name:"å¸‚å‡€ç‡",type:"value"},{pattern:/ps_ratio|å¸‚é”€ç‡/gi,name:"å¸‚é”€ç‡",type:"value"},{pattern:/roe|å‡€èµ„äº§æ”¶ç›Šç‡/gi,name:"ROE",type:"quality"},{pattern:/roa|èµ„äº§æ”¶ç›Šç‡/gi,name:"ROA",type:"quality"},{pattern:/gross_margin|æ¯›åˆ©ç‡/gi,name:"æ¯›åˆ©ç‡",type:"quality"},{pattern:/revenue_growth|è¥æ”¶å¢é•¿/gi,name:"è¥æ”¶å¢é•¿",type:"growth"},{pattern:/profit_growth|åˆ©æ¶¦å¢é•¿/gi,name:"åˆ©æ¶¦å¢é•¿",type:"growth"},{pattern:/eps_growth|EPSå¢é•¿/gi,name:"EPSå¢é•¿",type:"growth"},{pattern:/ma\d+|å‡çº¿|moving_average/gi,name:"å‡çº¿",type:"technical"},{pattern:/volatility|æ³¢åŠ¨ç‡/gi,name:"æ³¢åŠ¨ç‡",type:"technical"},{pattern:/volume|æˆäº¤é‡|æ¢æ‰‹ç‡/gi,name:"æˆäº¤é‡",type:"technical"}],s={stopLoss:/stop_loss|æ­¢æŸ|æ­¢æŸçº¿?\s*[=:]\s*([\d.]+)/gi,takeProfit:/take_profit|æ­¢ç›ˆ|æ­¢ç›ˆçº¿?\s*[=:]\s*([\d.]+)/gi,maxPosition:/max_position|æœ€å¤§ä»“ä½|æ€»ä»“ä½\s*[=:]\s*([\d.]+)/gi,singleStockMax:/single.*max|å•è‚¡.*ä»“ä½\s*[=:]\s*([\d.]+)/gi,drawdown:/drawdown|å›æ’¤|æœ€å¤§å›æ’¤/gi},i={ptrade:/PTrade|æ’ç”Ÿ|run_daily|run_weekly/i,qmt:/QMT|è¿…æŠ•|xtquant/i,joinquant:/èšå®½|jqdata|set_benchmark/i};class c{analyze(e,n){a.logger.info(`å¼€å§‹åˆ†æç­–ç•¥: ${n||"æœªå‘½å"}`,r);const t={name:this.extractName(e,n),platform:this.detectPlatform(e),factors:this.extractFactors(e),riskControl:this.extractRiskControl(e),stockSelection:this.extractStockSelection(e),trading:this.extractTradingInfo(e),issues:[]};return t.issues=this.detectIssues(t,e),a.logger.info(`ç­–ç•¥åˆ†æå®Œæˆ: ${t.factors.length}ä¸ªå› å­, ${t.issues.length}ä¸ªé—®é¢˜`,r),t}extractName(e,n){const t=e.match(/"""[\s\S]*?([^\n]+)[\s\S]*?"""/);return t?t[1].trim():n?n.replace(/\.(py|txt)$/,""):"æœªå‘½åç­–ç•¥"}detectPlatform(e){for(const[n,t]of Object.entries(i))if(t.test(e))return n;return"unknown"}extractFactors(e){const n=[],t=new Set;for(const{pattern:a,name:r,type:s}of o){const o=e.matchAll(a);for(const a of o)if(!t.has(r)){t.add(r);const o=e.lastIndexOf("\n",a.index)+1,i=e.indexOf("\n",a.index),c=e.slice(o,i>0?i:void 0).trim();n.push({name:r,type:s,code:c.slice(0,100)})}}return n}extractRiskControl(e){const n={hasDrawdownControl:s.drawdown.test(e)},t=e.match(/stop_loss\s*[=:]\s*([\d.]+)/i)||e.match(/æ­¢æŸ.*?([\d.]+)/);t&&(n.stopLoss=parseFloat(t[1]));const a=e.match(/take_profit\s*[=:]\s*([\d.]+)/i)||e.match(/æ­¢ç›ˆ.*?([\d.]+)/);a&&(n.takeProfit=parseFloat(a[1]));const r=e.match(/max_position\s*[=:]\s*([\d.]+)/i)||e.match(/æœ€å¤§ä»“ä½.*?([\d.]+)/);r&&(n.maxPosition=parseFloat(r[1]));const o=e.match(/single.*max\s*[=:]\s*([\d.]+)/i);return o&&(n.singleStockMax=parseFloat(o[1])),n}extractStockSelection(e){const n={universe:"æœªçŸ¥",filters:[]};/æ²ªæ·±300|000300/i.test(e)?n.universe="æ²ªæ·±300":/ä¸­è¯500|000905/i.test(e)?n.universe="ä¸­è¯500":/åˆ›ä¸šæ¿/i.test(e)?n.universe="åˆ›ä¸šæ¿":/å…¨å¸‚åœº|all_stocks/i.test(e)&&(n.universe="å…¨å¸‚åœº"),/ST/i.test(e)&&n.filters.push("æ’é™¤ST"),/åœç‰Œ|is_paused/i.test(e)&&n.filters.push("æ’é™¤åœç‰Œ"),/æ¶¨è·Œåœ|limit/i.test(e)&&n.filters.push("æ’é™¤æ¶¨è·Œåœ"),/å¸‚å€¼.*?äº¿|market_cap/i.test(e)&&n.filters.push("å¸‚å€¼ç­›é€‰");const t=e.match(/g\.stock_num\s*=\s*(\d+)/i)||e.match(/top.*?(\d+)/i);return t&&(n.topN=parseInt(t[1])),n}extractTradingInfo(e){const n={frequency:"daily",hasTimingLogic:!1};/run_monthly|æœˆåº¦/i.test(e)?n.frequency="monthly":/run_weekly|å‘¨åº¦|æ¯å‘¨/i.test(e)?n.frequency="weekly":/åˆ†é’Ÿ|intraday|minute/i.test(e)&&(n.frequency="intraday");const t=e.match(/rebalance_day\s*=\s*['"]?(\w+)['"]?/i);return t&&(n.rebalanceDay=t[1]),n.hasTimingLogic=/æ‹©æ—¶|timing|å¤§ç›˜.*åˆ¤æ–­|å¸‚åœº.*çŠ¶æ€/i.test(e),n}detectIssues(e,n){const t=[];return e.riskControl.stopLoss||t.push({type:"warning",category:"risk",message:"æœªè®¾ç½®æ­¢æŸçº¿",suggestion:"å»ºè®®è®¾ç½®8%-15%çš„æ­¢æŸçº¿æ§åˆ¶é£é™©"}),e.riskControl.maxPosition||t.push({type:"suggestion",category:"risk",message:"æœªæ˜ç¡®è®¾ç½®æœ€å¤§ä»“ä½",suggestion:"å»ºè®®è®¾ç½®æ€»ä»“ä½ä¸Šé™ï¼Œå¦‚80%"}),e.riskControl.stopLoss&&e.riskControl.stopLoss>.2&&t.push({type:"warning",category:"risk",message:`æ­¢æŸçº¿è¿‡å®½ (${(100*e.riskControl.stopLoss).toFixed(0)}%)`,suggestion:"å»ºè®®æ­¢æŸçº¿ä¸è¶…è¿‡15%"}),0===e.factors.length&&t.push({type:"warning",category:"factor",message:"æœªè¯†åˆ«åˆ°æ˜ç¡®çš„é€‰è‚¡å› å­",suggestion:"å»ºè®®ä½¿ç”¨é‡åŒ–å› å­ï¼ˆå¦‚åŠ¨é‡ã€ä»·å€¼ã€è´¨é‡ï¼‰è¿›è¡Œé€‰è‚¡"}),1===e.factors.length&&t.push({type:"suggestion",category:"factor",message:"ä»…ä½¿ç”¨å•ä¸€å› å­",suggestion:"å»ºè®®ç»„åˆå¤šä¸ªä½ç›¸å…³å› å­æé«˜ç¨³å®šæ€§"}),e.stockSelection.topN&&e.stockSelection.topN<5&&t.push({type:"warning",category:"risk",message:`æŒè‚¡æ•°é‡è¿‡å°‘ (${e.stockSelection.topN}åª)`,suggestion:"å»ºè®®æŒæœ‰5-20åªè‚¡ç¥¨åˆ†æ•£é£é™©"}),/def\s+initialize/i.test(n)||t.push({type:"error",category:"code",message:"ç¼ºå°‘initializeå‡½æ•°",suggestion:"éœ€è¦å®šä¹‰initialize(context)åˆå§‹åŒ–å‡½æ•°"}),t}}n.StrategyAnalyzer=c},238:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.generateStrategy=async function(e,n){c.logger.info("æ‰§è¡Œç”Ÿæˆç­–ç•¥å‘½ä»¤",d);try{const n=await async function(){const e=await i.window.showQuickPick(p,{placeHolder:"é€‰æ‹©ç­–ç•¥å¹³å°",title:"Step 1/3: é€‰æ‹©ç›®æ ‡å¹³å°"});return e?.value}();if(!n)return;const t=await async function(){const e=await i.window.showQuickPick(g,{placeHolder:"é€‰æ‹©ç­–ç•¥é£æ ¼",title:"Step 2/3: é€‰æ‹©ç­–ç•¥é£æ ¼"});return e?.value}();if(!t)return;const a=await async function(){const e=await i.window.showQuickPick([{label:"âœ… ä½¿ç”¨é»˜è®¤å‚æ•°",value:"default",description:"æ­¢æŸ8%, æ­¢ç›ˆ20%, å•ç¥¨10%"},{label:"âš™ï¸ è‡ªå®šä¹‰å‚æ•°",value:"custom",description:"æ‰‹åŠ¨é…ç½®é£æ§å‚æ•°"}],{placeHolder:"é£æ§å‚æ•°é…ç½®",title:"Step 3/3: é…ç½®é£æ§å‚æ•°"});if(!e)return;if("default"===e.value)return{max_position:.1,stop_loss:.08,take_profit:.2};const n=await i.window.showInputBox({prompt:"å•ç¥¨æœ€å¤§ä»“ä½ (%)",value:"10",validateInput:e=>{const n=parseFloat(e);return isNaN(n)||n<=0||n>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});if(!n)return;const t=await i.window.showInputBox({prompt:"æ­¢æŸçº¿ (%)",value:"8",validateInput:e=>{const n=parseFloat(e);return isNaN(n)||n<=0||n>50?"è¯·è¾“å…¥1-50ä¹‹é—´çš„æ•°å­—":null}});if(!t)return;const a=await i.window.showInputBox({prompt:"æ­¢ç›ˆçº¿ (%)",value:"20",validateInput:e=>{const n=parseFloat(e);return isNaN(n)||n<=0||n>100?"è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—":null}});return a?{max_position:parseFloat(n)/100,stop_loss:parseFloat(t)/100,take_profit:parseFloat(a)/100}:void 0}();if(!a)return;await async function(e,n,t,a,r){await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(n,o)=>{try{n.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const s=await e.getMarketStatus();if(o.isCancellationRequested)return;n.report({message:"è·å–æ¨èå› å­...",increment:20});const l=await e.recommendFactors({market_regime:s.data?.regime});if(o.isCancellationRequested)return;n.report({message:`ç”Ÿæˆ${t.toUpperCase()}ç­–ç•¥ä»£ç ...`,increment:30});const p=(l.data||[]).slice(0,5).map(e=>e.name),g=await e.generateStrategy({factors:p,style:a,platform:t,risk_params:r});if(n.report({increment:30}),!g.ok||!g.data)return void i.window.showErrorMessage(`ç”Ÿæˆç­–ç•¥å¤±è´¥: ${g.error||"æœªçŸ¥é”™è¯¯"}`);const u=g.data;c.logger.info(`ç­–ç•¥ç”ŸæˆæˆåŠŸ: ${u.name}`,d),n.report({message:"å®Œæˆ",increment:20}),await async function(e,n,t){const a=await i.workspace.openTextDocument({content:n.code,language:"python"});switch(await i.window.showTextDocument(a,i.ViewColumn.One),await i.window.showInformationMessage(`${t.toUpperCase()} ç­–ç•¥ "${n.name}" å·²ç”Ÿæˆ`,"ä¿å­˜æ–‡ä»¶","å¤åˆ¶ä»£ç ","æŸ¥çœ‹è¯´æ˜")){case"ä¿å­˜æ–‡ä»¶":await async function(e,n){const t=`${e.name}.py`,a=await i.window.showSaveDialog({defaultUri:i.Uri.file(t),filters:{Pythonæ–‡ä»¶:["py"]},title:`ä¿å­˜${n.toUpperCase()}ç­–ç•¥`});if(a){await i.workspace.fs.writeFile(a,Buffer.from(e.code,"utf-8"));const n=i.Uri.file(a.fsPath.replace(".py","_meta.json")),t={name:e.name,platform:e.platform,style:e.style,factors:e.factors,risk_params:e.risk_params,created_at:(new Date).toISOString()};await i.workspace.fs.writeFile(n,Buffer.from(JSON.stringify(t,null,2),"utf-8")),i.window.showInformationMessage(`ç­–ç•¥å·²ä¿å­˜: ${a.fsPath}`),c.logger.info(`ç­–ç•¥ä¿å­˜åˆ°: ${a.fsPath}`,d)}}(n,t);break;case"å¤åˆ¶ä»£ç ":await i.env.clipboard.writeText(n.code),i.window.showInformationMessage("ç­–ç•¥ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"æŸ¥çœ‹è¯´æ˜":!function(e){const n=`\n# ç­–ç•¥è¯´æ˜\n\n## åŸºæœ¬ä¿¡æ¯\n- **ç­–ç•¥åç§°**: ${e.name}\n- **ç›®æ ‡å¹³å°**: ${e.platform.toUpperCase()}\n- **ç­–ç•¥é£æ ¼**: ${{multi_factor:"å¤šå› å­é€‰è‚¡",momentum_growth:"åŠ¨é‡æˆé•¿",value:"ä»·å€¼æŠ•èµ„",market_neutral:"å¸‚åœºä¸­æ€§"}[e.style]}\n\n## ä½¿ç”¨å› å­\n${e.factors.map(e=>`- ${e}`).join("\n")}\n\n## é£æ§å‚æ•°\n- **å•ç¥¨æœ€å¤§ä»“ä½**: ${(100*e.risk_params.max_position).toFixed(0)}%\n- **æ­¢æŸçº¿**: ${(100*e.risk_params.stop_loss).toFixed(0)}%\n- **æ­¢ç›ˆçº¿**: ${(100*e.risk_params.take_profit).toFixed(0)}%\n\n## ç­–ç•¥æè¿°\n${e.description}\n\n## ä½¿ç”¨è¯´æ˜\n1. å°†ä»£ç å¤åˆ¶åˆ°${e.platform.toUpperCase()}å®¢æˆ·ç«¯\n2. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è‚¡ç¥¨æ± å’Œå‚æ•°\n3. è¿›è¡Œå›æµ‹éªŒè¯åå†å®ç›˜ä½¿ç”¨\n4. æ³¨æ„é£é™©æ§åˆ¶ï¼Œä¸è¦è¶…è¿‡æ‰¿å—èƒ½åŠ›\n    `;i.workspace.openTextDocument({content:n,language:"markdown"}).then(e=>{i.window.showTextDocument(e,i.ViewColumn.Beside)})}(n)}}(0,u,t)}catch(e){l.ErrorHandler.handle(e,d)}})}(e,0,n,t,a)}catch(e){l.ErrorHandler.handle(e,d)}};const i=s(t(398)),c=t(628),l=t(799),d="GenerateStrategy",p=[{label:"ğŸ“Š PTrade (æ’ç”Ÿ)",value:"ptrade",description:"æ’ç”ŸPTradeå¹³å°ï¼Œæ”¯æŒAè‚¡ã€ETFäº¤æ˜“",detail:"å‡½æ•°: initialize(), handle_data()"},{label:"ğŸ“ˆ QMT (è¿…æŠ•)",value:"qmt",description:"è¿…æŠ•QMTå¹³å°ï¼Œæ”¯æŒè‚¡ç¥¨ã€æœŸè´§äº¤æ˜“",detail:"å‡½æ•°: init(), handlebar()"}],g=[{label:"ğŸ“ˆ å¤šå› å­é€‰è‚¡",value:"multi_factor",description:"ç»¼åˆå¤šä¸ªå› å­è¯„åˆ†é€‰è‚¡",detail:"é€‚åˆ: å„ç§å¸‚åœºç¯å¢ƒ"},{label:"ğŸš€ åŠ¨é‡æˆé•¿",value:"momentum_growth",description:"è¿½é€å¼ºåŠ¿æˆé•¿è‚¡",detail:"é€‚åˆ: ç‰›å¸‚ã€é£é™©åå¥½ä¸Šå‡"},{label:"ğŸ’° ä»·å€¼æŠ•èµ„",value:"value",description:"ä½ä¼°å€¼é«˜åˆ†çº¢æ ‡çš„",detail:"é€‚åˆ: ç†Šå¸‚ã€é£é™©åå¥½ä¸‹é™"},{label:"âš–ï¸ å¸‚åœºä¸­æ€§",value:"market_neutral",description:"å¤šç©ºå¯¹å†²ç­–ç•¥",detail:"é€‚åˆ: éœ‡è¡å¸‚ã€ä¸ç¡®å®šç¯å¢ƒ"}]},265:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.activate=async function(e){console.log("[TRQuant] ğŸš€ æ‰©å±•æ¿€æ´»å¼€å§‹..."),S.logger.info("TRQuant Extension æ­£åœ¨æ¿€æ´»...",$);const n=Date.now();try{console.log("[TRQuant] ğŸ“¦ æ³¨å†Œ createProject å‘½ä»¤...");const a=i.commands.registerCommand("trquant.createProject",async()=>{console.log("[TRQuant] âœ… createProject å‘½ä»¤è¢«è§¦å‘!"),i.window.setStatusBarMessage("ğŸ‰ æ­£åœ¨åˆ›å»ºé¡¹ç›®...",2e3);try{const n=`ç­–ç•¥_${(new Date).toISOString().slice(0,10).replace(/-/g,"")}_${Math.random().toString(36).substr(2,6)}`;console.log(`[TRQuant] ç”Ÿæˆé¡¹ç›®å: ${n}`);const a=i.workspace.workspaceFolders?.[0];let r;r=a?t(928).join(a.uri.fsPath,"Projects"):t(928).join(e.extensionPath,"data","Projects");const o=t(896);o.existsSync(r)||o.mkdirSync(r,{recursive:!0});const s=await i.window.showInputBox({title:"ğŸ‰ åˆ›å»ºé‡åŒ–é¡¹ç›®",prompt:`é¡¹ç›®å°†åˆ›å»ºåœ¨: ${r}`,value:n,valueSelection:[0,n.length],placeHolder:"è¾“å…¥é¡¹ç›®åç§°ï¼ˆå¦‚ï¼šç¥¥ç‘ç¢§éœ„å‡¤å‡°ï¼‰",ignoreFocusOut:!0,validateInput:e=>e&&0!==e.trim().length?/[<>:"/\\|?*]/.test(e)?"é¡¹ç›®åç§°ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦":null:"é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º"});if(!s)return void console.log("[TRQuant] ç”¨æˆ·å–æ¶ˆ");const c=s.trim(),l=t(928).join(r,c);o.existsSync(l)||o.mkdirSync(l,{recursive:!0});const d=t(928).join(l,"main.py"),p=new Date,g=new Date(p);g.setMonth(g.getMonth()-3);const u=new Date(g);u.setFullYear(u.getFullYear()-1);const m=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;let f="neutral",h=[];try{const e=await(O?.getMarketStatus());e?.ok&&e?.data?.regime&&(f=e.data.regime,console.log(`[TRQuant] è·å–å¸‚åœºçŠ¶æ€: ${f}`));const n=await(O?.getMainlines({top_n:5}));n?.ok&&n?.data&&(h=n.data.slice(0,5).map(e=>({name:e.name||"",industries:e.industries||[]})),console.log(`[TRQuant] è·å–æŠ•èµ„ä¸»çº¿: ${h.map(e=>e.name).join(", ")}`))}catch(e){console.log("[TRQuant] è·å–å·¥ä½œæµæ•°æ®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼")}const v=t(928).join(e.extensionPath,"templates","strategies","multi_factor_template.py");let y;if(o.existsSync(v)){if(y=o.readFileSync(v,"utf-8"),console.log("[TRQuant] ä½¿ç”¨å®Œæ•´å¤–éƒ¨æ¨¡æ¿"),y=y.replace(/\{project_name\}/g,c).replace(/\{create_time\}/g,(new Date).toLocaleString("zh-CN")).replace(/\{start_date\}/g,m(u)).replace(/\{end_date\}/g,m(g)),y=y.replace(/MARKET_REGIME = 'neutral'/,`MARKET_REGIME = '${f}'`),h.length>0){const e=h.map(e=>`    ('${e.name}', ${JSON.stringify(e.industries)}),`).join("\n");y=y.replace(/HOT_MAINLINES = \[\n    \('äººå·¥æ™ºèƒ½'.*?\n    \('åŠå¯¼ä½“'.*?\n\]/s,`HOT_MAINLINES = [\n${e}\n]`)}y=y.replace(/\{\{/g,"{").replace(/\}\}/g,"}")}else console.log("[TRQuant] æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨ç®€åŒ–æ¨¡æ¿"),y=`# -*- coding: utf-8 -*-\n"""\n${c} - æ™ºèƒ½å¤šå› å­é‡åŒ–ç­–ç•¥\n=====================================\n\nåˆ›å»ºæ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\nå›æµ‹åŒºé—´: ${m(u)} è‡³ ${m(g)}\nåŸºå‡†æŒ‡æ•°: 000300.XSHG (æ²ªæ·±300)\n\nå¸‚åœºçŠ¶æ€: ${f}\næŠ•èµ„ä¸»çº¿: ${h.map(e=>e.name).join(", ")||"æ²ªæ·±300æˆåˆ†è‚¡"}\n"""\n\nimport numpy as np\nimport pandas as pd\n\nMARKET_REGIME = '${f}'\nHOT_MAINLINES = ${JSON.stringify(h.map(e=>[e.name,e.industries]))}\n\ndef initialize(context):\n    set_benchmark('000300.XSHG')\n    g.stock_num = 10\n    g.market_regime = MARKET_REGIME\n    log.info('ç­–ç•¥åˆå§‹åŒ–: ${c}')\n    log.info(f'å¸‚åœºçŠ¶æ€: {g.market_regime}')\n\ndef handle_data(context, data):\n    pass\n`;o.writeFileSync(d,y,"utf-8");const b=await i.workspace.openTextDocument(d);await i.window.showTextDocument(b),i.commands.executeCommand("workbench.files.action.refreshFilesExplorer"),i.window.showInformationMessage(`âœ… é¡¹ç›® "${c}" åˆ›å»ºæˆåŠŸï¼`,"è¿è¡Œå›æµ‹").then(e=>{"è¿è¡Œå›æµ‹"===e&&i.commands.executeCommand("trquant.runBacktest")})}catch(e){console.error("[TRQuant] createProject é”™è¯¯:",e),i.window.showErrorMessage(`åˆ›å»ºé¡¹ç›®å¤±è´¥: ${e}`)}});e.subscriptions.push(a),console.log("[TRQuant] âœ… createProject å‘½ä»¤æ³¨å†ŒæˆåŠŸ");const r=P.ConfigManager.getInstance();e.subscriptions.push({dispose:()=>r.dispose()}),O=new p.TRQuantClient(e),e.subscriptions.push({dispose:()=>O.dispose()}),C=function(){const e=i.window.createStatusBarItem(i.StatusBarAlignment.Right,100);return e.text="$(graph) TRQuant",e.tooltip="TRQuant é‡åŒ–åŠ©æ‰‹ - ç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿",e.command="trquant.showPanel",e.show(),e}(),e.subscriptions.push(C),function(e){const n=[{id:"trquant.getMarketStatus",handler:()=>(0,u.getMarketStatus)(O,e)},{id:"trquant.getMainlines",handler:()=>(0,m.getMainlines)(O,e)},{id:"trquant.recommendFactors",handler:()=>(0,f.recommendFactors)(O,e)},{id:"trquant.generateStrategy",handler:()=>(0,h.generateStrategy)(O,e)},{id:"trquant.analyzeBacktest",handler:()=>(0,v.analyzeBacktest)(O,e)},{id:"trquant.runBacktest",handler:async()=>{try{console.log("[TRQuant] è¿è¡Œå›æµ‹å‘½ä»¤è§¦å‘"),(0,w.showBacktestConfigPanel)(e.extensionUri,O,e)}catch(e){console.error("[TRQuant] è¿è¡Œå›æµ‹é”™è¯¯:",e),i.window.showErrorMessage(`è¿è¡Œå›æµ‹å¤±è´¥: ${e}`)}}},{id:"trquant.openBacktestConfig",handler:async()=>{(0,w.showBacktestConfigPanel)(e.extensionUri,O,e)}},{id:"trquant.enableMCP",handler:async()=>{await j(e),i.window.showInformationMessage("TRQuant MCP Server å·²å¯ç”¨")}},{id:"trquant.showPanel",handler:async()=>{y.MarketPanel.createOrShow(e.extensionUri,O)}},{id:"trquant.showDashboard",handler:async()=>{b.MainDashboard.createOrShow(e.extensionUri,O)}},{id:"trquant.openDashboard",handler:async()=>{b.MainDashboard.createOrShow(e.extensionUri,O)}},{id:"trquant.showWelcome",handler:async()=>{b.MainDashboard.createOrShow(e.extensionUri,O)}},{id:"trquant.showLogs",handler:async()=>{S.logger.show()}},{id:"trquant.refreshStatus",handler:async()=>{await T(),i.window.showInformationMessage("çŠ¶æ€å·²åˆ·æ–°")}},{id:"trquant.openWorkflowPanel",handler:async()=>{console.log("[TRQuant] æ‰“å¼€å·¥ä½œæµé¢æ¿ -> å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ"),S.logger.info("æ‰“å¼€å·¥ä½œæµé¢æ¿ï¼ˆå¯åŠ¨æ¡Œé¢ç³»ç»Ÿï¼‰",$),await E()}},{id:"trquant.launchDesktopSystem",handler:async()=>{console.log("[TRQuant] å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ"),S.logger.info("å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ",$),await E()}},{id:"trquant.openWorkflowPanelWebview",handler:async()=>{console.log("[TRQuant] æ‰“å¼€WebViewå·¥ä½œæµé¢æ¿"),S.logger.info("æ‰“å¼€WebViewå·¥ä½œæµé¢æ¿",$);const{WorkflowPanel:n}=await Promise.resolve().then(()=>s(t(360)));n.createOrShow(e.extensionUri,O)}},{id:"trquant.localBackup",handler:async()=>{console.log("[TRQuant] æœ¬åœ°å¤‡ä»½"),S.logger.info("æœ¬åœ°å¤‡ä»½",$),await(0,k.localBackup)(e)}},{id:"trquant.gitCommit",handler:async()=>{console.log("[TRQuant] Git Commit"),S.logger.info("Git Commit",$),await(0,k.gitCommit)(e)}},{id:"trquant.refreshSystem",handler:async()=>{console.log("[TRQuant] åˆ·æ–°ç³»ç»Ÿ"),S.logger.info("åˆ·æ–°ç³»ç»Ÿ",$),await(0,k.refreshSystem)(e)}}];for(const{id:t,handler:a}of n){const n=i.commands.registerCommand(t,async()=>{S.logger.debug(`æ‰§è¡Œå‘½ä»¤: ${t}`,$),await M.ErrorHandler.wrap(a,t)});e.subscriptions.push(n)}S.logger.info(`å·²æ³¨å†Œ ${n.length} ä¸ªå‘½ä»¤`,$)}(e),console.log("[TRQuant] âœ… æ‰€æœ‰å‘½ä»¤æ³¨å†Œå®Œæˆ"),(0,b.registerMainDashboard)(e,O),(0,k.registerDeveloperProvider)(e),e.subscriptions.push(i.commands.registerCommand("trquant.guide.createProject",async()=>{await i.commands.executeCommand("workbench.action.quickOpen",">TRQuant: æ–°å»ºé‡åŒ–é¡¹ç›®")})),(0,_.registerStrategyOptimizer)(e,O),(0,x.registerStrategyOptimizerPanel)(e),e.subscriptions.push(i.commands.registerCommand("trquant.openAShareManual",async()=>{try{S.logger.info("=== å¼€å§‹å¯åŠ¨Aè‚¡å®æ“æ‰‹å†Œ ===",$);let n=l.join(e.extensionPath,"AShare-manual");if(c.existsSync(n))S.logger.info(`âœ“ ä½¿ç”¨æ‰©å±•è·¯å¾„: ${n}`,$);else{S.logger.info(`æ‰©å±•è·¯å¾„ä¸å­˜åœ¨ï¼Œå°è¯•å·¥ä½œåŒºè·¯å¾„: ${n}`,$);const e=i.workspace.workspaceFolders?.[0];if(e){const t=l.join(e.uri.fsPath,"extension","AShare-manual");S.logger.info(`æ£€æŸ¥å·¥ä½œåŒºè·¯å¾„: ${t}`,$),c.existsSync(t)?(n=t,S.logger.info(`âœ“ ä½¿ç”¨å·¥ä½œåŒºè·¯å¾„: ${n}`,$)):S.logger.warn(`å·¥ä½œåŒºè·¯å¾„ä¹Ÿä¸å­˜åœ¨: ${t}`,$)}}if(!c.existsSync(n)){const e=`æ‰‹å†Œç›®å½•ä¸å­˜åœ¨: ${n}\nè¯·ç¡®ä¿Aè‚¡æ‰‹å†Œå·²æ­£ç¡®å®‰è£…ã€‚`;return S.logger.error(e,$),void i.window.showErrorMessage(e)}const t=l.join(n,"package.json");if(!c.existsSync(t)){const e=`æ‰‹å†Œé…ç½®ä¸å­˜åœ¨: ${t}`;return S.logger.error(e,$),void i.window.showErrorMessage(e)}S.logger.info(`âœ“ package.jsonå­˜åœ¨: ${t}`,$);const a=l.join(n,"node_modules");if(!c.existsSync(a)){if(S.logger.info("æ£€æµ‹åˆ°node_modulesä¸å­˜åœ¨ï¼Œéœ€è¦å®‰è£…ä¾èµ–",$),"å®‰è£…"===await i.window.showWarningMessage("Aè‚¡æ‰‹å†Œéœ€è¦å®‰è£…ä¾èµ–ï¼Œæ˜¯å¦ç°åœ¨å®‰è£…ï¼Ÿ","å®‰è£…","å–æ¶ˆ")){const e=i.window.createTerminal({name:"Aè‚¡æ‰‹å†Œ-å®‰è£…",cwd:n});return e.show(),e.sendText("npm install"),void i.window.showInformationMessage('æ­£åœ¨å®‰è£…ä¾èµ–ï¼Œå®‰è£…å®Œæˆåè¯·é‡æ–°ç‚¹å‡»"ğŸ“š Aè‚¡å®æ“æ‰‹å†Œ"')}return}S.logger.info("âœ“ node_moduleså­˜åœ¨",$),S.logger.info(`å¯åŠ¨npm run devè¿›ç¨‹: ${n}`,$);try{d.spawn("npm",["run","dev"],{cwd:n,stdio:"ignore",detached:!0,shell:!0}).unref(),S.logger.info("âœ“ npm run devè¿›ç¨‹å·²å¯åŠ¨",$),i.window.showInformationMessage("æ­£åœ¨å¯åŠ¨Aè‚¡æ‰‹å†ŒæœåŠ¡å™¨ï¼Œè¯·ç¨å€™..."),setTimeout(async()=>{S.logger.info("å°è¯•æ‰“å¼€æµè§ˆå™¨åˆ° http://localhost:4321",$);try{await i.env.openExternal(i.Uri.parse("http://localhost:4321")),S.logger.info("âœ… Aè‚¡æ‰‹å†Œå·²åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€",$),i.window.showInformationMessage("âœ… Aè‚¡é«˜å€è‚¡å®æ“æ‰‹å†Œå·²å¯åŠ¨ - äº”å†Œå¯¼èˆªé¦–é¡µ")}catch(e){S.logger.warn(`æ‰“å¼€æµè§ˆå™¨å¤±è´¥: ${e}`,$);const n=[4322,4323,4324];for(const e of n)try{return await i.env.openExternal(i.Uri.parse(`http://localhost:${e}`)),S.logger.info(`âœ… å·²æ‰“å¼€Aè‚¡æ‰‹å†Œ (ç«¯å£${e})`,$),void i.window.showInformationMessage(`âœ… Aè‚¡æ‰‹å†Œå·²æ‰“å¼€ (ç«¯å£${e})`)}catch(e){}i.window.showWarningMessage("æ— æ³•è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè¯·æ‰‹åŠ¨è®¿é—® http://localhost:4321")}},2e3)}catch(e){S.logger.error(`å¯åŠ¨è¿›ç¨‹å¤±è´¥: ${e}`,$),i.window.showErrorMessage(`å¯åŠ¨å¤±è´¥: ${e instanceof Error?e.message:String(e)}`)}}catch(e){const n=e instanceof Error?e.message:String(e);S.logger.error(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${n}`,$),i.window.showErrorMessage(`å¯åŠ¨Aè‚¡æ‰‹å†Œå¤±è´¥: ${n}`)}})),S.logger.info("âœ“ Aè‚¡å®æ“æ‰‹å†Œå‘½ä»¤å·²æ³¨å†Œ",$),P.config.get("mcpEnabled")&&await j(e),T();const o=Date.now()-n;S.logger.info(`TRQuant Extension æ¿€æ´»å®Œæˆ (${o}ms)`,$),S.logger.info("å‡†å¤‡æ‰“å¼€ä¸»æ§åˆ¶å°...",$);try{b.MainDashboard.createOrShow(e.extensionUri,O),S.logger.info("âœ… ä¸»æ§åˆ¶å°å·²è‡ªåŠ¨æ‰“å¼€",$)}catch(e){S.logger.error(`âŒ æ‰“å¼€ä¸»æ§åˆ¶å°å¤±è´¥: ${e}`,$),i.window.showErrorMessage(`ä¸»æ§åˆ¶å°æ‰“å¼€å¤±è´¥: ${e}`,"é‡è¯•").then(e=>{"é‡è¯•"===e&&i.commands.executeCommand("trquant.openDashboard")})}i.window.showInformationMessage("ğŸ‰ éŸ¬ç¿é‡åŒ–å·²å¯åŠ¨ï¼")}catch(e){throw M.ErrorHandler.handle(e,$),e}},n.deactivate=function(){S.logger.info("TRQuant Extension æ­£åœ¨åœç”¨...",$),O&&O.dispose(),S.logger.dispose()};const i=s(t(398)),c=s(t(896)),l=s(t(928)),d=s(t(317)),p=t(3),g=t(334),u=t(501),m=t(327),f=t(405),h=t(238),v=t(900),y=t(395),b=t(126),w=t(56),x=t(279),_=t(410),k=t(974),S=t(628),P=t(478),M=t(799),$="Extension";let O,C;async function E(e){const n="/home/taotao/dev/QuantTest/TRQuant",t=l.join(n,"TRQuant.py"),a=l.join(n,"venv","bin","python");if(c.existsSync(t))if(c.existsSync(a)){S.logger.info(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿ: ${t}`,$);try{d.spawn(a,[t,"--fast"],{cwd:n,detached:!0,stdio:"ignore",env:{...process.env,QT_AUTO_SCREEN_SCALE_FACTOR:"1"}}).unref(),i.window.showInformationMessage("ğŸ–¥ï¸ éŸ¬ç¿é‡åŒ–æ¡Œé¢ç³»ç»Ÿå·²å¯åŠ¨ï¼"),S.logger.info("æ¡Œé¢ç³»ç»Ÿå¯åŠ¨æˆåŠŸ",$)}catch(e){const n=e instanceof Error?e.message:String(e);S.logger.error(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${n}`,$),i.window.showErrorMessage(`å¯åŠ¨æ¡Œé¢ç³»ç»Ÿå¤±è´¥: ${n}`)}}else i.window.showErrorMessage(`Python ç¯å¢ƒä¸å­˜åœ¨: ${a}\nè¯·å…ˆè¿è¡Œ: cd ${n} && python -m venv venv`);else i.window.showErrorMessage(`æ¡Œé¢ç³»ç»Ÿä¸å­˜åœ¨: ${t}\nè¯·ç¡®ä¿ TRQuant é¡¹ç›®å·²æ­£ç¡®å®‰è£…ã€‚`)}async function j(e){try{await g.MCPRegistrar.registerServer(e),S.logger.info("MCP Server å·²æ³¨å†Œ",$)}catch(e){S.logger.warn(`MCPæ³¨å†Œå¤±è´¥: ${e instanceof Error?e.message:String(e)}`,$)}}async function T(){try{const e=await O.getMarketStatus();if(e.ok&&e.data){const n=e.data.regime,t={risk_on:"ğŸ“ˆ",risk_off:"ğŸ“‰",neutral:"â¡ï¸"}[n]||"ğŸ“Š";C.text=`$(graph) ${t} TRQuant`,C.tooltip=`TRQuant | å¸‚åœº: ${n.toUpperCase()}\nç‚¹å‡»æ‰“å¼€æ§åˆ¶é¢æ¿`}}catch(e){S.logger.debug("æ›´æ–°çŠ¶æ€æ å¤±è´¥",$,{error:e})}}},279:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.StrategyOptimizerPanel=void 0,n.registerStrategyOptimizerPanel=function(e){e.subscriptions.push(i.commands.registerCommand("trquant.optimizeStrategy",async()=>{const n=i.window.activeTextEditor;if(n){const t=n.document.getText(),a=l.basename(n.document.fileName);u.createOrShow(e.extensionUri,t,a)}else u.createOrShow(e.extensionUri)})),d.logger.info("ç­–ç•¥ä¼˜åŒ–å™¨é¢æ¿å·²æ³¨å†Œ",g)};const i=s(t(398)),c=s(t(896)),l=s(t(928)),d=t(628);let p=null;const g="StrategyOptimizerPanel";class u{static currentPanel;_panel;_extensionUri;_disposables=[];_report=null;constructor(e,n){this._panel=e,this._extensionUri=n,this._panel.webview.onDidReceiveMessage(e=>this.handleMessage(e),null,this._disposables),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables)}static createOrShow(e,n,t){const a=i.ViewColumn.One;if(u.currentPanel)return u.currentPanel._panel.reveal(a),n&&u.currentPanel.analyzeStrategy(n,t),u.currentPanel;const r=i.window.createWebviewPanel("strategyOptimizer","ğŸ” ç­–ç•¥ä¼˜åŒ–å™¨",a,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});return u.currentPanel=new u(r,e),n?u.currentPanel.analyzeStrategy(n,t):u.currentPanel.updateContent(),u.currentPanel}async handleMessage(e){switch(e.command){case"analyzeFile":await this.analyzeFromFile();break;case"analyzeEditor":await this.analyzeFromEditor();break;case"exportReport":await this.exportReport()}}async analyzeFromFile(){const e=await i.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Pythonæ–‡ä»¶:["py"],æ‰€æœ‰æ–‡ä»¶:["*"]}});if(e&&e[0])try{const n=c.readFileSync(e[0].fsPath,"utf-8"),t=l.basename(e[0].fsPath);this.analyzeStrategy(n,t)}catch(e){i.window.showErrorMessage(`è¯»å–æ–‡ä»¶å¤±è´¥: ${e}`)}}async analyzeFromEditor(){const e=i.window.activeTextEditor;if(!e)return void i.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªç­–ç•¥æ–‡ä»¶");const n=e.document.getText(),t=l.basename(e.document.fileName);this.analyzeStrategy(n,t)}async analyzeStrategy(e,n){try{this._panel.webview.postMessage({command:"analyzing"});const a=(await async function(){if(!p){const e=await Promise.resolve().then(()=>s(t(410)));p=e.strategyOptimizer||e.StrategyOptimizerService?.getInstance()}return p}()).generateOptimizationReport(e,n);this._report=a,this._panel.webview.postMessage({command:"reportReady",report:a}),this.updateContent()}catch(e){d.logger.error(`ç­–ç•¥åˆ†æå¤±è´¥: ${e}`,g),i.window.showErrorMessage(`ç­–ç•¥åˆ†æå¤±è´¥: ${e}`),this._panel.webview.postMessage({command:"error",message:String(e)})}}async exportReport(){if(!this._report)return void i.window.showWarningMessage("æ²¡æœ‰å¯å¯¼å‡ºçš„æŠ¥å‘Š");const e=i.workspace.workspaceFolders?.[0];if(!e)return void i.window.showErrorMessage("è¯·å…ˆæ‰“å¼€å·¥ä½œåŒº");const n=l.join(e.uri.fsPath,"Reports");c.existsSync(n)||c.mkdirSync(n,{recursive:!0});const t=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5),a=l.join(n,`optimization_${t}.md`),r=this.generateMarkdownReport(this._report);c.writeFileSync(a,r,"utf-8"),i.window.showInformationMessage(`æŠ¥å‘Šå·²å¯¼å‡º: ${l.basename(a)}`,"æ‰“å¼€æ–‡ä»¶").then(e=>{"æ‰“å¼€æ–‡ä»¶"===e&&i.commands.executeCommand("vscode.open",i.Uri.file(a))})}generateMarkdownReport(e){let n="# ç­–ç•¥ä¼˜åŒ–æŠ¥å‘Š\n\n";n+=`**ç­–ç•¥åç§°**: ${e.strategyName}\n\n`,n+=`**å¹³å°**: ${e.platform}\n\n`,n+=`**åˆ†ææ—¶é—´**: ${new Date(e.analysisTime).toLocaleString("zh-CN")}\n\n`,n+="---\n\n",n+="## ğŸ“Š ç­–ç•¥è¯„åˆ†\n\n",n+="| ç»´åº¦ | è¯„åˆ† |\n",n+="|------|------|\n",n+=`| æ•´ä½“è¯„åˆ† | **${e.overallScore}/100** |\n`,n+=`| é£é™©æ§åˆ¶ | ${e.scoreBreakdown.risk}/100 |\n`,n+=`| å› å­æ„å»º | ${e.scoreBreakdown.factor}/100 |\n`,n+=`| é€‰è‚¡é€»è¾‘ | ${e.scoreBreakdown.selection}/100 |\n`,n+=`| ä»£ç è´¨é‡ | ${e.scoreBreakdown.code}/100 |\n\n`,n+="## ğŸ“ ä¼˜åŒ–æ‘˜è¦\n\n",n+=`${e.summary}\n\n`,n+="## ğŸ’¡ ä¼˜åŒ–å»ºè®®\n\n";for(const t of e.advices)n+=`### ${"high"===t.priority?"ğŸ”´":"medium"===t.priority?"ğŸŸ¡":"ğŸŸ¢"} ${t.title}\n\n`,n+=`**ç±»åˆ«**: ${t.category}\n\n`,n+=`**æè¿°**: ${t.description}\n\n`,t.currentState&&(n+=`**å½“å‰çŠ¶æ€**: ${t.currentState}\n\n`),t.suggestedState&&(n+=`**å»ºè®®çŠ¶æ€**: ${t.suggestedState}\n\n`),t.codeExample&&(n+=`**ä»£ç ç¤ºä¾‹**:\n\n\`\`\`python\n${t.codeExample}\n\`\`\`\n\n`),t.impact&&(n+=`**é¢„æœŸå½±å“**: ${t.impact}\n\n`),n+="---\n\n";return n}updateContent(){this._panel.webview.html=this.generateHtml()}generateHtml(){const e=this._report;return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>ç­–ç•¥ä¼˜åŒ–å™¨</title>\n    <style>\n        :root {\n            --bg-dark: #0a0e14;\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-card: #1c2128;\n            --text-primary: #e6edf3;\n            --text-secondary: #8b949e;\n            --text-muted: #6e7681;\n            --accent-gold: #f0b429;\n            --accent-green: #3fb950;\n            --accent-blue: #58a6ff;\n            --accent-red: #f85149;\n            --border-color: #30363d;\n        }\n        \n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        \n        body {\n            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-dark);\n            color: var(--text-primary);\n            padding: 24px;\n        }\n        \n        .header {\n            margin-bottom: 24px;\n        }\n        \n        .header h1 {\n            font-size: 24px;\n            margin-bottom: 8px;\n        }\n        \n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 16px;\n        }\n        \n        .btn {\n            padding: 10px 20px;\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            color: var(--text-secondary);\n            cursor: pointer;\n            font-size: 14px;\n        }\n        \n        .btn:hover {\n            background: var(--bg-secondary);\n            border-color: var(--accent-blue);\n            color: var(--text-primary);\n        }\n        \n        .btn-primary {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            border: none;\n            color: #fff;\n        }\n        \n        .score-section {\n            display: grid;\n            grid-template-columns: repeat(5, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n        \n        .score-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n        }\n        \n        .score-label {\n            font-size: 12px;\n            color: var(--text-muted);\n            margin-bottom: 8px;\n        }\n        \n        .score-value {\n            font-size: 32px;\n            font-weight: 700;\n            color: var(--accent-gold);\n        }\n        \n        .summary {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 24px;\n            white-space: pre-wrap;\n            line-height: 1.6;\n        }\n        \n        .advices {\n            display: flex;\n            flex-direction: column;\n            gap: 16px;\n        }\n        \n        .advice-card {\n            background: var(--bg-secondary);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 20px;\n        }\n        \n        .advice-header {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-bottom: 12px;\n        }\n        \n        .priority-badge {\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 12px;\n            font-weight: 600;\n        }\n        \n        .priority-high {\n            background: rgba(248, 81, 73, 0.2);\n            color: var(--accent-red);\n        }\n        \n        .priority-medium {\n            background: rgba(240, 180, 41, 0.2);\n            color: var(--accent-gold);\n        }\n        \n        .priority-low {\n            background: rgba(88, 166, 255, 0.2);\n            color: var(--accent-blue);\n        }\n        \n        .advice-title {\n            font-size: 18px;\n            font-weight: 600;\n        }\n        \n        .advice-body {\n            margin-top: 12px;\n            color: var(--text-secondary);\n            line-height: 1.6;\n        }\n        \n        .code-example {\n            background: var(--bg-card);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 12px;\n            margin-top: 12px;\n            font-family: 'Courier New', monospace;\n            font-size: 13px;\n            overflow-x: auto;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-muted);\n        }\n        \n        .empty-state .icon {\n            font-size: 64px;\n            margin-bottom: 16px;\n            opacity: 0.5;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>ğŸ” ç­–ç•¥ä¼˜åŒ–å™¨</h1>\n        <p style="color: var(--text-muted);">åˆ†æç­–ç•¥ä»£ç ï¼Œç”Ÿæˆä¼˜åŒ–å»ºè®®</p>\n        <div class="actions">\n            <button class="btn btn-primary" onclick="vscode.postMessage({command: 'analyzeEditor'})">\n                ğŸ“ åˆ†æå½“å‰ç¼–è¾‘å™¨\n            </button>\n            <button class="btn" onclick="vscode.postMessage({command: 'analyzeFile'})">\n                ğŸ“ é€‰æ‹©æ–‡ä»¶åˆ†æ\n            </button>\n            ${e?'<button class="btn" onclick="vscode.postMessage({command: \'exportReport\'})">ğŸ’¾ å¯¼å‡ºæŠ¥å‘Š</button>':""}\n        </div>\n    </div>\n    \n    ${e?`\n        <div class="score-section">\n            <div class="score-card">\n                <div class="score-label">æ•´ä½“è¯„åˆ†</div>\n                <div class="score-value">${e.overallScore}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">é£é™©æ§åˆ¶</div>\n                <div class="score-value">${e.scoreBreakdown.risk}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">å› å­æ„å»º</div>\n                <div class="score-value">${e.scoreBreakdown.factor}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">é€‰è‚¡é€»è¾‘</div>\n                <div class="score-value">${e.scoreBreakdown.selection}</div>\n            </div>\n            <div class="score-card">\n                <div class="score-label">ä»£ç è´¨é‡</div>\n                <div class="score-value">${e.scoreBreakdown.code}</div>\n            </div>\n        </div>\n        \n        <div class="summary">\n            <strong>ğŸ“ ä¼˜åŒ–æ‘˜è¦</strong><br><br>\n            ${e.summary}\n        </div>\n        \n        <div class="advices">\n            ${e.advices.map(e=>`\n                <div class="advice-card">\n                    <div class="advice-header">\n                        <span class="priority-badge priority-${e.priority}">\n                            ${"high"===e.priority?"ğŸ”´ é«˜ä¼˜å…ˆçº§":"medium"===e.priority?"ğŸŸ¡ ä¸­ä¼˜å…ˆçº§":"ğŸŸ¢ ä½ä¼˜å…ˆçº§"}\n                        </span>\n                        <span class="advice-title">${e.title}</span>\n                    </div>\n                    <div class="advice-body">\n                        <p>${e.description}</p>\n                        ${e.currentState?`<p><strong>å½“å‰çŠ¶æ€:</strong> ${e.currentState}</p>`:""}\n                        ${e.suggestedState?`<p><strong>å»ºè®®çŠ¶æ€:</strong> ${e.suggestedState}</p>`:""}\n                        ${e.codeExample?`\n                            <div class="code-example">\n                                <pre>${e.codeExample}</pre>\n                            </div>\n                        `:""}\n                        ${e.impact?`<p><strong>é¢„æœŸå½±å“:</strong> ${e.impact}</p>`:""}\n                    </div>\n                </div>\n            `).join("")}\n        </div>\n    `:'\n        <div class="empty-state">\n            <div class="icon">ğŸ”</div>\n            <h2>å¼€å§‹åˆ†æç­–ç•¥</h2>\n            <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ†æç­–ç•¥ä»£ç </p>\n        </div>\n    '}\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case 'analyzing':\n                    document.body.innerHTML = '<div class="empty-state"><div class="icon">â³</div><h2>æ­£åœ¨åˆ†æç­–ç•¥...</h2></div>';\n                    break;\n                case 'reportReady':\n                    location.reload();\n                    break;\n                case 'error':\n                    alert('åˆ†æå¤±è´¥: ' + message.message);\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>`}dispose(){for(u.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}}n.StrategyOptimizerPanel=u},317:e=>{e.exports=require("child_process")},327:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.getMainlines=async function(e,n){c.logger.info("æ‰§è¡Œè·å–æŠ•èµ„ä¸»çº¿å‘½ä»¤",d);const t=await i.window.showQuickPick([{label:"ğŸ“… çŸ­æœŸ (1-5å¤©)",value:"short",description:"é€‚åˆçŸ­çº¿äº¤æ˜“"},{label:"ğŸ“† ä¸­æœŸ (1-4å‘¨)",value:"medium",description:"é€‚åˆæ³¢æ®µæ“ä½œ"},{label:"ğŸ“† é•¿æœŸ (1æœˆ+)",value:"long",description:"é€‚åˆä»·å€¼æŠ•èµ„"}],{placeHolder:"é€‰æ‹©æŠ•èµ„å‘¨æœŸ"});t&&await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(a,r)=>{try{if(a.report({message:"æ­£åœ¨è·å–æŠ•èµ„ä¸»çº¿...",increment:0}),r.isCancellationRequested)return void c.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",d);const o=await e.getMainlines({top_n:20,time_horizon:t.value});if(a.report({increment:60}),!o.ok||!o.data)return void i.window.showErrorMessage(`è·å–æŠ•èµ„ä¸»çº¿å¤±è´¥: ${o.error||"æœªçŸ¥é”™è¯¯"}`);const s=o.data;c.logger.info(`è·å–åˆ° ${s.length} æ¡æŠ•èµ„ä¸»çº¿`,d),a.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(e,n,t){const a=i.window.createWebviewPanel("trquantMainlines","ğŸ¯ æŠ•èµ„ä¸»çº¿",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(e,n){const t=e.length>0?e.map((e,n)=>function(e,n){const t=n<3?`rank-${n+1}`:"rank-default",a=Math.min(100*e.score,100);return`\n        <div class="mainline-card" onclick="selectMainline('${e.name}')">\n            <div class="mainline-header">\n                <div class="mainline-rank">\n                    <div class="rank-badge ${t}">${n+1}</div>\n                    <span class="mainline-name">${e.name}</span>\n                </div>\n                <div class="mainline-score">\n                    <div class="score-bar">\n                        <div class="score-fill" style="width: ${a}%"></div>\n                    </div>\n                    <span class="score-value">${e.score.toFixed(2)}</span>\n                </div>\n            </div>\n            <div class="mainline-industries">\n                ${e.industries.map(e=>`<span class="industry-tag">${e}</span>`).join("")}\n            </div>\n            <div class="mainline-logic">\n                ğŸ’¡ ${e.logic||"æš‚æ— è¯¦ç»†è¯´æ˜"}\n            </div>\n        </div>\n    `}(e,n)).join(""):'<div class="empty-state">æš‚æ— æŠ•èµ„ä¸»çº¿æ•°æ®</div>';return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>æŠ•èµ„ä¸»çº¿</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n            --gold: #fbbf24;\n            --silver: #94a3b8;\n            --bronze: #b45309;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .time-badge {\n            background: var(--primary);\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .stats-row {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .stat-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .stat-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .stat-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .mainlines-list {\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n\n        .mainline-card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .mainline-card:hover {\n            border-color: var(--primary);\n            transform: translateY(-2px);\n        }\n\n        .mainline-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 12px;\n        }\n\n        .mainline-rank {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n\n        .rank-badge {\n            width: 32px;\n            height: 32px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: 700;\n            font-size: 14px;\n        }\n\n        .rank-1 { background: var(--gold); color: #1a1a2e; }\n        .rank-2 { background: var(--silver); color: #1a1a2e; }\n        .rank-3 { background: var(--bronze); color: white; }\n        .rank-default { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .mainline-name {\n            font-size: 18px;\n            font-weight: 600;\n        }\n\n        .mainline-score {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .score-bar {\n            width: 100px;\n            height: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .score-fill {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--success));\n            border-radius: 4px;\n        }\n\n        .score-value {\n            font-weight: 600;\n            color: var(--success);\n            min-width: 50px;\n            text-align: right;\n        }\n\n        .mainline-industries {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n            margin-bottom: 12px;\n        }\n\n        .industry-tag {\n            background: var(--bg-tertiary);\n            color: var(--text-secondary);\n            padding: 4px 12px;\n            border-radius: 16px;\n            font-size: 12px;\n        }\n\n        .mainline-logic {\n            color: var(--text-secondary);\n            font-size: 14px;\n            line-height: 1.6;\n            padding-left: 16px;\n            border-left: 3px solid var(--primary);\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n            padding-top: 24px;\n            border-top: 1px solid var(--border);\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-muted);\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ¯</span>\n            <div>\n                <div class="header-title">æŠ•èµ„ä¸»çº¿ TOP ${e.length}</div>\n                <div class="header-subtitle">åŸºäºå¸‚åœºçƒ­åº¦ã€èµ„é‡‘æµå‘ã€è¡Œä¸šæ™¯æ°”åº¦ç»¼åˆè¯„ä¼°</div>\n            </div>\n        </div>\n        <span class="time-badge">${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[n]||n}</span>\n    </div>\n\n    <div class="stats-row">\n        <div class="stat-card">\n            <div class="stat-value">${e.length}</div>\n            <div class="stat-label">ä¸»çº¿æ•°é‡</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${e.length>0?e[0].score.toFixed(2):"-"}</div>\n            <div class="stat-label">æœ€é«˜è¯„åˆ†</div>\n        </div>\n        <div class="stat-card">\n            <div class="stat-value">${function(e){const n=new Set;return e.forEach(e=>e.industries.forEach(e=>n.add(e))),n.size}(e)}</div>\n            <div class="stat-label">æ¶‰åŠè¡Œä¸š</div>\n        </div>\n    </div>\n\n    <div class="mainlines-list">\n        ${t}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ åŸºäºä¸»çº¿ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function selectMainline(mainline) {\n            vscode.postMessage({ command: 'selectMainline', mainline });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ command: 'generateStrategy' });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(n,t),a.webview.onDidReceiveMessage(async e=>{switch(e.command){case"selectMainline":a=e.mainline,i.window.showInformationMessage(`å·²é€‰æ‹©ä¸»çº¿: ${a}`,"æŸ¥çœ‹è¯¦æƒ…","ç­›é€‰è‚¡ç¥¨").then(e=>{"æŸ¥çœ‹è¯¦æƒ…"===e?c.logger.info(`æŸ¥çœ‹ä¸»çº¿è¯¦æƒ…: ${a}`,d):"ç­›é€‰è‚¡ç¥¨"===e&&c.logger.info(`åŸºäºä¸»çº¿ç­›é€‰è‚¡ç¥¨: ${a}`,d)});break;case"generateStrategy":i.commands.executeCommand("trquant.generateStrategy");break;case"copyPrompt":const r=p(n,t);await i.env.clipboard.writeText(r),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}var a},void 0,e.subscriptions)}(n,s,t.value),a.report({increment:20}),async function(e){if(0!==e.length)switch(await i.window.showInformationMessage(`è·å–åˆ° ${e.length} æ¡æŠ•èµ„ä¸»çº¿`,"ç”Ÿæˆç­–ç•¥","æ¨èå› å­","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":i.commands.executeCommand("trquant.generateStrategy");break;case"æ¨èå› å­":i.commands.executeCommand("trquant.recommendFactors");break;case"å¤åˆ¶Prompt":const n=p(e,"short");await i.env.clipboard.writeText(n),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}}(s)}catch(e){l.ErrorHandler.handle(e,d)}})};const i=s(t(398)),c=t(628),l=t(799),d="GetMainlines";function p(e,n){return`# Aè‚¡æŠ•èµ„ä¸»çº¿åˆ†æ\n\n## åˆ†æå‘¨æœŸ: ${{short:"çŸ­æœŸ (1-5å¤©)",medium:"ä¸­æœŸ (1-4å‘¨)",long:"é•¿æœŸ (1æœˆ+)"}[n]||n}\n\n## TOP ${e.length} æŠ•èµ„ä¸»çº¿\n\n${e.map((e,n)=>`\n### ${n+1}. ${e.name} (è¯„åˆ†: ${e.score.toFixed(2)})\n- **ç›¸å…³è¡Œä¸š**: ${e.industries.join(", ")}\n- **æŠ•èµ„é€»è¾‘**: ${e.logic||"æš‚æ— "}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸ŠæŠ•èµ„ä¸»çº¿ï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå½“å‰æœ€å€¼å¾—å…³æ³¨çš„ä¸»çº¿åŠå…¶åŸå› \n2. æ¨èé€‚åˆè¿™äº›ä¸»çº¿çš„é‡åŒ–å› å­\n3. ç”Ÿæˆé’ˆå¯¹TOP3ä¸»çº¿çš„PTradeé‡åŒ–ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- ç­–ç•¥åº”è¯¥èšç„¦äºä¸»çº¿ç›¸å…³çš„è‚¡ç¥¨æ± \n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n- æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},334:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.MCPRegistrar=void 0;const i=s(t(398)),c=s(t(928)),l=s(t(896)),d=s(t(857)),p=t(628),g=t(478),u="MCPRegistrar";n.MCPRegistrar=class{static async registerServer(e){p.logger.info("å¼€å§‹æ³¨å†ŒMCP Server...",u);try{const n=this.getMCPConfigPath();p.logger.info(`MCPé…ç½®è·¯å¾„: ${n}`,u);let t=this.loadMCPConfig(n);const a=g.config.getPythonPath(e.extensionPath),r=c.join(e.extensionPath,"python","mcp_server.py");t.mcpServers.trquant={command:a,args:[r],env:{PYTHONIOENCODING:"utf-8",TRQUANT_ROOT:c.dirname(e.extensionPath)}},this.saveMCPConfig(n,t),p.logger.info("MCP Server æ³¨å†ŒæˆåŠŸ",u),i.window.showInformationMessage("TRQuant MCP Server å·²æ³¨å†Œã€‚é‡å¯Cursoråç”Ÿæ•ˆã€‚","æŸ¥çœ‹é…ç½®","äº†è§£æ›´å¤š").then(e=>{"æŸ¥çœ‹é…ç½®"===e?this.openMCPConfig(n):"äº†è§£æ›´å¤š"===e&&i.env.openExternal(i.Uri.parse("https://docs.cursor.com/context/model-context-protocol"))})}catch(e){throw p.logger.error(`MCPæ³¨å†Œå¤±è´¥: ${e instanceof Error?e.message:String(e)}`,u),e}}static getMCPConfigPath(){const e=d.homedir(),n=[c.join(e,".cursor","mcp.json"),c.join(e,"Library","Application Support","Cursor","mcp.json"),c.join(e,"AppData","Roaming","Cursor","mcp.json")];for(const e of n)if(l.existsSync(e))return e;switch(d.platform()){case"darwin":return n[1];case"win32":return n[2];default:return n[0]}}static loadMCPConfig(e){try{if(l.existsSync(e)){const n=l.readFileSync(e,"utf-8");return JSON.parse(n)}}catch(e){p.logger.warn(`è¯»å–MCPé…ç½®å¤±è´¥: ${e}`,u)}return{mcpServers:{}}}static saveMCPConfig(e,n){const t=c.dirname(e);l.existsSync(t)||l.mkdirSync(t,{recursive:!0});const a=JSON.stringify(n,null,2);l.writeFileSync(e,a,"utf-8"),p.logger.info(`MCPé…ç½®å·²ä¿å­˜: ${e}`,u)}static async openMCPConfig(e){const n=await i.workspace.openTextDocument(e);await i.window.showTextDocument(n)}static isRegistered(){try{const e=this.getMCPConfigPath();return"trquant"in this.loadMCPConfig(e).mcpServers}catch{return!1}}static async unregisterServer(){p.logger.info("ç§»é™¤MCP Serveræ³¨å†Œ...",u);try{const e=this.getMCPConfigPath();let n=this.loadMCPConfig(e);"trquant"in n.mcpServers&&(delete n.mcpServers.trquant,this.saveMCPConfig(e,n),p.logger.info("MCP Server å·²ç§»é™¤",u))}catch(e){p.logger.error(`ç§»é™¤MCPæ³¨å†Œå¤±è´¥: ${e instanceof Error?e.message:String(e)}`,u)}}}},360:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowPanel=void 0,n.registerWorkflowPanel=function(e,n){if(console.log("[WorkflowPanel] ========== å¼€å§‹æ³¨å†Œå·¥ä½œæµé¢æ¿å‘½ä»¤ =========="),c.logger.info("å¼€å§‹æ³¨å†Œå·¥ä½œæµé¢æ¿",l),!e)throw console.error("[WorkflowPanel] âŒ context å‚æ•°ä¸ºç©º"),new Error("context å‚æ•°ä¸èƒ½ä¸ºç©º");if(!n)throw console.error("[WorkflowPanel] âŒ client å‚æ•°ä¸ºç©º"),new Error("client å‚æ•°ä¸èƒ½ä¸ºç©º");console.log("[WorkflowPanel] å‚æ•°éªŒè¯é€šè¿‡ï¼Œå¼€å§‹æ³¨å†Œå‘½ä»¤...");try{const t=i.commands.registerCommand("trquant.openWorkflowPanel",()=>{console.log("[WorkflowPanel] âœ… trquant.openWorkflowPanel å‘½ä»¤è¢«è§¦å‘"),c.logger.info("æ‰“å¼€å·¥ä½œæµé¢æ¿å‘½ä»¤è¢«è§¦å‘",l);try{p.createOrShow(e.extensionUri,n),console.log("[WorkflowPanel] âœ… å·¥ä½œæµé¢æ¿å·²åˆ›å»º"),c.logger.info("å·¥ä½œæµé¢æ¿å·²åˆ›å»º",l)}catch(e){const n=e instanceof Error?e.message:String(e);console.error("[WorkflowPanel] âŒ åˆ›å»ºå·¥ä½œæµé¢æ¿å¤±è´¥:",n),c.logger.error(`åˆ›å»ºå·¥ä½œæµé¢æ¿å¤±è´¥: ${n}`,l),i.window.showErrorMessage(`æ‰“å¼€å·¥ä½œæµé¢æ¿å¤±è´¥: ${n}`)}});console.log("[WorkflowPanel] å‘½ä»¤å·²æ³¨å†Œï¼Œdisposable:",t),e.subscriptions.push(t),console.log("[WorkflowPanel] å‘½ä»¤å·²æ·»åŠ åˆ°context.subscriptionsï¼Œå½“å‰è®¢é˜…æ•°:",e.subscriptions.length),console.log("[WorkflowPanel] å‘½ä»¤å·²æ³¨å†Œåˆ°context.subscriptions"),setTimeout(()=>{i.commands.getCommands().then(e=>{console.log("[WorkflowPanel] æ£€æŸ¥å‘½ä»¤åˆ—è¡¨ï¼Œæ€»æ•°:",e.length),e.includes("trquant.openWorkflowPanel")?(console.log("[WorkflowPanel] âœ… å‘½ä»¤æ³¨å†ŒéªŒè¯æˆåŠŸ: trquant.openWorkflowPanel"),c.logger.info("å·¥ä½œæµé¢æ¿å‘½ä»¤æ³¨å†ŒéªŒè¯æˆåŠŸ",l)):(console.error("[WorkflowPanel] âŒ å‘½ä»¤æ³¨å†ŒéªŒè¯å¤±è´¥: trquant.openWorkflowPanel ä¸åœ¨å‘½ä»¤åˆ—è¡¨ä¸­"),console.error("[WorkflowPanel] æœç´¢trquantç›¸å…³å‘½ä»¤:",e.filter(e=>e.startsWith("trquant."))),c.logger.error("å·¥ä½œæµé¢æ¿å‘½ä»¤æ³¨å†ŒéªŒè¯å¤±è´¥",l))},e=>{console.error("[WorkflowPanel] éªŒè¯å‘½ä»¤æ—¶å‡ºé”™:",e)})},1e3),c.logger.info("å·¥ä½œæµé¢æ¿å·²æ³¨å†Œï¼ˆå¤ç”¨æ¡Œé¢ç³»ç»Ÿä»£ç ï¼‰",l),console.log("[WorkflowPanel] ========== å·¥ä½œæµé¢æ¿å‘½ä»¤æ³¨å†Œå®Œæˆ ==========")}catch(e){const n=e instanceof Error?e.message:String(e);throw console.error("[WorkflowPanel] âŒ æ³¨å†Œå‘½ä»¤æ—¶å‘ç”Ÿå¼‚å¸¸:",n),console.error("[WorkflowPanel] é”™è¯¯å †æ ˆ:",e instanceof Error?e.stack:"æ— å †æ ˆä¿¡æ¯"),c.logger.error(`æ³¨å†Œå·¥ä½œæµé¢æ¿å‘½ä»¤æ—¶å‘ç”Ÿå¼‚å¸¸: ${n}`,l),e}};const i=s(t(398)),c=t(628),l="WorkflowPanel",d=[{id:"data_source",name:"ä¿¡æ¯è·å–",icon:"ğŸ“¡",color:"#58a6ff"},{id:"market_trend",name:"å¸‚åœºè¶‹åŠ¿",icon:"ğŸ“ˆ",color:"#667eea"},{id:"mainline",name:"æŠ•èµ„ä¸»çº¿",icon:"ğŸ”¥",color:"#F59E0B"},{id:"candidate_pool",name:"å€™é€‰æ± æ„å»º",icon:"ğŸ“¦",color:"#a371f7"},{id:"factor",name:"å› å­æ„å»º",icon:"ğŸ§®",color:"#3fb950"},{id:"strategy",name:"ç­–ç•¥ç”Ÿæˆ",icon:"ğŸ’»",color:"#d29922"}];class p{static currentPanel;_panel;_extensionUri;_client;_disposables=[];_currentStep=null;_isRunning=!1;constructor(e,n,t){this._panel=e,this._extensionUri=n,this._client=t,this._panel.webview.html=this._getHtmlContent(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(e=>this._handleMessage(e),null,this._disposables)}static createOrShow(e,n){console.log("[WorkflowPanel] createOrShow è¢«è°ƒç”¨"),c.logger.info("åˆ›å»ºå·¥ä½œæµé¢æ¿",l);const t=i.ViewColumn.One;if(p.currentPanel)return console.log("[WorkflowPanel] é¢æ¿å·²å­˜åœ¨ï¼Œæ˜¾ç¤ºç°æœ‰é¢æ¿"),p.currentPanel._panel.reveal(t),p.currentPanel;console.log("[WorkflowPanel] åˆ›å»ºæ–°çš„å·¥ä½œæµé¢æ¿");const a=i.window.createWebviewPanel("trquantWorkflow","ğŸ”„ é›†æˆå·¥ä½œæµç¨‹",t,{enableScripts:!0,retainContextWhenHidden:!0,localResourceRoots:[e]});return p.currentPanel=new p(a,e,n),console.log("[WorkflowPanel] å·¥ä½œæµé¢æ¿åˆ›å»ºæˆåŠŸ"),c.logger.info("å·¥ä½œæµé¢æ¿åˆ›å»ºæˆåŠŸ",l),p.currentPanel}dispose(){for(p.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}async _handleMessage(e){switch(c.logger.info(`[WorkflowPanel] æ”¶åˆ°æ¶ˆæ¯: ${e.command}`,l),e.command){case"runStep":await this._runStep(e.stepId);break;case"runAll":await this._runAll();break;case"cancel":this._isRunning=!1,this._postMessage({command:"cancelled"})}}async _runStep(e){if(this._isRunning)i.window.showWarningMessage("å·¥ä½œæµæ­£åœ¨æ‰§è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ");else{this._isRunning=!0,this._currentStep=e,this._postMessage({command:"stepStarted",stepId:e,stepName:d.find(n=>n.id===e)?.name||e});try{const n=await this._client.callBridge("run_workflow_step",{step_id:e}),t=n;n.ok?this._postMessage({command:"stepFinished",stepId:e,success:!0,summary:t.summary||"æ‰§è¡ŒæˆåŠŸ",details:t.data||{},stepName:t.step_name||d.find(n=>n.id===e)?.name||e}):this._postMessage({command:"stepFinished",stepId:e,success:!1,summary:t.error||"æ‰§è¡Œå¤±è´¥",details:{},stepName:d.find(n=>n.id===e)?.name||e})}catch(n){const t=n instanceof Error?n.message:String(n);c.logger.error(`æ­¥éª¤ ${e} æ‰§è¡Œå¤±è´¥: ${t}`,l),this._postMessage({command:"stepFinished",stepId:e,success:!1,summary:`æ‰§è¡Œå¤±è´¥: ${t}`,details:{},stepName:d.find(n=>n.id===e)?.name||e})}finally{this._isRunning=!1,this._currentStep=null}}}async _runAll(){this._isRunning?i.window.showWarningMessage("å·¥ä½œæµæ­£åœ¨æ‰§è¡Œä¸­ï¼Œè¯·ç­‰å¾…å®Œæˆ"):(this._isRunning=!0,await i.window.withProgress({location:i.ProgressLocation.Notification,title:"ğŸ”„ æ‰§è¡Œå®Œæ•´å·¥ä½œæµ",cancellable:!0},async(e,n)=>{const t=[];let a=!1;this._postMessage({command:"allStarted"});try{const n=await this._client.callBridge("run_full_workflow",{}),r=n;if(!n.ok||!r.data)throw new Error(n.error||"æ‰§è¡Œå¤±è´¥");{const n=r.data,o=n.steps||[];for(const n of o){const r=this._getStepIdFromName(n.step_name);this._postMessage({command:"stepFinished",stepId:r,success:n.success,summary:n.summary||"",details:n.details||{},stepName:n.step_name}),t.push({step:n.step_name,success:n.success,error:n.error}),n.success||(a=!0),e.report({message:`${n.step_name}: ${n.success?"âœ…":"âŒ"}`,increment:100/o.length})}this._postMessage({command:"allFinished",success:!a,results:t,strategyFile:n.strategy_file,totalTime:n.total_time}),a?i.window.showWarningMessage("âš ï¸ å·¥ä½œæµå®Œæˆï¼Œéƒ¨åˆ†æ­¥éª¤æœ‰é”™è¯¯"):i.window.showInformationMessage("âœ… å®Œæ•´å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼")}}catch(e){const n=e instanceof Error?e.message:String(e);c.logger.error(`å®Œæ•´å·¥ä½œæµæ‰§è¡Œå¤±è´¥: ${n}`,l),this._postMessage({command:"allFinished",success:!1,results:[],error:n}),i.window.showErrorMessage(`å·¥ä½œæµæ‰§è¡Œå¤±è´¥: ${n}`)}finally{this._isRunning=!1}}))}_getStepIdFromName(e){return{æ•°æ®æº:"data_source",æ•°æ®æºæ£€æµ‹:"data_source",å¸‚åœºè¶‹åŠ¿:"market_trend",æŠ•èµ„ä¸»çº¿:"mainline",å€™é€‰æ± :"candidate_pool",å€™é€‰æ± æ„å»º:"candidate_pool",å› å­æ¨è:"factor",ç­–ç•¥ç”Ÿæˆ:"strategy"}[e]||e.toLowerCase().replace(/\s+/g,"_")}_postMessage(e){this._panel.webview.postMessage(e)}_getHtmlContent(){return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>é›†æˆå·¥ä½œæµç¨‹</title>\n    <style>\n        :root {\n            --bg-primary: #0d1117;\n            --bg-secondary: #161b22;\n            --bg-tertiary: #21262d;\n            --border-color: #30363d;\n            --text-primary: #c9d1d9;\n            --text-secondary: #8b949e;\n            --accent-blue: #58a6ff;\n            --accent-green: #3fb950;\n            --accent-yellow: #d29922;\n            --accent-red: #f85149;\n            --accent-purple: #a371f7;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            height: 100vh;\n            overflow: hidden;\n        }\n        \n        .container {\n            display: flex;\n            height: 100vh;\n            gap: 0;\n        }\n        \n        /* å·¦ä¾§æ­¥éª¤åŒºåŸŸ */\n        .steps-panel {\n            width: 280px;\n            background: var(--bg-secondary);\n            border-right: 1px solid var(--border-color);\n            padding: 16px;\n            overflow-y: auto;\n        }\n        \n        .header {\n            margin-bottom: 20px;\n        }\n        \n        .header h1 {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 12px;\n        }\n        \n        .run-all-btn {\n            width: 100%;\n            padding: 10px;\n            background: linear-gradient(135deg, #6366f1, #8b5cf6);\n            color: white;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            font-size: 14px;\n            transition: all 0.2s;\n        }\n        \n        .run-all-btn:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n        }\n        \n        .run-all-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n        \n        .steps-list {\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        \n        .step-card {\n            background: var(--bg-tertiary);\n            border: 2px solid var(--border-color);\n            border-left: 4px solid var(--step-color);\n            border-radius: 10px;\n            padding: 14px;\n            cursor: pointer;\n            transition: all 0.2s;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n        \n        .step-card:hover {\n            background: var(--bg-primary);\n            border-color: var(--accent-blue);\n        }\n        \n        .step-card.running {\n            border-color: var(--accent-yellow);\n            animation: pulse 1.5s infinite;\n        }\n        \n        .step-card.completed {\n            border-color: var(--accent-green);\n        }\n        \n        .step-card.failed {\n            border-color: var(--accent-red);\n        }\n        \n        @keyframes pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(217, 153, 34, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(217, 153, 34, 0); }\n        }\n        \n        .step-icon {\n            font-size: 26px;\n            width: 36px;\n            text-align: center;\n        }\n        \n        .step-name {\n            flex: 1;\n            font-size: 15px;\n            font-weight: 600;\n        }\n        \n        .step-status {\n            font-size: 16px;\n        }\n        \n        /* å³ä¾§ç»“æœåŒºåŸŸ */\n        .result-panel {\n            flex: 1;\n            background: var(--bg-primary);\n            padding: 20px;\n            overflow-y: auto;\n        }\n        \n        .result-header {\n            margin-bottom: 20px;\n        }\n        \n        .result-title {\n            font-size: 20px;\n            font-weight: 600;\n            margin-bottom: 8px;\n        }\n        \n        .result-summary {\n            background: var(--bg-secondary);\n            padding: 16px;\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n            margin-bottom: 20px;\n        }\n        \n        .result-details {\n            background: var(--bg-secondary);\n            padding: 16px;\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n            max-height: 400px;\n            overflow-y: auto;\n        }\n        \n        .result-details table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        .result-details th,\n        .result-details td {\n            padding: 8px;\n            text-align: left;\n            border-bottom: 1px solid var(--border-color);\n        }\n        \n        .result-details th {\n            background: var(--bg-tertiary);\n            font-weight: 600;\n        }\n        \n        .empty-state {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--text-secondary);\n        }\n        \n        .empty-icon {\n            font-size: 48px;\n            margin-bottom: 12px;\n            opacity: 0.5;\n        }\n        \n        .progress-bar {\n            height: 6px;\n            background: var(--bg-tertiary);\n            border-radius: 3px;\n            overflow: hidden;\n            margin: 12px 0;\n        }\n        \n        .progress-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #6366f1, #8b5cf6);\n            width: 0%;\n            transition: width 0.3s;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        \x3c!-- å·¦ä¾§æ­¥éª¤ --\x3e\n        <div class="steps-panel">\n            <div class="header">\n                <h1>ğŸ”„ é›†æˆå·¥ä½œæµç¨‹</h1>\n                <button class="run-all-btn" id="runAllBtn" onclick="runAll()">\n                    â–¶ï¸ ä¸€é”®æ‰§è¡Œå…¨éƒ¨\n                </button>\n            </div>\n            <div class="steps-list" id="stepsList">\n                ${d.map(e=>`\n                    <div class="step-card" id="step-${e.id}" \n                         style="--step-color: ${e.color}"\n                         onclick="runStep('${e.id}')">\n                        <div class="step-icon">${e.icon}</div>\n                        <div class="step-name">${e.name}</div>\n                        <div class="step-status" id="status-${e.id}">â–¶ï¸</div>\n                    </div>\n                `).join("")}\n            </div>\n        </div>\n        \n        \x3c!-- å³ä¾§ç»“æœ --\x3e\n        <div class="result-panel">\n            <div class="result-header">\n                <div class="result-title" id="resultTitle">ğŸ“‹ æ‰§è¡Œç»“æœ</div>\n            </div>\n            <div class="result-summary" id="resultSummary">\n                ç‚¹å‡»å·¦ä¾§æ­¥éª¤å¼€å§‹æ‰§è¡Œ...\n            </div>\n            <div class="result-details" id="resultDetails"></div>\n        </div>\n    </div>\n    \n    <script>\n        const vscode = acquireVsCodeApi();\n        let isRunning = false;\n        \n        function runStep(stepId) {\n            if (isRunning) {\n                return;\n            }\n            vscode.postMessage({ command: 'runStep', stepId });\n        }\n        \n        function runAll() {\n            if (isRunning) {\n                return;\n            }\n            vscode.postMessage({ command: 'runAll' });\n        }\n        \n        function setStepStatus(stepId, status) {\n            const card = document.getElementById('step-' + stepId);\n            const statusEl = document.getElementById('status-' + stepId);\n            \n            card.classList.remove('running', 'completed', 'failed');\n            \n            switch(status) {\n                case 'running':\n                    card.classList.add('running');\n                    statusEl.textContent = 'â³';\n                    break;\n                case 'completed':\n                    card.classList.add('completed');\n                    statusEl.textContent = 'âœ…';\n                    break;\n                case 'failed':\n                    card.classList.add('failed');\n                    statusEl.textContent = 'âŒ';\n                    break;\n                default:\n                    statusEl.textContent = 'â–¶ï¸';\n            }\n        }\n        \n        function formatDetails(details) {\n            if (!details || Object.keys(details).length === 0) {\n                return '<div style="color:var(--text-secondary);">æ— è¯¦ç»†æ•°æ®</div>';\n            }\n            \n            let html = '';\n            \n            // æŠ•èµ„ä¸»çº¿\n            if (details.top_mainlines) {\n                const mainlines = details.top_mainlines;\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ”¥ æŠ•èµ„ä¸»çº¿ TOP' + mainlines.length + '</strong></div>';\n                html += '<table><tr><th>æ’å</th><th>åç§°</th><th>è¯„åˆ†</th></tr>';\n                mainlines.slice(0, 10).forEach(ml => {\n                    html += '<tr><td>#' + (ml.rank || '-') + '</td><td>' + (ml.name || '-') + '</td><td>' + ((ml.composite_score || ml.score || 0).toFixed?.(1) || '-') + '</td></tr>';\n                });\n                html += '</table>';\n            }\n            \n            // å€™é€‰æ± è‚¡ç¥¨\n            else if (details.stocks) {\n                const stocks = details.stocks;\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ“¦ å€™é€‰æ± è‚¡ç¥¨ (' + stocks.length + 'åª)</strong></div>';\n                html += '<table><tr><th>ä»£ç </th><th>åç§°</th><th>æ¥æº</th><th>è¯„åˆ†</th></tr>';\n                stocks.slice(0, 15).forEach(s => {\n                    html += '<tr><td>' + (s.code || '-') + '</td><td>' + (s.name || '-') + '</td><td>' + (s.source || '-') + '</td><td>' + ((s.score || 0).toFixed?.(1) || '-') + '</td></tr>';\n                });\n                html += '</table>';\n            }\n            \n            // æ¨èå› å­\n            else if (details.recommended_factors) {\n                const factors = details.recommended_factors;\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ§® æ¨èå› å­</strong></div>';\n                html += '<ul style="margin:0;padding-left:20px;">';\n                factors.forEach(f => {\n                    const weight = ((f.weight || 0) * 100).toFixed(0);\n                    html += '<li style="margin:6px 0;"><strong>' + (f.name || '-') + '</strong> (æƒé‡' + weight + '%) - ' + (f.reason || '') + '</li>';\n                });\n                html += '</ul>';\n            }\n            \n            // æ•°æ®æºæ£€æµ‹\n            else if (details.jqdata !== undefined || details.akshare !== undefined) {\n                html += '<div style="margin-bottom:12px;"><strong>ğŸ“¡ æ•°æ®æºçŠ¶æ€</strong></div>';\n                html += '<table><tr><th>æ•°æ®æº</th><th>çŠ¶æ€</th></tr>';\n                if (details.jqdata !== undefined) {\n                    html += '<tr><td>JQData</td><td style="color:' + (details.jqdata ? '#3fb950' : '#f85149') + ';">' + (details.jqdata ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨') + '</td></tr>';\n                }\n                if (details.akshare !== undefined) {\n                    html += '<tr><td>AKShare</td><td style="color:' + (details.akshare ? '#3fb950' : '#f85149') + ';">' + (details.akshare ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨') + '</td></tr>';\n                }\n                html += '</table>';\n            }\n            \n            // é»˜è®¤JSONæ˜¾ç¤º\n            else {\n                html += '<pre style="font-size:11px;overflow-x:auto;">' + JSON.stringify(details, null, 2) + '</pre>';\n            }\n            \n            return html;\n        }\n        \n        window.addEventListener('message', event => {\n            const message = event.data;\n            \n            switch (message.command) {\n                case 'stepStarted':\n                    isRunning = true;\n                    document.getElementById('runAllBtn').disabled = true;\n                    setStepStatus(message.stepId, 'running');\n                    document.getElementById('resultTitle').textContent = 'ğŸ“‹ ' + message.stepName + ' - æ‰§è¡Œä¸­';\n                    document.getElementById('resultSummary').textContent = 'æ­£åœ¨æ‰§è¡Œ ' + message.stepName + '...';\n                    document.getElementById('resultDetails').innerHTML = '';\n                    break;\n                    \n                case 'stepFinished':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    setStepStatus(message.stepId, message.success ? 'completed' : 'failed');\n                    document.getElementById('resultTitle').textContent = 'ğŸ“‹ ' + message.stepName + ' - ' + (message.success ? 'âœ… å®Œæˆ' : 'âŒ å¤±è´¥');\n                    document.getElementById('resultSummary').textContent = message.summary || (message.success ? 'æ‰§è¡ŒæˆåŠŸ' : 'æ‰§è¡Œå¤±è´¥');\n                    document.getElementById('resultDetails').innerHTML = formatDetails(message.details);\n                    break;\n                    \n                case 'allStarted':\n                    isRunning = true;\n                    document.getElementById('runAllBtn').disabled = true;\n                    document.getElementById('resultTitle').textContent = 'ğŸ”„ æ‰§è¡Œå®Œæ•´å·¥ä½œæµ';\n                    document.getElementById('resultSummary').textContent = 'æ­£åœ¨æ‰§è¡Œæ‰€æœ‰æ­¥éª¤...';\n                    document.getElementById('resultDetails').innerHTML = '';\n                    // é‡ç½®æ‰€æœ‰æ­¥éª¤çŠ¶æ€\n                    ${d.map(e=>`setStepStatus('${e.id}', 'default');`).join("")}\n                    break;\n                    \n                case 'allFinished':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    document.getElementById('resultTitle').textContent = message.success ? 'âœ… å·¥ä½œæµæ‰§è¡Œå®Œæˆ' : 'âš ï¸ å·¥ä½œæµå®Œæˆï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰';\n                    document.getElementById('resultSummary').textContent = 'å…±æ‰§è¡Œ ' + (message.results?.length || 0) + ' ä¸ªæ­¥éª¤';\n                    \n                    // æ˜¾ç¤ºæ±‡æ€»\n                    let summaryHtml = '<div style="margin-top:16px;">';\n                    summaryHtml += '<h4 style="margin-bottom:8px;">æ‰§è¡Œç»“æœæ±‡æ€»</h4>';\n                    if (message.results) {\n                        message.results.forEach(r => {\n                            summaryHtml += '<div style="display:flex;align-items:center;gap:8px;margin:4px 0;">';\n                            summaryHtml += '<span>' + (r.success ? 'âœ…' : 'âŒ') + '</span>';\n                            summaryHtml += '<span>' + r.step + '</span>';\n                            if (r.error) {\n                                summaryHtml += '<span style="color:#f85149;font-size:11px;">(' + r.error + ')</span>';\n                            }\n                            summaryHtml += '</div>';\n                        });\n                    }\n                    summaryHtml += '</div>';\n                    document.getElementById('resultDetails').innerHTML = summaryHtml;\n                    break;\n                    \n                case 'cancelled':\n                    isRunning = false;\n                    document.getElementById('runAllBtn').disabled = false;\n                    break;\n            }\n        });\n    <\/script>\n</body>\n</html>`}}n.WorkflowPanel=p},381:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.platformAdapter=n.PlatformAdapter=void 0;const t=[{source:{platform:"joinquant",api:"get_price",signature:"get_price(security, start_date, end_date, frequency, fields, skip_paused, fq, count, panel, fill_paused)"},target:{platform:"ptrade",api:"get_history",signature:"get_history(count, frequency, field, security_list, skip_paused, fq, bar_count)"},paramMapping:{security:"security_list",count:"count",frequency:e=>"1d"===e?"daily":e,fields:"field",skip_paused:"skip_paused",fq:"fq"},notes:["PTradeçš„get_historyè¿”å›æ ¼å¼ä¸JoinQuantä¸åŒ","éœ€è¦å¤„ç†è¿”å›æ•°æ®çš„æ ¼å¼è½¬æ¢","PTradeä¸æ”¯æŒstart_date/end_dateå‚æ•°ï¼Œéœ€è¦ç”¨countæ›¿ä»£"],examples:{before:"df = get_price('000001.XSHE', count=20, end_date='2024-01-01', frequency='daily', fields=['close', 'volume'])",after:"df = get_history(count=20, frequency='daily', field=['close', 'volume'], security_list=['000001.XSHE'])"}},{source:{platform:"joinquant",api:"get_current_data",signature:"get_current_data(security)"},target:{platform:"ptrade",api:"get_snapshot",signature:"get_snapshot(stock_code)"},paramMapping:{security:"stock_code"},notes:["è¿”å›æ•°æ®ç»“æ„ä¸åŒï¼Œéœ€è¦é€‚é…å­—æ®µå"],examples:{before:"current = get_current_data('000001.XSHE')",after:"current = get_snapshot('000001.XSHE')"}},{source:{platform:"joinquant",api:"history",signature:"history(count, unit, field, security_list, df, skip_paused, fq)"},target:{platform:"ptrade",api:"get_history",signature:"get_history(count, frequency, field, security_list, skip_paused, fq, bar_count)"},paramMapping:{count:"count",unit:e=>"1d"===e?"daily":"1m"===e?"minute":e,field:"field",security_list:"security_list",skip_paused:"skip_paused",fq:"fq"},notes:["unitå‚æ•°éœ€è¦è½¬æ¢ä¸ºfrequency"],examples:{before:"df = history(20, '1d', 'close', ['000001.XSHE'])",after:"df = get_history(count=20, frequency='daily', field='close', security_list=['000001.XSHE'])"}},{source:{platform:"joinquant",api:"get_index_stocks",signature:"get_index_stocks(index_symbol, date)"},target:{platform:"ptrade",api:"get_index_stocks",signature:"get_index_stocks(index_code)"},paramMapping:{index_symbol:e=>e.replace(".XSHG",".SH").replace(".XSHE",".SZ")},notes:["è‚¡ç¥¨ä»£ç åç¼€éœ€è¦è½¬æ¢: .XSHGâ†’.SH, .XSHEâ†’.SZ"],examples:{before:"stocks = get_index_stocks('000300.XSHG')",after:"stocks = get_index_stocks('000300.SH')"}},{source:{platform:"joinquant",api:"order_target_value",signature:"order_target_value(security, value)"},target:{platform:"ptrade",api:"order_target_percent",signature:"order_target_percent(stock_code, percent)"},paramMapping:{security:"stock_code",value:(e,n)=>`${e} / context.portfolio.total_value`},notes:["PTradeä½¿ç”¨ç™¾åˆ†æ¯”è€Œéé‡‘é¢","éœ€è¦è®¡ç®—: percent = value / portfolio.total_value"],examples:{before:"order_target_value('000001.XSHE', 100000)",after:"order_target_percent('000001.XSHE', 100000 / context.portfolio.total_value)"}},{source:{platform:"joinquant",api:"order",signature:"order(security, amount, style)"},target:{platform:"ptrade",api:"order_lots",signature:"order_lots(stock_code, lots, limit_price)"},paramMapping:{security:"stock_code",amount:e=>`${e} // 100`},notes:["PTradeä½¿ç”¨æ‰‹æ•°(100è‚¡=1æ‰‹)è€Œéè‚¡æ•°"],examples:{before:"order('000001.XSHE', 1000)",after:"order_lots('000001.XSHE', 10)"}},{source:{platform:"joinquant",api:"order_target",signature:"order_target(security, amount)"},target:{platform:"ptrade",api:"order_target_volume",signature:"order_target_volume(stock_code, volume)"},paramMapping:{security:"stock_code",amount:"volume"},notes:["å‚æ•°åä¸åŒä½†é€»è¾‘ç›¸åŒ"],examples:{before:"order_target('000001.XSHE', 1000)",after:"order_target_volume('000001.XSHE', 1000)"}},{source:{platform:"joinquant",api:"set_benchmark",signature:"set_benchmark(security)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeä¸éœ€è¦è®¾ç½®åŸºå‡†ï¼Œæ­¤è¡Œå¯åˆ é™¤æˆ–æ³¨é‡Š"],examples:{before:"set_benchmark('000300.XSHG')",after:"# set_benchmark('000300.XSHG')  # PTradeä¸éœ€è¦æ­¤è®¾ç½®"}},{source:{platform:"joinquant",api:"set_option",signature:"set_option(option_name, value)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeé…ç½®æ–¹å¼ä¸åŒï¼Œå¤§éƒ¨åˆ†é€‰é¡¹åœ¨ç­–ç•¥é…ç½®æ–‡ä»¶ä¸­è®¾ç½®"],examples:{before:"set_option('use_real_price', True)",after:"# PTradeåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®use_real_price"}},{source:{platform:"joinquant",api:"set_slippage",signature:"set_slippage(slippage)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeæ»‘ç‚¹åœ¨äº¤æ˜“é…ç½®ä¸­è®¾ç½®"],examples:{before:"set_slippage(PriceRelatedSlippage(0.002))",after:"# PTradeåœ¨äº¤æ˜“é…ç½®ä¸­è®¾ç½®æ»‘ç‚¹"}},{source:{platform:"joinquant",api:"set_order_cost",signature:"set_order_cost(cost, type)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeè´¹ç”¨åœ¨è´¦æˆ·é…ç½®ä¸­è®¾ç½®"],examples:{before:"set_order_cost(OrderCost(open_tax=0, close_tax=0.001, open_commission=0.0003, close_commission=0.0003), type='stock')",after:"# PTradeåœ¨è´¦æˆ·é…ç½®ä¸­è®¾ç½®äº¤æ˜“è´¹ç”¨"}},{source:{platform:"joinquant",api:"log.info",signature:"log.info(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["PTradeä½¿ç”¨printè¾“å‡ºæ—¥å¿—"],examples:{before:"log.info('ç­–ç•¥å¼€å§‹è¿è¡Œ')",after:"print('[INFO] ç­–ç•¥å¼€å§‹è¿è¡Œ')"}},{source:{platform:"joinquant",api:"log.warn",signature:"log.warn(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["å»ºè®®æ·»åŠ [WARN]å‰ç¼€"],examples:{before:"log.warn('é£é™©æç¤º')",after:"print('[WARN] é£é™©æç¤º')"}},{source:{platform:"joinquant",api:"log.error",signature:"log.error(msg)"},target:{platform:"ptrade",api:"print",signature:"print(msg)"},paramMapping:{msg:"msg"},notes:["å»ºè®®æ·»åŠ [ERROR]å‰ç¼€"],examples:{before:"log.error('æ‰§è¡Œå¤±è´¥')",after:"print('[ERROR] æ‰§è¡Œå¤±è´¥')"}},{source:{platform:"joinquant",api:"run_daily",signature:"run_daily(func, time)"},target:{platform:"ptrade",api:"",signature:""},paramMapping:{},notes:["PTradeä¸æ”¯æŒrun_daily","éœ€è¦åœ¨on_barä¸­æ ¹æ®æ—¶é—´åˆ¤æ–­æ‰§è¡Œ","ç¤ºä¾‹: if context.current_dt.hour == 9 and context.current_dt.minute == 30:"],examples:{before:"run_daily(my_func, '09:30')",after:"# åœ¨on_barä¸­æ·»åŠ æ—¶é—´åˆ¤æ–­:\n# if context.current_dt.strftime('%H:%M') == '09:30':\n#     my_func(context)"}}];class a{mappings=t;convert(e,n,t){const a=n.compatibility.sourcePlatform;return a===t?{success:!0,targetPlatform:t,originalCode:e,convertedCode:e,changes:[],warnings:["æºå¹³å°ä¸ç›®æ ‡å¹³å°ç›¸åŒï¼Œæ— éœ€è½¬æ¢"],errors:[],stats:{totalChanges:0,apiChanges:0,structureChanges:0,addedLines:0,removedLines:0}}:"joinquant"===a&&"ptrade"===t?this.convertJoinQuantToPTrade(e,n):"ptrade"===a&&"joinquant"===t?this.convertPTradeToJoinQuant(e,n):{success:!1,targetPlatform:t,originalCode:e,convertedCode:e,changes:[],warnings:[],errors:[`æš‚ä¸æ”¯æŒ ${a} â†’ ${t} çš„è½¬æ¢`],stats:{totalChanges:0,apiChanges:0,structureChanges:0,addedLines:0,removedLines:0}}}convertJoinQuantToPTrade(e,n){const t=[],a=[],r=[];let o=e;const s=e.split("\n");for(const e of n.dependencies.apis){const n=this.findMapping(e.name,"joinquant","ptrade");if(n){if(""===n.target.api){const a=s[e.line-1],r=`# ${a.trim()}  # PTradeä¸éœ€è¦æ­¤è®¾ç½®`;o=this.replaceLine(o,e.line,r),t.push({type:"api_replace",line:e.line,original:a.trim(),converted:r,reason:n.notes?.[0]||"PTradeä¸æ”¯æŒæ­¤API"})}else{const a=new RegExp(`\\b${e.name}\\s*\\(`,"g"),r=`${n.target.api}(`;o=o.replace(a,r),t.push({type:"api_replace",line:e.line,original:e.name,converted:n.target.api,reason:`APIè½¬æ¢: ${e.name} â†’ ${n.target.api}`})}n.notes&&a.push(...n.notes)}else r.push(`ç¬¬${e.line}è¡Œ: API '${e.name}' æ— æ³•è‡ªåŠ¨è½¬æ¢`)}o=o.replace(/\.XSHG/g,".SH"),o=o.replace(/\.XSHE/g,".SZ"),t.push({type:"param_change",line:0,original:".XSHG/.XSHE",converted:".SH/.SZ",reason:"è‚¡ç¥¨ä»£ç åç¼€è½¬æ¢"}),o=o.replace(/log\.info\s*\(\s*f?(['"])/g,"print('[INFO] ' + $1"),o=o.replace(/log\.info\s*\(/g,"print('[INFO]', "),o=o.replace(/log\.warn\s*\(\s*f?(['"])/g,"print('[WARN] ' + $1"),o=o.replace(/log\.warn\s*\(/g,"print('[WARN]', "),o=o.replace(/log\.error\s*\(\s*f?(['"])/g,"print('[ERROR] ' + $1"),o=o.replace(/log\.error\s*\(/g,"print('[ERROR]', "),o.includes("def on_bar")||(a.push("éœ€è¦æ·»åŠ  on_bar() å…¥å£å‡½æ•°"),o+='\n\n# ============================================================\n# PTradeå…¥å£å‡½æ•° (è‡ªåŠ¨ç”Ÿæˆ)\n# ============================================================\n\ndef on_bar(context, data):\n    """\n    PTradeä¸»å…¥å£å‡½æ•°\n    è¯·å°†handle_dataä¸­çš„é€»è¾‘è¿ç§»åˆ°æ­¤å‡½æ•°\n    """\n    handle_data(context, data)\n',t.push({type:"structure_change",line:0,original:"",converted:"def on_bar(context, data)",reason:"æ·»åŠ PTradeå…¥å£å‡½æ•°"}));const i=e.matchAll(/run_daily\s*\(\s*(\w+)\s*,\s*['"](\d{2}:\d{2})['"]\s*\)/g);for(const e of i){const n=e[1],t=e[2];a.push(`run_daily(${n}, '${t}') éœ€è¦åœ¨on_barä¸­ç”¨æ—¶é—´åˆ¤æ–­å®ç°`)}const c=(new Date).toLocaleString("zh-CN"),l=`"""\n${n.meta.name} - PTradeç‰ˆæœ¬\n============================\n\nåŸå¹³å°: JoinQuant\nè½¬æ¢æ—¶é—´: ${c}\nè½¬æ¢å·¥å…·: TRQuant Strategy Optimizer\n\nåŸå§‹ä¿¡æ¯:\n---------\n${n.meta.description||"æ— æè¿°"}\n\næ³¨æ„äº‹é¡¹:\n---------\n1. è¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç åç¼€æ˜¯å¦æ­£ç¡®\n2. ç¡®è®¤äº¤æ˜“è´¹ç”¨å’Œæ»‘ç‚¹é…ç½®\n3. æµ‹è¯•æ•°æ®è·å–å‡½æ•°è¿”å›æ ¼å¼\n"""`;return o=o.replace(/^[\s\S]*?"""[\s\S]*?"""/,l),{success:0===r.length,targetPlatform:"ptrade",originalCode:e,convertedCode:o,changes:t,warnings:a,errors:r,stats:{totalChanges:t.length,apiChanges:t.filter(e=>"api_replace"===e.type).length,structureChanges:t.filter(e=>"structure_change"===e.type).length,addedLines:t.filter(e=>"add"===e.type).length,removedLines:t.filter(e=>"remove"===e.type).length}}}convertPTradeToJoinQuant(e,n){const t=[],a=[];let r=e;return r=r.replace(/\.SH\b/g,".XSHG"),r=r.replace(/\.SZ\b/g,".XSHE"),r=r.replace(/\bget_history\s*\(/g,"get_price("),r=r.replace(/\bget_snapshot\s*\(/g,"get_current_data("),r=r.replace(/\border_target_percent\s*\(/g,"order_target_value("),r=r.replace(/\border_lots\s*\(/g,"order("),r=r.replace(/print\s*\(\s*\[INFO\]\s*/g,"log.info("),r=r.replace(/print\s*\(\s*\[WARN\]\s*/g,"log.warn("),r=r.replace(/print\s*\(\s*\[ERROR\]\s*/g,"log.error("),a.push("order_target_percentéœ€è¦æ‰‹åŠ¨è½¬æ¢ä¸ºé‡‘é¢å½¢å¼"),a.push("on_baré€»è¾‘éœ€è¦æ‹†åˆ†åˆ°handle_dataå’Œrun_daily"),{success:!0,targetPlatform:"joinquant",originalCode:e,convertedCode:r,changes:t,warnings:a,errors:[],stats:{totalChanges:t.length,apiChanges:t.filter(e=>"api_replace"===e.type).length,structureChanges:0,addedLines:0,removedLines:0}}}findMapping(e,n,t){return this.mappings.find(t=>t.source.platform===n&&t.source.api===e)}replaceLine(e,n,t){const a=e.split("\n");if(n>0&&n<=a.length){const e=a[n-1].match(/^\s*/)?.[0]||"";a[n-1]=e+t}return a.join("\n")}getAllMappings(){return this.mappings}addMapping(e){this.mappings.push(e)}}n.PlatformAdapter=a,n.platformAdapter=new a},395:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.MarketPanel=void 0;const i=s(t(398));class c{static currentPanel;_panel;_extensionUri;_client;_disposables=[];constructor(e,n,t){this._panel=e,this._extensionUri=n,this._client=t,this._update(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(async e=>{switch(e.command){case"refresh":await this._update();break;case"getMarketStatus":await i.commands.executeCommand("trquant.getMarketStatus");break;case"getMainlines":await i.commands.executeCommand("trquant.getMainlines");break;case"generateStrategy":await i.commands.executeCommand("trquant.generateStrategy")}},null,this._disposables)}static createOrShow(e,n){const t=i.ViewColumn.Beside;if(c.currentPanel)return void c.currentPanel._panel.reveal(t);const a=i.window.createWebviewPanel("trquantPanel","TRQuant æ§åˆ¶å°",t,{enableScripts:!0,retainContextWhenHidden:!0});c.currentPanel=new c(a,e,n)}async _update(){this._panel.webview.html=await this._getHtmlContent()}async _getHtmlContent(){let e=null,n=null;try{const t=await this._client.getMarketStatus();t.ok&&(e=t.data);const a=await this._client.getMainlines({top_n:5});a.ok&&(n=a.data)}catch(e){}const t="risk_on"===e?.regime?"#10b981":"risk_off"===e?.regime?"#ef4444":"#f59e0b";return`<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8">\n    <style>\n        body {\n            font-family: 'Segoe UI', sans-serif;\n            background: #1a1a2e;\n            color: #fff;\n            padding: 20px;\n            margin: 0;\n        }\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid #333;\n        }\n        .logo {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        .logo-icon { font-size: 32px; }\n        .logo-text {\n            font-size: 20px;\n            font-weight: bold;\n        }\n        .refresh-btn {\n            background: #333;\n            border: none;\n            color: #fff;\n            padding: 8px 16px;\n            border-radius: 8px;\n            cursor: pointer;\n        }\n        .refresh-btn:hover { background: #444; }\n\n        .status-card {\n            background: linear-gradient(135deg, ${t}22, ${t}11);\n            border: 1px solid ${t}44;\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .status-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .status-regime {\n            font-size: 24px;\n            font-weight: bold;\n        }\n        .status-badge {\n            background: ${t};\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n        .status-summary {\n            margin-top: 12px;\n            color: #d1d5db;\n            line-height: 1.6;\n        }\n\n        .section {\n            background: #252540;\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 16px;\n        }\n        .section-title {\n            font-size: 14px;\n            color: #9ca3af;\n            margin-bottom: 12px;\n        }\n\n        .mainline-item {\n            display: flex;\n            justify-content: space-between;\n            padding: 10px 0;\n            border-bottom: 1px solid #333;\n        }\n        .mainline-item:last-child { border: none; }\n\n        .actions {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 12px;\n            margin-top: 20px;\n        }\n        .action-btn {\n            background: #667eea;\n            border: none;\n            color: #fff;\n            padding: 14px;\n            border-radius: 10px;\n            cursor: pointer;\n            font-size: 14px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n        .action-btn:hover { background: #5a6fd6; }\n        .action-btn.primary { background: #10b981; }\n        .action-btn.primary:hover { background: #059669; }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="logo">\n            <span class="logo-icon">ğŸ“Š</span>\n            <span class="logo-text">TRQuant æ§åˆ¶å°</span>\n        </div>\n        <button class="refresh-btn" onclick="refresh()">ğŸ”„ åˆ·æ–°</button>\n    </div>\n\n    <div class="status-card">\n        <div class="status-header">\n            <span class="status-regime">\n                ${"risk_on"===e?.regime?"ğŸ“ˆ é£é™©åå¥½ä¸Šå‡":"risk_off"===e?.regime?"ğŸ“‰ é£é™©åå¥½ä¸‹é™":"â¡ï¸ éœ‡è¡å¸‚åœº"}\n            </span>\n            <span class="status-badge">${(e?.regime||"UNKNOWN").toUpperCase()}</span>\n        </div>\n        <div class="status-summary">\n            ${e?.summary||"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€..."}\n        </div>\n    </div>\n\n    ${n?`\n    <div class="section">\n        <div class="section-title">ğŸ¯ çƒ­é—¨ä¸»çº¿ TOP 5</div>\n        ${n.slice(0,5).map((e,n)=>`\n            <div class="mainline-item">\n                <span>${n+1}. ${e.name}</span>\n                <span style="color: #667eea">${e.score?.toFixed(2)}</span>\n            </div>\n        `).join("")}\n    </div>\n    `:""}\n\n    <div class="actions">\n        <button class="action-btn" onclick="getMarketStatus()">\n            ğŸ“Š å¸‚åœºçŠ¶æ€\n        </button>\n        <button class="action-btn" onclick="getMainlines()">\n            ğŸ¯ æŠ•èµ„ä¸»çº¿\n        </button>\n        <button class="action-btn" onclick="recommendFactors()">\n            ğŸ“ˆ å› å­æ¨è\n        </button>\n        <button class="action-btn primary" onclick="generateStrategy()">\n            ğŸš€ ç”Ÿæˆç­–ç•¥\n        </button>\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        function refresh() { vscode.postMessage({ command: 'refresh' }); }\n        function getMarketStatus() { vscode.postMessage({ command: 'getMarketStatus' }); }\n        function getMainlines() { vscode.postMessage({ command: 'getMainlines' }); }\n        function recommendFactors() { vscode.postMessage({ command: 'recommendFactors' }); }\n        function generateStrategy() { vscode.postMessage({ command: 'generateStrategy' }); }\n    <\/script>\n</body>\n</html>`}dispose(){for(c.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}}n.MarketPanel=c},398:e=>{e.exports=require("vscode")},405:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.recommendFactors=async function(e,n){c.logger.info("æ‰§è¡Œæ¨èå› å­å‘½ä»¤",d),await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{t.report({message:"è·å–å¸‚åœºçŠ¶æ€...",increment:0});const r=await e.getMarketStatus(),o=r.data?.regime||"neutral";if(a.isCancellationRequested)return;t.report({message:"æ¨èå› å­...",increment:30});const s=await e.recommendFactors({market_regime:o,top_n:15});if(t.report({increment:40}),!s.ok||!s.data)return void i.window.showErrorMessage(`è·å–å› å­æ¨èå¤±è´¥: ${s.error||"æœªçŸ¥é”™è¯¯"}`);const l=s.data;c.logger.info(`æ¨è ${l.length} ä¸ªå› å­`,d),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:20}),function(e,n,t){const a=i.window.createWebviewPanel("trquantFactors","ğŸ“ˆ å› å­æ¨è",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});a.webview.html=function(e,n){const t=g(n),a=p(e),r=Object.entries(a).map(([e,n])=>function(e,n){const t=n.map(e=>function(e){const n=e.weight>.7?"weight-high":e.weight>.4?"weight-medium":"weight-low";return`\n        <div class="factor-card" data-factor="${e.name}" onclick="toggleFactor('${e.name}', this)">\n            <div class="factor-header">\n                <span class="factor-name">${e.name}</span>\n                <span class="factor-weight ${n}">${(100*e.weight).toFixed(0)}%</span>\n            </div>\n            <div class="factor-reason">${e.reason||"åŸºäºå†å²è¡¨ç°æ¨è"}</div>\n        </div>\n    `}(e)).join("");return`\n        <div class="category-section">\n            <div class="category-title">${function(e){return{ç›ˆåˆ©èƒ½åŠ›:"ğŸ’°",æˆé•¿æ€§:"ğŸš€",ä¼°å€¼:"ğŸ“Š",åŠ¨é‡:"âš¡",æµåŠ¨æ€§:"ğŸ’§",æ³¢åŠ¨ç‡:"ğŸ“ˆ",è´¨é‡:"âœ¨",å…¶ä»–:"ğŸ“‹"}[e]||"ğŸ“‹"}(e)} ${e}</div>\n            <div class="factors-grid">\n                ${t}\n            </div>\n        </div>\n    `}(e,n)).join("");return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å› å­æ¨è</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-left {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${t.color};\n            color: white;\n            padding: 6px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n        }\n\n        .info-card {\n            background: linear-gradient(135deg, ${t.color}22, ${t.color}11);\n            border-left: 4px solid ${t.color};\n            border-radius: 12px;\n            padding: 16px 20px;\n            margin-bottom: 24px;\n        }\n\n        .info-card p {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .category-section {\n            margin-bottom: 24px;\n        }\n\n        .category-title {\n            font-size: 15px;\n            font-weight: 600;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .category-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .factors-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n            gap: 12px;\n        }\n\n        .factor-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            border: 1px solid var(--border);\n            cursor: pointer;\n            transition: all 0.2s;\n        }\n\n        .factor-card:hover {\n            border-color: var(--primary);\n        }\n\n        .factor-card.selected {\n            border-color: var(--success);\n            background: var(--success)11;\n        }\n\n        .factor-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 8px;\n        }\n\n        .factor-name {\n            font-weight: 600;\n            font-size: 15px;\n        }\n\n        .factor-weight {\n            background: var(--bg-tertiary);\n            padding: 4px 12px;\n            border-radius: 12px;\n            font-size: 13px;\n            font-weight: 600;\n        }\n\n        .weight-high { background: var(--success); color: white; }\n        .weight-medium { background: var(--warning); color: #1a1a2e; }\n        .weight-low { background: var(--bg-tertiary); color: var(--text-secondary); }\n\n        .factor-reason {\n            color: var(--text-secondary);\n            font-size: 13px;\n            line-height: 1.5;\n        }\n\n        .selected-factors {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            margin-bottom: 24px;\n            border: 1px solid var(--border);\n        }\n\n        .selected-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 12px;\n        }\n\n        .selected-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 8px;\n        }\n\n        .selected-tag {\n            background: var(--primary);\n            color: white;\n            padding: 6px 12px;\n            border-radius: 16px;\n            font-size: 13px;\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        }\n\n        .selected-tag .remove {\n            cursor: pointer;\n            opacity: 0.7;\n        }\n\n        .selected-tag .remove:hover { opacity: 1; }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div class="header-left">\n            <span class="header-icon">ğŸ“ˆ</span>\n            <div>\n                <div class="header-title">å› å­æ¨è</div>\n                <div class="header-subtitle">åŸºäºå½“å‰å¸‚åœºçŠ¶æ€çš„æ™ºèƒ½å› å­æ¨è</div>\n            </div>\n        </div>\n        <span class="regime-badge">å¸‚åœº: ${n.toUpperCase()}</span>\n    </div>\n\n    <div class="info-card">\n        <p>${t.factorAdvice}</p>\n    </div>\n\n    <div class="selected-factors" id="selectedFactors">\n        <div class="selected-title">å·²é€‰å› å­ (ç‚¹å‡»å¡ç‰‡æ·»åŠ /ç§»é™¤)</div>\n        <div class="selected-list" id="selectedList"></div>\n    </div>\n\n    ${r}\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="generateStrategy()">\n            ğŸš€ ä½¿ç”¨é€‰ä¸­å› å­ç”Ÿæˆç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        const selectedFactors = new Set();\n        \n        // é»˜è®¤é€‰ä¸­å‰5ä¸ªå› å­\n        const defaultFactors = ${JSON.stringify(e.slice(0,5).map(e=>e.name))};\n        defaultFactors.forEach(f => selectedFactors.add(f));\n        updateSelectedDisplay();\n        \n        function toggleFactor(name, element) {\n            if (selectedFactors.has(name)) {\n                selectedFactors.delete(name);\n                element.classList.remove('selected');\n            } else {\n                selectedFactors.add(name);\n                element.classList.add('selected');\n            }\n            updateSelectedDisplay();\n        }\n        \n        function removeFactor(name) {\n            selectedFactors.delete(name);\n            const card = document.querySelector(\`[data-factor="\${name}"]\`);\n            if (card) card.classList.remove('selected');\n            updateSelectedDisplay();\n        }\n        \n        function updateSelectedDisplay() {\n            const list = document.getElementById('selectedList');\n            list.innerHTML = Array.from(selectedFactors).map(f => \n                \`<span class="selected-tag">\n                    \${f}\n                    <span class="remove" onclick="removeFactor('\${f}')">Ã—</span>\n                </span>\`\n            ).join('');\n            \n            // æ›´æ–°å¡ç‰‡çŠ¶æ€\n            document.querySelectorAll('.factor-card').forEach(card => {\n                const factorName = card.getAttribute('data-factor');\n                if (selectedFactors.has(factorName)) {\n                    card.classList.add('selected');\n                }\n            });\n        }\n        \n        function generateStrategy() {\n            vscode.postMessage({ \n                command: 'generateStrategy',\n                factors: Array.from(selectedFactors)\n            });\n        }\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n    <\/script>\n</body>\n</html>`}(n,t),a.webview.onDidReceiveMessage(async e=>{switch(e.command){case"generateStrategy":!function(e){c.logger.info(`ä½¿ç”¨å› å­ç”Ÿæˆç­–ç•¥: ${e.join(", ")}`,d),i.commands.executeCommand("trquant.generateStrategy")}(e.factors||n.slice(0,5).map(e=>e.name));break;case"copyPrompt":const a=u(n,t);await i.env.clipboard.writeText(a),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}},void 0,e.subscriptions)}(n,l,o),t.report({increment:10}),async function(e){if(0!==e.length)switch(await i.window.showInformationMessage(`æ¨è ${e.length} ä¸ªå› å­`,"ç”Ÿæˆç­–ç•¥","å¤åˆ¶Prompt")){case"ç”Ÿæˆç­–ç•¥":i.commands.executeCommand("trquant.generateStrategy");break;case"å¤åˆ¶Prompt":const n=u(e,"neutral");await i.env.clipboard.writeText(n),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}}(l)}catch(e){l.ErrorHandler.handle(e,d)}})};const i=s(t(398)),c=t(628),l=t(799),d="RecommendFactors";function p(e){const n={};for(const t of e){const e=t.category||"å…¶ä»–";n[e]||(n[e]=[]),n[e].push(t)}return n}function g(e){const n={risk_on:{color:"#10b981",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œå»ºè®®ä¾§é‡æˆé•¿æ€§å’ŒåŠ¨é‡å› å­ã€‚é«˜Betaã€é«˜æˆé•¿çš„è‚¡ç¥¨å¯èƒ½è¡¨ç°æ›´å¥½ã€‚"},risk_off:{color:"#ef4444",factorAdvice:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®ä¾§é‡ä»·å€¼å’Œè´¨é‡å› å­ã€‚ä½æ³¢åŠ¨ã€é«˜åˆ†çº¢çš„è‚¡ç¥¨å¯èƒ½æ›´ç¨³å¥ã€‚"},neutral:{color:"#f59e0b",factorAdvice:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®å„ç±»å› å­ã€‚å¯ä»¥è€ƒè™‘å¸‚åœºä¸­æ€§ç­–ç•¥é™ä½æ–¹å‘æ€§é£é™©ã€‚"}};return n[e]||n.neutral}function u(e,n){const t=p(e);return`# é‡åŒ–å› å­æ¨è\n\n## å¸‚åœºçŠ¶æ€: ${n.toUpperCase()}\n\n${g(n).factorAdvice}\n\n## æ¨èå› å­åˆ—è¡¨\n\n${Object.entries(t).map(([e,n])=>`\n### ${e}\n${n.map(e=>`- **${e.name}** (æƒé‡: ${(100*e.weight).toFixed(0)}%): ${e.reason||""}`).join("\n")}\n`).join("\n")}\n\n---\n\nè¯·åŸºäºä»¥ä¸Šå› å­æ¨èï¼Œå¸®æˆ‘ï¼š\n1. åˆ†æå„å› å­åœ¨å½“å‰å¸‚åœºç¯å¢ƒä¸‹çš„æœ‰æ•ˆæ€§\n2. è®¾è®¡å› å­åˆæˆæ–¹æ¡ˆï¼ˆæƒé‡åˆ†é…ï¼‰\n3. ç”Ÿæˆä½¿ç”¨è¿™äº›å› å­çš„PTradeå¤šå› å­ç­–ç•¥ä»£ç \n\nè¦æ±‚ï¼š\n- å› å­éœ€è¦è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼ˆZ-scoreï¼‰\n- è€ƒè™‘å› å­é—´çš„ç›¸å…³æ€§\n- åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘\n`}},410:function(e,n,t){var a=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),r=this&&this.__exportStar||function(e,n){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(n,t)||a(n,e,t)};Object.defineProperty(n,"__esModule",{value:!0}),n.OptimizationAdvisor=n.createOptimizationAdvisor=n.StrategyAnalyzer=n.createStrategyAnalyzer=n.ManualLearner=n.createManualLearner=n.StrategyLearner=n.createStrategyLearner=n.reportGenerator=n.platformAdapter=n.codeAnalyzer=n.strategyOptimizer=n.StrategyOptimizerService=void 0,n.registerStrategyOptimizer=function(e,a){const r=t(628).logger,o=t(928),s="StrategyOptimizer",i=e.globalStorageUri.fsPath,c=e.extensionPath?o.join(e.extensionPath,"AShare-manual"):void 0;try{n.strategyOptimizer.initLearner(i,c),r.info("ç­–ç•¥ä¼˜åŒ–å™¨å­¦ä¹ å¼•æ“å·²åˆå§‹åŒ–",s)}catch(e){r.warn(`åˆå§‹åŒ–å­¦ä¹ å¼•æ“å¤±è´¥: ${e}`,s)}r.info("ç­–ç•¥ä¼˜åŒ–å™¨æœåŠ¡å·²æ³¨å†Œ",s)};const o=t(510),s=t(381),i=t(879),c=t(144),l=t(150),d=t(902);r(t(64),n);class p{static instance;learner=null;manualLearner=null;storagePath="";manualPath="";strategyAnalyzer;optimizationAdvisor;constructor(){this.strategyAnalyzer=(0,l.createStrategyAnalyzer)(),this.optimizationAdvisor=(0,d.createOptimizationAdvisor)()}static getInstance(){return p.instance||(p.instance=new p),p.instance}initLearner(e,n){this.storagePath=e,this.learner=(0,c.createStrategyLearner)(e),n&&(this.manualPath=n,this.manualLearner=(0,c.createManualLearner)(e,n))}getLearner(){return this.learner}getManualLearner(){return this.manualLearner}async learnFromManual(){return this.manualLearner?this.manualLearner.learnFromManual():{success:!1,stats:{},log:["æ‰‹å†Œå­¦ä¹ å™¨æœªåˆå§‹åŒ–"]}}watchManualUpdates(e){return this.manualLearner?this.manualLearner.watchForUpdates(e):null}analyzeStrategy(e,n){return o.codeAnalyzer.analyze(e,n)}convertToPlatform(e,n,t){const a=t||this.analyzeStrategy(e);return s.platformAdapter.convert(e,a,n)}generateReport(e,n="html"){const t=this.analyzeStrategy(e);switch(n){case"json":return i.reportGenerator.generate(t);case"markdown":return i.reportGenerator.generateMarkdown(t);default:return i.reportGenerator.generateHTML(t)}}async optimizeStrategy(e,n,t){const a=this.analyzeStrategy(e,t),r=s.platformAdapter.convert(e,a,n);return{analysis:a,conversion:r,report:i.reportGenerator.generateHTML(a,r)}}checkCompatibility(e){const n=this.analyzeStrategy(e);return{sourcePlatform:n.compatibility.sourcePlatform,compatibility:{joinquant:{score:n.compatibility.joinquant.score,level:n.compatibility.joinquant.level},ptrade:{score:n.compatibility.ptrade.score,level:n.compatibility.ptrade.level},qmt:{score:n.compatibility.qmt.score,level:n.compatibility.qmt.level},universal:{score:100,level:"full"}}}}getAPIMappings(){return s.platformAdapter.getAllMappings()}getPlatformInfo(e){const{PLATFORMS:n}=t(64);return n[e]}async learnFromDocuments(e){return this.learner?this.learner.learnFromDocuments(e):{learned:0,patterns:[],practices:[]}}async learnFromHistory(e){return this.learner?this.learner.learnFromHistory(e):{analyzed:0,successPatterns:[],failurePatterns:[]}}recordFeedback(e){this.learner&&this.learner.recordFeedback(e)}getRecommendedPatterns(e){if(!this.learner)return[];const n=this.analyzeStrategy(e);return this.learner.recommendPatterns(n)}getRecommendedPractices(e){if(!this.learner)return[];const n=this.analyzeStrategy(e);return this.learner.recommendBestPractices(n)}getLearningStats(){return this.learner?this.learner.getStats():null}saveLearningData(){this.learner&&this.learner.save()}analyzeStrategyDeep(e,n){return this.strategyAnalyzer.analyze(e,n)}generateOptimizationReport(e,n){const t=this.strategyAnalyzer.analyze(e,n);return this.optimizationAdvisor.generateReport(t)}quickOptimizationCheck(e){return this.generateOptimizationReport(e).advices.filter(e=>"high"===e.priority).map(e=>({priority:e.priority,title:e.title,suggestion:e.description}))}getStrategyScore(e){const n=this.generateOptimizationReport(e);return{overall:n.overallScore,...n.scoreBreakdown}}}n.StrategyOptimizerService=p,n.strategyOptimizer=p.getInstance();var g=t(510);Object.defineProperty(n,"codeAnalyzer",{enumerable:!0,get:function(){return g.codeAnalyzer}});var u=t(381);Object.defineProperty(n,"platformAdapter",{enumerable:!0,get:function(){return u.platformAdapter}});var m=t(879);Object.defineProperty(n,"reportGenerator",{enumerable:!0,get:function(){return m.reportGenerator}});var f=t(144);Object.defineProperty(n,"createStrategyLearner",{enumerable:!0,get:function(){return f.createStrategyLearner}}),Object.defineProperty(n,"StrategyLearner",{enumerable:!0,get:function(){return f.StrategyLearner}}),Object.defineProperty(n,"createManualLearner",{enumerable:!0,get:function(){return f.createManualLearner}}),Object.defineProperty(n,"ManualLearner",{enumerable:!0,get:function(){return f.ManualLearner}});var h=t(150);Object.defineProperty(n,"createStrategyAnalyzer",{enumerable:!0,get:function(){return h.createStrategyAnalyzer}}),Object.defineProperty(n,"StrategyAnalyzer",{enumerable:!0,get:function(){return h.StrategyAnalyzer}});var v=t(902);Object.defineProperty(n,"createOptimizationAdvisor",{enumerable:!0,get:function(){return v.createOptimizationAdvisor}}),Object.defineProperty(n,"OptimizationAdvisor",{enumerable:!0,get:function(){return v.OptimizationAdvisor}})},478:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.config=n.ConfigManager=void 0;const i=s(t(398)),c=s(t(928)),l=s(t(857)),d={pythonPath:"win32"===l.platform()?"python":"python3",serverHost:"127.0.0.1",serverPort:5e3,timeout:6e4,mcpEnabled:!0,mcpPort:5001,autoRefresh:!1,refreshInterval:3e5,defaultPlatform:"ptrade",defaultStyle:"multi_factor",defaultRiskParams:{maxPosition:.1,stopLoss:.08,takeProfit:.2}};class p{static instance;config;disposables=[];constructor(){this.config=this.loadConfig(),this.disposables.push(i.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("trquant")&&(this.config=this.loadConfig())}))}static getInstance(){return p.instance||(p.instance=new p),p.instance}loadConfig(){const e=i.workspace.getConfiguration("trquant");return{pythonPath:e.get("pythonPath")||d.pythonPath,serverHost:e.get("serverHost")||d.serverHost,serverPort:e.get("serverPort")||d.serverPort,timeout:e.get("timeout")||d.timeout,mcpEnabled:e.get("mcpEnabled")??d.mcpEnabled,mcpPort:e.get("mcpPort")||d.mcpPort,autoRefresh:e.get("autoRefresh")??d.autoRefresh,refreshInterval:e.get("refreshInterval")||d.refreshInterval,defaultPlatform:e.get("defaultPlatform")||d.defaultPlatform,defaultStyle:e.get("defaultStyle")||d.defaultStyle,defaultRiskParams:{maxPosition:e.get("defaultMaxPosition")||d.defaultRiskParams.maxPosition,stopLoss:e.get("defaultStopLoss")||d.defaultRiskParams.stopLoss,takeProfit:e.get("defaultTakeProfit")||d.defaultRiskParams.takeProfit}}}getConfig(){return{...this.config}}get(e){return this.config[e]}async set(e,n,t=i.ConfigurationTarget.Global){const a=i.workspace.getConfiguration("trquant");await a.update(e,n,t)}getPythonPath(e){const n=this.config.pythonPath;if(c.isAbsolute(n))return n;const t=c.join(e,"..","venv");return"win32"===l.platform()?c.join(t,"Scripts","python.exe"):c.join(t,"bin","python")}dispose(){this.disposables.forEach(e=>e.dispose())}}n.ConfigManager=p,n.config=p.getInstance()},501:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.getMarketStatus=async function(e,n){c.logger.info("æ‰§è¡Œè·å–å¸‚åœºçŠ¶æ€å‘½ä»¤",d),await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!0},async(t,a)=>{try{if(t.report({message:"æ­£åœ¨è·å–å¸‚åœºçŠ¶æ€...",increment:0}),a.isCancellationRequested)return void c.logger.info("ç”¨æˆ·å–æ¶ˆæ“ä½œ",d);const r=await e.getMarketStatus({universe:"CN_EQ",as_of:(new Date).toISOString().split("T")[0]});if(t.report({increment:50}),!r.ok||!r.data)return void i.window.showErrorMessage(`è·å–å¸‚åœºçŠ¶æ€å¤±è´¥: ${r.error||"æœªçŸ¥é”™è¯¯"}`);const o=r.data;c.logger.info(`å¸‚åœºçŠ¶æ€: ${o.regime}`,d),t.report({message:"æ¸²æŸ“ç»“æœ...",increment:30}),function(e,n){const t=i.window.createWebviewPanel("trquantMarketStatus","ğŸ“Š å¸‚åœºçŠ¶æ€",i.ViewColumn.Beside,{enableScripts:!0,retainContextWhenHidden:!0});t.webview.html=function(e){const n=p(e.regime),t=function(e){const n={SH000300:"æ²ªæ·±300",SZ399006:"åˆ›ä¸šæ¿æŒ‡",SH000016:"ä¸Šè¯50",SZ399905:"ä¸­è¯500"};return Object.entries(e).map(([e,t])=>{const a=n[e]||e,r="up"===t.trend?"â†‘":"down"===t.trend?"â†“":"â†’";return`\n                <div class="trend-item">\n                    <span class="trend-name">${a}</span>\n                    <div class="trend-value">\n                        <span class="trend-direction ${t.zscore>0?"positive":t.zscore<0?"negative":"neutral"}">${r}</span>\n                        <span class="zscore">(${t.zscore>=0?"+":""}${t.zscore.toFixed(2)})</span>\n                    </div>\n                </div>\n            `}).join("")}(e.index_trend),a=function(e){const n={growth:"æˆé•¿",value:"ä»·å€¼",momentum:"åŠ¨é‡",quality:"è´¨é‡",size:"å¸‚å€¼"};return e.map(e=>`\n                <div class="style-item">\n                    <span class="style-name">${n[e.style]||e.style}</span>\n                    <span class="style-score ${e.score>0?"positive":e.score<0?"negative":"neutral"}">${e.score>0?"+":""}${e.score.toFixed(2)}</span>\n                </div>\n            `).join("")}(e.style_rotation);return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å¸‚åœºçŠ¶æ€</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --text-muted: #6b7280;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            align-items: center;\n            gap: 16px;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-icon { font-size: 36px; }\n\n        .header-content { flex: 1; }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n            margin-bottom: 4px;\n        }\n\n        .header-subtitle {\n            color: var(--text-secondary);\n            font-size: 14px;\n        }\n\n        .regime-badge {\n            background: ${n.color};\n            color: white;\n            padding: 8px 20px;\n            border-radius: 24px;\n            font-weight: 600;\n            font-size: 14px;\n            text-transform: uppercase;\n        }\n\n        .card {\n            background: var(--bg-secondary);\n            border-radius: 16px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .card-title {\n            font-size: 14px;\n            color: var(--text-secondary);\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .card-title::before {\n            content: '';\n            width: 4px;\n            height: 16px;\n            background: var(--primary);\n            border-radius: 2px;\n        }\n\n        .trend-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 12px;\n        }\n\n        .trend-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 16px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .trend-name {\n            font-weight: 500;\n            font-size: 14px;\n        }\n\n        .trend-value {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .trend-direction {\n            font-size: 18px;\n        }\n\n        .zscore {\n            font-size: 13px;\n            color: var(--text-secondary);\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n        .neutral { color: var(--warning); }\n\n        .style-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 12px;\n        }\n\n        .style-item {\n            background: var(--bg-tertiary);\n            border-radius: 12px;\n            padding: 12px 20px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            flex: 1;\n            min-width: 150px;\n        }\n\n        .style-name { font-weight: 500; }\n\n        .style-score {\n            margin-left: auto;\n            font-weight: 600;\n            font-size: 18px;\n        }\n\n        .summary-card {\n            background: linear-gradient(135deg, ${n.color}22, ${n.color}11);\n            border-left: 4px solid ${n.color};\n        }\n\n        .summary-text {\n            color: var(--text-primary);\n            font-size: 15px;\n            line-height: 1.8;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover {\n            background: #5a6fd6;\n        }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover {\n            background: #3d3d5c;\n        }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <span class="header-icon">${n.icon}</span>\n        <div class="header-content">\n            <div class="header-title">Aè‚¡å¸‚åœºçŠ¶æ€</div>\n            <div class="header-subtitle">åŸºäºå¤šç»´åº¦æŒ‡æ ‡ç»¼åˆåˆ†æ</div>\n        </div>\n        <span class="regime-badge">${e.regime}</span>\n    </div>\n\n    <div class="card summary-card">\n        <div class="card-title">åˆ†æç»“è®º</div>\n        <div class="summary-text">${e.summary||n.description}</div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">æŒ‡æ•°è¶‹åŠ¿</div>\n        <div class="trend-grid">\n            ${t}\n        </div>\n    </div>\n\n    <div class="card">\n        <div class="card-title">é£æ ¼è½®åŠ¨</div>\n        <div class="style-list">\n            ${a}\n        </div>\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="copyPrompt()">\n            ğŸ“‹ å¤åˆ¶ä¸ºAI Prompt\n        </button>\n        <button class="btn btn-secondary" onclick="refresh()">\n            ğŸ”„ åˆ·æ–°æ•°æ®\n        </button>\n    </div>\n\n    <div class="timestamp">\n        æ›´æ–°æ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyPrompt() {\n            vscode.postMessage({ command: 'copyPrompt' });\n        }\n        \n        function refresh() {\n            vscode.postMessage({ command: 'refresh' });\n        }\n    <\/script>\n</body>\n</html>`}(n),t.webview.onDidReceiveMessage(async e=>{switch(e.command){case"copyPrompt":const e=g(n);await i.env.clipboard.writeText(e),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"refresh":i.commands.executeCommand("trquant.getMarketStatus"),t.dispose()}},void 0,e.subscriptions)}(n,o),t.report({increment:20}),async function(e){switch(await i.window.showInformationMessage(`å¸‚åœºçŠ¶æ€: ${e.regime.toUpperCase()}`,"å¤åˆ¶Prompt","ç”Ÿæˆç­–ç•¥","æŸ¥çœ‹ä¸»çº¿")){case"å¤åˆ¶Prompt":const n=g(e);await i.env.clipboard.writeText(n),i.window.showInformationMessage("Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"ç”Ÿæˆç­–ç•¥":i.commands.executeCommand("trquant.generateStrategy");break;case"æŸ¥çœ‹ä¸»çº¿":i.commands.executeCommand("trquant.getMainlines")}}(o)}catch(e){l.ErrorHandler.handle(e,d)}})};const i=s(t(398)),c=t(628),l=t(799),d="GetMarketStatus";function p(e){const n={risk_on:{icon:"ğŸ“ˆ",color:"#10b981",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸Šå‡ï¼Œé€‚åˆç§¯æé…ç½®æˆé•¿è‚¡å’Œé«˜Betaèµ„äº§ã€‚å»ºè®®å…³æ³¨ç§‘æŠ€ã€æ–°èƒ½æºç­‰é«˜æˆé•¿æ¿å—ã€‚"},risk_off:{icon:"ğŸ“‰",color:"#ef4444",description:"å½“å‰å¸‚åœºé£é™©åå¥½ä¸‹é™ï¼Œå»ºè®®é˜²å¾¡æ€§é…ç½®ã€‚å¯å…³æ³¨é«˜åˆ†çº¢ã€ä½æ³¢åŠ¨çš„ä»·å€¼è‚¡ï¼Œé€‚å½“é™ä½ä»“ä½ã€‚"},neutral:{icon:"â¡ï¸",color:"#f59e0b",description:"å½“å‰å¸‚åœºå¤„äºéœ‡è¡æ ¼å±€ï¼Œå»ºè®®å‡è¡¡é…ç½®ã€‚å¯é‡‡ç”¨å¸‚åœºä¸­æ€§ç­–ç•¥ï¼Œæ§åˆ¶é£é™©æ•å£ã€‚"}};return n[e]||n.neutral}function g(e){const n=p(e.regime);return`# Aè‚¡å¸‚åœºçŠ¶æ€åˆ†æ\n\n## å¸‚åœºRegime: ${e.regime.toUpperCase()}\n${n.description}\n\n## æŒ‡æ•°è¶‹åŠ¿\n${Object.entries(e.index_trend).map(([e,n])=>`- ${e}: ${n.trend} (åŠ¨é‡: ${n.zscore>=0?"+":""}${n.zscore.toFixed(2)})`).join("\n")}\n\n## é£æ ¼è½®åŠ¨\n${e.style_rotation.map(e=>`- ${e.style}: ${e.score>0?"å ä¼˜":"å¼±åŠ¿"} (${e.score>=0?"+":""}${e.score.toFixed(2)})`).join("\n")}\n\n## åˆ†ææ€»ç»“\n${e.summary||n.description}\n\n---\nè¯·åŸºäºä»¥ä¸Šå¸‚åœºçŠ¶æ€ï¼Œå¸®æˆ‘ç”Ÿæˆé€‚åˆå½“å‰å¸‚åœºç¯å¢ƒçš„PTradeé‡åŒ–ç­–ç•¥ä»£ç ã€‚è¦æ±‚ï¼š\n1. æ ¹æ®å¸‚åœºRegimeé€‰æ‹©åˆé€‚çš„ç­–ç•¥é£æ ¼\n2. åŒ…å«å®Œæ•´çš„é£æ§é€»è¾‘ï¼ˆæ­¢æŸ8%ï¼Œæ­¢ç›ˆ20%ï¼‰\n3. å•ç¥¨æœ€å¤§ä»“ä½10%\n4. æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š\n`}},510:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.codeAnalyzer=n.CodeAnalyzer=void 0;const t=[{pattern:/get_price\s*\(/g,name:"get_price",category:"data"},{pattern:/get_fundamentals\s*\(/g,name:"get_fundamentals",category:"data"},{pattern:/get_current_data\s*\(/g,name:"get_current_data",category:"data"},{pattern:/get_extras\s*\(/g,name:"get_extras",category:"data"},{pattern:/get_index_stocks\s*\(/g,name:"get_index_stocks",category:"data"},{pattern:/get_industry_stocks\s*\(/g,name:"get_industry_stocks",category:"data"},{pattern:/get_concept_stocks\s*\(/g,name:"get_concept_stocks",category:"data"},{pattern:/get_all_securities\s*\(/g,name:"get_all_securities",category:"data"},{pattern:/history\s*\(/g,name:"history",category:"data"},{pattern:/attribute_history\s*\(/g,name:"attribute_history",category:"data"},{pattern:/order\s*\(/g,name:"order",category:"trade"},{pattern:/order_target\s*\(/g,name:"order_target",category:"trade"},{pattern:/order_target_value\s*\(/g,name:"order_target_value",category:"trade"},{pattern:/order_value\s*\(/g,name:"order_value",category:"trade"},{pattern:/cancel_order\s*\(/g,name:"cancel_order",category:"trade"},{pattern:/get_open_orders\s*\(/g,name:"get_open_orders",category:"trade"},{pattern:/set_benchmark\s*\(/g,name:"set_benchmark",category:"setting"},{pattern:/set_option\s*\(/g,name:"set_option",category:"setting"},{pattern:/set_slippage\s*\(/g,name:"set_slippage",category:"setting"},{pattern:/set_order_cost\s*\(/g,name:"set_order_cost",category:"setting"},{pattern:/set_universe\s*\(/g,name:"set_universe",category:"setting"},{pattern:/log\.info\s*\(/g,name:"log.info",category:"log"},{pattern:/log\.warn\s*\(/g,name:"log.warn",category:"log"},{pattern:/log\.error\s*\(/g,name:"log.error",category:"log"},{pattern:/run_daily\s*\(/g,name:"run_daily",category:"schedule"},{pattern:/run_weekly\s*\(/g,name:"run_weekly",category:"schedule"},{pattern:/run_monthly\s*\(/g,name:"run_monthly",category:"schedule"}],a=[{pattern:/get_history\s*\(/g,name:"get_history",category:"data"},{pattern:/get_snapshot\s*\(/g,name:"get_snapshot",category:"data"},{pattern:/get_Ede\s*\(/g,name:"get_Ede",category:"data"},{pattern:/order_target_percent\s*\(/g,name:"order_target_percent",category:"trade"},{pattern:/order_lots\s*\(/g,name:"order_lots",category:"trade"},{pattern:/on_bar\s*\(/g,name:"on_bar",category:"entry"}],r=[{pattern:/\bpe\b|\bPE\b|pe_ratio|å¸‚ç›ˆç‡/gi,type:"value",name:"PE"},{pattern:/\bpb\b|\bPB\b|pb_ratio|å¸‚å‡€ç‡/gi,type:"value",name:"PB"},{pattern:/\bps\b|\bPS\b|ps_ratio|å¸‚é”€ç‡/gi,type:"value",name:"PS"},{pattern:/\bpcf\b|\bPCF\b|å¸‚ç°ç‡/gi,type:"value",name:"PCF"},{pattern:/dividend|è‚¡æ¯|åˆ†çº¢/gi,type:"value",name:"Dividend"},{pattern:/revenue_growth|è¥æ”¶å¢é•¿/gi,type:"growth",name:"RevenueGrowth"},{pattern:/profit_growth|åˆ©æ¶¦å¢é•¿|å‡€åˆ©æ¶¦å¢é•¿/gi,type:"growth",name:"ProfitGrowth"},{pattern:/eps_growth|æ¯è‚¡æ”¶ç›Šå¢é•¿/gi,type:"growth",name:"EPSGrowth"},{pattern:/roe_growth|ROEå¢é•¿/gi,type:"growth",name:"ROEGrowth"},{pattern:/\broe\b|\bROE\b|å‡€èµ„äº§æ”¶ç›Šç‡/gi,type:"quality",name:"ROE"},{pattern:/\broa\b|\bROA\b|æ€»èµ„äº§æ”¶ç›Šç‡/gi,type:"quality",name:"ROA"},{pattern:/gross_margin|æ¯›åˆ©ç‡/gi,type:"quality",name:"GrossMargin"},{pattern:/net_margin|å‡€åˆ©ç‡/gi,type:"quality",name:"NetMargin"},{pattern:/asset_turnover|èµ„äº§å‘¨è½¬/gi,type:"quality",name:"AssetTurnover"},{pattern:/momentum|åŠ¨é‡/gi,type:"momentum",name:"Momentum"},{pattern:/return_\d+d|æ”¶ç›Šç‡/gi,type:"momentum",name:"Return"},{pattern:/relative_strength|ç›¸å¯¹å¼ºåº¦/gi,type:"momentum",name:"RelativeStrength"},{pattern:/volatility|æ³¢åŠ¨ç‡/gi,type:"volatility",name:"Volatility"},{pattern:/\bbeta\b|è´å¡”/gi,type:"volatility",name:"Beta"},{pattern:/std_dev|æ ‡å‡†å·®/gi,type:"volatility",name:"StdDev"}],o=[{pattern:/\bMA\b|ç§»åŠ¨å¹³å‡|ma\(/gi,type:"ma",name:"MA"},{pattern:/\bEMA\b|æŒ‡æ•°å¹³å‡|ema\(/gi,type:"ma",name:"EMA"},{pattern:/\bMACD\b|macd/gi,type:"macd",name:"MACD"},{pattern:/\bRSI\b|rsi|ç›¸å¯¹å¼ºå¼±/gi,type:"rsi",name:"RSI"},{pattern:/\bKDJ\b|kdj/gi,type:"kdj",name:"KDJ"},{pattern:/\bBOLL\b|å¸ƒæ—|boll/gi,type:"boll",name:"BOLL"},{pattern:/\bATR\b|atr|å¹³å‡çœŸå®æ³¢å¹…/gi,type:"atr",name:"ATR"}];class s{analyze(e,n){const t=e.split("\n"),a=this.extractMeta(e,n),r=this.extractCodeBlocks(e),o=this.categorizeComponents(r),s=this.analyzeDependencies(e,t);return{meta:a,components:o,dependencies:s,compatibility:this.calculateCompatibility(s.apis),stats:this.calculateStats(e,r)}}extractMeta(e,n){const t={name:n?.replace(".py","")||"æœªå‘½åç­–ç•¥",description:""},a=e.match(/^[\s\S]*?"""([\s\S]*?)"""/);if(a){const e=a[1],n=e.match(/^(.+?)\s*[-=]/m);n&&(t.name=n[1].trim());const r=e.match(/åˆ›å»ºæ—¶é—´[ï¼š:]\s*(.+)/);r&&(t.createTime=r[1].trim());const o=e.match(/å›æµ‹åŒºé—´[ï¼š:]\s*(\d{4}-\d{2}-\d{2})\s*è‡³\s*(\d{4}-\d{2}-\d{2})/);o&&(t.backtestPeriod={start:o[1],end:o[2]});const s=e.match(/åŸºå‡†[æŒ‡æ•°]*[ï¼š:]\s*(\S+)/);s&&(t.benchmark=s[1]);const i=e.match(/ç­–ç•¥[è¯´æ˜ç‰¹è‰²]*[ï¼š:]*\n?([\s\S]*?)(?=\n\n|è¿ç§»|å¹³å°|$)/);i&&(t.description=i[1].trim().replace(/^[-\d.\s]+/gm,"").trim())}return t}extractCodeBlocks(e){const n=[],t=e.split("\n");let a=null,r=0,o=!1,s="";for(let e=0;e<t.length;e++){const i=t[e],c=i.trim(),l=i.length-i.trimStart().length;if(c.startsWith('"""')||c.startsWith("'''")){o?c.endsWith(s)&&(o=!1):(o=!0,s=c.substring(0,3),c.endsWith(s)&&c.length>3&&(o=!1));continue}if(o)continue;const d=c.match(/^def\s+(\w+)\s*\(/);if(d){a&&void 0!==a.startLine&&(a.endLine=e-1,a.content=t.slice(a.startLine,e).join("\n"),n.push(a)),a={type:"function",name:d[1],startLine:e,endLine:e,content:""},r=l;continue}const p=c.match(/^class\s+(\w+)/);if(p){a&&void 0!==a.startLine&&(a.endLine=e-1,a.content=t.slice(a.startLine,e).join("\n"),n.push(a)),a={type:"class",name:p[1],startLine:e,endLine:e,content:""},r=l;continue}const g=c.match(/^([A-Z_][A-Z0-9_]*)\s*=/);if(g&&0===l&&!a){let a=e;for(let n=e+1;n<t.length;n++){const e=t[n],r=e.trim(),o=e.length-e.trimStart().length;if(""===r||0===o&&!r.startsWith("#"))break;a=n}n.push({type:"variable",name:g[1],startLine:e,endLine:a,content:t.slice(e,a+1).join("\n")});continue}a&&l<=r&&""!==c&&!c.startsWith("#")&&(a.endLine=e-1,a.content=t.slice(a.startLine,e).join("\n"),n.push(a),a=null)}return a&&void 0!==a.startLine&&(a.endLine=t.length-1,a.content=t.slice(a.startLine).join("\n"),n.push(a)),n}categorizeComponents(e){const n={stockSelection:[],timing:[],riskControl:[],execution:[],utilities:[]};for(const t of e){const e=t.name.toLowerCase(),a=t.content.toLowerCase();e.includes("select")||e.includes("filter")||e.includes("stock")||a.includes("é€‰è‚¡")||a.includes("stock_pool")||a.includes("get_index_stocks")?(t.category="selection",n.stockSelection.push(t)):e.includes("timing")||e.includes("signal")||e.includes("market")||a.includes("æ‹©æ—¶")||a.includes("ä¿¡å·")||a.includes("è¶‹åŠ¿")?(t.category="timing",n.timing.push(t)):e.includes("risk")||e.includes("stop")||e.includes("control")||a.includes("æ­¢æŸ")||a.includes("æ­¢ç›ˆ")||a.includes("é£æ§")?(t.category="risk",n.riskControl.push(t)):e.includes("execute")||e.includes("trade")||e.includes("order")||e.includes("handle_data")||e.includes("rebalance")||a.includes("order")||a.includes("äº¤æ˜“")?(t.category="execution",n.execution.push(t)):(t.category="util",n.utilities.push(t))}return n}analyzeDependencies(e,n){const s=[],i=[],c=[],l=[],d=e.matchAll(/^(?:from\s+(\S+)\s+)?import\s+(.+)$/gm);for(const e of d)e[1]?l.push(`${e[1]}.${e[2]}`):l.push(e[2]);for(const a of t){let t;for(;null!==(t=a.pattern.exec(e));){const r=e.substring(0,t.index).split("\n").length,o=n[r-1]||"";s.push({name:a.name,platform:"joinquant",line:r,params:{},context:o.trim(),canConvert:!0})}a.pattern.lastIndex=0}for(const t of a){let a;for(;null!==(a=t.pattern.exec(e));){const r=e.substring(0,a.index).split("\n").length,o=n[r-1]||"";s.push({name:t.name,platform:"ptrade",line:r,params:{},context:o.trim(),canConvert:!0})}t.pattern.lastIndex=0}const p=new Set;for(const n of r)n.pattern.test(e)&&(p.has(n.name)||(p.add(n.name),i.push({name:n.name,type:n.type}))),n.pattern.lastIndex=0;const g=new Set;for(const n of o)n.pattern.test(e)&&(g.has(n.name)||(g.add(n.name),c.push({name:n.name,type:n.type}))),n.pattern.lastIndex=0;return{apis:s,factors:i,indicators:c,imports:l}}calculateCompatibility(e){const n=e.filter(e=>"joinquant"===e.platform),t=e.filter(e=>"ptrade"===e.platform);let a="joinquant";t.length>n.length&&(a="ptrade");const r=e=>{if(e===a)return{score:100,level:"full",issues:[],suggestions:[]};const r=[],o="joinquant"===a?n:t;for(const n of o)this.hasAPIMapping(n.name,a,e)?r.push({severity:"info",line:n.line,message:`API '${n.name}' å¯è‡ªåŠ¨è½¬æ¢`,api:n.name,suggestion:"å°†è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”API"}):r.push({severity:"error",line:n.line,message:`API '${n.name}' åœ¨ ${e} ä¸­æ²¡æœ‰ç›´æ¥å¯¹åº”`,api:n.name,suggestion:"éœ€è¦æ‰‹åŠ¨å®ç°æˆ–å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆ"});const s=r.filter(e=>"error"===e.severity).length,i=o.length||1,c=Math.max(0,100-s/i*100);let l;return l=c>=95?"full":c>=80?"high":c>=60?"medium":c>=30?"low":"none",{score:Math.round(c),level:l,issues:r,suggestions:this.generateSuggestions(r,e)}};return{sourcePlatform:a,joinquant:r("joinquant"),ptrade:r("ptrade"),qmt:r("qmt")}}hasAPIMapping(e,n,t){const a={get_price:{joinquant:"get_price",ptrade:"get_history",qmt:"ContextInfo.get_market_data"},get_current_data:{joinquant:"get_current_data",ptrade:"get_snapshot",qmt:"ContextInfo.get_full_tick"},order_target_value:{joinquant:"order_target_value",ptrade:"order_target_percent",qmt:"order_target_volume"},order:{joinquant:"order",ptrade:"order_lots",qmt:"order_volume"},set_benchmark:{joinquant:"set_benchmark",ptrade:null,qmt:null},"log.info":{joinquant:"log.info",ptrade:"print",qmt:"print"},run_daily:{joinquant:"run_daily",ptrade:null,qmt:null},get_index_stocks:{joinquant:"get_index_stocks",ptrade:null,qmt:"ContextInfo.get_stock_list_in_sector"}}[e];return!!a&&null!==a[t]}generateSuggestions(e,n){const t=[],a=e.filter(e=>"error"===e.severity).map(e=>e.api);return 0===a.length?t.push("ä»£ç å¯ç›´æ¥è½¬æ¢ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹"):(t.push(`éœ€è¦å¤„ç† ${a.length} ä¸ªä¸å…¼å®¹çš„APIè°ƒç”¨`),a.includes("run_daily")&&t.push("PTradeä¸æ”¯æŒrun_dailyï¼Œéœ€è¦åœ¨on_barä¸­å®ç°æ—¥é¢‘é€»è¾‘"),a.includes("set_benchmark")&&t.push("PTradeæ— éœ€è®¾ç½®åŸºå‡†ï¼Œå¯åˆ é™¤æ­¤è¡Œ"),"ptrade"===n&&(t.push("éœ€è¦æ·»åŠ  on_bar() ä½œä¸ºå…¥å£å‡½æ•°"),t.push("å»ºè®®æ·»åŠ  initialize() å’Œ before_trading_start() å‡½æ•°"))),t}calculateStats(e,n){const t=e.split("\n"),a=t.length;let r=0,o=0,s=!1;for(const e of t){const n=e.trim();n.startsWith('"""')||n.startsWith("'''")?(s?s=!1:(s=!0,n.length>3&&(n.endsWith('"""')||n.endsWith("'''"))&&(s=!1)),r++):s||n.startsWith("#")||""===n?r++:o++}const i=n.filter(e=>"function"===e.type).length;let c;return c=i<=5&&a<=200?"low":i<=15&&a<=500?"medium":"high",{totalLines:a,codeLines:o,commentLines:r,functionCount:i,classCount:n.filter(e=>"class"===e.type).length,complexity:c}}}n.CodeAnalyzer=s,n.codeAnalyzer=new s},628:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.logger=n.Logger=n.LogLevel=void 0;const i=s(t(398));var c;!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(c||(n.LogLevel=c={}));class l{static instance;outputChannel;minLevel=c.INFO;logs=[];maxLogs=1e3;constructor(){this.outputChannel=i.window.createOutputChannel("TRQuant")}static getInstance(){return l.instance||(l.instance=new l),l.instance}setLevel(e){this.minLevel=e}show(){this.outputChannel.show()}debug(e,n,t){this.log(c.DEBUG,e,n,t)}info(e,n,t){this.log(c.INFO,e,n,t)}warn(e,n,t){this.log(c.WARN,e,n,t)}error(e,n,t){this.log(c.ERROR,e,n,t)}log(e,n,t,a){if(e<this.minLevel)return;const r={level:e,message:n,timestamp:new Date,module:t,data:a};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift();const o=c[e].padEnd(5),s=`${r.timestamp.toISOString().substring(11,23)} ${o} ${t?`[${t}]`:""} ${n}${a?` | ${JSON.stringify(a)}`:""}`;this.outputChannel.appendLine(s),e===c.ERROR&&i.window.showErrorMessage(`TRQuant: ${n}`)}getRecentLogs(e=100){return this.logs.slice(-e)}clear(){this.logs=[],this.outputChannel.clear()}dispose(){this.outputChannel.dispose()}}n.Logger=l,n.logger=l.getInstance()},683:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.KnowledgeStore=void 0,n.getKnowledgeStore=function(e){return d||(d=new l(e)),d};const i=s(t(896)),c=s(t(928));class l{dataPath;data;isDirty=!1;constructor(e){this.dataPath=c.join(e,"knowledge.json"),this.data=this.load()}load(){try{if(i.existsSync(this.dataPath)){const e=i.readFileSync(this.dataPath,"utf-8");return JSON.parse(e)}}catch(e){console.error("[KnowledgeStore] åŠ è½½å¤±è´¥:",e)}return this.getDefaultData()}getDefaultData(){return{patterns:this.getBuiltinPatterns(),apiMappings:[],bestPractices:this.getBuiltinBestPractices(),userFeedback:[]}}getBuiltinPatterns(){return[{id:"multi_factor_selection",name:"å¤šå› å­é€‰è‚¡",category:"selection",description:"åŸºäºå¤šä¸ªé‡åŒ–å› å­å¯¹è‚¡ç¥¨è¿›è¡Œç»¼åˆè¯„åˆ†ç­›é€‰",codeTemplate:'\ndef select_stocks_by_factors(stocks, factor_weights):\n    """å¤šå› å­é€‰è‚¡"""\n    scores = {}\n    for stock in stocks:\n        score = 0\n        for factor, weight in factor_weights.items():\n            factor_value = get_factor_value(stock, factor)\n            score += factor_value * weight\n        scores[stock] = score\n    # è¿”å›å¾—åˆ†æœ€é«˜çš„è‚¡ç¥¨\n    return sorted(scores, key=scores.get, reverse=True)\n',effectiveness:85,usageCount:100},{id:"momentum_timing",name:"åŠ¨é‡æ‹©æ—¶",category:"timing",description:"åŸºäºä»·æ ¼åŠ¨é‡åˆ¤æ–­å¸‚åœºè¶‹åŠ¿",codeTemplate:"\ndef check_momentum_signal(index_code, lookback=20):\n    \"\"\"åŠ¨é‡æ‹©æ—¶ä¿¡å·\"\"\"\n    prices = get_price(index_code, count=lookback, fields=['close'])\n    returns = prices['close'].pct_change(lookback-1).iloc[-1]\n    \n    if returns > 0.05:\n        return 'bullish'\n    elif returns < -0.05:\n        return 'bearish'\n    return 'neutral'\n",effectiveness:70,usageCount:80},{id:"fixed_stop_loss",name:"å›ºå®šæ­¢æŸ",category:"risk",description:"å½“äºæŸè¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨æ­¢æŸ",codeTemplate:'\ndef check_stop_loss(context, stock, stop_loss_pct=-0.08):\n    """å›ºå®šæ­¢æŸæ£€æŸ¥"""\n    if stock not in context.portfolio.positions:\n        return False\n    \n    position = context.portfolio.positions[stock]\n    cost = position.avg_cost\n    current_price = position.price\n    \n    profit_pct = (current_price - cost) / cost\n    return profit_pct <= stop_loss_pct\n',effectiveness:90,usageCount:150},{id:"trailing_stop",name:"ç§»åŠ¨æ­¢æŸ",category:"risk",description:"æ ¹æ®æœ€é«˜ä»·åŠ¨æ€è°ƒæ•´æ­¢æŸçº¿",codeTemplate:'\ndef check_trailing_stop(context, stock, trail_pct=0.10):\n    """ç§»åŠ¨æ­¢æŸæ£€æŸ¥"""\n    if stock not in g.highest_prices:\n        return False\n    \n    highest = g.highest_prices[stock]\n    current = get_current_data()[stock].last_price\n    \n    # æ›´æ–°æœ€é«˜ä»·\n    if current > highest:\n        g.highest_prices[stock] = current\n        return False\n    \n    # æ£€æŸ¥å›æ’¤\n    drawdown = (highest - current) / highest\n    return drawdown >= trail_pct\n',effectiveness:85,usageCount:90},{id:"equal_weight_execution",name:"ç­‰æƒé‡æ‰§è¡Œ",category:"execution",description:"å¯¹ç›®æ ‡è‚¡ç¥¨è¿›è¡Œç­‰æƒé‡é…ç½®",codeTemplate:'\ndef execute_equal_weight(context, target_stocks, max_position=0.10):\n    """ç­‰æƒé‡æ‰§è¡Œ"""\n    if not target_stocks:\n        return\n    \n    total_value = context.portfolio.total_value\n    weight = min(1.0 / len(target_stocks), max_position)\n    \n    for stock in target_stocks:\n        target_value = total_value * weight\n        order_target_value(stock, target_value)\n',effectiveness:80,usageCount:120},{id:"market_regime_position",name:"å¸‚åœºçŠ¶æ€ä»“ä½ç®¡ç†",category:"risk",description:"æ ¹æ®å¸‚åœºçŠ¶æ€åŠ¨æ€è°ƒæ•´æ€»ä»“ä½",codeTemplate:"\nPOSITION_BY_REGIME = {\n    'risk_on': 0.90,   # ç‰›å¸‚é«˜ä»“ä½\n    'risk_off': 0.50,  # ç†Šå¸‚ä½ä»“ä½\n    'neutral': 0.70,   # éœ‡è¡ä¸­ä»“ä½\n}\n\ndef get_target_position(regime):\n    \"\"\"è·å–ç›®æ ‡ä»“ä½\"\"\"\n    return POSITION_BY_REGIME.get(regime, 0.70)\n",effectiveness:88,usageCount:85}]}getBuiltinBestPractices(){return[{id:"bp_stop_loss",title:"å¿…é¡»è®¾ç½®æ­¢æŸ",category:"é£æ§",description:"ä»»ä½•ç­–ç•¥éƒ½åº”è¯¥æœ‰æ­¢æŸæœºåˆ¶ï¼Œå»ºè®®å•ç¥¨æ­¢æŸçº¿è®¾ç½®åœ¨-8%å·¦å³",example:"\n# æ¨èçš„æ­¢æŸè®¾ç½®\nSTOP_LOSS = -0.08  # 8%æ­¢æŸ\nTAKE_PROFIT = 0.20  # 20%æ­¢ç›ˆ\n\ndef check_risk(context, stock):\n    profit = get_profit_pct(context, stock)\n    if profit <= STOP_LOSS:\n        order_target_value(stock, 0)\n        log.warn(f'æ­¢æŸ: {stock}')\n",references:["é‡åŒ–æŠ•èµ„ç­–ç•¥ä¸æŠ€æœ¯","Aè‚¡é‡åŒ–å®æˆ˜"]},{id:"bp_position_limit",title:"æ§åˆ¶å•ç¥¨ä»“ä½",category:"é£æ§",description:"å•ç¥¨ä»“ä½ä¸å®œè¶…è¿‡æ€»èµ„é‡‘çš„10%ï¼Œé¿å…ä¸ªè‚¡é£é™©é›†ä¸­",example:"\n# æ¨èçš„ä»“ä½æ§åˆ¶\nMAX_SINGLE_POSITION = 0.10  # å•ç¥¨æœ€å¤§10%\nMAX_TOTAL_POSITION = 0.80   # æ€»ä»“ä½æœ€å¤§80%\n\ndef calculate_position(context, stock, score):\n    max_value = context.portfolio.total_value * MAX_SINGLE_POSITION\n    target_value = min(calculated_value, max_value)\n    return target_value\n",references:["ç»„åˆç®¡ç†","é£é™©å¹³ä»·"]},{id:"bp_avoid_st",title:"è¿‡æ»¤STè‚¡ç¥¨",category:"é€‰è‚¡",description:"åœ¨é€‰è‚¡æ± ä¸­æ’é™¤STã€*STè‚¡ç¥¨ï¼Œé¿å…é€€å¸‚é£é™©",example:'\ndef filter_st_stocks(stocks):\n    """è¿‡æ»¤STè‚¡ç¥¨"""\n    current_data = get_current_data()\n    return [s for s in stocks \n            if not current_data[s].is_st \n            and not current_data[s].name.startswith(\'ST\')\n            and not current_data[s].name.startswith(\'*ST\')]\n',references:["Aè‚¡äº¤æ˜“è§„åˆ™"]},{id:"bp_avoid_suspension",title:"è¿‡æ»¤åœç‰Œè‚¡ç¥¨",category:"é€‰è‚¡",description:"äº¤æ˜“å‰æ£€æŸ¥è‚¡ç¥¨æ˜¯å¦åœç‰Œï¼Œé¿å…æ— æ•ˆä¸‹å•",example:'\ndef filter_paused_stocks(stocks):\n    """è¿‡æ»¤åœç‰Œè‚¡ç¥¨"""\n    current_data = get_current_data()\n    return [s for s in stocks \n            if not current_data[s].paused]\n',references:["äº¤æ˜“ç³»ç»Ÿè®¾è®¡"]},{id:"bp_limit_check",title:"æ¶¨è·Œåœæ£€æŸ¥",category:"æ‰§è¡Œ",description:"ä¸‹å•å‰æ£€æŸ¥æ˜¯å¦æ¶¨è·Œåœï¼Œé¿å…æ— æ•ˆå§”æ‰˜",example:'\ndef can_trade(stock):\n    """æ£€æŸ¥æ˜¯å¦å¯äº¤æ˜“"""\n    current_data = get_current_data()\n    data = current_data[stock]\n    \n    # æ¶¨åœä¸èƒ½ä¹°å…¥\n    if data.last_price >= data.high_limit * 0.995:\n        return False, \'buy\'\n    \n    # è·Œåœä¸èƒ½å–å‡º\n    if data.last_price <= data.low_limit * 1.005:\n        return False, \'sell\'\n    \n    return True, None\n',references:["Aè‚¡äº¤æ˜“è§„åˆ™","ç¨‹åºåŒ–äº¤æ˜“"]},{id:"bp_rebalance_frequency",title:"åˆç†çš„è°ƒä»“é¢‘ç‡",category:"æ‰§è¡Œ",description:"è°ƒä»“é¢‘ç‡ä¸å®œè¿‡é«˜ï¼Œå»ºè®®å‘¨é¢‘æˆ–æœˆé¢‘ï¼Œå‡å°‘äº¤æ˜“æˆæœ¬",example:'\n# æ¨èçš„è°ƒä»“è®¾ç½®\nREBALANCE_DAYS = 20  # æœˆåº¦è°ƒä»“\n\ndef should_rebalance(context):\n    """åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒä»“"""\n    if not hasattr(g, \'last_rebalance_date\'):\n        g.last_rebalance_date = context.current_dt.date()\n        return True\n    \n    days_since = (context.current_dt.date() - g.last_rebalance_date).days\n    if days_since >= REBALANCE_DAYS:\n        g.last_rebalance_date = context.current_dt.date()\n        return True\n    \n    return False\n',references:["äº¤æ˜“æˆæœ¬åˆ†æ"]},{id:"bp_logging",title:"å®Œå–„çš„æ—¥å¿—è®°å½•",category:"è°ƒè¯•",description:"è®°å½•å…³é”®æ“ä½œæ—¥å¿—ï¼Œä¾¿äºå›æµ‹åˆ†æå’Œé—®é¢˜æ’æŸ¥",example:'\ndef log_trade(context, stock, action, amount, price):\n    """è®°å½•äº¤æ˜“æ—¥å¿—"""\n    log.info(f\'[{context.current_dt}] {action}: {stock}, \'\n             f\'æ•°é‡: {amount}, ä»·æ ¼: {price:.2f}\')\n\ndef log_daily_summary(context):\n    """è®°å½•æ¯æ—¥æ€»ç»“"""\n    pv = context.portfolio.total_value\n    cash = context.portfolio.cash\n    positions = len(context.portfolio.positions)\n    log.info(f\'æ—¥ç»ˆ: æ€»å€¼={pv:.0f}, ç°é‡‘={cash:.0f}, æŒä»“={positions}åª\')\n',references:["é‡åŒ–ç³»ç»Ÿè®¾è®¡"]}]}save(){try{const e=c.dirname(this.dataPath);i.existsSync(e)||i.mkdirSync(e,{recursive:!0}),i.writeFileSync(this.dataPath,JSON.stringify(this.data,null,2),"utf-8"),this.isDirty=!1}catch(e){console.error("[KnowledgeStore] ä¿å­˜å¤±è´¥:",e)}}autoSave(){this.isDirty&&this.save()}getPatterns(e){return e?this.data.patterns.filter(n=>n.category===e):this.data.patterns}getPatternById(e){return this.data.patterns.find(n=>n.id===e)}addPattern(e){const n=this.data.patterns.findIndex(n=>n.id===e.id);n>=0?this.data.patterns[n]=e:this.data.patterns.push(e),this.isDirty=!0}updatePatternEffectiveness(e,n){const t=this.data.patterns.find(n=>n.id===e);t&&(t.effectiveness=n,t.usageCount++,this.isDirty=!0)}getAPIMappings(){return this.data.apiMappings}addAPIMapping(e){const n=this.data.apiMappings.findIndex(n=>n.source.api===e.source.api&&n.source.platform===e.source.platform&&n.target.platform===e.target.platform);n>=0?this.data.apiMappings[n]=e:this.data.apiMappings.push(e),this.isDirty=!0}getBestPractices(e){return e?this.data.bestPractices.filter(n=>n.category===e):this.data.bestPractices}addBestPractice(e){const n=this.data.bestPractices.findIndex(n=>n.id===e.id);n>=0?this.data.bestPractices[n]=e:this.data.bestPractices.push(e),this.isDirty=!0}getFeedback(e){return void 0!==e?this.data.userFeedback.filter(n=>n.resolved===e):this.data.userFeedback}addFeedback(e){this.data.userFeedback.push(e),this.isDirty=!0}resolveFeedback(e){const n=this.data.userFeedback.find(n=>n.timestamp===e);n&&(n.resolved=!0,this.isDirty=!0)}getStats(){return{patterns:this.data.patterns.length,apiMappings:this.data.apiMappings.length,bestPractices:this.data.bestPractices.length,feedback:{total:this.data.userFeedback.length,resolved:this.data.userFeedback.filter(e=>e.resolved).length,pending:this.data.userFeedback.filter(e=>!e.resolved).length}}}}n.KnowledgeStore=l;let d=null},767:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.ManualLearner=void 0,n.createManualLearner=function(e,n){return new m(e,n)};const i=s(t(896)),c=s(t(928)),l=t(683),d={"ashare-book1":{name:"Aè‚¡æŠ•èµ„åŸºç¡€",chapters:{"001":{name:"Aè‚¡å¸‚åœº",category:"åŸºç¡€çŸ¥è¯†"},"002":{name:"æŠ•èµ„å¿ƒç†",category:"äº¤æ˜“å¿ƒç†"},"003":{name:"é«˜å€è‚¡",category:"é€‰è‚¡ç­–ç•¥"},"004":{name:"è¡Œä¸šåˆ†æ",category:"è¡Œä¸šç ”ç©¶"},"005":{name:"åŸºæœ¬é¢",category:"åŸºæœ¬é¢åˆ†æ"},"006":{name:"é€‰è‚¡ç­›é€‰",category:"é€‰è‚¡ç­–ç•¥"},"007":{name:"äº¤æ˜“æ‰§è¡Œ",category:"äº¤æ˜“æ‰§è¡Œ"},"008":{name:"å·¥å…·ä½¿ç”¨",category:"å·¥å…·"},"009":{name:"æ¡ˆä¾‹åˆ†æ",category:"å®æˆ˜æ¡ˆä¾‹"},"010":{name:"äº¤æ˜“ç³»ç»Ÿ",category:"ç³»ç»Ÿæ„å»º"}}},"ashare-book2":{name:"å®è§‚ç»æµ",chapters:{"001":{name:"ç»æµå‘¨æœŸ",category:"å®è§‚æ‹©æ—¶"},"002":{name:"è´§å¸æ”¿ç­–",category:"æ”¿ç­–åˆ†æ"},"003":{name:"è´¢æ”¿æ”¿ç­–",category:"æ”¿ç­–åˆ†æ"},"004":{name:"è¡Œä¸šè½®åŠ¨",category:"è¡Œä¸šè½®åŠ¨"},"005":{name:"å¸‚åœºæƒ…ç»ª",category:"æƒ…ç»ªåˆ†æ"},"006":{name:"å®è§‚æ•°æ®",category:"æ•°æ®åˆ†æ"},"007":{name:"å…¨çƒå½±å“",category:"å…¨çƒè§†é‡"},"008":{name:"é£é™©ç›‘æ§",category:"é£æ§"},"009":{name:"å®è§‚æ‹©æ—¶",category:"å®è§‚æ‹©æ—¶"},"010":{name:"å®è§‚å·¥å…·",category:"å·¥å…·"}}},"ashare-book3":{name:"ä¸ªè‚¡ç ”ç©¶",chapters:{"001":{name:"ç ”ç©¶æ¡†æ¶",category:"ç ”ç©¶æ–¹æ³•"},"002":{name:"è´¢åŠ¡åˆ†æ",category:"åŸºæœ¬é¢åˆ†æ"},"003":{name:"ä¼°å€¼æ–¹æ³•",category:"ä¼°å€¼"},"004":{name:"è¡Œä¸šé¾™å¤´",category:"é€‰è‚¡ç­–ç•¥"},"005":{name:"æ¶ˆè´¹æ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"006":{name:"ç§‘æŠ€æ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"007":{name:"å‘¨æœŸæ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"008":{name:"é‡‘èæ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"009":{name:"åŒ»è¯æ¡ˆä¾‹",category:"è¡Œä¸šç ”ç©¶"},"010":{name:"æŠ¥å‘Šæ’°å†™",category:"ç ”ç©¶æ–¹æ³•"}}},"ashare-book4":{name:"æŠ€æœ¯åˆ†æ",chapters:{"001":{name:"æŠ€æœ¯åˆ†æåŸºç¡€",category:"æŠ€æœ¯åˆ†æ"},"002":{name:"Kçº¿å½¢æ€",category:"æŠ€æœ¯åˆ†æ"},"003":{name:"è¶‹åŠ¿åˆ†æ",category:"æŠ€æœ¯åˆ†æ"},"004":{name:"é‡ä»·å…³ç³»",category:"æŠ€æœ¯åˆ†æ"},"005":{name:"æŠ€æœ¯æŒ‡æ ‡",category:"æŠ€æœ¯æŒ‡æ ‡"}}},"ashare-book5":{name:"é‡åŒ–ä¸“é¢˜",chapters:{"001":{name:"å›æµ‹åŸºç¡€",category:"å›æµ‹"},"002":{name:"JQDataé›†æˆ",category:"æ•°æ®æº"},"003":{name:"éŸ¬ç¿å›æµ‹",category:"å›æµ‹"},"004":{name:"æŠ¥å‘Šåˆ†æ",category:"å›æµ‹åˆ†æ"},"005":{name:"é£é™©æ§åˆ¶",category:"é£æ§"},"006":{name:"PTradeå®ç›˜",category:"å®ç›˜äº¤æ˜“"},"007":{name:"QMTå®ç›˜",category:"å®ç›˜äº¤æ˜“"},"008":{name:"ç­–ç•¥è¿­ä»£",category:"ç­–ç•¥ä¼˜åŒ–"},"009":{name:"æ–‡ä»¶ç®¡ç†",category:"å·¥å…·"},"010":{name:"å®Œæ•´å·¥ä½œæµ",category:"ç³»ç»Ÿæ„å»º"}}},ashare:{name:"Aè‚¡é‡åŒ–æ ¸å¿ƒ",chapters:{"001":{name:"Aè‚¡å¸‚åœº",category:"åŸºç¡€çŸ¥è¯†"},"002":{name:"å› å­æ¡†æ¶",category:"å› å­æŠ•èµ„"},"003":{name:"é«˜å€è‚¡",category:"é€‰è‚¡ç­–ç•¥"},"004":{name:"è¡Œä¸šè½®åŠ¨",category:"è¡Œä¸šè½®åŠ¨"},"005":{name:"å¤šå› å­",category:"å¤šå› å­ç­–ç•¥"},"006":{name:"äº¤æ˜“æ‰§è¡Œ",category:"äº¤æ˜“æ‰§è¡Œ"},"007":{name:"é£é™©æ§åˆ¶",category:"é£æ§"},"008":{name:"å›æµ‹ç³»ç»Ÿ",category:"å›æµ‹"}}}},p=/```python\n([\s\S]*?)```/g,g=/(?:å»ºè®®|æ³¨æ„|æç¤º|æœ€ä½³å®è·µ|æ¨è)[ï¼š:]\s*(.+?)(?:\n|$)/g,u=/(?:æ­¢æŸ|æ­¢ç›ˆ|ä»“ä½|é£æ§)[ï¼š:]?\s*(.+?)(?:\n|$)/gi;class m{store;manualPath;learningLog=[];stats={filesScanned:0,patternsExtracted:0,practicesExtracted:0,codeBlocksFound:0};constructor(e,n){this.store=(0,l.getKnowledgeStore)(e),this.manualPath=n}async learnFromManual(){this.log("å¼€å§‹æ‰«æAè‚¡å®æ“æ‰‹å†Œ...");const e=c.join(this.manualPath,"src","pages");if(!i.existsSync(e))return this.log(`æ‰‹å†Œè·¯å¾„ä¸å­˜åœ¨: ${e}`),{success:!1,stats:this.stats,log:this.learningLog};for(const[n,t]of Object.entries(d)){const a=c.join(e,n);i.existsSync(a)&&await this.scanBookDirectory(a,n,t)}const n=c.join(this.manualPath,"docs");return i.existsSync(n)&&await this.scanDocsDirectory(n),this.store.save(),this.log(`å­¦ä¹ å®Œæˆï¼æ‰«æ${this.stats.filesScanned}ä¸ªæ–‡ä»¶ï¼Œæå–${this.stats.patternsExtracted}ä¸ªæ¨¡å¼ï¼Œ${this.stats.practicesExtracted}ä¸ªæœ€ä½³å®è·µ`),{success:!0,stats:this.stats,log:this.learningLog}}async scanBookDirectory(e,n,t){this.log(`æ‰«æ: ${t.name} (${n})`);const a=this.getAllMarkdownFiles(e);for(const e of a)try{const n=i.readFileSync(e,"utf-8"),a=c.basename(e),r=a.match(/(\d{3})_Chapter(\d+)/),o=r?r[1]:"000",s=t.chapters[o]||{name:"æœªçŸ¥",category:"é€šç”¨"};this.extractKnowledge(n,{source:`${t.name} - ${s.name}`,category:s.category,file:a}),this.stats.filesScanned++}catch(n){this.log(`å¤„ç†æ–‡ä»¶å¤±è´¥ ${e}: ${n}`)}}async scanDocsDirectory(e){this.log("æ‰«ædocsç›®å½•...");const n=i.readdirSync(e).filter(e=>e.endsWith(".md")).map(n=>c.join(e,n));for(const e of n)try{const n=i.readFileSync(e,"utf-8"),t=c.basename(e);this.extractKnowledge(n,{source:`æ–‡æ¡£: ${t}`,category:"å‚è€ƒæ–‡æ¡£",file:t}),this.stats.filesScanned++}catch(e){}}getAllMarkdownFiles(e){const n=[],t=i.readdirSync(e,{withFileTypes:!0});for(const a of t){const t=c.join(e,a.name);a.isDirectory()?n.push(...this.getAllMarkdownFiles(t)):a.name.endsWith(".md")&&n.push(t)}return n}extractKnowledge(e,n){const t=e.matchAll(p);for(const e of t){const t=e[1];this.stats.codeBlocksFound++;const a=t.match(/def\s+(\w+)\s*\([^)]*\):/);if(a){const e=a[1];this.addPatternFromCode(e,t,n)}}const a=e.matchAll(g);for(const e of a){const t=e[1].trim();t.length>10&&t.length<200&&this.addPractice(t,n)}const r=e.matchAll(u);for(const e of r){const t=e[1].trim();t.length>5&&t.length<150&&this.addPractice(t,{...n,category:"é£æ§"})}}addPatternFromCode(e,n,t){let a="execution";e.includes("select")||e.includes("filter")||e.includes("stock")?a="selection":e.includes("stop")||e.includes("risk")||e.includes("position")?a="risk":(e.includes("timing")||e.includes("signal")||e.includes("trend"))&&(a="timing");const r={id:`manual_${e}_${Date.now()}`,name:this.formatFunctionName(e),category:a,description:`ä»${t.source}å­¦ä¹ çš„${"selection"===a?"é€‰è‚¡":"risk"===a?"é£æ§":"timing"===a?"æ‹©æ—¶":"æ‰§è¡Œ"}å‡½æ•°`,codeTemplate:n.trim(),effectiveness:75,usageCount:0};this.store.addPattern(r),this.stats.patternsExtracted++}addPractice(e,n){const t={id:`manual_bp_${Date.now()}_${Math.random().toString(36).slice(2,6)}`,title:e.slice(0,50)+(e.length>50?"...":""),category:n.category,description:e,example:"",references:[n.source]};this.store.addBestPractice(t),this.stats.practicesExtracted++}watchForUpdates(e){const n=c.join(this.manualPath,"src","pages");return i.existsSync(n)?(this.log("å¼€å§‹ç›‘å¬æ‰‹å†Œæ›´æ–°..."),i.watch(n,{recursive:!0},(t,a)=>{if(a&&a.endsWith(".md")){this.log(`æ£€æµ‹åˆ°æ›´æ–°: ${a}`);const t=c.join(n,a);if(i.existsSync(t))try{const n=i.readFileSync(t,"utf-8");this.extractKnowledge(n,{source:"æ‰‹å†Œæ›´æ–°",category:"æ›´æ–°å†…å®¹",file:a}),this.store.save(),e&&e(a)}catch(e){this.log(`å¤„ç†æ›´æ–°å¤±è´¥: ${e}`)}}})):null}getChapterKnowledge(e,n){const t=d[e];if(!t)return{patterns:[],practices:[]};const a=t.chapters[n];if(!a)return{patterns:[],practices:[]};const r=`${t.name} - ${a.name}`;return{patterns:this.store.getPatterns().filter(e=>e.description.includes(r)),practices:this.store.getBestPractices().filter(e=>e.references.some(e=>e.includes(r)))}}getStats(){return{...this.stats,knowledgeStore:this.store.getStats()}}formatFunctionName(e){return e.replace(/_/g," ").replace(/([A-Z])/g," $1").trim().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}log(e){const n=`[${(new Date).toISOString()}] ${e}`;this.learningLog.push(n),console.log(`[ManualLearner] ${e}`)}getLearningLog(){return this.learningLog}}n.ManualLearner=m},799:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorHandler=n.ConfigError=n.DataError=n.PythonError=n.TRQuantError=n.ErrorCode=void 0;const i=s(t(398)),c=t(628);var l;!function(e){e[e.UNKNOWN=1e3]="UNKNOWN",e[e.TIMEOUT=1001]="TIMEOUT",e[e.CANCELLED=1002]="CANCELLED",e[e.PYTHON_NOT_FOUND=2e3]="PYTHON_NOT_FOUND",e[e.PYTHON_EXECUTION_ERROR=2001]="PYTHON_EXECUTION_ERROR",e[e.BRIDGE_CONNECTION_ERROR=2002]="BRIDGE_CONNECTION_ERROR",e[e.BRIDGE_RESPONSE_PARSE_ERROR=2003]="BRIDGE_RESPONSE_PARSE_ERROR",e[e.DATA_NOT_AVAILABLE=3e3]="DATA_NOT_AVAILABLE",e[e.DATA_PARSE_ERROR=3001]="DATA_PARSE_ERROR",e[e.DATA_VALIDATION_ERROR=3002]="DATA_VALIDATION_ERROR",e[e.CONFIG_INVALID=4e3]="CONFIG_INVALID",e[e.CONFIG_MISSING=4001]="CONFIG_MISSING",e[e.MCP_CONNECTION_ERROR=5e3]="MCP_CONNECTION_ERROR",e[e.MCP_TOOL_NOT_FOUND=5001]="MCP_TOOL_NOT_FOUND",e[e.MCP_EXECUTION_ERROR=5002]="MCP_EXECUTION_ERROR"}(l||(n.ErrorCode=l={}));class d extends Error{code;details;timestamp;constructor(e,n,t){super(n),this.name="TRQuantError",this.code=e,this.details=t,this.timestamp=new Date,Object.setPrototypeOf(this,d.prototype)}toUserMessage(){return{[l.UNKNOWN]:"å‘ç”ŸæœªçŸ¥é”™è¯¯",[l.TIMEOUT]:"æ“ä½œè¶…æ—¶ï¼Œè¯·é‡è¯•",[l.CANCELLED]:"æ“ä½œå·²å–æ¶ˆ",[l.PYTHON_NOT_FOUND]:"Pythonè§£é‡Šå™¨æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥é…ç½®",[l.PYTHON_EXECUTION_ERROR]:"Pythonæ‰§è¡Œé”™è¯¯",[l.BRIDGE_CONNECTION_ERROR]:"æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡",[l.BRIDGE_RESPONSE_PARSE_ERROR]:"åç«¯å“åº”è§£æå¤±è´¥",[l.DATA_NOT_AVAILABLE]:"æ•°æ®ä¸å¯ç”¨",[l.DATA_PARSE_ERROR]:"æ•°æ®è§£æå¤±è´¥",[l.DATA_VALIDATION_ERROR]:"æ•°æ®éªŒè¯å¤±è´¥",[l.CONFIG_INVALID]:"é…ç½®æ— æ•ˆ",[l.CONFIG_MISSING]:"ç¼ºå°‘å¿…è¦é…ç½®",[l.MCP_CONNECTION_ERROR]:"MCPæœåŠ¡è¿æ¥å¤±è´¥",[l.MCP_TOOL_NOT_FOUND]:"MCPå·¥å…·æœªæ‰¾åˆ°",[l.MCP_EXECUTION_ERROR]:"MCPå·¥å…·æ‰§è¡Œå¤±è´¥"}[this.code]||this.message}toLogString(){return`[${l[this.code]}] ${this.message}${this.details?` | Details: ${JSON.stringify(this.details)}`:""}`}}n.TRQuantError=d,n.PythonError=class extends d{constructor(e,n){super(l.PYTHON_EXECUTION_ERROR,e,n),this.name="PythonError"}},n.DataError=class extends d{constructor(e,n,t){super(e,n,t),this.name="DataError"}},n.ConfigError=class extends d{constructor(e,n){super(l.CONFIG_INVALID,e,n),this.name="ConfigError"}};class p{static handle(e,n){const t=n||"ErrorHandler";e instanceof d?(c.logger.error(e.toLogString(),t),i.window.showErrorMessage(e.toUserMessage())):e instanceof Error?(c.logger.error(e.message,t,{stack:e.stack}),i.window.showErrorMessage(`TRQuant: ${e.message}`)):(c.logger.error(String(e),t),i.window.showErrorMessage("TRQuant: å‘ç”ŸæœªçŸ¥é”™è¯¯"))}static async wrap(e,n){try{return await e()}catch(e){return void p.handle(e,n)}}static async withRetry(e,n=3,t=1e3,a){let r;for(let o=0;o<n;o++)try{return await e()}catch(e){r=e,c.logger.warn(`æ“ä½œå¤±è´¥ï¼Œç¬¬${o+1}æ¬¡é‡è¯•...`,a,{error:e instanceof Error?e.message:String(e)}),o<n-1&&await new Promise(e=>setTimeout(e,t))}throw r}static validateRequired(e,n){const t=n.filter(n=>void 0===e[n]||null===e[n]);if(t.length>0)throw new d(l.DATA_VALIDATION_ERROR,`ç¼ºå°‘å¿…éœ€å‚æ•°: ${t.join(", ")}`,{missing:t,provided:Object.keys(e)})}}n.ErrorHandler=p},857:e=>{e.exports=require("os")},879:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.reportGenerator=n.ReportGenerator=void 0;class t{generate(e,n){return{title:`${e.meta.name} - ç­–ç•¥åˆ†ææŠ¥å‘Š`,generatedAt:(new Date).toLocaleString("zh-CN"),version:"1.0.0",investmentPhilosophy:this.generatePhilosophy(e),codeArchitecture:this.generateArchitecture(e),platformCompatibility:this.generateCompatibility(e,n),optimizations:this.generateOptimizations(e),codeQuality:this.generateQuality(e)}}generateMarkdown(e,n){const t=this.generate(e,n);return`# ${t.title}\n\n> ç”Ÿæˆæ—¶é—´: ${t.generatedAt}\n> ç‰ˆæœ¬: ${t.version}\n\n---\n\n## ğŸ“Š æŠ•èµ„ç†å¿µ\n\n### æ ¸å¿ƒé€»è¾‘\n${t.investmentPhilosophy.coreLogic}\n\n### å¸‚åœºé€‚åº”\n${t.investmentPhilosophy.marketAdaptation}\n\n### é£é™©ç®¡ç†\n${t.investmentPhilosophy.riskManagement}\n\n### ç‰¹è‰²äº®ç‚¹\n${t.investmentPhilosophy.uniqueFeatures.map(e=>`- ${e}`).join("\n")}\n\n---\n\n## ğŸ—ï¸ ä»£ç æ¶æ„\n\n### æ¦‚è¿°\n${t.codeArchitecture.overview}\n\n### æ¨¡å—è¯´æ˜\n\n${t.codeArchitecture.modules.map(e=>`\n#### ${e.name}\n- **ç”¨é€”**: ${e.purpose}\n- **å¤æ‚åº¦**: ${e.complexity}\n- **å‡½æ•°**: ${e.functions.join(", ")}\n- **ä¾èµ–**: ${e.dependencies.join(", ")||"æ— "}\n`).join("\n")}\n\n### æµç¨‹å›¾\n\n\`\`\`mermaid\n${t.codeArchitecture.flowChart}\n\`\`\`\n\n### æ•°æ®æµ\n\n\`\`\`mermaid\n${t.codeArchitecture.dataFlow}\n\`\`\`\n\n---\n\n## ğŸ”„ å¹³å°å…¼å®¹æ€§\n\n${t.platformCompatibility.summary}\n\n| å¹³å° | å…¼å®¹åº¦ | ç­‰çº§ | éœ€ä¿®æ”¹ | å¤‡æ³¨ |\n|------|--------|------|--------|------|\n${Object.entries(t.platformCompatibility.details).map(([e,n])=>`| ${e} | ${n.score}% | ${n.level} | ${n.changes}å¤„ | ${n.notes.join("; ")} |`).join("\n")}\n\n---\n\n## ğŸ’¡ ä¼˜åŒ–å»ºè®®\n\n### æ€§èƒ½ä¼˜åŒ–\n${t.optimizations.performance.map(e=>this.formatOptimization(e)).join("\n")}\n\n### é£æ§ä¼˜åŒ–\n${t.optimizations.risk.map(e=>this.formatOptimization(e)).join("\n")}\n\n### ä»£ç å¯è¯»æ€§\n${t.optimizations.readability.map(e=>this.formatOptimization(e)).join("\n")}\n\n### å¹³å°é€‚é…\n${t.optimizations.platform.map(e=>this.formatOptimization(e)).join("\n")}\n\n---\n\n## ğŸ“ˆ ä»£ç è´¨é‡\n\n**æ€»åˆ†: ${t.codeQuality.score}/100**\n\n| æŒ‡æ ‡ | å¾—åˆ† |\n|------|------|\n| å¯ç»´æŠ¤æ€§ | ${t.codeQuality.metrics.maintainability}/100 |\n| å¯æµ‹è¯•æ€§ | ${t.codeQuality.metrics.testability}/100 |\n| æ–‡æ¡£å®Œæ•´æ€§ | ${t.codeQuality.metrics.documentation}/100 |\n| å¤æ‚åº¦æ§åˆ¶ | ${t.codeQuality.metrics.complexity}/100 |\n\n### æ”¹è¿›å»ºè®®\n${t.codeQuality.suggestions.map(e=>`- ${e}`).join("\n")}\n\n---\n\n*æŠ¥å‘Šç”± TRQuant Strategy Optimizer è‡ªåŠ¨ç”Ÿæˆ*\n`}generateHTML(e,n){const t=this.generate(e,n);return`<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${t.title}</title>\n    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"><\/script>\n    <style>\n        :root {\n            --primary: #6366f1;\n            --secondary: #8b5cf6;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --bg: #0f172a;\n            --card-bg: #1e293b;\n            --text: #e2e8f0;\n            --text-muted: #94a3b8;\n        }\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n            background: var(--bg);\n            color: var(--text);\n            line-height: 1.6;\n            padding: 2rem;\n        }\n        \n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n        \n        h1 {\n            font-size: 2.5rem;\n            background: linear-gradient(135deg, var(--primary), var(--secondary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            margin-bottom: 0.5rem;\n        }\n        \n        .meta {\n            color: var(--text-muted);\n            margin-bottom: 2rem;\n        }\n        \n        h2 {\n            font-size: 1.5rem;\n            color: var(--primary);\n            margin: 2rem 0 1rem;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n        \n        h3 {\n            font-size: 1.2rem;\n            margin: 1.5rem 0 0.5rem;\n        }\n        \n        .card {\n            background: var(--card-bg);\n            border-radius: 12px;\n            padding: 1.5rem;\n            margin-bottom: 1.5rem;\n            border: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        .grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n            gap: 1rem;\n        }\n        \n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin: 1rem 0;\n        }\n        \n        th, td {\n            padding: 0.75rem;\n            text-align: left;\n            border-bottom: 1px solid rgba(255,255,255,0.1);\n        }\n        \n        th {\n            background: rgba(99,102,241,0.2);\n            font-weight: 600;\n        }\n        \n        .badge {\n            display: inline-block;\n            padding: 0.25rem 0.75rem;\n            border-radius: 9999px;\n            font-size: 0.75rem;\n            font-weight: 600;\n        }\n        \n        .badge-success { background: rgba(16,185,129,0.2); color: var(--success); }\n        .badge-warning { background: rgba(245,158,11,0.2); color: var(--warning); }\n        .badge-danger { background: rgba(239,68,68,0.2); color: var(--danger); }\n        .badge-info { background: rgba(99,102,241,0.2); color: var(--primary); }\n        \n        .score {\n            font-size: 3rem;\n            font-weight: 700;\n            background: linear-gradient(135deg, var(--primary), var(--secondary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n        }\n        \n        .progress {\n            height: 8px;\n            background: rgba(255,255,255,0.1);\n            border-radius: 4px;\n            overflow: hidden;\n            margin-top: 0.5rem;\n        }\n        \n        .progress-bar {\n            height: 100%;\n            background: linear-gradient(90deg, var(--primary), var(--secondary));\n            border-radius: 4px;\n        }\n        \n        ul {\n            list-style-position: inside;\n            margin: 0.5rem 0;\n        }\n        \n        li {\n            margin: 0.25rem 0;\n        }\n        \n        .mermaid {\n            background: rgba(255,255,255,0.05);\n            padding: 1rem;\n            border-radius: 8px;\n            margin: 1rem 0;\n        }\n        \n        .optimization {\n            border-left: 3px solid var(--primary);\n            padding-left: 1rem;\n            margin: 1rem 0;\n        }\n        \n        .optimization.high { border-color: var(--danger); }\n        .optimization.medium { border-color: var(--warning); }\n        .optimization.low { border-color: var(--success); }\n        \n        code {\n            background: rgba(99,102,241,0.2);\n            padding: 0.2rem 0.5rem;\n            border-radius: 4px;\n            font-family: 'Fira Code', monospace;\n            font-size: 0.9em;\n        }\n        \n        pre {\n            background: rgba(0,0,0,0.3);\n            padding: 1rem;\n            border-radius: 8px;\n            overflow-x: auto;\n        }\n        \n        pre code {\n            background: none;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <h1>${t.title}</h1>\n        <p class="meta">ğŸ“… ${t.generatedAt} | ğŸ”– ç‰ˆæœ¬ ${t.version}</p>\n        \n        \x3c!-- æŠ•èµ„ç†å¿µ --\x3e\n        <h2>ğŸ“Š æŠ•èµ„ç†å¿µ</h2>\n        <div class="grid">\n            <div class="card">\n                <h3>ğŸ¯ æ ¸å¿ƒé€»è¾‘</h3>\n                <p>${t.investmentPhilosophy.coreLogic}</p>\n            </div>\n            <div class="card">\n                <h3>ğŸ“ˆ å¸‚åœºé€‚åº”</h3>\n                <p>${t.investmentPhilosophy.marketAdaptation}</p>\n            </div>\n            <div class="card">\n                <h3>ğŸ›¡ï¸ é£é™©ç®¡ç†</h3>\n                <p>${t.investmentPhilosophy.riskManagement}</p>\n            </div>\n        </div>\n        <div class="card">\n            <h3>âœ¨ ç‰¹è‰²äº®ç‚¹</h3>\n            <ul>\n                ${t.investmentPhilosophy.uniqueFeatures.map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n        </div>\n        \n        \x3c!-- ä»£ç æ¶æ„ --\x3e\n        <h2>ğŸ—ï¸ ä»£ç æ¶æ„</h2>\n        <div class="card">\n            <p>${t.codeArchitecture.overview}</p>\n        </div>\n        \n        <div class="grid">\n            ${t.codeArchitecture.modules.map(e=>`\n            <div class="card">\n                <h3>${e.name}</h3>\n                <p>${e.purpose}</p>\n                <p><span class="badge badge-info">${e.complexity}å¤æ‚åº¦</span></p>\n                <p><strong>å‡½æ•°:</strong> ${e.functions.join(", ")}</p>\n            </div>\n            `).join("")}\n        </div>\n        \n        <div class="card">\n            <h3>æµç¨‹å›¾</h3>\n            <div class="mermaid">\n${t.codeArchitecture.flowChart}\n            </div>\n        </div>\n        \n        \x3c!-- å¹³å°å…¼å®¹æ€§ --\x3e\n        <h2>ğŸ”„ å¹³å°å…¼å®¹æ€§</h2>\n        <div class="card">\n            <p>${t.platformCompatibility.summary}</p>\n            <table>\n                <tr>\n                    <th>å¹³å°</th>\n                    <th>å…¼å®¹åº¦</th>\n                    <th>ç­‰çº§</th>\n                    <th>éœ€ä¿®æ”¹</th>\n                    <th>å¤‡æ³¨</th>\n                </tr>\n                ${Object.entries(t.platformCompatibility.details).map(([e,n])=>`\n                <tr>\n                    <td><strong>${e}</strong></td>\n                    <td>\n                        <div>${n.score}%</div>\n                        <div class="progress"><div class="progress-bar" style="width: ${n.score}%"></div></div>\n                    </td>\n                    <td><span class="badge ${n.score>=80?"badge-success":n.score>=50?"badge-warning":"badge-danger"}">${n.level}</span></td>\n                    <td>${n.changes}å¤„</td>\n                    <td>${n.notes.join("; ")}</td>\n                </tr>\n                `).join("")}\n            </table>\n        </div>\n        \n        \x3c!-- ä¼˜åŒ–å»ºè®® --\x3e\n        <h2>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h2>\n        ${this.renderOptimizationsHTML(t.optimizations)}\n        \n        \x3c!-- ä»£ç è´¨é‡ --\x3e\n        <h2>ğŸ“ˆ ä»£ç è´¨é‡</h2>\n        <div class="card">\n            <div style="text-align: center; margin-bottom: 1rem;">\n                <div class="score">${t.codeQuality.score}</div>\n                <div class="meta">æ€»åˆ† / 100</div>\n            </div>\n            <div class="grid">\n                ${Object.entries(t.codeQuality.metrics).map(([e,n])=>`\n                <div>\n                    <div style="display: flex; justify-content: space-between;">\n                        <span>${this.translateMetric(e)}</span>\n                        <span>${n}/100</span>\n                    </div>\n                    <div class="progress"><div class="progress-bar" style="width: ${n}%"></div></div>\n                </div>\n                `).join("")}\n            </div>\n            <h3 style="margin-top: 1.5rem;">æ”¹è¿›å»ºè®®</h3>\n            <ul>\n                ${t.codeQuality.suggestions.map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n        </div>\n        \n        <p class="meta" style="text-align: center; margin-top: 3rem;">\n            æŠ¥å‘Šç”± TRQuant Strategy Optimizer è‡ªåŠ¨ç”Ÿæˆ\n        </p>\n    </div>\n    \n    <script>\n        mermaid.initialize({ \n            startOnLoad: true,\n            theme: 'dark',\n            themeVariables: {\n                primaryColor: '#6366f1',\n                primaryTextColor: '#e2e8f0',\n                primaryBorderColor: '#4f46e5',\n                lineColor: '#94a3b8',\n                secondaryColor: '#1e293b',\n                tertiaryColor: '#0f172a'\n            }\n        });\n    <\/script>\n</body>\n</html>`}generatePhilosophy(e){const n=e.dependencies.factors,t=e.components.riskControl.length>0,a=e.components.timing.length>0;let r="åŸºäº";const o=[...new Set(n.map(e=>e.type))];if(o.length>0){const e={value:"ä»·å€¼",growth:"æˆé•¿",quality:"è´¨é‡",momentum:"åŠ¨é‡",volatility:"æ³¢åŠ¨"};r+=o.map(n=>e[n]||n).join("+")+"å¤šå› å­æ¨¡å‹"}else r+="é‡åŒ–é€‰è‚¡æ¨¡å‹";r+="ï¼Œç­›é€‰å…·æœ‰æŠ•èµ„ä»·å€¼çš„æ ‡çš„";let s="";s=a?"å…·å¤‡å¸‚åœºæ‹©æ—¶èƒ½åŠ›ï¼Œæ ¹æ®å¸‚åœºè¶‹åŠ¿åŠ¨æ€è°ƒæ•´ä»“ä½":"é‡‡ç”¨å›ºå®šç­–ç•¥ï¼Œé€‚åˆé•¿æœŸæŒæœ‰";let i="";i=t?e.components.riskControl.map(e=>e.name).some(e=>e.includes("stop"))?"è®¾æœ‰æ­¢æŸæ­¢ç›ˆæœºåˆ¶ï¼Œæ§åˆ¶å•ç¥¨é£é™©":"åŒ…å«é£é™©æ§åˆ¶æ¨¡å—ï¼Œç®¡ç†ç»„åˆé£é™©":"å»ºè®®æ·»åŠ é£æ§æ¨¡å—ä»¥æ§åˆ¶ä¸‹è¡Œé£é™©";const c=[];return"low"===e.stats.complexity&&c.push("ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤"),n.length>=3&&c.push(`å¤šç»´åº¦å› å­è¯„ä¼°ï¼ˆ${n.length}ä¸ªå› å­ï¼‰`),a&&c.push("åŠ¨æ€å¸‚åœºé€‚åº”èƒ½åŠ›"),t&&c.push("å®Œå–„çš„é£é™©æ§åˆ¶ä½“ç³»"),e.dependencies.indicators.length>0&&c.push(`æŠ€æœ¯æŒ‡æ ‡è¾…åŠ©ï¼ˆ${e.dependencies.indicators.map(e=>e.name).join("ã€")}ï¼‰`),{coreLogic:r,marketAdaptation:s,riskManagement:i,uniqueFeatures:c}}generateArchitecture(e){const n=[];e.components.stockSelection.length>0&&n.push({name:"é€‰è‚¡æ¨¡å—",purpose:"æ ¹æ®å› å­ç­›é€‰æŠ•èµ„æ ‡çš„",functions:e.components.stockSelection.map(e=>e.name),dependencies:["æ•°æ®è·å–","å› å­è®¡ç®—"],complexity:e.components.stockSelection.length>3?"high":"medium"}),e.components.timing.length>0&&n.push({name:"æ‹©æ—¶æ¨¡å—",purpose:"åˆ¤æ–­å¸‚åœºè¶‹åŠ¿ï¼Œç”Ÿæˆäº¤æ˜“ä¿¡å·",functions:e.components.timing.map(e=>e.name),dependencies:["å¸‚åœºæ•°æ®","æŠ€æœ¯æŒ‡æ ‡"],complexity:"medium"}),e.components.riskControl.length>0&&n.push({name:"é£æ§æ¨¡å—",purpose:"æ§åˆ¶é£é™©ï¼Œä¿æŠ¤èµ„é‡‘å®‰å…¨",functions:e.components.riskControl.map(e=>e.name),dependencies:["æŒä»“æ•°æ®","ä»·æ ¼æ•°æ®"],complexity:"medium"}),e.components.execution.length>0&&n.push({name:"æ‰§è¡Œæ¨¡å—",purpose:"æ‰§è¡Œäº¤æ˜“æŒ‡ä»¤ï¼Œç®¡ç†æŒä»“",functions:e.components.execution.map(e=>e.name),dependencies:["é€‰è‚¡ç»“æœ","é£æ§æ£€æŸ¥"],complexity:"medium"});const t=this.generateFlowChart(e),a=this.generateDataFlow(e);return{overview:`ç­–ç•¥åŒ…å« ${n.length} ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œ${e.stats.functionCount} ä¸ªå‡½æ•°ï¼Œä»£ç å¤æ‚åº¦ä¸º${"low"===e.stats.complexity?"ä½":"medium"===e.stats.complexity?"ä¸­":"é«˜"}ã€‚`,modules:n,flowChart:t,dataFlow:a}}generateFlowChart(e){return"graph TD\n    A[ç­–ç•¥å¯åŠ¨] --\x3e B[åˆå§‹åŒ–é…ç½®]\n    B --\x3e C{æ¯æ—¥æ‰§è¡Œ}\n    C --\x3e D[æ•°æ®è·å–]\n    D --\x3e E[é€‰è‚¡ç­›é€‰]\n    E --\x3e F[å› å­æ‰“åˆ†]\n    F --\x3e G{é£æ§æ£€æŸ¥}\n    G --\x3e|é€šè¿‡| H[æ‰§è¡Œäº¤æ˜“]\n    G --\x3e|ä¸é€šè¿‡| I[è°ƒæ•´æŒä»“]\n    H --\x3e J[è®°å½•æ—¥å¿—]\n    I --\x3e J\n    J --\x3e C\n    \n    style A fill:#6366f1,stroke:#4f46e5,color:#fff\n    style H fill:#10b981,stroke:#059669,color:#fff\n    style G fill:#f59e0b,stroke:#d97706,color:#fff"}generateDataFlow(e){return"graph LR\n    subgraph æ•°æ®å±‚\n        A1[è¡Œæƒ…æ•°æ®]\n        A2[è´¢åŠ¡æ•°æ®]\n        A3[æŒä»“æ•°æ®]\n    end\n    \n    subgraph è®¡ç®—å±‚\n        B1[å› å­è®¡ç®—]\n        B2[æŒ‡æ ‡è®¡ç®—]\n        B3[é£é™©è¯„ä¼°]\n    end\n    \n    subgraph å†³ç­–å±‚\n        C1[é€‰è‚¡å†³ç­–]\n        C2[ä»“ä½å†³ç­–]\n        C3[äº¤æ˜“æ‰§è¡Œ]\n    end\n    \n    A1 --\x3e B1\n    A2 --\x3e B1\n    A1 --\x3e B2\n    A3 --\x3e B3\n    B1 --\x3e C1\n    B2 --\x3e C2\n    B3 --\x3e C2\n    C1 --\x3e C3\n    C2 --\x3e C3\n    \n    style A1 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style A2 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style A3 fill:#3b82f6,stroke:#2563eb,color:#fff\n    style C3 fill:#10b981,stroke:#059669,color:#fff"}generateCompatibility(e,n){const t={};for(const n of["joinquant","ptrade","qmt"]){const a=e.compatibility[n];t[n]={score:a.score,level:this.translateLevel(a.level),changes:a.issues.filter(e=>"error"===e.severity).length,notes:a.suggestions.slice(0,2)}}const a=e.compatibility.sourcePlatform;return{summary:`å½“å‰ä»£ç åŸºäº ${a.toUpperCase()} å¹³å°å¼€å‘ã€‚å¯ç›´æ¥åœ¨ ${a} è¿è¡Œï¼Œè½¬æ¢åˆ°å…¶ä»–å¹³å°éœ€è¦è¿›è¡ŒAPIé€‚é…ã€‚`,details:t}}generateOptimizations(e){const n={performance:[],risk:[],readability:[],platform:[]};e.stats.totalLines>500&&n.performance.push({category:"æ€§èƒ½",priority:"medium",title:"ä»£ç é‡è¾ƒå¤§",description:"ç­–ç•¥ä»£ç è¶…è¿‡500è¡Œï¼Œå»ºè®®æ‹†åˆ†æ¨¡å—",impact:"æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œæ‰§è¡Œæ•ˆç‡"}),0===e.components.riskControl.length&&n.risk.push({category:"é£æ§",priority:"high",title:"ç¼ºå°‘é£æ§æ¨¡å—",description:"å»ºè®®æ·»åŠ æ­¢æŸã€æ­¢ç›ˆã€ä»“ä½ç®¡ç†ç­‰é£æ§æœºåˆ¶",impact:"æ§åˆ¶ä¸‹è¡Œé£é™©ï¼Œä¿æŠ¤èµ„é‡‘å®‰å…¨",implementation:"æ·»åŠ  check_risk() å‡½æ•°ï¼Œè®¾ç½®æ­¢æŸçº¿-8%ï¼Œæ­¢ç›ˆçº¿20%"}),e.stats.commentLines<.2*e.stats.codeLines&&n.readability.push({category:"æ–‡æ¡£",priority:"low",title:"æ³¨é‡Šä¸è¶³",description:"ä»£ç æ³¨é‡Šæ¯”ä¾‹ä½äº20%ï¼Œå»ºè®®å¢åŠ æ³¨é‡Š",impact:"æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§"});for(const t of["ptrade","qmt"]){const a=e.compatibility[t];a.score<100&&n.platform.push({category:"å¹³å°é€‚é…",priority:a.score<50?"high":"medium",title:`${t.toUpperCase()} é€‚é…`,description:`éœ€è¦ä¿®æ”¹ ${a.issues.filter(e=>"error"===e.severity).length} å¤„APIè°ƒç”¨`,impact:`æ”¯æŒåœ¨ ${t.toUpperCase()} å¹³å°è¿è¡Œ`,implementation:a.suggestions.join("\n")})}return n}generateQuality(e){const n={maintainability:0,testability:0,documentation:0,complexity:0};n.maintainability=Math.min(100,Math.max(0,100-e.stats.totalLines/10+5*e.stats.functionCount-("high"===e.stats.complexity?20:"medium"===e.stats.complexity?10:0))),n.testability=Math.min(100,10*e.stats.functionCount+5*e.components.utilities.length);const t=e.stats.commentLines/e.stats.totalLines;n.documentation=Math.min(100,200*t),n.complexity="low"===e.stats.complexity?90:"medium"===e.stats.complexity?70:50;const a=Math.round((n.maintainability+n.testability+n.documentation+n.complexity)/4),r=[];return n.maintainability<70&&r.push("å»ºè®®æ‹†åˆ†å¤§å‡½æ•°ï¼Œä¿æŒå•ä¸ªå‡½æ•°ä¸è¶…è¿‡50è¡Œ"),n.testability<70&&r.push("å»ºè®®å¢åŠ å·¥å…·å‡½æ•°ï¼Œæé«˜ä»£ç å¤ç”¨æ€§"),n.documentation<70&&r.push("å»ºè®®ä¸ºæ¯ä¸ªå‡½æ•°æ·»åŠ docstringè¯´æ˜"),n.complexity<70&&r.push("å»ºè®®ç®€åŒ–å¤æ‚é€»è¾‘ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼é‡æ„"),{score:a,metrics:{maintainability:Math.round(n.maintainability),testability:Math.round(n.testability),documentation:Math.round(n.documentation),complexity:Math.round(n.complexity)},suggestions:r}}formatOptimization(e){return`\n#### ${"high"===e.priority?"ğŸ”´":"medium"===e.priority?"ğŸŸ¡":"ğŸŸ¢"} ${e.title}\n\n- **ä¼˜å…ˆçº§**: ${"high"===e.priority?"é«˜":"medium"===e.priority?"ä¸­":"ä½"}\n- **æè¿°**: ${e.description}\n- **å½±å“**: ${e.impact}\n${e.implementation?`- **å®ç°**: ${e.implementation}`:""}\n`}renderOptimizationsHTML(e){return[{key:"performance",title:"ğŸš€ æ€§èƒ½ä¼˜åŒ–",items:e.performance},{key:"risk",title:"ğŸ›¡ï¸ é£æ§ä¼˜åŒ–",items:e.risk},{key:"readability",title:"ğŸ“– ä»£ç å¯è¯»æ€§",items:e.readability},{key:"platform",title:"ğŸ”„ å¹³å°é€‚é…",items:e.platform}].map(e=>`\n            <div class="card">\n                <h3>${e.title}</h3>\n                ${0===e.items.length?'<p class="meta">æš‚æ— ä¼˜åŒ–å»ºè®®</p>':e.items.map(e=>`\n                    <div class="optimization ${e.priority}">\n                        <h4>${e.title}</h4>\n                        <p>${e.description}</p>\n                        <p class="meta">å½±å“: ${e.impact}</p>\n                        ${e.implementation?`<p><strong>å»ºè®®:</strong> ${e.implementation}</p>`:""}\n                    </div>\n                  `).join("")}\n            </div>\n        `).join("")}translateLevel(e){return{full:"å®Œå…¨å…¼å®¹",high:"é«˜åº¦å…¼å®¹",medium:"éƒ¨åˆ†å…¼å®¹",low:"ä½å…¼å®¹",none:"ä¸å…¼å®¹"}[e]||e}translateMetric(e){return{maintainability:"å¯ç»´æŠ¤æ€§",testability:"å¯æµ‹è¯•æ€§",documentation:"æ–‡æ¡£å®Œæ•´æ€§",complexity:"å¤æ‚åº¦æ§åˆ¶"}[e]||e}}n.ReportGenerator=t,n.reportGenerator=new t},896:e=>{e.exports=require("fs")},900:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.analyzeBacktest=async function(e,n){c.logger.info("æ‰§è¡Œå›æµ‹åˆ†æå‘½ä»¤",d);try{const t=await i.window.showQuickPick([{label:"ğŸ“‚ ä»æ–‡ä»¶å¯¼å…¥",value:"file",description:"é€‰æ‹©å›æµ‹ç»“æœæ–‡ä»¶"},{label:"ğŸ“ æ‰‹åŠ¨è¾“å…¥",value:"manual",description:"è¾“å…¥å…³é”®æŒ‡æ ‡"},{label:"ğŸ“‹ ä»å‰ªè´´æ¿",value:"clipboard",description:"ä»å‰ªè´´æ¿è¯»å–æŒ‡æ ‡"}],{placeHolder:"é€‰æ‹©å›æµ‹æ•°æ®æ¥æº"});if(!t)return;let a;switch(t.value){case"file":a=await async function(){const e=await i.window.showOpenDialog({canSelectMany:!1,filters:{JSONæ–‡ä»¶:["json"],CSVæ–‡ä»¶:["csv"],æ‰€æœ‰æ–‡ä»¶:["*"]},title:"é€‰æ‹©å›æµ‹ç»“æœæ–‡ä»¶"});if(!e||0===e.length)return;const n=e[0].fsPath,t=await i.workspace.fs.readFile(e[0]),a=Buffer.from(t).toString("utf-8");try{if(n.endsWith(".json"))return p(JSON.parse(a));if(n.endsWith(".csv"))return g(a)}catch(e){c.logger.error(`è§£ææ–‡ä»¶å¤±è´¥: ${e}`,d),i.window.showErrorMessage("æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼")}}();break;case"manual":a=await async function(){const e=await i.window.showInputBox({prompt:"æ€»æ”¶ç›Šç‡ (%)",value:"0",validateInput:e=>isNaN(parseFloat(e))?"è¯·è¾“å…¥æ•°å­—":null});if(!e)return;const n=await i.window.showInputBox({prompt:"å¤æ™®æ¯”ç‡",value:"0",validateInput:e=>isNaN(parseFloat(e))?"è¯·è¾“å…¥æ•°å­—":null});if(!n)return;const t=await i.window.showInputBox({prompt:"æœ€å¤§å›æ’¤ (%)",value:"0",validateInput:e=>isNaN(parseFloat(e))?"è¯·è¾“å…¥æ•°å­—":null});if(!t)return;const a=await i.window.showInputBox({prompt:"èƒœç‡ (%)",value:"50",validateInput:e=>isNaN(parseFloat(e))?"è¯·è¾“å…¥æ•°å­—":null});if(!a)return;const r=await i.window.showInputBox({prompt:"äº¤æ˜“æ¬¡æ•°",value:"0",validateInput:e=>isNaN(parseInt(e))?"è¯·è¾“å…¥æ•´æ•°":null});return r?{total_return:parseFloat(e)/100,annual_return:parseFloat(e)/100,sharpe_ratio:parseFloat(n),max_drawdown:parseFloat(t)/100,win_rate:parseFloat(a)/100,trade_count:parseInt(r),profit_loss_ratio:1}:void 0}();break;case"clipboard":a=await async function(){const e=await i.env.clipboard.readText();if(e.trim())try{return p(JSON.parse(e))}catch{try{return g(e)}catch{return void i.window.showErrorMessage("æ— æ³•è§£æå‰ªè´´æ¿å†…å®¹")}}else i.window.showWarningMessage("å‰ªè´´æ¿ä¸ºç©º")}()}if(!a)return void i.window.showWarningMessage("æœªèƒ½è·å–å›æµ‹æ•°æ®");await async function(e,n,t){await i.window.withProgress({location:i.ProgressLocation.Notification,title:"TRQuant",cancellable:!1},async a=>{a.report({message:"åˆ†æå›æµ‹ç»“æœ...",increment:0});const r=await e.analyzeBacktest({backtest_data:{metrics:t}});if(a.report({increment:60}),r.ok&&r.data)m(n,t,r.data);else{const e=function(e){const n=[],t=[];e.total_return<0?(n.push("âš ï¸ ç­–ç•¥äºæŸï¼Œéœ€è¦å…¨é¢æ£€è§†"),t.push("æ£€æŸ¥å…¥åœºä¿¡å·æ˜¯å¦è¿‡äºæ¿€è¿›"),t.push("è€ƒè™‘å¢åŠ æ›´å¤šè¿‡æ»¤æ¡ä»¶")):e.total_return<.1?(n.push("ğŸ’¡ æ”¶ç›Šè¾ƒä½ï¼Œå­˜åœ¨ä¼˜åŒ–ç©ºé—´"),t.push("å°è¯•è°ƒæ•´å› å­æƒé‡")):e.total_return>.5&&n.push("âœ… æ”¶ç›Šè¡¨ç°ä¼˜ç§€"),e.sharpe_ratio<.5?(n.push("âš ï¸ å¤æ™®æ¯”ç‡åä½ï¼Œé£é™©è°ƒæ•´æ”¶ç›Šä¸ä½³"),t.push("å¢åŠ æ­¢æŸæ¡ä»¶æˆ–é™ä½ä»“ä½")):e.sharpe_ratio>2?n.push("âœ… å¤æ™®æ¯”ç‡ä¼˜ç§€ï¼Œç­–ç•¥è´¨é‡é«˜"):n.push("ğŸ’¡ å¤æ™®æ¯”ç‡ä¸€èˆ¬ï¼Œå¯ä»¥ä¼˜åŒ–"),e.max_drawdown>.3?(n.push("âš ï¸ æœ€å¤§å›æ’¤è¿‡å¤§ï¼Œé£æ§éœ€è¦åŠ å¼º"),t.push("é™ä½å•ç¥¨ä»“ä½è‡³5%ä»¥ä¸‹"),t.push("å¢åŠ ç»„åˆåˆ†æ•£åº¦")):e.max_drawdown>.2?(n.push("ğŸ’¡ æœ€å¤§å›æ’¤ä¸­ç­‰ï¼Œå»ºè®®ä¼˜åŒ–"),t.push("è€ƒè™‘å¢åŠ åŠ¨æ€æ­¢æŸ")):n.push("âœ… æœ€å¤§å›æ’¤æ§åˆ¶è‰¯å¥½"),e.win_rate<.4?(n.push("âš ï¸ èƒœç‡åä½"),t.push("ä¼˜åŒ–é€‰è‚¡æ¡ä»¶"),t.push("å¢åŠ ç¡®è®¤ä¿¡å·")):e.win_rate>.6&&n.push("âœ… èƒœç‡è¾ƒé«˜"),e.trade_count<10?(n.push("ğŸ’¡ äº¤æ˜“æ¬¡æ•°è¾ƒå°‘ï¼Œç»Ÿè®¡æ„ä¹‰æœ‰é™"),t.push("å»¶é•¿å›æµ‹å‘¨æœŸ")):e.trade_count>500&&(n.push("ğŸ’¡ äº¤æ˜“é¢‘ç¹ï¼Œæ³¨æ„äº¤æ˜“æˆæœ¬"),t.push("è€ƒè™‘é™ä½æ¢ä»“é¢‘ç‡"));const a=u(e);return a>=80?n.unshift("ğŸ† ç­–ç•¥ç»¼åˆè¯„åˆ†: ä¼˜ç§€ ("+a+"/100)"):a>=60?n.unshift("ğŸ“Š ç­–ç•¥ç»¼åˆè¯„åˆ†: è‰¯å¥½ ("+a+"/100)"):a>=40?n.unshift("ğŸ“‹ ç­–ç•¥ç»¼åˆè¯„åˆ†: ä¸€èˆ¬ ("+a+"/100)"):n.unshift("âš ï¸ ç­–ç•¥ç»¼åˆè¯„åˆ†: è¾ƒå·® ("+a+"/100)"),{metrics:e,trades:[],diagnosis:n,suggestions:t.length>0?t:["ç­–ç•¥è¡¨ç°è‰¯å¥½ï¼Œä¿æŒè§‚å¯Ÿ"]}}(t);m(n,t,e)}a.report({increment:40})})}(e,n,a)}catch(e){l.ErrorHandler.handle(e,d)}};const i=s(t(398)),c=t(628),l=t(799),d="AnalyzeBacktest";function p(e){return{total_return:e.total_return??e.totalReturn??e.return??0,annual_return:e.annual_return??e.annualReturn??e.cagr??0,sharpe_ratio:e.sharpe_ratio??e.sharpeRatio??e.sharpe??0,max_drawdown:e.max_drawdown??e.maxDrawdown??e.mdd??0,win_rate:e.win_rate??e.winRate??0,trade_count:e.trade_count??e.tradeCount??e.trades??0,profit_loss_ratio:e.profit_loss_ratio??e.plRatio??1}}function g(e){const n=e.trim().split("\n"),t={};for(const e of n){const[n,a]=e.split(/[,\t:=]/);n&&a&&(t[n.trim().toLowerCase().replace(/\s+/g,"_")]=parseFloat(a.trim()))}return p(t)}function u(e){let n=50;return e.total_return>.5?n+=30:e.total_return>.2?n+=20:e.total_return>0?n+=10:n-=20,e.sharpe_ratio>2?n+=25:e.sharpe_ratio>1?n+=15:e.sharpe_ratio>.5?n+=5:n-=10,e.max_drawdown<.1?n+=25:e.max_drawdown<.2?n+=15:e.max_drawdown<.3?n+=5:n-=15,e.win_rate>.6?n+=20:e.win_rate>.5?n+=10:e.win_rate>.4?n+=0:n-=10,Math.max(0,Math.min(100,n))}function m(e,n,t){const a=i.window.createWebviewPanel("trquantBacktestAnalysis","ğŸ“Š å›æµ‹åˆ†ææŠ¥å‘Š",i.ViewColumn.Beside,{enableScripts:!0});a.webview.html=function(e,n){const t=u(e),a=t>=80?"#10b981":t>=60?"#f59e0b":"#ef4444";return`<!DOCTYPE html>\n<html lang="zh">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>å›æµ‹åˆ†ææŠ¥å‘Š</title>\n    <style>\n        :root {\n            --bg-primary: #1a1a2e;\n            --bg-secondary: #252540;\n            --bg-tertiary: #2d2d4a;\n            --text-primary: #ffffff;\n            --text-secondary: #9ca3af;\n            --primary: #667eea;\n            --success: #10b981;\n            --warning: #f59e0b;\n            --danger: #ef4444;\n            --border: #3d3d5c;\n        }\n\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            padding: 24px;\n            line-height: 1.6;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 24px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border);\n        }\n\n        .header-title {\n            font-size: 24px;\n            font-weight: 600;\n        }\n\n        .score-badge {\n            width: 80px;\n            height: 80px;\n            border-radius: 50%;\n            background: ${a}22;\n            border: 3px solid ${a};\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .score-value {\n            font-size: 28px;\n            font-weight: 700;\n            color: ${a};\n        }\n\n        .score-label {\n            font-size: 12px;\n            color: var(--text-secondary);\n        }\n\n        .metrics-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 16px;\n            margin-bottom: 24px;\n        }\n\n        .metric-card {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 16px;\n            text-align: center;\n            border: 1px solid var(--border);\n        }\n\n        .metric-value {\n            font-size: 24px;\n            font-weight: 700;\n            color: var(--primary);\n        }\n\n        .metric-label {\n            color: var(--text-secondary);\n            font-size: 13px;\n            margin-top: 4px;\n        }\n\n        .positive { color: var(--success); }\n        .negative { color: var(--danger); }\n\n        .section {\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            padding: 20px;\n            margin-bottom: 16px;\n            border: 1px solid var(--border);\n        }\n\n        .section-title {\n            font-size: 15px;\n            font-weight: 600;\n            margin-bottom: 16px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .diagnosis-item, .suggestion-item {\n            padding: 12px 16px;\n            margin-bottom: 8px;\n            background: var(--bg-tertiary);\n            border-radius: 8px;\n            font-size: 14px;\n        }\n\n        .actions {\n            display: flex;\n            gap: 12px;\n            margin-top: 24px;\n        }\n\n        .btn {\n            padding: 12px 24px;\n            border-radius: 10px;\n            border: none;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n        }\n\n        .btn-primary:hover { background: #5a6fd6; }\n\n        .btn-secondary {\n            background: var(--bg-tertiary);\n            color: var(--text-primary);\n        }\n\n        .btn-secondary:hover { background: #3d3d5c; }\n\n        .timestamp {\n            text-align: center;\n            color: var(--text-muted);\n            font-size: 12px;\n            margin-top: 24px;\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <div>\n            <div class="header-title">ğŸ“Š å›æµ‹åˆ†ææŠ¥å‘Š</div>\n        </div>\n        <div class="score-badge">\n            <div class="score-value">${t}</div>\n            <div class="score-label">ç»¼åˆè¯„åˆ†</div>\n        </div>\n    </div>\n\n    <div class="metrics-grid">\n        <div class="metric-card">\n            <div class="metric-value ${e.total_return>=0?"positive":"negative"}">\n                ${(100*e.total_return).toFixed(2)}%\n            </div>\n            <div class="metric-label">æ€»æ”¶ç›Š</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${e.sharpe_ratio.toFixed(2)}</div>\n            <div class="metric-label">å¤æ™®æ¯”ç‡</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value negative">${(100*e.max_drawdown).toFixed(2)}%</div>\n            <div class="metric-label">æœ€å¤§å›æ’¤</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${(100*e.win_rate).toFixed(1)}%</div>\n            <div class="metric-label">èƒœç‡</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${e.trade_count}</div>\n            <div class="metric-label">äº¤æ˜“æ¬¡æ•°</div>\n        </div>\n        <div class="metric-card">\n            <div class="metric-value">${e.profit_loss_ratio.toFixed(2)}</div>\n            <div class="metric-label">ç›ˆäºæ¯”</div>\n        </div>\n    </div>\n\n    <div class="section">\n        <div class="section-title">ğŸ” è¯Šæ–­ç»“æœ</div>\n        ${n.diagnosis.map(e=>`<div class="diagnosis-item">${e}</div>`).join("")}\n    </div>\n\n    <div class="section">\n        <div class="section-title">ğŸ’¡ ä¼˜åŒ–å»ºè®®</div>\n        ${n.suggestions.map(e=>`<div class="suggestion-item">${e}</div>`).join("")}\n    </div>\n\n    <div class="actions">\n        <button class="btn btn-primary" onclick="optimizeStrategy()">\n            ğŸš€ ç”Ÿæˆä¼˜åŒ–ç­–ç•¥\n        </button>\n        <button class="btn btn-secondary" onclick="copyReport()">\n            ğŸ“‹ å¤åˆ¶æŠ¥å‘Š\n        </button>\n    </div>\n\n    <div class="timestamp">\n        ç”Ÿæˆæ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n    </div>\n\n    <script>\n        const vscode = acquireVsCodeApi();\n        \n        function copyReport() {\n            vscode.postMessage({ command: 'copyReport' });\n        }\n        \n        function optimizeStrategy() {\n            vscode.postMessage({ command: 'optimizeStrategy' });\n        }\n    <\/script>\n</body>\n</html>`}(n,t),a.webview.onDidReceiveMessage(async e=>{switch(e.command){case"copyReport":const e=function(e,n){return`# å›æµ‹åˆ†ææŠ¥å‘Š\n\n## ç»¼åˆè¯„åˆ†: ${u(e)}/100\n\n## å…³é”®æŒ‡æ ‡\n- æ€»æ”¶ç›Š: ${(100*e.total_return).toFixed(2)}%\n- å¤æ™®æ¯”ç‡: ${e.sharpe_ratio.toFixed(2)}\n- æœ€å¤§å›æ’¤: ${(100*e.max_drawdown).toFixed(2)}%\n- èƒœç‡: ${(100*e.win_rate).toFixed(1)}%\n- äº¤æ˜“æ¬¡æ•°: ${e.trade_count}\n- ç›ˆäºæ¯”: ${e.profit_loss_ratio.toFixed(2)}\n\n## è¯Šæ–­ç»“æœ\n${n.diagnosis.map(e=>`- ${e}`).join("\n")}\n\n## ä¼˜åŒ–å»ºè®®\n${n.suggestions.map(e=>`- ${e}`).join("\n")}\n\n---\nç”Ÿæˆæ—¶é—´: ${(new Date).toLocaleString("zh-CN")}\n`}(n,t);await i.env.clipboard.writeText(e),i.window.showInformationMessage("æŠ¥å‘Šå·²å¤åˆ¶åˆ°å‰ªè´´æ¿");break;case"optimizeStrategy":i.commands.executeCommand("trquant.generateStrategy")}},void 0,e.subscriptions)}},902:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.OptimizationAdvisor=void 0,n.createOptimizationAdvisor=function(e){return new r(e)};const a=t(628);class r{knowledgeStore=null;constructor(e){this.knowledgeStore=e||null}setKnowledgeStore(e){this.knowledgeStore=e}generateReport(e){a.logger.info(`ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š: ${e.name}`,"OptimizationAdvisor");const n=[];n.push(...this.generateRiskAdvices(e)),n.push(...this.generateFactorAdvices(e)),n.push(...this.generateSelectionAdvices(e)),n.push(...this.generateCodeAdvices(e)),this.knowledgeStore&&n.push(...this.getKnowledgeBasedAdvices(e));const t=this.calculateScores(e,n),r=this.generateSummary(e,t,n);return{strategyName:e.name,platform:e.platform,analysisTime:(new Date).toISOString(),overallScore:t.overall,scoreBreakdown:{risk:t.risk,factor:t.factor,selection:t.selection,code:t.code},advices:n.sort((e,n)=>{const t={high:0,medium:1,low:2};return t[e.priority]-t[n.priority]}),summary:r}}generateRiskAdvices(e){const n=[],t=e.riskControl;return t.stopLoss?t.stopLoss>.15&&n.push({id:"risk_stop_loss_tight",category:"risk",priority:"medium",title:"æ”¶ç´§æ­¢æŸçº¿",description:`å½“å‰æ­¢æŸçº¿ ${(100*t.stopLoss).toFixed(0)}% è¿‡äºå®½æ¾`,currentState:`${(100*t.stopLoss).toFixed(0)}%`,suggestedState:"8-12%",impact:"å‡å°‘å•æ¬¡äº¤æ˜“æŸå¤±"}):n.push({id:"risk_stop_loss",category:"risk",priority:"high",title:"æ·»åŠ æ­¢æŸæœºåˆ¶",description:"ç­–ç•¥ç¼ºå°‘æ­¢æŸè®¾ç½®ï¼Œåœ¨å¸‚åœºå¤§å¹…ä¸‹è·Œæ—¶å¯èƒ½é€ æˆé‡å¤§æŸå¤±",suggestedState:"æ­¢æŸçº¿ 8%",codeExample:"# æ­¢æŸè®¾ç½®\nSTOP_LOSS = 0.08  # 8%æ­¢æŸ\n\ndef check_stop_loss(context, stock):\n    cost = context.portfolio.positions[stock].avg_cost\n    price = context.portfolio.positions[stock].price\n    if (cost - price) / cost >= STOP_LOSS:\n        order_target(stock, 0)\n        log.info(f'{stock} è§¦å‘æ­¢æŸ')",impact:"æ˜¾è‘—é™ä½æœ€å¤§å›æ’¤",source:"Aè‚¡å®æ“æ‰‹å†Œ-é£æ§ç¯‡"}),t.takeProfit||n.push({id:"risk_take_profit",category:"risk",priority:"medium",title:"æ·»åŠ æ­¢ç›ˆæœºåˆ¶",description:"å»ºè®®è®¾ç½®åŠ¨æ€æ­¢ç›ˆï¼Œé”å®šåˆ©æ¶¦",suggestedState:"æ­¢ç›ˆçº¿ 20-30%",codeExample:"# æ­¢ç›ˆè®¾ç½®\nTAKE_PROFIT = 0.20  # 20%æ­¢ç›ˆ\n\ndef check_take_profit(context, stock):\n    cost = context.portfolio.positions[stock].avg_cost\n    price = context.portfolio.positions[stock].price\n    if (price - cost) / cost >= TAKE_PROFIT:\n        order_target(stock, 0)\n        log.info(f'{stock} è§¦å‘æ­¢ç›ˆ')",impact:"é”å®šæ”¶ç›Šï¼Œé¿å…åˆ©æ¶¦å›å"}),t.maxPosition||n.push({id:"risk_position",category:"risk",priority:"medium",title:"è®¾ç½®ä»“ä½ä¸Šé™",description:"å»ºè®®è®¾ç½®æœ€å¤§ä»“ä½æ§åˆ¶ï¼Œä¿ç•™ç°é‡‘åº”å¯¹é£é™©",suggestedState:"æœ€å¤§ä»“ä½ 80%",codeExample:"MAX_POSITION = 0.8  # æœ€å¤§ä»“ä½80%",impact:"ä¿ç•™æµåŠ¨æ€§ï¼Œä¾¿äºæŠ„åº•"}),t.hasDrawdownControl||n.push({id:"risk_drawdown",category:"risk",priority:"low",title:"æ·»åŠ å›æ’¤æ§åˆ¶",description:"å»ºè®®ç›‘æ§ç»„åˆå›æ’¤ï¼Œè§¦å‘é˜ˆå€¼æ—¶é™ä½ä»“ä½",suggestedState:"å›æ’¤è¶…15%å‡ä»“50%",impact:"æ§åˆ¶ç»„åˆçº§åˆ«é£é™©"}),n}generateFactorAdvices(e){const n=[],t=e.factors;0===t.length?n.push({id:"factor_missing",category:"factor",priority:"high",title:"æ·»åŠ é‡åŒ–å› å­",description:"ç­–ç•¥ç¼ºå°‘æ˜ç¡®çš„é‡åŒ–å› å­ï¼Œå»ºè®®ä½¿ç”¨å› å­é€‰è‚¡",suggestedState:"å¤šå› å­ç»„åˆ",codeExample:"# æ¨èå› å­ç»„åˆ\nfactors = {\n    'momentum': 0.3,    # åŠ¨é‡å› å­\n    'value': 0.3,       # ä»·å€¼å› å­\n    'quality': 0.2,     # è´¨é‡å› å­\n    'volatility': 0.2,  # ä½æ³¢å› å­\n}",impact:"æé«˜é€‰è‚¡çš„ç§‘å­¦æ€§å’Œç¨³å®šæ€§",source:"Aè‚¡å®æ“æ‰‹å†Œ-å› å­ç¯‡"}):1===t.length&&n.push({id:"factor_single",category:"factor",priority:"medium",title:"å¢åŠ å› å­å¤šæ ·æ€§",description:`å½“å‰ä»…ä½¿ç”¨ ${t[0].name}ï¼Œå»ºè®®ç»„åˆå¤šå› å­`,currentState:t[0].name,suggestedState:"3-5ä¸ªä½ç›¸å…³å› å­",impact:"é™ä½å•å› å­å¤±æ•ˆé£é™©ï¼Œæé«˜ç¨³å®šæ€§"});const a={};for(const e of t)a[e.type]=(a[e.type]||0)+1;return t.length>=2&&1===Object.keys(a).length&&n.push({id:"factor_diversity",category:"factor",priority:"medium",title:"å¢åŠ å› å­ç±»å‹å¤šæ ·æ€§",description:"å½“å‰å› å­ç±»å‹å•ä¸€ï¼Œå»ºè®®æ··åˆä¸åŒç±»å‹å› å­",currentState:`å…¨éƒ¨ä¸º${t[0].type}ç±»å‹`,suggestedState:"åŠ¨é‡+ä»·å€¼+è´¨é‡ç»„åˆ",impact:"å› å­äº’è¡¥ï¼Œé€‚åº”ä¸åŒå¸‚åœºç¯å¢ƒ"}),n}generateSelectionAdvices(e){const n=[],t=e.stockSelection;return"æœªçŸ¥"!==t.universe&&"å…¨å¸‚åœº"!==t.universe||n.push({id:"selection_universe",category:"selection",priority:"medium",title:"ç¼©å°è‚¡ç¥¨æ± èŒƒå›´",description:"å…¨å¸‚åœºé€‰è‚¡å¯èƒ½åŒ…å«æµåŠ¨æ€§å·®çš„è‚¡ç¥¨",suggestedState:"æ²ªæ·±300/ä¸­è¯500æˆåˆ†è‚¡",impact:"æé«˜æµåŠ¨æ€§ï¼Œé™ä½å†²å‡»æˆæœ¬"}),t.topN&&t.topN>30?n.push({id:"selection_topn_reduce",category:"selection",priority:"low",title:"å‡å°‘æŒè‚¡æ•°é‡",description:`å½“å‰æŒè‚¡${t.topN}åªï¼Œå¯èƒ½è¿‡äºåˆ†æ•£`,currentState:`${t.topN}åª`,suggestedState:"10-20åª",impact:"æé«˜é€‰è‚¡é›†ä¸­åº¦å’Œæ”¶ç›Šå¼¹æ€§"}):t.topN&&t.topN<5&&n.push({id:"selection_topn_increase",category:"selection",priority:"high",title:"å¢åŠ æŒè‚¡æ•°é‡",description:`å½“å‰æŒè‚¡${t.topN}åªï¼Œé£é™©è¿‡äºé›†ä¸­`,currentState:`${t.topN}åª`,suggestedState:"5-10åª",impact:"åˆ†æ•£é£é™©ï¼Œé™ä½æ³¢åŠ¨"}),t.filters.includes("æ’é™¤ST")||n.push({id:"selection_filter_st",category:"selection",priority:"medium",title:"æ’é™¤STè‚¡ç¥¨",description:"å»ºè®®è¿‡æ»¤ST/*STè‚¡ç¥¨ï¼Œé¿å…é€€å¸‚é£é™©",codeExample:"# æ’é™¤STè‚¡ç¥¨\nstocks = [s for s in stocks if not get_extras('is_st', s)]",impact:"é™ä½è¸©é›·é£é™©"}),n}generateCodeAdvices(e){const n=[];for(const t of e.issues)"code"===t.category&&n.push({id:`code_${t.message.replace(/\s+/g,"_").toLowerCase()}`,category:"code",priority:"error"===t.type?"high":"low",title:t.message,description:t.suggestion||"",impact:"ä»£ç è§„èŒƒæ€§"});return n}getKnowledgeBasedAdvices(e){if(!this.knowledgeStore)return[];const n=[],t=this.knowledgeStore.getBestPractices();for(const a of t.slice(0,5))this.checkPracticeApplied(a,e)||n.push({id:`kb_${a.id}`,category:this.mapPracticeCategory(a.category),priority:"medium",title:a.title,description:a.description,codeExample:a.example,source:a.references?.[0]||"çŸ¥è¯†åº“",impact:"æ¥è‡ªå®æ“ç»éªŒçš„ä¼˜åŒ–å»ºè®®"});return n}checkPracticeApplied(e,n){const t=e.description.toLowerCase();return!(!t.includes("æ­¢æŸ")||!n.riskControl.stopLoss)||!(!t.includes("æ­¢ç›ˆ")||!n.riskControl.takeProfit)||!!(t.includes("å¤šå› å­")&&n.factors.length>=3)}mapPracticeCategory(e){return{risk:"risk",selection:"selection",trading:"performance",position:"risk"}[e]||"performance"}calculateScores(e,n){let t=70,a=70,r=70,o=80;e.riskControl.stopLoss&&(t+=10),e.riskControl.takeProfit&&(t+=5),e.riskControl.maxPosition&&(t+=5),e.riskControl.hasDrawdownControl&&(t+=10),a+=Math.min(10*e.factors.length,30),e.stockSelection.topN&&e.stockSelection.topN>=5&&e.stockSelection.topN<=20&&(r+=10),r+=5*e.stockSelection.filters.length;const s=e.issues.filter(e=>"code"===e.category);o-=20*s.filter(e=>"error"===e.type).length,o-=5*s.filter(e=>"warning"===e.type).length;const i=5*n.filter(e=>"high"===e.priority).length;return{risk:Math.max(0,Math.min(100,t-i)),factor:Math.max(0,Math.min(100,a-i)),selection:Math.max(0,Math.min(100,r-i)),code:Math.max(0,Math.min(100,o)),overall:Math.round((t+a+r+o)/4-i)}}generateSummary(e,n,t){const a=t.filter(e=>"high"===e.priority),r=t.filter(e=>"medium"===e.priority);let o=`ç­–ç•¥ "${e.name}" æ•´ä½“è¯„åˆ† ${n.overall}/100ã€‚`;if(a.length>0){o+=`\n\nğŸ”´ å‘ç° ${a.length} ä¸ªé«˜ä¼˜å…ˆçº§é—®é¢˜éœ€è¦ä¼˜å…ˆå¤„ç†ï¼š`;for(const e of a.slice(0,3))o+=`\n  â€¢ ${e.title}`}r.length>0&&(o+=`\n\nğŸŸ¡ å‘ç° ${r.length} ä¸ªä¸­ç­‰ä¼˜å…ˆçº§ä¼˜åŒ–å»ºè®®ã€‚`);const s=[];return e.riskControl.stopLoss&&e.riskControl.takeProfit&&s.push("é£æ§å®Œå–„"),e.factors.length>=3&&s.push("å¤šå› å­é€‰è‚¡"),e.trading.hasTimingLogic&&s.push("åŒ…å«æ‹©æ—¶é€»è¾‘"),s.length>0&&(o+=`\n\nâœ… ç­–ç•¥äº®ç‚¹ï¼š${s.join("ã€")}`),o}}n.OptimizationAdvisor=r},928:e=>{e.exports=require("path")},974:function(e,n,t){var a,r=this&&this.__createBinding||(Object.create?function(e,n,t,a){void 0===a&&(a=t);var r=Object.getOwnPropertyDescriptor(n,t);r&&!("get"in r?!n.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,a,r)}:function(e,n,t,a){void 0===a&&(a=t),e[a]=n[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var n=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[n.length]=t);return n},a(e)},function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t=a(e),s=0;s<t.length;s++)"default"!==t[s]&&r(n,e,t[s]);return o(n,e),n});Object.defineProperty(n,"__esModule",{value:!0}),n.DeveloperProvider=void 0,n.registerDeveloperProvider=function(e){const n=new m(e),t=i.window.createTreeView("trquant-developer",{treeDataProvider:n,showCollapseAll:!1});e.subscriptions.push(t);const a=i.commands.registerCommand("trquant.refreshDeveloper",()=>{n.refresh()});e.subscriptions.push(a),p.logger.info("å¼€å‘è€…åŠŸèƒ½åŒºå·²æ³¨å†Œ",g)},n.localBackup=async function(e){const n=i.workspace.workspaceFolders?.[0];if(!n)return void i.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const t=n.uri.fsPath,a=["node_modules",".git",".backups","venv","__pycache__",".pytest_cache",".vscode",".cursor","*.pyc","*.pyo","*.log","dist","build","*.vsix"];try{await i.window.withProgress({location:i.ProgressLocation.Notification,title:"ğŸ’¾ æœ¬åœ°å¤‡ä»½",cancellable:!1},async e=>{const n=c.join(t,".backups");l.existsSync(n)||l.mkdirSync(n,{recursive:!0});const r=`backup-${(new Date).toISOString().replace(/[:.]/g,"-")}`,o=c.join(n,r);e.report({increment:0,message:"æ­£åœ¨åˆ›å»ºå¤‡ä»½ç›®å½•..."}),l.existsSync(o)||l.mkdirSync(o,{recursive:!0});const s={timestamp:(new Date).toISOString(),projectRoot:t,backupPath:o};l.writeFileSync(c.join(o,"backup-info.json"),JSON.stringify(s,null,2),"utf-8"),e.report({increment:10,message:"æ­£åœ¨å¤åˆ¶æ–‡ä»¶..."}),await async function(e,n,t){const a=e=>t.some(n=>n.includes("*")?new RegExp("^"+n.replace(/\*/g,".*")+"$").test(e):e===n||e.includes(n)),r=async(e,t)=>{const o=l.readdirSync(e,{withFileTypes:!0});for(const s of o){const o=c.join(e,s.name),i=c.join(t,s.name);a(s.name)||o===n||o.startsWith(n+c.sep)||(s.isDirectory()?(l.mkdirSync(i,{recursive:!0}),await r(o,i)):s.isFile()&&l.copyFileSync(o,i))}};await r(e,n)}(t,o,a),e.report({increment:100,message:"å¤‡ä»½å®Œæˆï¼"}),i.window.showInformationMessage(`âœ… æœ¬åœ°å¤‡ä»½å®Œæˆï¼\nå¤‡ä»½ä½ç½®: ${o}`,{modal:!1}),p.logger.info("æœ¬åœ°å¤‡ä»½å®Œæˆ",g,{backupPath:o})})}catch(e){const n=e instanceof Error?e.message:String(e);p.logger.error(`æœ¬åœ°å¤‡ä»½å¤±è´¥: ${n}`,g),i.window.showErrorMessage(`æœ¬åœ°å¤‡ä»½å¤±è´¥: ${n}`)}},n.gitCommit=async function(e){const n=i.workspace.workspaceFolders?.[0];if(!n)return void i.window.showWarningMessage("è¯·å…ˆæ‰“å¼€ä¸€ä¸ªå·¥ä½œåŒº");const t=n.uri.fsPath,a=c.join(t,".git");if(!l.existsSync(a)){if("æ˜¯"!==await i.window.showWarningMessage("å½“å‰ç›®å½•ä¸æ˜¯Gitä»“åº“ï¼Œæ˜¯å¦åˆå§‹åŒ–Gitä»“åº“ï¼Ÿ","æ˜¯","å¦"))return;try{await f("git",["init"],t),i.window.showInformationMessage("âœ… Gitä»“åº“åˆå§‹åŒ–æˆåŠŸ")}catch(e){return void i.window.showErrorMessage(`Gitåˆå§‹åŒ–å¤±è´¥: ${e}`)}}const r=(new Date).toISOString().slice(0,19).replace("T"," "),o=await i.window.showInputBox({prompt:"è¯·è¾“å…¥æäº¤æ¶ˆæ¯",placeHolder:"ä¾‹å¦‚: feat: æ·»åŠ æ–°åŠŸèƒ½",value:`backup: ${r}`});if(o)try{await i.window.withProgress({location:i.ProgressLocation.Notification,title:"ğŸ“ Git Commit",cancellable:!1},async e=>{e.report({increment:0,message:"æ­£åœ¨æ‰§è¡Œ git add..."}),await f("git",["add","-A"],t),p.logger.info("Git add å®Œæˆ",g),e.report({increment:50,message:"æ­£åœ¨æ‰§è¡Œ git commit..."}),await f("git",["commit","-m",o],t),p.logger.info("Git commit å®Œæˆ",g),e.report({increment:100,message:"æäº¤å®Œæˆï¼"}),i.window.showInformationMessage(`âœ… Git Commit å®Œæˆï¼\næäº¤æ¶ˆæ¯: ${o}`,{modal:!1}),p.logger.info("Git Commit å®Œæˆ",g,{commitMessage:o})})}catch(e){const n=e instanceof Error?e.message:String(e);p.logger.error(`Git Commit å¤±è´¥: ${n}`,g),i.window.showErrorMessage(`Git Commit å¤±è´¥: ${n}`)}},n.refreshSystem=async function(e){const n=e.extensionPath;let t=n;const a=c.join(n,"package.json");if(!l.existsSync(a)){const e=c.resolve(n,"../../.."),a=c.join(e,"extension","package.json");if(!l.existsSync(a))return void i.window.showErrorMessage("æ— æ³•æ‰¾åˆ°æ‰©å±•å¼€å‘ç›®å½•ã€‚è¯·åœ¨å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚");t=c.join(e,"extension")}const r=c.join(t,"package.json");if(l.existsSync(r))try{await i.window.withProgress({location:i.ProgressLocation.Notification,title:"ğŸ”„ åˆ·æ–°ç³»ç»Ÿ",cancellable:!1},async e=>{e.report({increment:0,message:"æ­£åœ¨æ£€æŸ¥ä¾èµ–..."}),p.logger.info("å¼€å§‹åˆ·æ–°ç³»ç»Ÿ",g,{extensionDir:t});try{const n=c.join(t,"node_modules");l.existsSync(n)?p.logger.info("ä¾èµ–å·²å­˜åœ¨ï¼Œè·³è¿‡å®‰è£…",g):(e.report({increment:5,message:"æ­£åœ¨å®‰è£…ä¾èµ–..."}),await h("npm install",t),p.logger.info("ä¾èµ–å®‰è£…å®Œæˆ",g))}catch(e){const n=e instanceof Error?e.message:String(e);p.logger.warn(`ä¾èµ–æ£€æŸ¥/å®‰è£…å¤±è´¥ï¼Œç»§ç»­å°è¯•ç¼–è¯‘: ${n}`,g)}e.report({increment:20,message:"æ­£åœ¨ç¼–è¯‘TypeScript..."});try{try{await h("npm --version",t)}catch(e){throw new Error("npm ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿å·²å®‰è£… Node.js å’Œ npm")}p.logger.info(`å¼€å§‹ç¼–è¯‘ï¼Œå·¥ä½œç›®å½•: ${t}`,g),await h("npm run compile",t),e.report({increment:40,message:"ç¼–è¯‘å®Œæˆï¼Œæ­£åœ¨æ‰“åŒ…æ‰©å±•..."}),p.logger.info("TypeScriptç¼–è¯‘å®Œæˆ",g)}catch(e){const n=e instanceof Error?e.message:String(e);throw p.logger.error(`ç¼–è¯‘å¤±è´¥: ${n}`,g,{extensionDir:t}),new Error(`ç¼–è¯‘å¤±è´¥: ${n}`)}e.report({increment:60,message:"æ­£åœ¨æ‰“åŒ…æ‰©å±•..."});try{await h("npx @vscode/vsce package --allow-missing-repository --no-dependencies",t),e.report({increment:80,message:"æ‰“åŒ…å®Œæˆï¼Œæ­£åœ¨å®‰è£…æ‰©å±•..."}),p.logger.info("æ‰©å±•æ‰“åŒ…å®Œæˆ",g)}catch(e){const n=e instanceof Error?e.message:String(e);throw new Error(`æ‰“åŒ…å¤±è´¥: ${n}`)}e.report({increment:90,message:"æ­£åœ¨å®‰è£…æ‰©å±•..."});try{const n=l.readdirSync(t).filter(e=>e.endsWith(".vsix")).sort().reverse();if(0===n.length)throw new Error("æœªæ‰¾åˆ°.vsixæ–‡ä»¶");const a=c.join(t,n[0]);await h(`cursor --install-extension "${a}" --force`,t),e.report({increment:100,message:"å®‰è£…å®Œæˆï¼Œå³å°†é‡æ–°åŠ è½½çª—å£..."}),p.logger.info("æ‰©å±•å®‰è£…å®Œæˆ",g)}catch(e){const n=e instanceof Error?e.message:String(e);throw new Error(`å®‰è£…å¤±è´¥: ${n}`)}}),i.window.showInformationMessage("âœ… ç³»ç»Ÿåˆ·æ–°å®Œæˆï¼çª—å£å³å°†é‡æ–°åŠ è½½...",{modal:!1}),setTimeout(()=>{i.commands.executeCommand("workbench.action.reloadWindow")},1e3)}catch(e){const n=e instanceof Error?e.message:String(e);p.logger.error(`åˆ·æ–°ç³»ç»Ÿå¤±è´¥: ${n}`,g),i.window.showErrorMessage(`åˆ·æ–°ç³»ç»Ÿå¤±è´¥: ${n}`)}else i.window.showErrorMessage("æœªæ‰¾åˆ° package.json")};const i=s(t(398)),c=s(t(928)),l=s(t(896)),d=s(t(317)),p=t(628),g="DeveloperProvider";class u extends i.TreeItem{label;collapsibleState;command;icon;constructor(e,n,t,a){super(e,n),this.label=e,this.collapsibleState=n,this.command=t,this.icon=a,this.tooltip=e,this.contextValue=this.getContextValue(),a&&(this.iconPath=new i.ThemeIcon(a))}getContextValue(){return this.label.includes("æœ¬åœ°å¤‡ä»½")?"localBackup":this.label.includes("Git Commit")?"gitCommit":this.label.includes("åˆ·æ–°")?"refresh":""}}class m{context;_onDidChangeTreeData=new i.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;constructor(e){this.context=e}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}getChildren(e){return e?Promise.resolve([]):Promise.resolve([new u("ğŸ’¾ æœ¬åœ°å¤‡ä»½",i.TreeItemCollapsibleState.None,{command:"trquant.localBackup",title:"æœ¬åœ°å¤‡ä»½",arguments:[]},"save"),new u("ğŸ“ Git Commit",i.TreeItemCollapsibleState.None,{command:"trquant.gitCommit",title:"Git Commit",arguments:[]},"git-commit"),new u("ğŸ”„ åˆ·æ–°ç³»ç»Ÿ",i.TreeItemCollapsibleState.None,{command:"trquant.refreshSystem",title:"åˆ·æ–°ç³»ç»Ÿ",arguments:[]},"sync")])}}function f(e,n,t){return new Promise((a,r)=>{const o=d.spawn(e,n,{cwd:t,shell:!1,stdio:["ignore","pipe","pipe"]});let s="",i="";o.stdout?.on("data",e=>{s+=e.toString()}),o.stderr?.on("data",e=>{i+=e.toString()}),o.on("close",e=>{0===e?a(s):r(new Error(`å‘½ä»¤æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : ${e}): ${i||s}`))}),o.on("error",e=>{r(new Error(`å‘½ä»¤æ‰§è¡Œé”™è¯¯: ${e.message}`))})})}function h(e,n){return new Promise((t,a)=>{const r={...process.env,PATH:process.env.PATH||"/usr/local/bin:/usr/bin:/bin",HOME:process.env.HOME||process.env.USERPROFILE};p.logger.info(`æ‰§è¡Œå‘½ä»¤: ${e}`,g,{cwd:n});const o=e.split(/\s+/),s=o[0],i=o.slice(1),c=d.spawn(s,i,{cwd:n,env:r,shell:!0,stdio:["ignore","pipe","pipe"]});let l="",u="";c.stdout?.on("data",e=>{const n=e.toString();l+=n,n.length<200&&p.logger.info(`å‘½ä»¤è¾“å‡º: ${n.trim()}`,g)}),c.stderr?.on("data",e=>{const n=e.toString();u+=n,n.length<200&&p.logger.warn(`å‘½ä»¤è­¦å‘Š: ${n.trim()}`,g)}),c.on("close",r=>{if(0===r)p.logger.info("å‘½ä»¤æ‰§è¡ŒæˆåŠŸ",g,{command:e}),t(l);else{const t=u||l||`é€€å‡ºç : ${r}`;p.logger.error(`å‘½ä»¤æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : ${r})`,g,{command:e,cwd:n,stderr:u.substring(0,500),stdout:l.substring(0,500)}),a(new Error(`å‘½ä»¤æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : ${r}): ${t.substring(0,500)}`))}}),c.on("error",t=>{p.logger.error(`å‘½ä»¤æ‰§è¡Œé”™è¯¯: ${t.message}`,g,{command:e,cwd:n}),a(new Error(`å‘½ä»¤æ‰§è¡Œé”™è¯¯: ${t.message}`))})})}n.DeveloperProvider=m}},n={},t=function t(a){var r=n[a];if(void 0!==r)return r.exports;var o=n[a]={exports:{}};return e[a].call(o.exports,o,o.exports,t),o.exports}(265);module.exports=t})();
//# sourceMappingURL=extension.js.map